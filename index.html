<!DOCTYPE html>
<html lang="es-CR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRTE MEP - Sistema Integral de Agenda y Evidencias</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            --mep-azul-principal: #0056a6;
            --mep-azul-secundario: #0072ce;
            --mep-verde: #00a859;
            --mep-naranja: #f26522;
            --mep-gris-institucional: #4a5c7a;
            --mep-blanco-hueso: #f8f9fa;
            --color-fondo: #f0f5ff;
            --color-fondo-tarjeta: rgba(255, 255, 255, 0.85);
            --color-texto: #1a365d;
            --color-texto-secundario: #4a5568;
            --color-borde: rgba(0, 86, 166, 0.15);
            --sombra-suave: 0 8px 32px rgba(0, 86, 166, 0.08);
            --sombra-fuerte: 0 12px 40px rgba(0, 0, 0, 0.1);
            --gradiente-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.5) 100%);
            --gradiente-primario: linear-gradient(135deg, var(--mep-azul-principal) 0%, #003a75 100%);
            --radio-borde: 18px;
        }
        [data-tema="oscuro"] {
            --color-fondo: #0f172a;
            --color-fondo-tarjeta: rgba(30, 41, 59, 0.85);
            --color-texto: #e2e8f0;
            --color-texto-secundario: #94a3b8;
            --color-borde: rgba(148, 163, 184, 0.2);
            --sombra-suave: 0 8px 32px rgba(0, 0, 0, 0.3);
            --sombra-fuerte: 0 12px 40px rgba(0, 0, 0, 0.4);
            --gradiente-glass: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.6) 100%);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        body {
            background: var(--color-fondo);
            color: var(--color-texto);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.4s ease, color 0.4s ease;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(0, 86, 166, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 168, 89, 0.05) 0%, transparent 50%);
            z-index: -1;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* ===== HEADER Y NAVEGACIN ===== */
        .header-sistema {
            background: var(--gradiente-glass);
            backdrop-filter: blur(12px);
            border-radius: var(--radio-borde);
            padding: 25px 40px;
            margin-bottom: 25px;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
        }
        .logo-mep {
            display: flex;
            align-items: center;
            gap: 22px;
        }
        .logo-mep i {
            font-size: 3.2rem;
            background: var(--gradiente-primario);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .titulo-sistema h1 {
            color: var(--mep-azul-principal);
            font-size: 2rem;
            margin-bottom: 5px;
            font-weight: 700;
        }
        .titulo-sistema p {
            color: var(--color-texto-secundario);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-usuario-fecha {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        .fecha-actual-cr {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--mep-azul-principal);
            background: var(--color-fondo-tarjeta);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .control-tema {
            position: absolute;
            top: 25px;
            right: 25px;
            background: var(--color-fondo-tarjeta);
            border: 1px solid var(--color-borde);
            border-radius: 50px;
            padding: 8px;
            cursor: pointer;
            z-index: 10;
            box-shadow: var(--sombra-suave);
        }
        
        /* Navegaci贸n */
        .nav-principal {
            background: var(--gradiente-glass);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            overflow: hidden;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
        }
        .nav-btn {
            flex: 1;
            padding: 20px 10px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--color-texto-secundario);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.4s;
            position: relative;
        }
        .nav-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 4px;
            background: var(--mep-azul-principal);
            transition: width 0.4s ease;
        }
        .nav-btn:hover {
            color: var(--mep-azul-principal);
            background: rgba(0, 86, 166, 0.05);
        }
        .nav-btn.activo {
            color: var(--mep-azul-principal);
            background: rgba(255, 255, 255, 0.5);
        }
        .nav-btn.activo::before {
            width: 80%;
        }
        
        /* ===== CONTENIDO ===== */
        .seccion-contenido {
            display: none;
            background: var(--gradiente-glass);
            backdrop-filter: blur(15px);
            border-radius: var(--radio-borde);
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
            animation: aparecer 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes aparecer {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .seccion-contenido.visible {
            display: block;
        }
        .titulo-seccion {
            color: var(--mep-azul-principal);
            margin-bottom: 30px;
            padding-bottom: 18px;
            border-bottom: 2px solid var(--color-borde);
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            font-size: 1.8rem;
        }
        
        /* ===== DASHBOARD ===== */
        .panel-estadisticas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 22px;
            margin-bottom: 35px;
        }
        .tarjeta-estadistica {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 28px;
            text-align: center;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
            transition: all 0.3s ease;
        }
        .tarjeta-estadistica:hover {
            transform: translateY(-8px);
            box-shadow: var(--sombra-fuerte);
        }
        .valor-estadistica {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--mep-azul-principal);
            line-height: 1;
            margin: 12px 0;
        }
        
        /* ===== CALENDARIO ===== */
        .contenedor-calendario {
            background: var(--gradiente-glass);
            backdrop-filter: blur(12px);
            border-radius: var(--radio-borde);
            padding: 30px;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
            margin-bottom: 30px;
        }
        .encabezado-calendario {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .mes-anio-actual {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--mep-azul-principal);
            min-width: 280px;
        }
        .btn-control-mes {
            background: var(--color-fondo-tarjeta);
            border: 1px solid var(--color-borde);
            color: var(--color-texto);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-hoy {
            background: var(--mep-naranja);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        .cuadricula-dias-semana {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }
        .cuadricula-mes {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        .celda-dia {
            aspect-ratio: 1 / 1;
            background: var(--color-fondo-tarjeta);
            border: 2px solid var(--color-borde);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding-top: 15px;
        }
        .celda-dia:hover {
            border-color: var(--mep-azul-principal);
            background: rgba(0, 86, 166, 0.08);
            transform: translateY(-5px);
        }
        .celda-dia.hoy {
            background: linear-gradient(135deg, #e6f2ff, #cce5ff);
            border-color: var(--mep-azul-principal);
            color: var(--mep-azul-principal);
            font-weight: 800;
        }
        .numero-dia {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .indicadores-actividad {
            position: absolute;
            bottom: 10px;
            display: flex;
            gap: 4px;
        }
        .punto-actividad {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .punto-tarea { background-color: var(--mep-verde); }
        .punto-bitacora { background-color: var(--mep-naranja); }
        .punto-archivo { background-color: var(--mep-azul-secundario); }
        
        /* ===== BITCORA ===== */
        .formulario-bitacora {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        .grupo-form {
            margin-bottom: 20px;
        }
        .etiqueta {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--color-texto);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .entrada, .area-texto, .seleccion {
            width: 100%;
            padding: 16px 20px;
            background: var(--color-fondo-tarjeta);
            border: 2px solid var(--color-borde);
            border-radius: 14px;
            font-size: 1rem;
            color: var(--color-texto);
            transition: all 0.3s;
        }
        .entrada:focus, .area-texto:focus, .seleccion:focus {
            outline: none;
            border-color: var(--mep-azul-principal);
            box-shadow: 0 0 0 4px rgba(0, 86, 166, 0.15);
        }
        .area-texto {
            min-height: 220px;
            resize: vertical;
            line-height: 1.6;
        }
        
        /* ===== ARCHIVOS ===== */
        .zona-subida {
            border: 3px dashed var(--color-borde);
            border-radius: 20px;
            padding: 60px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s;
            background: rgba(255, 255, 255, 0.3);
            margin: 30px 0;
        }
        .zona-subida.drag-over {
            border-color: var(--mep-verde);
            background: rgba(0, 168, 89, 0.08);
        }
        .vista-previa-archivos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .tarjeta-archivo {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px;
            border: 1px solid var(--color-borde);
            transition: all 0.4s;
            text-align: center;
            box-shadow: var(--sombra-suave);
            position: relative;
        }
        .tarjeta-archivo:hover {
            transform: translateY(-10px);
            box-shadow: var(--sombra-fuerte);
            border-color: var(--mep-azul-principal);
        }
        .icono-archivo {
            font-size: 3.2rem;
            margin-bottom: 20px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nombre-archivo {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--color-texto);
            word-break: break-word;
        }
        .detalles-archivo {
            font-size: 0.85rem;
            color: var(--color-texto-secundario);
            margin-bottom: 20px;
        }
        .acciones-archivo {
            display: flex;
            justify-content: center;
            gap: 12px;
        }
        .btn-accion-archivo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--color-fondo-tarjeta);
            color: var(--color-texto);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 1px solid var(--color-borde);
        }
        .btn-accion-archivo:hover {
            background: var(--mep-azul-principal);
            color: white;
            transform: scale(1.1);
        }
        .pdf { color: #e53e3e; }
        .word { color: #2b579a; }
        .excel { color: #217346; }
        .powerpoint { color: #d24726; }
        .imagen { color: #38a169; }
        .otro { color: #718096; }
        
        /* ===== TAREAS ===== */
        .contenedor-tareas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }
        .lista-tareas {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
            max-height: 600px;
            overflow-y: auto;
        }
        .tarea-item {
            background: var(--color-fondo-tarjeta);
            border-radius: 14px;
            padding: 22px;
            margin-bottom: 18px;
            border-left: 5px solid var(--mep-verde);
            border: 1px solid var(--color-borde);
            transition: all 0.3s;
        }
        .tarea-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        .tarea-item.pendiente { border-left-color: var(--mep-naranja); }
        .tarea-item.completada { border-left-color: #a0aec0; opacity: 0.8; }
        .tarea-titulo {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--color-texto);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tarea-fecha {
            font-size: 0.85rem;
            color: var(--color-texto-secundario);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .etiqueta-estado {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .etiqueta-pendiente { background: #fff5f5; color: #c53030; }
        .etiqueta-completada { background: #f0fff4; color: #2f855a; }
        .etiqueta-en-progreso { background: #ebf8ff; color: #2b6cb0; }
        
        /* ===== FILTROS ===== */
        .contenedor-filtros {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
        }
        .filtros-tiempo {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .btn-filtro {
            padding: 14px 28px;
            background: var(--color-fondo-tarjeta);
            border: 1px solid var(--color-borde);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            color: var(--color-texto);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-filtro:hover {
            background: rgba(0, 86, 166, 0.1);
            border-color: var(--mep-azul-principal);
        }
        .btn-filtro.activo {
            background: var(--mep-azul-principal);
            color: white;
            border-color: var(--mep-azul-principal);
        }
        
        /* ===== INFORMES ===== */
        .opciones-informe {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        .tarjeta-informe {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--color-borde);
            transition: all 0.4s;
            cursor: pointer;
            text-align: center;
        }
        .tarjeta-informe:hover {
            background: white;
            border-color: var(--mep-verde);
            transform: translateY(-10px);
            box-shadow: var(--sombra-fuerte);
        }
        .contenedor-exportacion {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
        }
        
        /* ===== ENLACES ===== */
        .panel-enlaces {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .enlace-institucional {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px 20px;
            text-align: center;
            border: 1px solid var(--color-borde);
            transition: all 0.4s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }
        .enlace-institucional:hover {
            transform: translateY(-8px);
            border-color: var(--mep-azul-principal);
            color: var(--mep-azul-principal);
        }
        
        /* ===== BOTONES ===== */
        .boton {
            padding: 16px 32px;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.4s;
            text-decoration: none;
            font-size: 1rem;
        }
        .boton-principal {
            background: var(--gradiente-primario);
            color: white;
        }
        .boton-principal:hover {
            transform: translateY(-5px);
        }
        .boton-exito {
            background: linear-gradient(135deg, var(--mep-verde), #008548);
            color: white;
        }
        .boton-advertencia {
            background: linear-gradient(135deg, var(--mep-naranja), #d4561a);
            color: white;
        }
        .boton-secundario {
            background: transparent;
            color: var(--mep-azul-principal);
            border: 2px solid var(--mep-azul-principal);
        }
        
        /* ===== NOTIFICACIONES ===== */
        .notificacion {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 22px 28px;
            background: var(--gradiente-glass);
            backdrop-filter: blur(15px);
            color: white;
            border-radius: 16px;
            box-shadow: var(--sombra-fuerte);
            z-index: 10000;
            animation: deslizarEntrada 0.5s;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .notificacion.exito { background: linear-gradient(135deg, var(--mep-verde), #008548); }
        .notificacion.error { background: linear-gradient(135deg, #e53e3e, #c53030); }
        .notificacion.info { background: linear-gradient(135deg, var(--mep-azul-principal), #003a75); }
        @keyframes deslizarEntrada {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .contenedor-tareas { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .nav-principal { flex-direction: column; }
            .header-sistema { flex-direction: column; gap: 25px; }
            .panel-estadisticas { grid-template-columns: 1fr; }
            .vista-previa-archivos { grid-template-columns: 1fr; }
        }
        
        /* ===== MEJORAS ESPECFICAS ===== */
        .grupo-botones {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        .estado-vacio {
            text-align: center;
            padding: 80px 30px;
            color: var(--color-texto-secundario);
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
        }
        .badge-teletrabajo { background: #e6fffa; color: #234e52; }
        .badge-presencial { background: #fef3c7; color: #92400e; }
        .badge-mixto { background: #ebf8ff; color: #2b6cb0; }
        
        /* Bot贸n eliminar destacado */
        .btn-eliminar {
            background: #fed7d7 !important;
            color: #c53030 !important;
            border-color: #fc8181 !important;
        }
        .btn-eliminar:hover {
            background: #c53030 !important;
            color: white !important;
        }
    </style>
</head>
<body data-tema="claro">
    <div class="container">
        <!-- HEADER -->
        <header class="header-sistema">
            <div class="logo-mep">
                <i class="fas fa-university"></i>
                <div class="titulo-sistema">
                    <h1>DRTE MEP - Sistema Integral de Agenda y Evidencias</h1>
                    <p><i class="fas fa-landmark"></i> Departamento de Investigaci贸n, Desarrollo e Implementaci贸n</p>
                    <p><i class="fas fa-user-tie"></i> Asesor Nacional: Kevin S谩nchez Bogar铆n | <i class="fas fa-id-card"></i> C贸digo: DRTE-AN-2024</p>
                </div>
            </div>
            <div class="info-usuario-fecha">
                <div class="fecha-actual-cr">
                    <i class="far fa-clock"></i>
                    <span id="fecha-hora-cr">Cargando fecha...</span>
                </div>
                <p class="marca-agua">Sistema v3.1 | 100% Offline | Persistencia garantizada</p>
            </div>
            <div class="control-tema" id="controlTema" title="Cambiar tema">
                <i class="fas fa-moon"></i>
            </div>
        </header>

        <!-- NAVEGACIN -->
        <nav class="nav-principal">
            <button class="nav-btn activo" data-seccion="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
            <button class="nav-btn" data-seccion="bitacora"><i class="fas fa-book"></i> Bit谩cora Diaria</button>
            <button class="nav-btn" data-seccion="calendario"><i class="far fa-calendar-alt"></i> Calendario</button>
            <button class="nav-btn" data-seccion="tareas"><i class="fas fa-tasks"></i> Gesti贸n de Tareas</button>
            <button class="nav-btn" data-seccion="archivos"><i class="fas fa-folder-open"></i> Archivos</button>
            <button class="nav-btn" data-seccion="informes"><i class="fas fa-chart-bar"></i> Informes</button>
            <button class="nav-btn" data-seccion="enlaces"><i class="fas fa-external-link-alt"></i> Enlaces</button>
        </nav>

        <!-- DASHBOARD -->
        <section id="dashboard" class="seccion-contenido visible">
            <h2 class="titulo-seccion"><i class="fas fa-tachometer-alt"></i> Dashboard General</h2>
            
            <div class="panel-estadisticas">
                <div class="tarjeta-estadistica"><i class="fas fa-file-alt"></i><div class="valor-estadistica" id="total-bitacoras">0</div><div class="etiqueta-estadistica">Bit谩coras</div></div>
                <div class="tarjeta-estadistica"><i class="fas fa-tasks"></i><div class="valor-estadistica" id="total-tareas">0</div><div class="etiqueta-estadistica">Tareas Activas</div></div>
                <div class="tarjeta-estadistica"><i class="fas fa-file-upload"></i><div class="valor-estadistica" id="total-archivos">0</div><div class="etiqueta-estadistica">Archivos</div></div>
                <div class="tarjeta-estadistica"><i class="fas fa-laptop-house"></i><div class="valor-estadistica" id="horas-teletrabajo">0h</div><div class="etiqueta-estadistica">Horas Teletrabajo</div></div>
                <div class="tarjeta-estadistica"><i class="fas fa-building"></i><div class="valor-estadistica" id="horas-presencial">0h</div><div class="etiqueta-estadistica">Horas Presencial</div></div>
                <div class="tarjeta-estadistica"><i class="fas fa-calendar-check"></i><div class="valor-estadistica" id="dias-activos">0</div><div class="etiqueta-estadistica">D铆as Activos</div></div>
            </div>

            <div class="contenedor-filtros">
                <h3><i class="fas fa-filter"></i> Filtros R谩pidos</h3>
                <div class="filtros-tiempo">
                    <button class="btn-filtro activo" data-filtro="hoy"><i class="fas fa-sun"></i> Hoy</button>
                    <button class="btn-filtro" data-filtro="ayer"><i class="fas fa-calendar-day"></i> Ayer</button>
                    <button class="btn-filtro" data-filtro="semana"><i class="fas fa-calendar-week"></i> Esta Semana</button>
                    <button class="btn-filtro" data-filtro="mes"><i class="fas fa-calendar-alt"></i> Este Mes</button>
                    <button class="btn-filtro" data-filtro="teletrabajo"><i class="fas fa-laptop-house"></i> Solo Teletrabajo</button>
                    <button class="btn-filtro" data-filtro="presencial"><i class="fas fa-building"></i> Solo Presencial</button>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-top: 30px;">
                <div>
                    <h3><i class="fas fa-history"></i> Actividad Reciente</h3>
                    <div id="lista-actividad-reciente" class="lista-tareas" style="max-height: 400px;">
                        <div class="estado-vacio"><i class="fas fa-stream"></i><p>No hay actividad reciente</p></div>
                    </div>
                </div>
                <div>
                    <h3><i class="fas fa-bolt"></i> Acciones R谩pidas</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                        <button class="boton boton-principal" id="btnBitacoraRapida"><i class="fas fa-plus-circle"></i> Nueva Bit谩cora</button>
                        <button class="boton boton-exito" id="btnTareaRapida"><i class="fas fa-tasks"></i> Nueva Tarea</button>
                        <button class="boton boton-advertencia" id="btnExportarDashboard"><i class="fas fa-file-export"></i> Exportar Resumen</button>
                        <button class="boton boton-secundario" id="btnRespaldoManual"><i class="fas fa-database"></i> Crear Respaldo</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- BITCORA -->
        <section id="bitacora" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-book"></i> Bit谩cora Diaria</h2>
            
            <div class="formulario-bitacora">
                <div class="grupo-form"><label class="etiqueta"><i class="far fa-calendar"></i> Fecha</label><input type="date" class="entrada" id="fecha-bitacora" required></div>
                <div class="grupo-form"><label class="etiqueta"><i class="fas fa-user-clock"></i> Modalidad</label><select class="seleccion" id="modalidad-bitacora" required><option value="">Seleccione</option><option value="teletrabajo">Teletrabajo</option><option value="presencial">Presencial</option><option value="mixto">Mixto</option></select></div>
                <div class="grupo-form"><label class="etiqueta"><i class="fas fa-briefcase"></i> Funci贸n</label><select class="seleccion" id="funcion-bitacora" required><option value="">Seleccione</option><option value="orientacion">Orientaciones curriculares</option><option value="evaluacion">Evaluaci贸n de aprendizajes</option><option value="seguimiento">Seguimiento curricular</option><option value="coordinacion">Coordinaciones</option><option value="formacion">Formaci贸n docente</option><option value="monitoreo">Monitoreo</option><option value="informes">Informes</option><option value="investigacion">Investigaci贸n</option><option value="desarrollo">Desarrollo</option></select></div>
                <div class="grupo-form" style="grid-column: 1 / -1;"><label class="etiqueta"><i class="fas fa-clipboard-list"></i> Descripci贸n</label><textarea class="area-texto" id="descripcion-bitacora" placeholder="Describa la actividad..." required></textarea></div>
                <div class="grupo-form"><label class="etiqueta"><i class="far fa-clock"></i> Horas</label><input type="number" class="entrada" id="horas-bitacora" min="0.5" step="0.5" required></div>
                <div class="grupo-form"><label class="etiqueta"><i class="fas fa-hashtag"></i> Referencia</label><input type="text" class="entrada" id="referencia-bitacora"></div>
            </div>

            <div class="zona-subida" id="zonaSubidaBitacora">
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="info-subida">Arrastre archivos aqu铆 o haga clic</div>
                <div class="formatos-permitidos">PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, PPT, PPTX (Max 50MB)</div>
                <input type="file" id="inputArchivosBitacora" multiple style="display: none;" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.ppt,.pptx,.txt,.csv">
            </div>

            <div id="vistaPreviaBitacora" class="vista-previa-archivos" style="display: none;"></div>

            <div class="grupo-botones">
                <button class="boton boton-principal" id="btnGuardarBitacora"><i class="fas fa-save"></i> Guardar Bit谩cora</button>
                <button class="boton boton-secundario" id="btnLimpiarBitacora"><i class="fas fa-eraser"></i> Limpiar</button>
                <button class="boton boton-exito" id="btnCopiarBitacora"><i class="far fa-copy"></i> Copiar para Correo</button>
            </div>

            <h3 style="margin-top: 40px;"><i class="fas fa-history"></i> Bit谩coras Anteriores</h3>
            <div id="lista-bitacoras" class="lista-tareas" style="max-height: 500px; margin-top: 20px;">
                <div class="estado-vacio"><i class="fas fa-book"></i><p>No hay bit谩coras</p></div>
            </div>
        </section>

        <!-- CALENDARIO -->
        <section id="calendario" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="far fa-calendar-alt"></i> Calendario</h2>
            
            <div class="contenedor-calendario">
                <div class="encabezado-calendario">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button class="btn-control-mes" id="btnMesAnterior"><i class="fas fa-chevron-left"></i></button>
                        <div class="mes-anio-actual" id="mesAnioActual">Enero 2026</div>
                        <button class="btn-control-mes" id="btnMesSiguiente"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <button class="btn-hoy" id="btnIrHoy"><i class="fas fa-calendar-day"></i> Ir a Hoy</button>
                </div>

                <div class="cuadricula-dias-semana">
                    <div>Dom</div><div>Lun</div><div>Mar</div><div>Mi茅</div><div>Jue</div><div>Vie</div><div>S谩b</div>
                </div>

                <div class="cuadricula-mes" id="cuadriculaMes"></div>
            </div>

            <div id="detalle-dia-seleccionado" style="margin-top: 40px; display: none;">
                <h3><i class="far fa-calendar-check"></i> Actividades para <span id="fecha-seleccionada-texto">[Fecha]</span></h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; margin-top: 20px;">
                    <div><h4><i class="fas fa-tasks"></i> Tareas</h4><div id="tareas-del-dia" class="lista-tareas" style="max-height: 300px;"></div></div>
                    <div><h4><i class="fas fa-book"></i> Bit谩coras</h4><div id="bitacoras-del-dia" class="lista-tareas" style="max-height: 300px;"></div></div>
                    <div><h4><i class="fas fa-file"></i> Archivos</h4><div id="archivos-del-dia" class="vista-previa-archivos" style="max-height: 300px; overflow-y: auto;"></div></div>
                </div>
            </div>
        </section>

        <!-- TAREAS -->
        <section id="tareas" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-tasks"></i> Gesti贸n de Tareas</h2>
            
            <div class="contenedor-tareas">
                <div class="formulario-tarea" style="background: var(--gradiente-glass); padding: 30px; border-radius: 20px;">
                    <h3><i class="fas fa-plus-circle"></i> Nueva Tarea</h3>
                    <div class="formulario-bitacora">
                        <div class="grupo-form"><label class="etiqueta"><i class="fas fa-heading"></i> T铆tulo</label><input type="text" class="entrada" id="titulo-tarea" required></div>
                        <div class="grupo-form"><label class="etiqueta"><i class="far fa-calendar"></i> Vencimiento</label><input type="date" class="entrada" id="fecha-vencimiento-tarea" required></div>
                        <div class="grupo-form"><label class="etiqueta"><i class="fas fa-briefcase"></i> Funci贸n</label><select class="seleccion" id="funcion-tarea"><option value="">Seleccione</option><option value="orientacion">Orientaciones</option><option value="evaluacion">Evaluaci贸n</option><option value="seguimiento">Seguimiento</option><option value="coordinacion">Coordinaciones</option><option value="formacion">Formaci贸n</option><option value="monitoreo">Monitoreo</option><option value="informes">Informes</option></select></div>
                        <div class="grupo-form"><label class="etiqueta"><i class="fas fa-flag"></i> Prioridad</label><select class="seleccion" id="prioridad-tarea"><option value="baja">Baja</option><option value="media" selected>Media</option><option value="alta">Alta</option><option value="urgente">Urgente</option></select></div>
                        <div class="grupo-form"><label class="etiqueta"><i class="fas fa-clipboard-list"></i> Descripci贸n</label><textarea class="area-texto" id="descripcion-tarea" rows="4"></textarea></div>
                        <div class="grupo-form"><label class="etiqueta"><i class="fas fa-tag"></i> Estado</label><select class="seleccion" id="estado-tarea"><option value="pendiente">Pendiente</option><option value="en-progreso">En Progreso</option><option value="completada">Completada</option></select></div>
                    </div>
                    <button class="boton boton-principal" id="btnGuardarTarea" style="margin-top: 25px; width: 100%;"><i class="fas fa-save"></i> Guardar Tarea</button>
                </div>

                <div class="lista-tareas">
                    <h3><i class="fas fa-list-ul"></i> Tareas Activas</h3>
                    <div class="filtros-tiempo" style="margin: 20px 0;">
                        <button class="btn-filtro activo" data-filtro-tareas="todas">Todas</button>
                        <button class="btn-filtro" data-filtro-tareas="pendientes">Pendientes</button>
                        <button class="btn-filtro" data-filtro-tareas="completadas">Completadas</button>
                        <button class="btn-filtro" data-filtro-tareas="vencidas">Vencidas</button>
                    </div>
                    <div id="lista-tareas-activas">
                        <div class="estado-vacio"><i class="fas fa-tasks"></i><p>No hay tareas</p></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ARCHIVOS -->
        <section id="archivos" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-folder-open"></i> Archivos y Evidencias</h2>
            
            <div class="contenedor-filtros">
                <div class="filtros-tiempo">
                    <button class="btn-filtro activo" data-filtro-archivos="todos"><i class="fas fa-layer-group"></i> Todos</button>
                    <button class="btn-filtro" data-filtro-archivos="hoy"><i class="fas fa-sun"></i> Hoy</button>
                    <button class="btn-filtro" data-filtro-archivos="semana"><i class="fas fa-calendar-week"></i> Esta Semana</button>
                    <button class="btn-filtro" data-filtro-archivos="pdf"><i class="fas fa-file-pdf"></i> PDF</button>
                    <button class="btn-filtro" data-filtro-archivos="imagenes"><i class="fas fa-image"></i> Im谩genes</button>
                    <button class="btn-filtro" data-filtro-archivos="documentos"><i class="fas fa-file-word"></i> Documentos</button>
                </div>
                <div style="position: relative; margin-top: 20px;">
                    <input type="text" class="entrada" id="buscador-archivos" placeholder="Buscar archivos...">
                    <i class="fas fa-search" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--color-texto-secundario);"></i>
                </div>
            </div>

            <div class="zona-subida" id="zonaSubidaGeneral">
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="info-subida">Arrastre y suelte archivos aqu铆</div>
                <div class="formatos-permitidos">PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, CSV, TXT, PPT, PPTX</div>
                <input type="file" id="inputArchivosGeneral" multiple style="display: none;" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.csv,.txt,.ppt,.pptx">
            </div>

            <div id="vistaPreviaGeneral" class="vista-previa-archivos">
                <div class="estado-vacio"><i class="fas fa-folder-open"></i><p>No hay archivos</p></div>
            </div>
        </section>

        <!-- INFORMES -->
        <section id="informes" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-chart-bar"></i> Informes</h2>
            
            <div class="opciones-informe">
                <div class="tarjeta-informe" data-tipo-informe="diario"><i class="fas fa-calendar-day"></i><h3>Informe Diario</h3><p>Resumen de un d铆a espec铆fico</p></div>
                <div class="tarjeta-informe" data-tipo-informe="semanal"><i class="fas fa-calendar-week"></i><h3>Informe Semanal</h3><p>Consolidado semanal</p></div>
                <div class="tarjeta-informe" data-tipo-informe="mensual"><i class="fas fa-calendar-alt"></i><h3>Informe Mensual</h3><p>Reporte mensual completo</p></div>
                <div class="tarjeta-informe" data-tipo-informe="teletrabajo"><i class="fas fa-laptop-house"></i><h3>Teletrabajo</h3><p>Actividades teletrabajo</p></div>
                <div class="tarjeta-informe" data-tipo-informe="presencial"><i class="fas fa-building"></i><h3>Presencial</h3><p>Actividades presenciales</p></div>
                <div class="tarjeta-informe" data-tipo-informe="funcion"><i class="fas fa-briefcase"></i><h3>Por Funci贸n</h3><p>Agrupado por funci贸n</p></div>
            </div>

            <div class="contenedor-exportacion">
                <h3><i class="fas fa-file-export"></i> Exportar Informe</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                    <div><label class="etiqueta"><i class="far fa-calendar"></i> Fecha Inicio</label><input type="date" class="entrada" id="fecha-inicio-informe"></div>
                    <div><label class="etiqueta"><i class="far fa-calendar"></i> Fecha Fin</label><input type="date" class="entrada" id="fecha-fin-informe"></div>
                    <div><label class="etiqueta"><i class="fas fa-filter"></i> Tipo</label><select class="seleccion" id="tipo-informe-seleccionado"><option value="diario">Diario</option><option value="semanal" selected>Semanal</option><option value="mensual">Mensual</option><option value="teletrabajo">Teletrabajo</option><option value="presencial">Presencial</option><option value="funcion">Por Funci贸n</option><option value="completo">Completo</option></select></div>
                </div>
                
                <div class="grupo-botones" style="margin-top: 30px;">
                    <button class="boton boton-principal" id="btnGenerarInforme"><i class="fas fa-chart-bar"></i> Previsualizar</button>
                    <button class="boton boton-exito" id="btnExportarExcel"><i class="fas fa-file-excel"></i> Exportar Excel</button>
                    <button class="boton" id="btnExportarPDF" style="background: #e53e3e; color: white;"><i class="fas fa-file-pdf"></i> Exportar PDF</button>
                    <button class="boton boton-secundario" id="btnCopiarInforme"><i class="far fa-copy"></i> Copiar para Correo</button>
                    <button class="boton" id="btnImprimirInforme" style="background: #4a5568; color: white;"><i class="fas fa-print"></i> Imprimir</button>
                </div>
            </div>

            <div id="vistaPreviaInforme" style="margin-top: 40px; display: none;">
                <h3><i class="fas fa-eye"></i> Vista Previa</h3>
                <div style="background: white; border-radius: 18px; padding: 30px; margin-top: 20px; max-height: 500px; overflow-y: auto;" id="contenido-informe"></div>
            </div>
        </section>

        <!-- ENLACES -->
        <section id="enlaces" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-external-link-alt"></i> Enlaces Institucionales</h2>
            
            <div class="panel-enlaces">
                <a href="https://outlook.office.com" class="enlace-institucional" target="_blank"><i class="fas fa-envelope"></i><span>Correo MEP</span><small>Outlook 365</small></a>
                <a href="https://adminmepcr.sharepoint.com/:f:/r/sites/DRTE-Intranet/DOCUMENTOSASESORESDRTE/INFORMES/kevin.sanchez.bogarin@mep.go.cr" class="enlace-institucional" target="_blank"><i class="fas fa-folder-tree"></i><span>SharePoint DRTE</span><small>Repositorio documental</small></a>
                <a href="https://sistemas.mep.go.cr" class="enlace-institucional" target="_blank"><i class="fas fa-network-wired"></i><span>Sistema PNFT</span><small>Plataforma nacional</small></a>
                <a href="https://adminmepcr.sharepoint.com/sites/repositorio-pnft" class="enlace-institucional" target="_blank"><i class="fas fa-archive"></i><span>Repositorios</span><small>Archivos hist贸ricos</small></a>
                <a href="https://adminmepcr.sharepoint.com/:f:/r/sites/DiseoMallaCurricular-Enmallados/Documentos%20compartidos/Expediente%20PNFT/2025/Malla%20Curricular%20FT%20-%20Estudio%20y%20Ajustes" class="enlace-institucional" target="_blank"><i class="fas fa-project-diagram"></i><span>Malla Curricular</span><small>Dise帽o y ajustes</small></a>
                <a href="https://drive.google.com" class="enlace-institucional" target="_blank"><i class="fas fa-hdd"></i><span>Google Drive</span><small>Almacenamiento</small></a>
                <a href="https://meet.google.com" class="enlace-institucional" target="_blank"><i class="fas fa-video"></i><span>Google Meet</span><small>Videoconferencias</small></a>
                <a href="https://teams.microsoft.com" class="enlace-institucional" target="_blank"><i class="fab fa-microsoft"></i><span>Teams</span><small>Colaboraci贸n</small></a>
                <a href="https://www.onenote.com" class="enlace-institucional" target="_blank"><i class="fas fa-sticky-note"></i><span>OneNote</span><small>Notas</small></a>
                <a href="https://www.youtube.com" class="enlace-institucional" target="_blank"><i class="fab fa-youtube"></i><span>YouTube</span><small>Recursos educativos</small></a>
            </div>
            
            <div style="margin-top: 40px; background: var(--gradiente-glass); border-radius: 18px; padding: 25px;">
                <h3><i class="fas fa-info-circle"></i> Notas de Uso</h3>
                <ul style="margin-top: 15px; padding-left: 20px; line-height: 1.8;">
                    <li>Sistema 100% offline - datos guardados en su navegador</li>
                    <li>Exporte regularmente sus datos para respaldo</li>
                    <li>Use "Copiar para Correo" para formatos listos para enviar</li>
                    <li>Para asistencia: departamento de sistemas DRTE MEP</li>
                </ul>
            </div>
        </section>
    </div>

    <!-- NOTIFICACIONES -->
    <div id="contenedorNotificaciones"></div>

    <!-- MODAL -->
    <div id="modalArchivo" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 20000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 20px; max-width: 900px; width: 100%; max-height: 90vh; overflow: hidden;">
            <div style="padding: 25px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;" id="tituloModalArchivo">Vista Previa</h3>
                <button id="btnCerrarModal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>
            <div style="padding: 30px; max-height: calc(90vh - 100px); overflow-y: auto;" id="contenidoModalArchivo"></div>
        </div>
    </div>

    <script>
        // ===== SISTEMA CORREGIDO =====
        const SISTEMA_VERSION = '3.1';
        
        // Formatear fecha
        const formatearFechaCR = (fecha = null) => {
            const fechaObj = fecha ? new Date(fecha) : new Date();
            return fechaObj.toISOString().split('T')[0];
        };
        
        const formatearFechaLegible = (fecha = null) => {
            const fechaObj = fecha ? new Date(fecha) : new Date();
            return fechaObj.toLocaleDateString('es-CR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        };
        
        // Estado global
        const estadoSistema = {
            fechaActual: formatearFechaCR(),
            mesCalendario: new Date().getMonth(),
            anioCalendario: new Date().getFullYear(),
            datos: {
                bitacoras: JSON.parse(localStorage.getItem('drte_bitacoras')) || [],
                tareas: JSON.parse(localStorage.getItem('drte_tareas')) || [],
                archivos: JSON.parse(localStorage.getItem('drte_archivos')) || []
            }
        };
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            inicializarSistema();
            configurarNavegacion();
            configurarEventListeners();
            actualizarDashboard();
            inicializarCalendario();
            cargarBitacoras();
            cargarTareas();
            cargarArchivos();
            actualizarFechaHora();
        });
        
        function inicializarSistema() {
            // Configurar fechas
            document.getElementById('fecha-bitacora').value = formatearFechaCR();
            document.getElementById('fecha-vencimiento-tarea').value = formatearFechaCR();
            
            // Fechas de informe (mes actual)
            const primerDiaMes = new Date(estadoSistema.anioCalendario, estadoSistema.mesCalendario, 1);
            const ultimoDiaMes = new Date(estadoSistema.anioCalendario, estadoSistema.mesCalendario + 1, 0);
            document.getElementById('fecha-inicio-informe').value = formatearFechaCR(primerDiaMes);
            document.getElementById('fecha-fin-informe').value = formatearFechaCR(ultimoDiaMes);
        }
        
        function configurarNavegacion() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const seccionId = btn.getAttribute('data-seccion');
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('activo'));
                    btn.classList.add('activo');
                    document.querySelectorAll('.seccion-contenido').forEach(sec => sec.classList.remove('visible'));
                    document.getElementById(seccionId).classList.add('visible');
                    
                    if (seccionId === 'calendario') renderizarCalendario();
                    if (seccionId === 'dashboard') actualizarDashboard();
                });
            });
        }
        
        function configurarEventListeners() {
            // Tema
            document.getElementById('controlTema').addEventListener('click', () => {
                const temaActual = document.body.getAttribute('data-tema');
                const nuevoTema = temaActual === 'claro' ? 'oscuro' : 'claro';
                document.body.setAttribute('data-tema', nuevoTema);
                document.getElementById('controlTema').innerHTML = nuevoTema === 'claro' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            });
            
            // Bit谩cora
            document.getElementById('btnGuardarBitacora').addEventListener('click', guardarBitacora);
            document.getElementById('btnLimpiarBitacora').addEventListener('click', () => {
                if (confirm('驴Limpiar formulario?')) {
                    document.getElementById('descripcion-bitacora').value = '';
                    document.getElementById('horas-bitacora').value = '';
                    document.getElementById('referencia-bitacora').value = '';
                    document.getElementById('vistaPreviaBitacora').style.display = 'none';
                    document.getElementById('vistaPreviaBitacora').innerHTML = '';
                }
            });
            document.getElementById('btnCopiarBitacora').addEventListener('click', copiarBitacoraParaCorreo);
            
            // Subida archivos bit谩cora
            const zonaSubidaBitacora = document.getElementById('zonaSubidaBitacora');
            const inputArchivosBitacora = document.getElementById('inputArchivosBitacora');
            zonaSubidaBitacora.addEventListener('click', () => inputArchivosBitacora.click());
            inputArchivosBitacora.addEventListener('change', (e) => manejarSubidaArchivos(e, 'bitacora'));
            
            // Drag & drop bit谩cora
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                zonaSubidaBitacora.addEventListener(eventName, prevenirComportamiento, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                zonaSubidaBitacora.addEventListener(eventName, () => zonaSubidaBitacora.classList.add('drag-over'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                zonaSubidaBitacora.addEventListener(eventName, () => zonaSubidaBitacora.classList.remove('drag-over'), false);
            });
            zonaSubidaBitacora.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                inputArchivosBitacora.files = files;
                manejarSubidaArchivos({ target: { files } }, 'bitacora');
            });
            
            // Subida archivos general
            const zonaSubidaGeneral = document.getElementById('zonaSubidaGeneral');
            const inputArchivosGeneral = document.getElementById('inputArchivosGeneral');
            zonaSubidaGeneral.addEventListener('click', () => inputArchivosGeneral.click());
            inputArchivosGeneral.addEventListener('change', (e) => manejarSubidaArchivos(e, 'general'));
            
            // Drag & drop general
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                zonaSubidaGeneral.addEventListener(eventName, prevenirComportamiento, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                zonaSubidaGeneral.addEventListener(eventName, () => zonaSubidaGeneral.classList.add('drag-over'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                zonaSubidaGeneral.addEventListener(eventName, () => zonaSubidaGeneral.classList.remove('drag-over'), false);
            });
            zonaSubidaGeneral.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                inputArchivosGeneral.files = files;
                manejarSubidaArchivos({ target: { files } }, 'general');
            });
            
            // Tareas
            document.getElementById('btnGuardarTarea').addEventListener('click', guardarTarea);
            
            // Filtros tareas
            document.querySelectorAll('[data-filtro-tareas]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-filtro-tareas]').forEach(b => b.classList.remove('activo'));
                    btn.classList.add('activo');
                    filtrarTareas(btn.getAttribute('data-filtro-tareas'));
                });
            });
            
            // Calendario
            document.getElementById('btnMesAnterior').addEventListener('click', () => {
                estadoSistema.mesCalendario--;
                if (estadoSistema.mesCalendario < 0) {
                    estadoSistema.mesCalendario = 11;
                    estadoSistema.anioCalendario--;
                }
                renderizarCalendario();
            });
            document.getElementById('btnMesSiguiente').addEventListener('click', () => {
                estadoSistema.mesCalendario++;
                if (estadoSistema.mesCalendario > 11) {
                    estadoSistema.mesCalendario = 0;
                    estadoSistema.anioCalendario++;
                }
                renderizarCalendario();
            });
            document.getElementById('btnIrHoy').addEventListener('click', () => {
                estadoSistema.mesCalendario = new Date().getMonth();
                estadoSistema.anioCalendario = new Date().getFullYear();
                renderizarCalendario();
            });
            
            // Filtros archivos
            document.querySelectorAll('[data-filtro-archivos]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-filtro-archivos]').forEach(b => b.classList.remove('activo'));
                    btn.classList.add('activo');
                    filtrarArchivos(btn.getAttribute('data-filtro-archivos'));
                });
            });
            
            // Buscador archivos
            document.getElementById('buscador-archivos').addEventListener('input', (e) => {
                buscarArchivos(e.target.value);
            });
            
            // Informes
            document.querySelectorAll('.tarjeta-informe').forEach(tarjeta => {
                tarjeta.addEventListener('click', () => {
                    document.getElementById('tipo-informe-seleccionado').value = tarjeta.getAttribute('data-tipo-informe');
                });
            });
            document.getElementById('btnGenerarInforme').addEventListener('click', generarInforme);
            document.getElementById('btnExportarExcel').addEventListener('click', exportarAExcel);
            document.getElementById('btnExportarPDF').addEventListener('click', exportarAPDF);
            document.getElementById('btnCopiarInforme').addEventListener('click', copiarInformeParaCorreo);
            document.getElementById('btnImprimirInforme').addEventListener('click', imprimirInforme);
            
            // Acciones r谩pidas dashboard
            document.getElementById('btnBitacoraRapida').addEventListener('click', () => {
                document.querySelector('[data-seccion="bitacora"]').click();
            });
            document.getElementById('btnTareaRapida').addEventListener('click', () => {
                document.querySelector('[data-seccion="tareas"]').click();
            });
            document.getElementById('btnRespaldoManual').addEventListener('click', crearRespaldoManual);
            
            // Modal
            document.getElementById('btnCerrarModal').addEventListener('click', () => {
                document.getElementById('modalArchivo').style.display = 'none';
            });
            document.getElementById('modalArchivo').addEventListener('click', (e) => {
                if (e.target.id === 'modalArchivo') {
                    document.getElementById('modalArchivo').style.display = 'none';
                }
            });
        }
        
        function prevenirComportamiento(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        // ===== BITCORA =====
        function guardarBitacora() {
            const fecha = document.getElementById('fecha-bitacora').value;
            const modalidad = document.getElementById('modalidad-bitacora').value;
            const funcion = document.getElementById('funcion-bitacora').value;
            const descripcion = document.getElementById('descripcion-bitacora').value;
            const horas = parseFloat(document.getElementById('horas-bitacora').value) || 0;
            const referencia = document.getElementById('referencia-bitacora').value;
            
            if (!fecha || !modalidad || !funcion || !descripcion.trim() || horas <= 0) {
                mostrarNotificacion('Complete todos los campos obligatorios', 'error');
                return;
            }
            
            // Obtener archivos adjuntos
            const archivosAdjuntos = [];
            document.querySelectorAll('#vistaPreviaBitacora .tarjeta-archivo').forEach(el => {
                const idArchivo = el.getAttribute('data-id-archivo');
                if (idArchivo) archivosAdjuntos.push(idArchivo);
            });
            
            const nuevaBitacora = {
                id: 'bit_' + Date.now(),
                fecha: fecha,
                modalidad: modalidad,
                funcion: funcion,
                descripcion: descripcion.trim(),
                horas: horas,
                referencia: referencia.trim(),
                archivos: archivosAdjuntos,
                fechaCreacion: new Date().toISOString()
            };
            
            estadoSistema.datos.bitacoras.push(nuevaBitacora);
            guardarDatos();
            
            mostrarNotificacion('Bit谩cora guardada', 'exito');
            cargarBitacoras();
            actualizarDashboard();
            
            // Limpiar
            document.getElementById('descripcion-bitacora').value = '';
            document.getElementById('horas-bitacora').value = '';
            document.getElementById('referencia-bitacora').value = '';
            document.getElementById('vistaPreviaBitacora').style.display = 'none';
            document.getElementById('vistaPreviaBitacora').innerHTML = '';
            
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
            }
        }
        
        function cargarBitacoras() {
            const contenedor = document.getElementById('lista-bitacoras');
            const bitacoras = estadoSistema.datos.bitacoras;
            
            if (bitacoras.length === 0) {
                contenedor.innerHTML = '<div class="estado-vacio"><i class="fas fa-book"></i><p>No hay bit谩coras</p></div>';
                return;
            }
            
            bitacoras.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
            
            let html = '';
            bitacoras.forEach(bitacora => {
                const fechaLegible = formatearFechaLegible(bitacora.fecha);
                const iconoModalidad = bitacora.modalidad === 'teletrabajo' ? 'fa-laptop-house' : 
                                      bitacora.modalidad === 'presencial' ? 'fa-building' : 'fa-blender-phone';
                const badgeClass = bitacora.modalidad === 'teletrabajo' ? 'badge-teletrabajo' : 
                                 bitacora.modalidad === 'presencial' ? 'badge-presencial' : 'badge-mixto';
                const badgeText = bitacora.modalidad === 'teletrabajo' ? 'Teletrabajo' : 
                                bitacora.modalidad === 'presencial' ? 'Presencial' : 'Mixto';
                
                const funcionTexto = {
                    'orientacion': 'Orientaciones curriculares',
                    'evaluacion': 'Evaluaci贸n de aprendizajes',
                    'seguimiento': 'Seguimiento curricular',
                    'coordinacion': 'Coordinaciones interdepartamentales',
                    'formacion': 'Eventos de formaci贸n docente',
                    'monitoreo': 'Monitoreo y acompa帽amiento',
                    'informes': 'Informes para jefatura',
                    'investigacion': 'Investigaci贸n educativa',
                    'desarrollo': 'Desarrollo de recursos t茅cnicos'
                }[bitacora.funcion] || bitacora.funcion;
                
                html += `
                    <div class="tarea-item" data-id="${bitacora.id}">
                        <div class="tarea-titulo">
                            <i class="fas ${iconoModalidad}"></i> ${funcionTexto}
                            <span class="badge ${badgeClass}">${badgeText}</span>
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-calendar"></i> ${fechaLegible} | 
                            <i class="far fa-clock"></i> ${bitacora.horas} horas
                        </div>
                        <div class="tarea-descripcion">${bitacora.descripcion.substring(0, 300)}${bitacora.descripcion.length > 300 ? '...' : ''}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div>
                                ${bitacora.archivos.length > 0 ? `<i class="fas fa-paperclip"></i> ${bitacora.archivos.length} archivo(s)` : '<span style="color: var(--color-texto-secundario);"><i class="fas fa-paperclip"></i> Sin archivos</span>'}
                            </div>
                            <div>
                                <button class="btn-accion-archivo" onclick="editarBitacora('${bitacora.id}')" title="Editar"><i class="fas fa-edit"></i></button>
                                <button class="btn-accion-archivo btn-eliminar" onclick="eliminarBitacora('${bitacora.id}')" title="Eliminar"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function editarBitacora(id) {
            const bitacora = estadoSistema.datos.bitacoras.find(b => b.id === id);
            if (!bitacora) return;
            
            document.getElementById('fecha-bitacora').value = bitacora.fecha;
            document.getElementById('modalidad-bitacora').value = bitacora.modalidad;
            document.getElementById('funcion-bitacora').value = bitacora.funcion;
            document.getElementById('descripcion-bitacora').value = bitacora.descripcion;
            document.getElementById('horas-bitacora').value = bitacora.horas;
            document.getElementById('referencia-bitacora').value = bitacora.referencia || '';
            
            const btnGuardar = document.getElementById('btnGuardarBitacora');
            const textoOriginal = btnGuardar.innerHTML;
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Actualizar Bit谩cora';
            btnGuardar.onclick = () => actualizarBitacora(id);
            
            const btnCancelar = document.createElement('button');
            btnCancelar.className = 'boton boton-advertencia';
            btnCancelar.innerHTML = '<i class="fas fa-times"></i> Cancelar';
            btnCancelar.onclick = () => {
                btnGuardar.innerHTML = textoOriginal;
                btnGuardar.onclick = guardarBitacora;
                btnCancelar.remove();
                document.getElementById('fecha-bitacora').value = formatearFechaCR();
                document.getElementById('modalidad-bitacora').value = '';
                document.getElementById('funcion-bitacora').value = '';
                document.getElementById('descripcion-bitacora').value = '';
                document.getElementById('horas-bitacora').value = '';
                document.getElementById('referencia-bitacora').value = '';
            };
            
            document.querySelector('.grupo-botones').appendChild(btnCancelar);
            document.querySelector('[data-seccion="bitacora"]').click();
        }
        
        function actualizarBitacora(id) {
            const fecha = document.getElementById('fecha-bitacora').value;
            const modalidad = document.getElementById('modalidad-bitacora').value;
            const funcion = document.getElementById('funcion-bitacora').value;
            const descripcion = document.getElementById('descripcion-bitacora').value;
            const horas = parseFloat(document.getElementById('horas-bitacora').value) || 0;
            const referencia = document.getElementById('referencia-bitacora').value;
            
            const index = estadoSistema.datos.bitacoras.findIndex(b => b.id === id);
            if (index === -1) return;
            
            const archivosAdjuntos = [];
            document.querySelectorAll('#vistaPreviaBitacora .tarjeta-archivo').forEach(el => {
                const idArchivo = el.getAttribute('data-id-archivo');
                if (idArchivo) archivosAdjuntos.push(idArchivo);
            });
            
            estadoSistema.datos.bitacoras[index] = {
                ...estadoSistema.datos.bitacoras[index],
                fecha: fecha,
                modalidad: modalidad,
                funcion: funcion,
                descripcion: descripcion.trim(),
                horas: horas,
                referencia: referencia.trim(),
                archivos: archivosAdjuntos
            };
            
            guardarDatos();
            mostrarNotificacion('Bit谩cora actualizada', 'exito');
            cargarBitacoras();
            actualizarDashboard();
            
            const btnGuardar = document.getElementById('btnGuardarBitacora');
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Guardar Bit谩cora';
            btnGuardar.onclick = guardarBitacora;
            
            const btnCancelar = document.querySelector('.grupo-botones .boton-advertencia');
            if (btnCancelar) btnCancelar.remove();
            
            document.getElementById('fecha-bitacora').value = formatearFechaCR();
            document.getElementById('modalidad-bitacora').value = '';
            document.getElementById('funcion-bitacora').value = '';
            document.getElementById('descripcion-bitacora').value = '';
            document.getElementById('horas-bitacora').value = '';
            document.getElementById('referencia-bitacora').value = '';
            document.getElementById('vistaPreviaBitacora').style.display = 'none';
            document.getElementById('vistaPreviaBitacora').innerHTML = '';
        }
        
        function eliminarBitacora(id) {
            if (!confirm('驴Eliminar esta bit谩cora?')) return;
            
            const index = estadoSistema.datos.bitacoras.findIndex(b => b.id === id);
            if (index === -1) return;
            
            estadoSistema.datos.bitacoras.splice(index, 1);
            guardarDatos();
            mostrarNotificacion('Bit谩cora eliminada', 'exito');
            cargarBitacoras();
            actualizarDashboard();
            
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
            }
        }
        
        function copiarBitacoraParaCorreo() {
            const fecha = document.getElementById('fecha-bitacora').value;
            const modalidad = document.getElementById('modalidad-bitacora').value;
            const funcion = document.getElementById('funcion-bitacora').value;
            const descripcion = document.getElementById('descripcion-bitacora').value;
            const horas = document.getElementById('horas-bitacora').value;
            
            if (!fecha || !modalidad || !funcion || !descripcion.trim() || !horas) {
                mostrarNotificacion('Complete la bit谩cora primero', 'error');
                return;
            }
            
            const modalidadTexto = modalidad === 'teletrabajo' ? 'Teletrabajo' : modalidad === 'presencial' ? 'Presencial' : 'Mixto';
            
            const textoCorreo = `Bit谩cora DRTE MEP - ${formatearFechaLegible(fecha)}

Fecha: ${formatearFechaLegible(fecha)}
Modalidad: ${modalidadTexto}
Funci贸n: ${funcion}
Horas: ${horas}

Descripci贸n:
${descripcion}

---
Sistema DRTE MEP`;

            navigator.clipboard.writeText(textoCorreo).then(() => {
                mostrarNotificacion('Copiado al portapapeles', 'exito');
            });
        }
        
        // ===== ARCHIVOS =====
        function manejarSubidaArchivos(event, tipo) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            const MAX_TAMANIO = 50 * 1024 * 1024;
            const FORMATOS = ['.pdf','.doc','.docx','.xls','.xlsx','.jpg','.jpeg','.png','.ppt','.pptx','.txt','.csv'];
            
            for (let file of files) {
                if (file.size > MAX_TAMANIO) {
                    mostrarNotificacion(`${file.name} excede 50MB`, 'error');
                    continue;
                }
                
                const extension = '.' + file.name.split('.').pop().toLowerCase();
                if (!FORMATOS.includes(extension)) {
                    mostrarNotificacion(`${file.name} formato no permitido`, 'error');
                    continue;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const archivo = {
                        id: 'arch_' + Date.now(),
                        nombre: file.name,
                        tipo: file.type,
                        tama帽o: file.size,
                        contenido: e.target.result,
                        fechaSubida: new Date().toISOString(),
                        fechaArchivo: tipo === 'bitacora' ? document.getElementById('fecha-bitacora').value : formatearFechaCR(),
                        relacion: tipo
                    };
                    
                    estadoSistema.datos.archivos.push(archivo);
                    guardarDatos();
                    mostrarArchivoEnVistaPrevia(archivo, tipo);
                    actualizarDashboard();
                    mostrarNotificacion(`${file.name} subido`, 'exito');
                };
                reader.readAsDataURL(file);
            }
            
            event.target.value = '';
        }
        
        function mostrarArchivoEnVistaPrevia(archivo, tipo) {
            const contenedorId = tipo === 'bitacora' ? 'vistaPreviaBitacora' : 'vistaPreviaGeneral';
            const contenedor = document.getElementById(contenedorId);
            contenedor.style.display = 'grid';
            
            let claseIcono = 'otro';
            if (archivo.tipo.includes('pdf')) claseIcono = 'pdf';
            else if (archivo.tipo.includes('word') || archivo.nombre.match(/\.(doc|docx)$/i)) claseIcono = 'word';
            else if (archivo.tipo.includes('excel') || archivo.nombre.match(/\.(xls|xlsx|csv)$/i)) claseIcono = 'excel';
            else if (archivo.tipo.includes('powerpoint') || archivo.nombre.match(/\.(ppt|pptx)$/i)) claseIcono = 'powerpoint';
            else if (archivo.tipo.includes('image')) claseIcono = 'imagen';
            
            let icono = 'fas fa-file';
            if (claseIcono === 'pdf') icono = 'fas fa-file-pdf';
            else if (claseIcono === 'word') icono = 'fas fa-file-word';
            else if (claseIcono === 'excel') icono = 'fas fa-file-excel';
            else if (claseIcono === 'powerpoint') icono = 'fas fa-file-powerpoint';
            else if (claseIcono === 'imagen') icono = 'fas fa-file-image';
            
            const tama帽oFormateado = archivo.tama帽o < 1024 * 1024 
                ? (archivo.tama帽o / 1024).toFixed(1) + ' KB' 
                : (archivo.tama帽o / (1024 * 1024)).toFixed(1) + ' MB';
            
            const tarjetaHTML = `
                <div class="tarjeta-archivo" data-id-archivo="${archivo.id}">
                    <div class="icono-archivo ${claseIcono}"><i class="${icono}"></i></div>
                    <div class="nombre-archivo">${archivo.nombre.length > 30 ? archivo.nombre.substring(0, 30) + '...' : archivo.nombre}</div>
                    <div class="detalles-archivo">${formatearFechaLegible(archivo.fechaArchivo)}<br>${tama帽oFormateado}</div>
                    <div class="acciones-archivo">
                        <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')"><i class="fas fa-eye"></i></button>
                        <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')"><i class="fas fa-download"></i></button>
                        <button class="btn-accion-archivo btn-eliminar" onclick="eliminarArchivo('${archivo.id}', '${tipo}')"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `;
            
            contenedor.innerHTML = tarjetaHTML + contenedor.innerHTML;
        }
        
        function cargarArchivos() {
            const contenedor = document.getElementById('vistaPreviaGeneral');
            const archivos = estadoSistema.datos.archivos;
            
            if (archivos.length === 0) {
                contenedor.innerHTML = '<div class="estado-vacio"><i class="fas fa-folder-open"></i><p>No hay archivos</p></div>';
                return;
            }
            
            archivos.sort((a, b) => new Date(b.fechaSubida) - new Date(a.fechaSubida));
            
            let html = '';
            archivos.forEach(archivo => {
                let claseIcono = 'otro';
                if (archivo.tipo.includes('pdf')) claseIcono = 'pdf';
                else if (archivo.tipo.includes('word') || archivo.nombre.match(/\.(doc|docx)$/i)) claseIcono = 'word';
                else if (archivo.tipo.includes('excel') || archivo.nombre.match(/\.(xls|xlsx|csv)$/i)) claseIcono = 'excel';
                else if (archivo.tipo.includes('powerpoint') || archivo.nombre.match(/\.(ppt|pptx)$/i)) claseIcono = 'powerpoint';
                else if (archivo.tipo.includes('image')) claseIcono = 'imagen';
                
                let icono = 'fas fa-file';
                if (claseIcono === 'pdf') icono = 'fas fa-file-pdf';
                else if (claseIcono === 'word') icono = 'fas fa-file-word';
                else if (claseIcono === 'excel') icono = 'fas fa-file-excel';
                else if (claseIcono === 'powerpoint') icono = 'fas fa-file-powerpoint';
                else if (claseIcono === 'imagen') icono = 'fas fa-file-image';
                
                const tama帽oFormateado = archivo.tama帽o < 1024 * 1024 
                    ? (archivo.tama帽o / 1024).toFixed(1) + ' KB' 
                    : (archivo.tama帽o / (1024 * 1024)).toFixed(1) + ' MB';
                
                html += `
                    <div class="tarjeta-archivo" data-id-archivo="${archivo.id}">
                        <div class="icono-archivo ${claseIcono}"><i class="${icono}"></i></div>
                        <div class="nombre-archivo">${archivo.nombre.length > 30 ? archivo.nombre.substring(0, 30) + '...' : archivo.nombre}</div>
                        <div class="detalles-archivo">${formatearFechaLegible(archivo.fechaArchivo)}<br>${tama帽oFormateado}</div>
                        <div class="acciones-archivo">
                            <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')"><i class="fas fa-eye"></i></button>
                            <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')"><i class="fas fa-download"></i></button>
                            <button class="btn-accion-archivo btn-eliminar" onclick="eliminarArchivo('${archivo.id}', 'general')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function verArchivo(id) {
            const archivo = estadoSistema.datos.archivos.find(a => a.id === id);
            if (!archivo) return;
            
            const modal = document.getElementById('modalArchivo');
            const titulo = document.getElementById('tituloModalArchivo');
            const contenido = document.getElementById('contenidoModalArchivo');
            
            titulo.textContent = archivo.nombre;
            
            if (archivo.tipo.includes('image')) {
                contenido.innerHTML = `<img src="${archivo.contenido}" alt="${archivo.nombre}" style="max-width: 100%; max-height: 70vh; border-radius: 10px;">`;
            } else if (archivo.tipo.includes('pdf')) {
                contenido.innerHTML = `<iframe src="${archivo.contenido}" width="100%" height="600" style="border: none;"></iframe>`;
            } else {
                contenido.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-file ${archivo.tipo.includes('pdf') ? 'pdf' : archivo.tipo.includes('word') ? 'word' : archivo.tipo.includes('excel') ? 'excel' : 'otro'}" style="font-size: 5rem;"></i>
                        <h4>${archivo.nombre}</h4>
                        <p>Tipo: ${archivo.tipo}</p>
                        <p>Tama帽o: ${archivo.tama帽o < 1024 * 1024 ? (archivo.tama帽o / 1024).toFixed(1) + ' KB' : (archivo.tama帽o / (1024 * 1024)).toFixed(1) + ' MB'}</p>
                        <button class="boton boton-principal" onclick="descargarArchivo('${archivo.id}')"><i class="fas fa-download"></i> Descargar</button>
                    </div>
                `;
            }
            
            modal.style.display = 'flex';
        }
        
        function descargarArchivo(id) {
            const archivo = estadoSistema.datos.archivos.find(a => a.id === id);
            if (!archivo) return;
            
            const a = document.createElement('a');
            a.href = archivo.contenido;
            a.download = archivo.nombre;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        function eliminarArchivo(id, tipo) {
            if (!confirm('驴Eliminar este archivo?')) return;
            
            // Eliminar de bit谩coras si est谩 asociado
            estadoSistema.datos.bitacoras.forEach(bitacora => {
                const index = bitacora.archivos.indexOf(id);
                if (index !== -1) bitacora.archivos.splice(index, 1);
            });
            
            // Eliminar archivo
            const index = estadoSistema.datos.archivos.findIndex(a => a.id === id);
            if (index !== -1) estadoSistema.datos.archivos.splice(index, 1);
            
            guardarDatos();
            
            if (tipo === 'bitacora') {
                const elemento = document.querySelector(`#vistaPreviaBitacora [data-id-archivo="${id}"]`);
                if (elemento) elemento.remove();
                if (document.querySelectorAll('#vistaPreviaBitacora .tarjeta-archivo').length === 0) {
                    document.getElementById('vistaPreviaBitacora').style.display = 'none';
                }
            } else {
                cargarArchivos();
            }
            
            actualizarDashboard();
            mostrarNotificacion('Archivo eliminado', 'exito');
        }
        
        function filtrarArchivos(filtro) {
            const hoy = new Date(formatearFechaCR());
            const inicioSemana = new Date(hoy);
            inicioSemana.setDate(hoy.getDate() - hoy.getDay() + 1);
            const finSemana = new Date(inicioSemana);
            finSemana.setDate(inicioSemana.getDate() + 6);
            
            let archivosFiltrados = estadoSistema.datos.archivos;
            
            switch(filtro) {
                case 'hoy':
                    archivosFiltrados = archivosFiltrados.filter(a => a.fechaArchivo === formatearFechaCR());
                    break;
                case 'semana':
                    archivosFiltrados = archivosFiltrados.filter(a => {
                        const fechaArchivo = new Date(a.fechaArchivo);
                        return fechaArchivo >= inicioSemana && fechaArchivo <= finSemana;
                    });
                    break;
                case 'pdf':
                    archivosFiltrados = archivosFiltrados.filter(a => a.tipo.includes('pdf'));
                    break;
                case 'imagenes':
                    archivosFiltrados = archivosFiltrados.filter(a => a.tipo.includes('image'));
                    break;
                case 'documentos':
                    archivosFiltrados = archivosFiltrados.filter(a => 
                        a.tipo.includes('word') || 
                        a.tipo.includes('excel') || 
                        a.tipo.includes('powerpoint') ||
                        a.nombre.match(/\.(doc|docx|xls|xlsx|ppt|pptx)$/i)
                    );
                    break;
                case 'todos':
                default:
                    break;
            }
            
            mostrarArchivosFiltrados(archivosFiltrados);
        }
        
        function buscarArchivos(termino) {
            if (!termino.trim()) {
                cargarArchivos();
                return;
            }
            
            termino = termino.toLowerCase();
            const archivosFiltrados = estadoSistema.datos.archivos.filter(a => 
                a.nombre.toLowerCase().includes(termino) || 
                a.tipo.toLowerCase().includes(termino)
            );
            
            mostrarArchivosFiltrados(archivosFiltrados);
        }
        
        function mostrarArchivosFiltrados(archivos) {
            const contenedor = document.getElementById('vistaPreviaGeneral');
            
            if (archivos.length === 0) {
                contenedor.innerHTML = '<div class="estado-vacio"><i class="fas fa-search"></i><p>No se encontraron archivos</p></div>';
                return;
            }
            
            let html = '';
            archivos.forEach(archivo => {
                let claseIcono = 'otro';
                if (archivo.tipo.includes('pdf')) claseIcono = 'pdf';
                else if (archivo.tipo.includes('word') || archivo.nombre.match(/\.(doc|docx)$/i)) claseIcono = 'word';
                else if (archivo.tipo.includes('excel') || archivo.nombre.match(/\.(xls|xlsx|csv)$/i)) claseIcono = 'excel';
                else if (archivo.tipo.includes('powerpoint') || archivo.nombre.match(/\.(ppt|pptx)$/i)) claseIcono = 'powerpoint';
                else if (archivo.tipo.includes('image')) claseIcono = 'imagen';
                
                let icono = 'fas fa-file';
                if (claseIcono === 'pdf') icono = 'fas fa-file-pdf';
                else if (claseIcono === 'word') icono = 'fas fa-file-word';
                else if (claseIcono === 'excel') icono = 'fas fa-file-excel';
                else if (claseIcono === 'powerpoint') icono = 'fas fa-file-powerpoint';
                else if (claseIcono === 'imagen') icono = 'fas fa-file-image';
                
                const tama帽oFormateado = archivo.tama帽o < 1024 * 1024 
                    ? (archivo.tama帽o / 1024).toFixed(1) + ' KB' 
                    : (archivo.tama帽o / (1024 * 1024)).toFixed(1) + ' MB';
                
                html += `
                    <div class="tarjeta-archivo" data-id-archivo="${archivo.id}">
                        <div class="icono-archivo ${claseIcono}"><i class="${icono}"></i></div>
                        <div class="nombre-archivo">${archivo.nombre.length > 30 ? archivo.nombre.substring(0, 30) + '...' : archivo.nombre}</div>
                        <div class="detalles-archivo">${formatearFechaLegible(archivo.fechaArchivo)}<br>${tama帽oFormateado}</div>
                        <div class="acciones-archivo">
                            <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')"><i class="fas fa-eye"></i></button>
                            <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')"><i class="fas fa-download"></i></button>
                            <button class="btn-accion-archivo btn-eliminar" onclick="eliminarArchivo('${archivo.id}', 'general')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        // ===== TAREAS =====
        function guardarTarea() {
            const titulo = document.getElementById('titulo-tarea').value.trim();
            const fechaVencimiento = document.getElementById('fecha-vencimiento-tarea').value;
            const funcion = document.getElementById('funcion-tarea').value;
            const prioridad = document.getElementById('prioridad-tarea').value;
            const descripcion = document.getElementById('descripcion-tarea').value.trim();
            const estado = document.getElementById('estado-tarea').value;
            
            if (!titulo || !fechaVencimiento) {
                mostrarNotificacion('Complete t铆tulo y fecha de vencimiento', 'error');
                return;
            }
            
            const nuevaTarea = {
                id: 'tarea_' + Date.now(),
                titulo: titulo,
                fechaVencimiento: fechaVencimiento,
                funcion: funcion || '',
                prioridad: prioridad,
                descripcion: descripcion,
                estado: estado,
                fechaCreacion: new Date().toISOString(),
                completada: estado === 'completada'
            };
            
            estadoSistema.datos.tareas.push(nuevaTarea);
            guardarDatos();
            
            mostrarNotificacion('Tarea guardada', 'exito');
            cargarTareas();
            actualizarDashboard();
            
            // Limpiar
            document.getElementById('titulo-tarea').value = '';
            document.getElementById('fecha-vencimiento-tarea').value = formatearFechaCR();
            document.getElementById('funcion-tarea').value = '';
            document.getElementById('prioridad-tarea').value = 'media';
            document.getElementById('descripcion-tarea').value = '';
            document.getElementById('estado-tarea').value = 'pendiente';
            
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
            }
        }
        
        function cargarTareas() {
            const contenedor = document.getElementById('lista-tareas-activas');
            const tareas = estadoSistema.datos.tareas;
            
            if (tareas.length === 0) {
                contenedor.innerHTML = '<div class="estado-vacio"><i class="fas fa-tasks"></i><p>No hay tareas</p></div>';
                return;
            }
            
            tareas.sort((a, b) => new Date(a.fechaVencimiento) - new Date(b.fechaVencimiento));
            
            let html = '';
            tareas.forEach(tarea => {
                const fechaLegible = formatearFechaLegible(tarea.fechaVencimiento);
                let claseEstado = '';
                let textoEstado = '';
                if (tarea.estado === 'completada') {
                    claseEstado = 'completada';
                    textoEstado = 'Completada';
                } else if (tarea.estado === 'en-progreso') {
                    claseEstado = 'en-progreso';
                    textoEstado = 'En Progreso';
                } else {
                    const hoy = new Date(formatearFechaCR());
                    const fechaVenc = new Date(tarea.fechaVencimiento);
                    if (fechaVenc < hoy) {
                        claseEstado = 'pendiente vencida';
                        textoEstado = 'Vencida';
                    } else {
                        claseEstado = 'pendiente';
                        textoEstado = 'Pendiente';
                    }
                }
                
                let colorPrioridad = '#718096';
                if (tarea.prioridad === 'media') colorPrioridad = '#d69e2e';
                else if (tarea.prioridad === 'alta') colorPrioridad = '#ed8936';
                else if (tarea.prioridad === 'urgente') colorPrioridad = '#c53030';
                
                html += `
                    <div class="tarea-item ${claseEstado}" data-id="${tarea.id}">
                        <div class="tarea-titulo">
                            ${tarea.titulo}
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="etiqueta-estado ${tarea.estado === 'pendiente' ? 'etiqueta-pendiente' : tarea.estado === 'completada' ? 'etiqueta-completada' : 'etiqueta-en-progreso'}">
                                    ${textoEstado}
                                </span>
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${colorPrioridad};" title="Prioridad ${tarea.prioridad}"></div>
                            </div>
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-calendar"></i> Vence: ${fechaLegible}
                        </div>
                        <div class="tarea-descripcion">${tarea.descripcion || 'Sin descripci贸n'}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div>${tarea.funcion ? `<i class="fas fa-briefcase"></i> ${tarea.funcion}` : ''}</div>
                            <div>
                                <button class="btn-accion-archivo" onclick="marcarTareaCompletada('${tarea.id}')" title="${tarea.estado === 'completada' ? 'Marcar pendiente' : 'Marcar completada'}"><i class="fas ${tarea.estado === 'completada' ? 'fa-undo' : 'fa-check'}"></i></button>
                                <button class="btn-accion-archivo" onclick="editarTarea('${tarea.id}')" title="Editar"><i class="fas fa-edit"></i></button>
                                <button class="btn-accion-archivo btn-eliminar" onclick="eliminarTarea('${tarea.id}')" title="Eliminar"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function marcarTareaCompletada(id) {
            const tarea = estadoSistema.datos.tareas.find(t => t.id === id);
            if (!tarea) return;
            
            const nuevoEstado = tarea.estado === 'completada' ? 'pendiente' : 'completada';
            tarea.estado = nuevoEstado;
            tarea.completada = nuevoEstado === 'completada';
            
            guardarDatos();
            cargarTareas();
            actualizarDashboard();
            
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
            }
            
            mostrarNotificacion(`Tarea marcada como ${nuevoEstado}`, 'exito');
        }
        
        function editarTarea(id) {
            const tarea = estadoSistema.datos.tareas.find(t => t.id === id);
            if (!tarea) return;
            
            document.getElementById('titulo-tarea').value = tarea.titulo;
            document.getElementById('fecha-vencimiento-tarea').value = tarea.fechaVencimiento;
            document.getElementById('funcion-tarea').value = tarea.funcion || '';
            document.getElementById('prioridad-tarea').value = tarea.prioridad || 'media';
            document.getElementById('descripcion-tarea').value = tarea.descripcion || '';
            document.getElementById('estado-tarea').value = tarea.estado || 'pendiente';
            
            const btnGuardar = document.getElementById('btnGuardarTarea');
            const textoOriginal = btnGuardar.innerHTML;
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Actualizar Tarea';
            btnGuardar.onclick = () => actualizarTarea(id);
            
            const btnCancelar = document.createElement('button');
            btnCancelar.className = 'boton boton-advertencia';
            btnCancelar.innerHTML = '<i class="fas fa-times"></i> Cancelar';
            btnCancelar.style.marginTop = '15px';
            btnCancelar.onclick = () => {
                btnGuardar.innerHTML = textoOriginal;
                btnGuardar.onclick = guardarTarea;
                btnCancelar.remove();
                document.getElementById('titulo-tarea').value = '';
                document.getElementById('fecha-vencimiento-tarea').value = formatearFechaCR();
                document.getElementById('funcion-tarea').value = '';
                document.getElementById('prioridad-tarea').value = 'media';
                document.getElementById('descripcion-tarea').value = '';
                document.getElementById('estado-tarea').value = 'pendiente';
            };
            
            document.querySelector('.formulario-tarea').appendChild(btnCancelar);
            document.querySelector('[data-seccion="tareas"]').click();
        }
        
        function actualizarTarea(id) {
            const titulo = document.getElementById('titulo-tarea').value.trim();
            const fechaVencimiento = document.getElementById('fecha-vencimiento-tarea').value;
            const funcion = document.getElementById('funcion-tarea').value;
            const prioridad = document.getElementById('prioridad-tarea').value;
            const descripcion = document.getElementById('descripcion-tarea').value.trim();
            const estado = document.getElementById('estado-tarea').value;
            
            const index = estadoSistema.datos.tareas.findIndex(t => t.id === id);
            if (index === -1) return;
            
            estadoSistema.datos.tareas[index] = {
                ...estadoSistema.datos.tareas[index],
                titulo: titulo,
                fechaVencimiento: fechaVencimiento,
                funcion: funcion || '',
                prioridad: prioridad,
                descripcion: descripcion,
                estado: estado,
                completada: estado === 'completada'
            };
            
            guardarDatos();
            mostrarNotificacion('Tarea actualizada', 'exito');
            cargarTareas();
            actualizarDashboard();
            
            const btnGuardar = document.getElementById('btnGuardarTarea');
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Guardar Tarea';
            btnGuardar.onclick = guardarTarea;
            
            const btnCancelar = document.querySelector('.formulario-tarea .boton-advertencia');
            if (btnCancelar) btnCancelar.remove();
            
            document.getElementById('titulo-tarea').value = '';
            document.getElementById('fecha-vencimiento-tarea').value = formatearFechaCR();
            document.getElementById('funcion-tarea').value = '';
            document.getElementById('prioridad-tarea').value = 'media';
            document.getElementById('descripcion-tarea').value = '';
            document.getElementById('estado-tarea').value = 'pendiente';
        }
        
        function eliminarTarea(id) {
            if (!confirm('驴Eliminar esta tarea?')) return;
            
            const index = estadoSistema.datos.tareas.findIndex(t => t.id === id);
            if (index === -1) return;
            
            estadoSistema.datos.tareas.splice(index, 1);
            guardarDatos();
            mostrarNotificacion('Tarea eliminada', 'exito');
            cargarTareas();
            actualizarDashboard();
            
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
            }
        }
        
        function filtrarTareas(filtro) {
            const tareas = estadoSistema.datos.tareas;
            let tareasFiltradas = [];
            const hoy = new Date(formatearFechaCR());
            
            switch(filtro) {
                case 'pendientes':
                    tareasFiltradas = tareas.filter(t => t.estado !== 'completada');
                    break;
                case 'completadas':
                    tareasFiltradas = tareas.filter(t => t.estado === 'completada');
                    break;
                case 'vencidas':
                    tareasFiltradas = tareas.filter(t => {
                        const fechaVenc = new Date(t.fechaVencimiento);
                        return fechaVenc < hoy && t.estado !== 'completada';
                    });
                    break;
                default:
                    tareasFiltradas = tareas;
                    break;
            }
            
            const contenedor = document.getElementById('lista-tareas-activas');
            
            if (tareasFiltradas.length === 0) {
                contenedor.innerHTML = '<div class="estado-vacio"><i class="fas fa-tasks"></i><p>No hay tareas</p></div>';
                return;
            }
            
            tareasFiltradas.sort((a, b) => new Date(a.fechaVencimiento) - new Date(b.fechaVencimiento));
            
            let html = '';
            tareasFiltradas.forEach(tarea => {
                const fechaLegible = formatearFechaLegible(tarea.fechaVencimiento);
                let claseEstado = '';
                let textoEstado = '';
                if (tarea.estado === 'completada') {
                    claseEstado = 'completada';
                    textoEstado = 'Completada';
                } else if (tarea.estado === 'en-progreso') {
                    claseEstado = 'en-progreso';
                    textoEstado = 'En Progreso';
                } else {
                    const hoy = new Date(formatearFechaCR());
                    const fechaVenc = new Date(tarea.fechaVencimiento);
                    if (fechaVenc < hoy) {
                        claseEstado = 'pendiente vencida';
                        textoEstado = 'Vencida';
                    } else {
                        claseEstado = 'pendiente';
                        textoEstado = 'Pendiente';
                    }
                }
                
                let colorPrioridad = '#718096';
                if (tarea.prioridad === 'media') colorPrioridad = '#d69e2e';
                else if (tarea.prioridad === 'alta') colorPrioridad = '#ed8936';
                else if (tarea.prioridad === 'urgente') colorPrioridad = '#c53030';
                
                html += `
                    <div class="tarea-item ${claseEstado}" data-id="${tarea.id}">
                        <div class="tarea-titulo">
                            ${tarea.titulo}
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="etiqueta-estado ${tarea.estado === 'pendiente' ? 'etiqueta-pendiente' : tarea.estado === 'completada' ? 'etiqueta-completada' : 'etiqueta-en-progreso'}">
                                    ${textoEstado}
                                </span>
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${colorPrioridad};"></div>
                            </div>
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-calendar"></i> Vence: ${fechaLegible}
                        </div>
                        <div class="tarea-descripcion">${tarea.descripcion || 'Sin descripci贸n'}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div>${tarea.funcion ? `<i class="fas fa-briefcase"></i> ${tarea.funcion}` : ''}</div>
                            <div>
                                <button class="btn-accion-archivo" onclick="marcarTareaCompletada('${tarea.id}')"><i class="fas ${tarea.estado === 'completada' ? 'fa-undo' : 'fa-check'}"></i></button>
                                <button class="btn-accion-archivo" onclick="editarTarea('${tarea.id}')"><i class="fas fa-edit"></i></button>
                                <button class="btn-accion-archivo btn-eliminar" onclick="eliminarTarea('${tarea.id}')"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        // ===== CALENDARIO =====
        function inicializarCalendario() {
            renderizarCalendario();
        }
        
        function renderizarCalendario() {
            const cuadricula = document.getElementById('cuadriculaMes');
            const mesAnioActual = document.getElementById('mesAnioActual');
            
            const nombresMeses = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
            mesAnioActual.textContent = `${nombresMeses[estadoSistema.mesCalendario]} ${estadoSistema.anioCalendario}`;
            
            const primerDia = new Date(estadoSistema.anioCalendario, estadoSistema.mesCalendario, 1);
            const ultimoDia = new Date(estadoSistema.anioCalendario, estadoSistema.mesCalendario + 1, 0);
            const primerDiaSemana = primerDia.getDay();
            const diasEnMes = ultimoDia.getDate();
            const fechaActual = formatearFechaCR();
            
            cuadricula.innerHTML = '';
            
            // D铆as mes anterior
            for (let i = 0; i < primerDiaSemana; i++) {
                const celda = document.createElement('div');
                celda.className = 'celda-dia fuera-mes';
                celda.innerHTML = `<div class="numero-dia">${new Date(estadoSistema.anioCalendario, estadoSistema.mesCalendario, -i).getDate()}</div>`;
                cuadricula.appendChild(celda);
            }
            
            // D铆as mes actual
            for (let dia = 1; dia <= diasEnMes; dia++) {
                const fechaCompleta = `${estadoSistema.anioCalendario}-${String(estadoSistema.mesCalendario + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                const esHoy = fechaCompleta === fechaActual;
                
                const tareasDia = estadoSistema.datos.tareas.filter(t => t.fechaVencimiento === fechaCompleta);
                const bitacorasDia = estadoSistema.datos.bitacoras.filter(b => b.fecha === fechaCompleta);
                const archivosDia = estadoSistema.datos.archivos.filter(a => a.fechaArchivo === fechaCompleta);
                
                const celda = document.createElement('div');
                celda.className = 'celda-dia' + (esHoy ? ' hoy' : '');
                celda.innerHTML = `
                    <div class="numero-dia">${dia}</div>
                    <div class="indicadores-actividad">
                        ${tareasDia.length > 0 ? '<div class="punto-actividad punto-tarea"></div>' : ''}
                        ${bitacorasDia.length > 0 ? '<div class="punto-actividad punto-bitacora"></div>' : ''}
                        ${archivosDia.length > 0 ? '<div class="punto-actividad punto-archivo"></div>' : ''}
                    </div>
                `;
                
                celda.setAttribute('data-fecha', fechaCompleta);
                celda.addEventListener('click', () => mostrarDetalleDia(fechaCompleta));
                cuadricula.appendChild(celda);
            }
            
            // D铆as mes siguiente
            const celdasTotales = 42;
            const celdasPuestas = primerDiaSemana + diasEnMes;
            const diasSiguienteMes = celdasTotales - celdasPuestas;
            
            for (let dia = 1; dia <= diasSiguienteMes; dia++) {
                const celda = document.createElement('div');
                celda.className = 'celda-dia fuera-mes';
                celda.innerHTML = `<div class="numero-dia">${dia}</div>`;
                cuadricula.appendChild(celda);
            }
        }
        
        function mostrarDetalleDia(fecha) {
            document.getElementById('fecha-seleccionada-texto').textContent = formatearFechaLegible(fecha);
            document.getElementById('detalle-dia-seleccionado').style.display = 'block';
            
            const tareasDia = estadoSistema.datos.tareas.filter(t => t.fechaVencimiento === fecha);
            const bitacorasDia = estadoSistema.datos.bitacoras.filter(b => b.fecha === fecha);
            const archivosDia = estadoSistema.datos.archivos.filter(a => a.fechaArchivo === fecha);
            
            // Tareas
            const contenedorTareas = document.getElementById('tareas-del-dia');
            if (tareasDia.length === 0) {
                contenedorTareas.innerHTML = '<div class="estado-vacio"><p>No hay tareas</p><button class="boton boton-exito" onclick="crearTareaDesdeCalendario(\'' + fecha + '\')"><i class="fas fa-plus"></i> Crear Tarea</button></div>';
            } else {
                let html = '';
                tareasDia.forEach(tarea => {
                    let colorPrioridad = '#718096';
                    if (tarea.prioridad === 'media') colorPrioridad = '#d69e2e';
                    else if (tarea.prioridad === 'alta') colorPrioridad = '#ed8936';
                    else if (tarea.prioridad === 'urgente') colorPrioridad = '#c53030';
                    
                    html += `
                        <div class="tarea-item ${tarea.estado === 'completada' ? 'completada' : 'pendiente'}">
                            <div class="tarea-titulo">
                                ${tarea.titulo}
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${colorPrioridad};"></div>
                            </div>
                            <div class="tarea-descripcion">${tarea.descripcion || 'Sin descripci贸n'}</div>
                            <div style="margin-top: 10px;">
                                <span class="etiqueta-estado ${tarea.estado === 'pendiente' ? 'etiqueta-pendiente' : tarea.estado === 'completada' ? 'etiqueta-completada' : 'etiqueta-en-progreso'}">
                                    ${tarea.estado === 'pendiente' ? 'Pendiente' : tarea.estado === 'completada' ? 'Completada' : 'En Progreso'}
                                </span>
                                <button class="btn-accion-archivo" onclick="editarTarea('${tarea.id}')"><i class="fas fa-edit"></i></button>
                            </div>
                        </div>
                    `;
                });
                contenedorTareas.innerHTML = html;
            }
            
            // Bit谩coras
            const contenedorBitacoras = document.getElementById('bitacoras-del-dia');
            if (bitacorasDia.length === 0) {
                contenedorBitacoras.innerHTML = '<div class="estado-vacio"><p>No hay bit谩coras</p><button class="boton boton-principal" onclick="crearBitacoraDesdeCalendario(\'' + fecha + '\')"><i class="fas fa-plus"></i> Crear Bit谩cora</button></div>';
            } else {
                let html = '';
                bitacorasDia.forEach(bitacora => {
                    const funcionTexto = {
                        'orientacion': 'Orientaciones curriculares',
                        'evaluacion': 'Evaluaci贸n de aprendizajes',
                        'seguimiento': 'Seguimiento curricular',
                        'coordinacion': 'Coordinaciones',
                        'formacion': 'Formaci贸n docente',
                        'monitoreo': 'Monitoreo',
                        'informes': 'Informes',
                        'investigacion': 'Investigaci贸n',
                        'desarrollo': 'Desarrollo'
                    }[bitacora.funcion] || bitacora.funcion;
                    
                    const badgeClass = bitacora.modalidad === 'teletrabajo' ? 'badge-teletrabajo' : 
                                     bitacora.modalidad === 'presencial' ? 'badge-presencial' : 'badge-mixto';
                    
                    html += `
                        <div class="tarea-item">
                            <div class="tarea-titulo">
                                ${funcionTexto}
                                <span class="badge ${badgeClass}">${bitacora.modalidad === 'teletrabajo' ? 'Teletrabajo' : bitacora.modalidad === 'presencial' ? 'Presencial' : 'Mixto'}</span>
                            </div>
                            <div class="tarea-fecha"><i class="far fa-clock"></i> ${bitacora.horas} horas</div>
                            <div class="tarea-descripcion">${bitacora.descripcion.substring(0, 150)}${bitacora.descripcion.length > 150 ? '...' : ''}</div>
                            <div style="margin-top: 10px;">
                                <button class="btn-accion-archivo" onclick="editarBitacora('${bitacora.id}')"><i class="fas fa-edit"></i></button>
                            </div>
                        </div>
                    `;
                });
                contenedorBitacoras.innerHTML = html;
            }
            
            // Archivos
            const contenedorArchivos = document.getElementById('archivos-del-dia');
            if (archivosDia.length === 0) {
                contenedorArchivos.innerHTML = '<div class="estado-vacio"><p>No hay archivos</p></div>';
            } else {
                let html = '';
                archivosDia.forEach(archivo => {
                    let claseIcono = 'otro';
                    if (archivo.tipo.includes('pdf')) claseIcono = 'pdf';
                    else if (archivo.tipo.includes('word') || archivo.nombre.match(/\.(doc|docx)$/i)) claseIcono = 'word';
                    else if (archivo.tipo.includes('excel') || archivo.nombre.match(/\.(xls|xlsx|csv)$/i)) claseIcono = 'excel';
                    else if (archivo.tipo.includes('powerpoint') || archivo.nombre.match(/\.(ppt|pptx)$/i)) claseIcono = 'powerpoint';
                    else if (archivo.tipo.includes('image')) claseIcono = 'imagen';
                    
                    let icono = 'fas fa-file';
                    if (claseIcono === 'pdf') icono = 'fas fa-file-pdf';
                    else if (claseIcono === 'word') icono = 'fas fa-file-word';
                    else if (claseIcono === 'excel') icono = 'fas fa-file-excel';
                    else if (claseIcono === 'powerpoint') icono = 'fas fa-file-powerpoint';
                    else if (claseIcono === 'imagen') icono = 'fas fa-file-image';
                    
                    html += `
                        <div class="tarjeta-archivo" style="margin-bottom: 15px;">
                            <div class="icono-archivo ${claseIcono}"><i class="${icono}"></i></div>
                            <div class="nombre-archivo">${archivo.nombre.length > 20 ? archivo.nombre.substring(0, 20) + '...' : archivo.nombre}</div>
                            <div class="acciones-archivo">
                                <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')"><i class="fas fa-eye"></i></button>
                                <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')"><i class="fas fa-download"></i></button>
                            </div>
                        </div>
                    `;
                });
                contenedorArchivos.innerHTML = html;
            }
        }
        
        function crearTareaDesdeCalendario(fecha) {
            document.querySelector('[data-seccion="tareas"]').click();
            document.getElementById('fecha-vencimiento-tarea').value = fecha;
        }
        
        function crearBitacoraDesdeCalendario(fecha) {
            document.querySelector('[data-seccion="bitacora"]').click();
            document.getElementById('fecha-bitacora').value = fecha;
        }
        
        // ===== DASHBOARD =====
        function actualizarDashboard() {
            const totalBitacoras = estadoSistema.datos.bitacoras.length;
            const totalTareas = estadoSistema.datos.tareas.filter(t => t.estado !== 'completada').length;
            const totalArchivos = estadoSistema.datos.archivos.length;
            
            let horasTeletrabajo = 0;
            let horasPresencial = 0;
            estadoSistema.datos.bitacoras.forEach(b => {
                if (b.modalidad === 'teletrabajo') horasTeletrabajo += b.horas;
                else if (b.modalidad === 'presencial') horasPresencial += b.horas;
                else {
                    horasTeletrabajo += b.horas / 2;
                    horasPresencial += b.horas / 2;
                }
            });
            
            const fechasConActividad = new Set();
            estadoSistema.datos.bitacoras.forEach(b => fechasConActividad.add(b.fecha));
            estadoSistema.datos.tareas.forEach(t => fechasConActividad.add(t.fechaVencimiento));
            
            document.getElementById('total-bitacoras').textContent = totalBitacoras;
            document.getElementById('total-tareas').textContent = totalTareas;
            document.getElementById('total-archivos').textContent = totalArchivos;
            document.getElementById('horas-teletrabajo').textContent = horasTeletrabajo.toFixed(1) + 'h';
            document.getElementById('horas-presencial').textContent = horasPresencial.toFixed(1) + 'h';
            document.getElementById('dias-activos').textContent = fechasConActividad.size;
            
            actualizarActividadReciente();
        }
        
        function actualizarActividadReciente() {
            const contenedor = document.getElementById('lista-actividad-reciente');
            const actividades = [];
            
            estadoSistema.datos.bitacoras.forEach(b => {
                actividades.push({
                    tipo: 'bitacora',
                    fecha: b.fecha,
                    titulo: `Bit谩cora: ${b.funcion}`,
                    descripcion: b.descripcion.substring(0, 100),
                    modalidad: b.modalidad,
                    horas: b.horas
                });
            });
            
            estadoSistema.datos.tareas.forEach(t => {
                actividades.push({
                    tipo: 'tarea',
                    fecha: t.fechaVencimiento,
                    titulo: `Tarea: ${t.titulo}`,
                    descripcion: t.descripcion || 'Sin descripci贸n',
                    estado: t.estado
                });
            });
            
            actividades.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
            const actividadesRecientes = actividades.slice(0, 10);
            
            if (actividadesRecientes.length === 0) {
                contenedor.innerHTML = '<div class="estado-vacio"><i class="fas fa-stream"></i><p>No hay actividad</p></div>';
                return;
            }
            
            let html = '';
            actividadesRecientes.forEach(actividad => {
                const fechaLegible = formatearFechaLegible(actividad.fecha);
                const icono = actividad.tipo === 'bitacora' ? 
                    (actividad.modalidad === 'teletrabajo' ? 'fa-laptop-house' : 'fa-building') : 
                    (actividad.estado === 'completada' ? 'fa-check-circle' : 'fa-tasks');
                
                const color = actividad.tipo === 'bitacora' ? 
                    (actividad.modalidad === 'teletrabajo' ? 'var(--mep-verde)' : 'var(--mep-naranja)') : 
                    (actividad.estado === 'completada' ? 'var(--mep-verde)' : 'var(--mep-azul-principal)');
                
                html += `
                    <div class="tarea-item" style="margin-bottom: 15px;">
                        <div class="tarea-titulo"><i class="fas ${icono}" style="color: ${color};"></i> ${actividad.titulo}</div>
                        <div class="tarea-fecha"><i class="far fa-calendar"></i> ${fechaLegible}${actividad.tipo === 'bitacora' ? ` | <i class="far fa-clock"></i> ${actividad.horas} horas` : ''}</div>
                        <div class="tarea-descripcion">${actividad.descripcion}</div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        // ===== INFORMES =====
        function generarInforme() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas', 'error');
                return;
            }
            
            const bitacorasFiltradas = estadoSistema.datos.bitacoras.filter(b => {
                const fechaBitacora = new Date(b.fecha);
                return fechaBitacora >= new Date(fechaInicio) && fechaBitacora <= new Date(fechaFin);
            });
            
            const tareasFiltradas = estadoSistema.datos.tareas.filter(t => {
                const fechaTarea = new Date(t.fechaVencimiento);
                return fechaTarea >= new Date(fechaInicio) && fechaTarea <= new Date(fechaFin);
            });
            
            if (bitacorasFiltradas.length === 0 && tareasFiltradas.length === 0) {
                mostrarNotificacion('No hay actividades en ese per铆odo', 'error');
                return;
            }
            
            let totalHoras = 0;
            let horasTeletrabajo = 0;
            let horasPresencial = 0;
            let horasMixto = 0;
            const funcionesContador = {};
            
            bitacorasFiltradas.forEach(b => {
                totalHoras += b.horas;
                if (b.modalidad === 'teletrabajo') horasTeletrabajo += b.horas;
                else if (b.modalidad === 'presencial') horasPresencial += b.horas;
                else horasMixto += b.horas;
                
                funcionesContador[b.funcion] = (funcionesContador[b.funcion] || 0) + 1;
            });
            
            let contenidoHTML = `
                <h2 style="color: var(--mep-azul-principal);">Informe DRTE MEP</h2>
                <p><strong>Per铆odo:</strong> ${formatearFechaLegible(fechaInicio)} al ${formatearFechaLegible(fechaFin)}</p>
                <p><strong>Generado:</strong> ${formatearFechaLegible()}</p>
                <hr style="margin: 25px 0;">
                
                <h3>Estad铆sticas</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-azul-principal);">
                        <strong>Bit谩coras</strong><br><span style="font-size: 1.5rem; font-weight: bold;">${bitacorasFiltradas.length}</span>
                    </div>
                    <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-verde);">
                        <strong>Horas Totales</strong><br><span style="font-size: 1.5rem; font-weight: bold;">${totalHoras.toFixed(1)}</span>
                    </div>
                    <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-naranja);">
                        <strong>Tareas</strong><br><span style="font-size: 1.5rem; font-weight: bold;">${tareasFiltradas.length}</span>
                    </div>
                </div>
                
                <h3>Distribuci贸n por Modalidad</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <div style="background: #f0fff4; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-verde);">
                        <strong>Teletrabajo</strong><br>${horasTeletrabajo.toFixed(1)} horas<br>${totalHoras > 0 ? ((horasTeletrabajo / totalHoras) * 100).toFixed(1) : 0}%
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-naranja);">
                        <strong>Presencial</strong><br>${horasPresencial.toFixed(1)} horas<br>${totalHoras > 0 ? ((horasPresencial / totalHoras) * 100).toFixed(1) : 0}%
                    </div>
                    <div style="background: #ebf8ff; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-azul-principal);">
                        <strong>Mixto</strong><br>${horasMixto.toFixed(1)} horas<br>${totalHoras > 0 ? ((horasMixto / totalHoras) * 100).toFixed(1) : 0}%
                    </div>
                </div>
            `;
            
            if (bitacorasFiltradas.length > 0) {
                contenidoHTML += `<h3>Detalle de Bit谩coras (${bitacorasFiltradas.length})</h3><table style="width: 100%; border-collapse: collapse; margin-top: 10px;">`;
                contenidoHTML += `<tr style="background: #f7fafc; font-weight: bold;">
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Fecha</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Funci贸n</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Modalidad</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Horas</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Descripci贸n</td>
                </tr>`;
                
                bitacorasFiltradas.forEach(b => {
                    const funcionTexto = {
                        'orientacion': 'Orientaciones curriculares',
                        'evaluacion': 'Evaluaci贸n de aprendizajes',
                        'seguimiento': 'Seguimiento curricular',
                        'coordinacion': 'Coordinaciones',
                        'formacion': 'Formaci贸n docente',
                        'monitoreo': 'Monitoreo',
                        'informes': 'Informes',
                        'investigacion': 'Investigaci贸n',
                        'desarrollo': 'Desarrollo'
                    }[b.funcion] || b.funcion;
                    
                    contenidoHTML += `<tr>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${formatearFechaLegible(b.fecha)}</td>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${funcionTexto}</td>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${b.modalidad === 'teletrabajo' ? 'Teletrabajo' : b.modalidad === 'presencial' ? 'Presencial' : 'Mixto'}</td>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${b.horas}</td>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${b.descripcion.substring(0, 100)}${b.descripcion.length > 100 ? '...' : ''}</td>
                    </tr>`;
                });
                contenidoHTML += `</table>`;
            }
            
            if (tareasFiltradas.length > 0) {
                contenidoHTML += `<h3 style="margin-top: 30px;">Tareas (${tareasFiltradas.length})</h3><table style="width: 100%; border-collapse: collapse; margin-top: 10px;">`;
                contenidoHTML += `<tr style="background: #f7fafc; font-weight: bold;">
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">T铆tulo</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Vence</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Prioridad</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">Estado</td>
                </tr>`;
                
                tareasFiltradas.forEach(t => {
                    contenidoHTML += `<tr>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${t.titulo}</td>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${formatearFechaLegible(t.fechaVencimiento)}</td>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${t.prioridad}</td>
                        <td style="padding: 10px; border: 1px solid #e2e8f0;">${t.estado === 'pendiente' ? 'Pendiente' : t.estado === 'completada' ? 'Completada' : 'En Progreso'}</td>
                    </tr>`;
                });
                contenidoHTML += `</table>`;
            }
            
            contenidoHTML += `
                <hr style="margin: 40px 0;">
                <div style="text-align: right;">
                    <p><strong>Asesor Nacional DRTE MEP</strong></p>
                    <p>Kevin S谩nchez Bogar铆n</p>
                    <p>${formatearFechaLegible()}</p>
                </div>
            `;
            
            document.getElementById('contenido-informe').innerHTML = contenidoHTML;
            document.getElementById('vistaPreviaInforme').style.display = 'block';
            mostrarNotificacion('Informe generado', 'exito');
        }
        
        function exportarAExcel() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas', 'error');
                return;
            }
            
            const bitacorasFiltradas = estadoSistema.datos.bitacoras.filter(b => {
                const fechaBitacora = new Date(b.fecha);
                return fechaBitacora >= new Date(fechaInicio) && fechaBitacora <= new Date(fechaFin);
            });
            
            if (bitacorasFiltradas.length === 0) {
                mostrarNotificacion('No hay bit谩coras', 'error');
                return;
            }
            
            let csvContent = "Fecha,Modalidad,Funci贸n,Horas,Descripci贸n\n";
            
            bitacorasFiltradas.forEach(b => {
                const funcionTexto = {
                    'orientacion': 'Orientaciones curriculares',
                    'evaluacion': 'Evaluaci贸n de aprendizajes',
                    'seguimiento': 'Seguimiento curricular',
                    'coordinacion': 'Coordinaciones',
                    'formacion': 'Formaci贸n docente',
                    'monitoreo': 'Monitoreo',
                    'informes': 'Informes',
                    'investigacion': 'Investigaci贸n',
                    'desarrollo': 'Desarrollo'
                }[b.funcion] || b.funcion;
                
                const descripcionEscapada = b.descripcion.replace(/"/g, '""');
                csvContent += `"${formatearFechaLegible(b.fecha)}","${b.modalidad}","${funcionTexto}","${b.horas}","${descripcionEscapada}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Informe_DRTE_${fechaInicio}_a_${fechaFin}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            mostrarNotificacion('CSV exportado', 'exito');
        }
        
        function exportarAPDF() {
            const contenido = document.getElementById('contenido-informe');
            if (!contenido || !contenido.innerHTML.trim()) {
                mostrarNotificacion('Genere un informe primero', 'error');
                return;
            }
            
            // Simular exportaci贸n PDF
            const ventana = window.open('', '_blank');
            ventana.document.write(`
                <html>
                    <head>
                        <title>Informe DRTE MEP</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 40px; }
                            h1 { color: #0056a6; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                        </style>
                    </head>
                    <body>
                        ${contenido.innerHTML}
                    </body>
                </html>
            `);
            ventana.document.close();
            ventana.print();
            
            mostrarNotificacion('PDF listo para imprimir', 'info');
        }
        
        function copiarInformeParaCorreo() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas', 'error');
                return;
            }
            
            const bitacorasFiltradas = estadoSistema.datos.bitacoras.filter(b => {
                const fechaBitacora = new Date(b.fecha);
                return fechaBitacora >= new Date(fechaInicio) && fechaBitacora <= new Date(fechaFin);
            });
            
            if (bitacorasFiltradas.length === 0) {
                mostrarNotificacion('No hay bit谩coras', 'error');
                return;
            }
            
            let totalHoras = 0;
            bitacorasFiltradas.forEach(b => totalHoras += b.horas);
            
            const textoCorreo = `INFORME DRTE MEP
Per铆odo: ${formatearFechaLegible(fechaInicio)} al ${formatearFechaLegible(fechaFin)}
Bit谩coras: ${bitacorasFiltradas.length}
Horas totales: ${totalHoras.toFixed(1)}
Generado: ${formatearFechaLegible()}

Detalle:
${bitacorasFiltradas.map(b => {
    const funcionTexto = {
        'orientacion': 'Orientaciones curriculares',
        'evaluacion': 'Evaluaci贸n de aprendizajes',
        'seguimiento': 'Seguimiento curricular',
        'coordinacion': 'Coordinaciones',
        'formacion': 'Formaci贸n docente',
        'monitoreo': 'Monitoreo',
        'informes': 'Informes',
        'investigacion': 'Investigaci贸n',
        'desarrollo': 'Desarrollo'
    }[b.funcion] || b.funcion;
    
    return ` ${formatearFechaLegible(b.fecha)} - ${funcionTexto} (${b.modalidad}): ${b.horas} horas`;
}).join('\n')}

---
Asesor Nacional DRTE MEP
Kevin S谩nchez Bogar铆n`;

            navigator.clipboard.writeText(textoCorreo).then(() => {
                mostrarNotificacion('Copiado al portapapeles', 'exito');
            });
        }
        
        function imprimirInforme() {
            const contenido = document.getElementById('contenido-informe');
            if (!contenido || !contenido.innerHTML.trim()) {
                mostrarNotificacion('Genere un informe primero', 'error');
                return;
            }
            
            const ventana = window.open('', '_blank');
            ventana.document.write(`
                <html>
                    <head><title>Informe DRTE MEP</title></head>
                    <body>${contenido.innerHTML}</body>
                </html>
            `);
            ventana.document.close();
            ventana.print();
        }
        
        // ===== UTILIDADES =====
        function guardarDatos() {
            localStorage.setItem('drte_bitacoras', JSON.stringify(estadoSistema.datos.bitacoras));
            localStorage.setItem('drte_tareas', JSON.stringify(estadoSistema.datos.tareas));
            localStorage.setItem('drte_archivos', JSON.stringify(estadoSistema.datos.archivos));
        }
        
        function crearRespaldoManual() {
            const datosRespaldo = {
                version: SISTEMA_VERSION,
                fechaRespaldo: new Date().toISOString(),
                datos: estadoSistema.datos
            };
            
            const jsonRespaldo = JSON.stringify(datosRespaldo, null, 2);
            const blob = new Blob([jsonRespaldo], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Respaldo_DRTE_${formatearFechaCR().replace(/-/g, '')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            mostrarNotificacion('Respaldo creado', 'exito');
        }
        
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const contenedor = document.getElementById('contenedorNotificaciones');
            const id = 'notificacion_' + Date.now();
            
            const notificacion = document.createElement('div');
            notificacion.id = id;
            notificacion.className = `notificacion ${tipo}`;
            notificacion.innerHTML = `
                <i class="fas ${tipo === 'exito' ? 'fa-check-circle' : tipo === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${mensaje}</span>
            `;
            
            contenedor.appendChild(notificacion);
            
            setTimeout(() => {
                const notif = document.getElementById(id);
                if (notif) {
                    notif.style.animation = 'deslizarSalida 0.4s ease forwards';
                    setTimeout(() => notif.remove(), 400);
                }
            }, 5000);
        }
        
        function actualizarFechaHora() {
            const elemento = document.getElementById('fecha-hora-cr');
            const actualizar = () => {
                const fecha = new Date();
                elemento.textContent = fecha.toLocaleDateString('es-CR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };
            actualizar();
            setInterval(actualizar, 60000);
        }
        
        // Exportar funciones al scope global
        window.verArchivo = verArchivo;
        window.descargarArchivo = descargarArchivo;
        window.eliminarArchivo = eliminarArchivo;
        window.editarBitacora = editarBitacora;
        window.eliminarBitacora = eliminarBitacora;
        window.marcarTareaCompletada = marcarTareaCompletada;
        window.editarTarea = editarTarea;
        window.eliminarTarea = eliminarTarea;
        window.crearTareaDesdeCalendario = crearTareaDesdeCalendario;
        window.crearBitacoraDesdeCalendario = crearBitacoraDesdeCalendario;
    </script>
</body>
</html>
