<!DOCTYPE html>
<html lang="es-CR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRTE MEP - Sistema Integral de Agenda y Evidencias</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22></text></svg>">
    
    <!-- Script para jsPDF (Exportaci贸n a PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        :root {
            /* Paleta Institucional DRTE MEP */
            --mep-azul-principal: #0056a6;
            --mep-azul-secundario: #0072ce;
            --mep-verde: #00a859;
            --mep-naranja: #f26522;
            --mep-rojo: #e53e3e;
            --mep-gris-institucional: #4a5c7a;
            --mep-blanco-hueso: #f8f9fa;
            
            /* Modo Claro (Por defecto) */
            --color-fondo: #f0f5ff;
            --color-fondo-tarjeta: rgba(255, 255, 255, 0.85);
            --color-texto: #1a365d;
            --color-texto-secundario: #4a5568;
            --color-borde: rgba(0, 86, 166, 0.15);
            --sombra-suave: 0 8px 32px rgba(0, 86, 166, 0.08);
            --sombra-fuerte: 0 12px 40px rgba(0, 0, 0, 0.1);
            --gradiente-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.5) 100%);
            --gradiente-primario: linear-gradient(135deg, var(--mep-azul-principal) 0%, #003a75 100%);
            --radio-borde: 18px;
        }
        
        /* Modo Oscuro */
        [data-tema="oscuro"] {
            --color-fondo: #0f172a;
            --color-fondo-tarjeta: rgba(30, 41, 59, 0.85);
            --color-texto: #e2e8f0;
            --color-texto-secundario: #94a3b8;
            --color-borde: rgba(148, 163, 184, 0.2);
            --sombra-suave: 0 8px 32px rgba(0, 0, 0, 0.3);
            --sombra-fuerte: 0 12px 40px rgba(0, 0, 0, 0.4);
            --gradiente-glass: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.6) 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: var(--color-fondo);
            color: var(--color-texto);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.4s ease, color 0.4s ease;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(0, 86, 166, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 168, 89, 0.05) 0%, transparent 50%);
            z-index: -1;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        /* ===== HEADER Y NAVEGACIN MEJORADOS ===== */
        .header-sistema {
            background: var(--gradiente-glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--radio-borde);
            padding: 25px 40px;
            margin-bottom: 25px;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            overflow: hidden;
        }
        
        .header-sistema::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3));
            pointer-events: none;
        }
        
        .logo-mep {
            display: flex;
            align-items: center;
            gap: 22px;
        }
        
        .logo-mep i {
            font-size: 3.2rem;
            background: var(--gradiente-primario);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        
        .titulo-sistema h1 {
            color: var(--mep-azul-principal);
            font-size: 2rem;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .titulo-sistema p {
            color: var(--color-texto-secundario);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-usuario-fecha {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .fecha-actual-cr {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--mep-azul-principal);
            background: var(--color-fondo-tarjeta);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-tema {
            position: absolute;
            top: 25px;
            right: 25px;
            background: var(--color-fondo-tarjeta);
            border: 1px solid var(--color-borde);
            border-radius: 50px;
            padding: 8px;
            cursor: pointer;
            z-index: 10;
            box-shadow: var(--sombra-suave);
        }
        
        /* Navegaci贸n tipo pesta帽as profesionales */
        .nav-principal {
            background: var(--gradiente-glass);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            overflow: hidden;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
            position: relative;
        }
        
        .nav-btn {
            flex: 1;
            padding: 20px 10px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--color-texto-secundario);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 4px;
            background: var(--mep-azul-principal);
            transition: width 0.4s ease;
            border-radius: 2px 2px 0 0;
        }
        
        .nav-btn:hover {
            color: var(--mep-azul-principal);
            background: rgba(0, 86, 166, 0.05);
        }
        
        .nav-btn.activo {
            color: var(--mep-azul-principal);
            background: rgba(255, 255, 255, 0.5);
        }
        
        .nav-btn.activo::before {
            width: 80%;
        }
        
        /* ===== CONTENIDO DE SECCIONES (GLASSMORPHISM) ===== */
        .seccion-contenido {
            display: none;
            background: var(--gradiente-glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: var(--radio-borde);
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
            animation: aparecer 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes aparecer {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .seccion-contenido.visible {
            display: block;
        }
        
        .titulo-seccion {
            color: var(--mep-azul-principal);
            margin-bottom: 30px;
            padding-bottom: 18px;
            border-bottom: 2px solid var(--color-borde);
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Playfair Display', serif;
            font-weight: 600;
            font-size: 1.8rem;
        }
        
        .titulo-seccion i {
            font-size: 1.8rem;
        }
        
        /* ===== DASHBOARD CON ESTADSTICAS ===== */
        .panel-estadisticas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 22px;
            margin-bottom: 35px;
        }
        
        .tarjeta-estadistica {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 28px;
            text-align: center;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tarjeta-estadistica:hover {
            transform: translateY(-8px);
            box-shadow: var(--sombra-fuerte);
        }
        
        .tarjeta-estadistica::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--mep-azul-principal), var(--mep-verde));
        }
        
        .tarjeta-estadistica i {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--mep-azul-principal), var(--mep-verde));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .valor-estadistica {
            font-size: 2.8rem;
            font-weight: 800;
            color: var(--mep-azul-principal);
            line-height: 1;
            margin: 12px 0;
        }
        
        .etiqueta-estadistica {
            color: var(--color-texto-secundario);
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        /* ===== CALENDARIO DINMICO (ESTILO OUTLOOK/TEAMS) ===== */
        .contenedor-calendario {
            background: var(--gradiente-glass);
            backdrop-filter: blur(12px);
            border-radius: var(--radio-borde);
            padding: 30px;
            box-shadow: var(--sombra-suave);
            border: 1px solid var(--color-borde);
            margin-bottom: 30px;
        }
        
        .encabezado-calendario {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .controles-mes {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .mes-anio-actual {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--mep-azul-principal);
            min-width: 280px;
        }
        
        .btn-control-mes {
            background: var(--color-fondo-tarjeta);
            border: 1px solid var(--color-borde);
            color: var(--color-texto);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }
        
        .btn-control-mes:hover {
            background: var(--mep-azul-principal);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 86, 166, 0.3);
        }
        
        .btn-hoy {
            background: var(--mep-naranja);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(242, 101, 34, 0.3);
        }
        
        .btn-hoy:hover {
            background: #d4561a;
            transform: translateY(-3px);
        }
        
        .cuadricula-dias-semana {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .dia-semana {
            text-align: center;
            font-weight: 700;
            padding: 16px 8px;
            color: var(--mep-gris-institucional);
            background: rgba(0, 86, 166, 0.05);
            border-radius: 12px;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .cuadricula-mes {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }
        
        .celda-dia {
            aspect-ratio: 1 / 1;
            background: var(--color-fondo-tarjeta);
            border: 2px solid var(--color-borde);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding-top: 15px;
            overflow: hidden;
        }
        
        .celda-dia:hover {
            border-color: var(--mep-azul-principal);
            background: rgba(0, 86, 166, 0.08);
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 10px 25px rgba(0, 86, 166, 0.15);
            z-index: 2;
        }
        
        .celda-dia.hoy {
            background: linear-gradient(135deg, #e6f2ff, #cce5ff);
            border-color: var(--mep-azul-principal);
            color: var(--mep-azul-principal);
            font-weight: 800;
            box-shadow: 0 6px 20px rgba(0, 86, 166, 0.2);
        }
        
        .numero-dia {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            z-index: 1;
        }
        
        .indicadores-actividad {
            position: absolute;
            bottom: 10px;
            display: flex;
            gap: 4px;
            z-index: 1;
        }
        
        .punto-actividad {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .punto-tarea { background-color: var(--mep-verde); }
        .punto-bitacora { background-color: var(--mep-naranja); }
        .punto-archivo { background-color: var(--mep-azul-secundario); }
        
        .celda-dia.fuera-mes {
            background: rgba(148, 163, 184, 0.05);
            color: var(--color-texto-secundario);
            border-color: rgba(148, 163, 184, 0.2);
        }
        
        .celda-dia.fuera-mes:hover {
            background: rgba(148, 163, 184, 0.1);
        }
        
        /* ===== BITCORA DIARIA (OBLIGATORIA) ===== */
        .formulario-bitacora {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .grupo-form-grande {
            grid-column: 1 / -1;
        }
        
        .grupo-form {
            margin-bottom: 20px;
        }
        
        .etiqueta {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--color-texto);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .entrada, .area-texto, .seleccion {
            width: 100%;
            padding: 16px 20px;
            background: var(--color-fondo-tarjeta);
            border: 2px solid var(--color-borde);
            border-radius: 14px;
            font-size: 1rem;
            color: var(--color-texto);
            transition: all 0.3s;
        }
        
        .entrada:focus, .area-texto:focus, .seleccion:focus {
            outline: none;
            border-color: var(--mep-azul-principal);
            box-shadow: 0 0 0 4px rgba(0, 86, 166, 0.15);
            background: white;
        }
        
        .area-texto {
            min-height: 220px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .grupo-botones-bitacora {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            grid-column: 1 / -1;
            margin-top: 15px;
        }
        
        /* ===== GESTIN DE ARCHIVOS (DRAG & DROP) ===== */
        .zona-subida {
            border: 3px dashed var(--color-borde);
            border-radius: 20px;
            padding: 60px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s;
            background: rgba(255, 255, 255, 0.3);
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }
        
        .zona-subida.drag-over {
            border-color: var(--mep-verde);
            background: rgba(0, 168, 89, 0.08);
            transform: scale(1.02);
        }
        
        .zona-subida:hover {
            border-color: var(--mep-azul-principal);
            background: rgba(0, 86, 166, 0.08);
        }
        
        .zona-subida i {
            font-size: 4rem;
            color: var(--mep-azul-principal);
            margin-bottom: 20px;
            opacity: 0.8;
        }
        
        .info-subida {
            font-size: 1.1rem;
            color: var(--color-texto-secundario);
            margin-bottom: 10px;
        }
        
        .formatos-permitidos {
            font-size: 0.9rem;
            color: var(--mep-gris-institucional);
        }
        
        .vista-previa-archivos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .tarjeta-archivo {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px;
            border: 1px solid var(--color-borde);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            box-shadow: var(--sombra-suave);
            position: relative;
            overflow: hidden;
        }
        
        .tarjeta-archivo:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: var(--sombra-fuerte);
            border-color: var(--mep-azul-principal);
        }
        
        .icono-archivo {
            font-size: 3.2rem;
            margin-bottom: 20px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nombre-archivo {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--color-texto);
            word-break: break-word;
            font-size: 1.1rem;
        }
        
        .detalles-archivo {
            font-size: 0.85rem;
            color: var(--color-texto-secundario);
            margin-bottom: 20px;
        }
        
        .acciones-archivo {
            display: flex;
            justify-content: center;
            gap: 12px;
        }
        
        .btn-accion-archivo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--color-fondo-tarjeta);
            color: var(--color-texto);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border: 1px solid var(--color-borde);
        }
        
        .btn-accion-archivo:hover {
            background: var(--mep-azul-principal);
            color: white;
            transform: scale(1.1);
        }
        
        /* Bot贸n eliminar espec铆fico ROJO */
        .btn-eliminar {
            background: var(--mep-rojo) !important;
            color: white !important;
            border-color: var(--mep-rojo) !important;
        }
        
        .btn-eliminar:hover {
            background: #c53030 !important;
            transform: scale(1.15) !important;
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3) !important;
        }
        
        .pdf { color: #e53e3e; }
        .word { color: #2b579a; }
        .excel { color: #217346; }
        .powerpoint { color: #d24726; }
        .imagen { color: #38a169; }
        .zip { color: #805ad5; }
        .otro { color: #718096; }
        
        /* ===== SISTEMA DE TAREAS ===== */
        .contenedor-tareas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }
        
        .formulario-tarea {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
        }
        
        .lista-tareas {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .tarea-item {
            background: var(--color-fondo-tarjeta);
            border-radius: 14px;
            padding: 22px;
            margin-bottom: 18px;
            border-left: 5px solid var(--mep-verde);
            border: 1px solid var(--color-borde);
            transition: all 0.3s;
            position: relative;
        }
        
        .tarea-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        .tarea-item.pendiente { border-left-color: var(--mep-naranja); }
        .tarea-item.completada { border-left-color: #a0aec0; opacity: 0.8; }
        
        .tarea-titulo {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: var(--color-texto);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tarea-fecha {
            font-size: 0.85rem;
            color: var(--color-texto-secundario);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tarea-descripcion {
            color: var(--color-texto);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .etiqueta-estado {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .etiqueta-pendiente { background: #fff5f5; color: #c53030; }
        .etiqueta-completada { background: #f0fff4; color: #2f855a; }
        .etiqueta-en-progreso { background: #ebf8ff; color: #2b6cb0; }
        
        /* ===== FILTROS AVANZADOS ===== */
        .contenedor-filtros {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
        }
        
        .filtros-tiempo {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .btn-filtro {
            padding: 14px 28px;
            background: var(--color-fondo-tarjeta);
            border: 1px solid var(--color-borde);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            color: var(--color-texto);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-filtro:hover {
            background: rgba(0, 86, 166, 0.1);
            border-color: var(--mep-azul-principal);
            transform: translateY(-3px);
        }
        
        .btn-filtro.activo {
            background: var(--mep-azul-principal);
            color: white;
            border-color: var(--mep-azul-principal);
            box-shadow: 0 6px 15px rgba(0, 86, 166, 0.3);
        }
        
        .filtros-avanzados {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .buscador-tiempo-real {
            position: relative;
            grid-column: 1 / -1;
        }
        
        .buscador-tiempo-real input {
            padding-right: 50px;
        }
        
        .buscador-tiempo-real i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-texto-secundario);
        }
        
        /* ===== SISTEMA DE INFORMES ===== */
        .opciones-informe {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .tarjeta-informe {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--color-borde);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .tarjeta-informe:hover {
            background: white;
            border-color: var(--mep-verde);
            transform: translateY(-10px) scale(1.03);
            box-shadow: var(--sombra-fuerte);
        }
        
        .tarjeta-informe i {
            font-size: 3rem;
            margin-bottom: 20px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--mep-azul-principal), var(--mep-verde));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .contenedor-exportacion {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid var(--color-borde);
            box-shadow: var(--sombra-suave);
        }
        
        .botones-exportacion {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        /* ===== PANEL DE ENLACES INSTITUCIONALES ===== */
        .panel-enlaces {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .enlace-institucional {
            background: var(--gradiente-glass);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 25px 20px;
            text-align: center;
            border: 1px solid var(--color-borde);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .enlace-institucional:hover {
            transform: translateY(-8px) scale(1.05);
            border-color: var(--mep-azul-principal);
            box-shadow: 0 15px 35px rgba(0, 86, 166, 0.2);
            color: var(--mep-azul-principal);
        }
        
        .enlace-institucional i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: block;
            color: var(--mep-azul-principal);
        }
        
        .enlace-institucional span {
            font-weight: 600;
            font-size: 0.95rem;
            display: block;
            line-height: 1.4;
        }
        
        /* ===== BOTONES Y NOTIFICACIONES ===== */
        .boton {
            padding: 16px 32px;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-decoration: none;
            font-size: 1rem;
            letter-spacing: 0.3px;
        }
        
        .boton-principal {
            background: var(--gradiente-primario);
            color: white;
            box-shadow: 0 6px 20px rgba(0, 86, 166, 0.3);
        }
        
        .boton-principal:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 86, 166, 0.4);
        }
        
        .boton-exito {
            background: linear-gradient(135deg, var(--mep-verde), #008548);
            color: white;
            box-shadow: 0 6px 20px rgba(0, 168, 89, 0.3);
        }
        
        .boton-advertencia {
            background: linear-gradient(135deg, var(--mep-naranja), #d4561a);
            color: white;
            box-shadow: 0 6px 20px rgba(242, 101, 34, 0.3);
        }
        
        .boton-peligro {
            background: linear-gradient(135deg, var(--mep-rojo), #c53030);
            color: white;
            box-shadow: 0 6px 20px rgba(229, 62, 62, 0.3);
        }
        
        .boton-peligro:hover {
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            transform: translateY(-5px);
        }
        
        .boton-secundario {
            background: transparent;
            color: var(--mep-azul-principal);
            border: 2px solid var(--mep-azul-principal);
        }
        
        .boton-secundario:hover {
            background: rgba(0, 86, 166, 0.1);
        }
        
        .notificacion {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 22px 28px;
            background: var(--gradiente-glass);
            backdrop-filter: blur(15px);
            color: white;
            border-radius: 16px;
            box-shadow: var(--sombra-fuerte);
            z-index: 10000;
            animation: deslizarEntrada 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateX(0);
        }
        
        .notificacion.exito { background: linear-gradient(135deg, var(--mep-verde), #008548); }
        .notificacion.error { background: linear-gradient(135deg, #e53e3e, #c53030); }
        .notificacion.info { background: linear-gradient(135deg, var(--mep-azul-principal), #003a75); }
        
        @keyframes deslizarEntrada {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes deslizarSalida {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .notificacion.deslizar-salida {
            animation: deslizarSalida 0.4s ease forwards;
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .contenedor-tareas { grid-template-columns: 1fr; }
            .formulario-bitacora { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 992px) {
            .header-sistema { flex-direction: column; text-align: center; gap: 25px; }
            .info-usuario-fecha { align-items: center; }
            .mes-anio-actual { min-width: auto; font-size: 1.5rem; }
            .cuadricula-mes { gap: 6px; }
            .celda-dia { border-radius: 10px; }
            .panel-enlaces { grid-template-columns: repeat(3, 1fr); }
        }
        
        @media (max-width: 768px) {
            .nav-principal { flex-direction: column; }
            .nav-btn { padding: 18px; justify-content: flex-start; }
            .nav-btn::before { height: 100%; width: 4px; top: 0; left: 0; right: auto; transform: none; }
            .filtros-tiempo { justify-content: center; }
            .opciones-informe { grid-template-columns: 1fr; }
            .panel-enlaces { grid-template-columns: repeat(2, 1fr); }
            .seccion-contenido { padding: 25px 20px; }
        }
        
        @media (max-width: 576px) {
            .panel-estadisticas { grid-template-columns: 1fr; }
            .vista-previa-archivos { grid-template-columns: 1fr; }
            .panel-enlaces { grid-template-columns: 1fr; }
            .filtros-tiempo { flex-direction: column; align-items: stretch; }
            .btn-filtro { justify-content: center; }
            .botones-exportacion { flex-direction: column; }
            .boton { width: 100%; justify-content: center; }
            .encabezado-calendario { flex-direction: column; align-items: stretch; }
            .controles-mes { justify-content: center; }
            .btn-hoy { justify-content: center; }
        }
        
        /* ===== ESTADOS VACOS Y LOADING ===== */
        .estado-vacio {
            text-align: center;
            padding: 80px 30px;
            color: var(--color-texto-secundario);
        }
        
        .estado-vacio i {
            font-size: 5rem;
            margin-bottom: 25px;
            color: var(--color-borde);
            opacity: 0.6;
        }
        
        .cargando {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 86, 166, 0.2);
            border-radius: 50%;
            border-top-color: var(--mep-azul-principal);
            animation: girar 1s ease-in-out infinite;
            margin: 30px auto;
            display: block;
        }
        
        @keyframes girar {
            to { transform: rotate(360deg); }
        }
        
        /* ===== MEJORAS DE SCROLL ===== */
        .lista-tareas::-webkit-scrollbar {
            width: 8px;
        }
        
        .lista-tareas::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        .lista-tareas::-webkit-scrollbar-thumb {
            background: var(--mep-azul-principal);
            border-radius: 10px;
        }
        
        .lista-tareas::-webkit-scrollbar-thumb:hover {
            background: var(--mep-azul-secundario);
        }
        
        /* ===== DETALLES VISUALES ===== */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-left: 10px;
        }
        
        .badge-teletrabajo { background: #e6fffa; color: #234e52; }
        .badge-presencial { background: #fef3c7; color: #92400e; }
        
        .marca-agua {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 0.7rem;
            color: rgba(0, 0, 0, 0.2);
            font-style: italic;
        }
        
        [data-tema="oscuro"] .marca-agua {
            color: rgba(255, 255, 255, 0.2);
        }
        
        /* ===== MODALES ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 20000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-contenido {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: aparecer 0.3s ease;
        }
        
        .modal-encabezado {
            padding: 25px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gradiente-primario);
            color: white;
        }
        
        .modal-encabezado h3 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .modal-cerrar {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .modal-cerrar:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-cuerpo {
            padding: 30px;
            text-align: center;
        }
        
        .modal-cuerpo i {
            font-size: 4rem;
            color: var(--mep-rojo);
            margin-bottom: 20px;
        }
        
        .modal-cuerpo p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #4a5568;
        }
        
        .modal-acciones {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        /* ===== ESTILOS PARA IMPRESIN ===== */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #contenedor-impresion, #contenedor-impresion * {
                visibility: visible;
            }
            
            #contenedor-impresion {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                background: white;
                color: black;
            }
            
            .no-imprimir {
                display: none !important;
            }
            
            .header-impresion {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 3px solid #0056a6;
                padding-bottom: 20px;
            }
            
            .logo-impresion {
                width: 150px;
                height: auto;
                margin-bottom: 15px;
            }
            
            .fecha-impresion {
                text-align: right;
                font-size: 0.9rem;
                color: #666;
                margin-bottom: 20px;
            }
            
            table {
                width: 100%;
                border-collapse: collapse;
                margin: 20px 0;
            }
            
            th, td {
                border: 1px solid #ddd;
                padding: 10px;
                text-align: left;
            }
            
            th {
                background-color: #f5f5f5;
                font-weight: bold;
            }
            
            .total-impresion {
                font-weight: bold;
                font-size: 1.2rem;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 2px solid #0056a6;
            }
            
            .firma-impresion {
                margin-top: 50px;
                text-align: right;
                border-top: 1px solid #ddd;
                padding-top: 20px;
            }
        }
        
        /* ===== NUEVO: BOTONES ELIMINAR EN CALENDARIO ===== */
        .btn-eliminar-mini {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--mep-rojo);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-left: 5px;
            transition: all 0.3s;
        }
        
        .btn-eliminar-mini:hover {
            background: #c53030;
            transform: scale(1.1);
        }
        
        /* ===== NUEVO: BOTONES ELIMINAR EN TAREAS ===== */
        .tarea-acciones {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .btn-eliminar-tarea {
            background: var(--mep-rojo);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .btn-eliminar-tarea:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(229, 62, 62, 0.3);
        }
    </style>
</head>
<body data-tema="claro">
    <div class="container">
        <!-- HEADER INSTITUCIONAL -->
        <header class="header-sistema">
            <div class="logo-mep">
                <div class="titulo-sistema">
                    <h1>DRTE MEP - Sistema Integral de Agenda y Evidencias</h1>
                    <p><i class="fas fa-landmark"></i> Departamento de Investigaci贸n, Desarrollo e Implementaci贸n</p>
                    <p><i class="fas fa-user-tie"></i> Asesor Nacional: Kevin S谩nchez Bogar铆n | <i class="fas fa-id-card"></i> C贸digo: DRTE-AN-2024</p>
                </div>
            </div>
            <div class="info-usuario-fecha">
                <div class="fecha-actual-cr">
                    <i class="far fa-clock"></i>
                    <span id="fecha-hora-cr">Cargando fecha de Costa Rica (UTC-6)...</span>
                </div>
                <p class="marca-agua">Sistema v3.0 | 100% Offline | Persistencia garantizada</p>
            </div>
            <div class="control-tema" id="controlTema" title="Cambiar tema claro/oscuro">
                <i class="fas fa-moon"></i>
            </div>
        </header>

        <!-- NAVEGACIN PRINCIPAL -->
        <nav class="nav-principal">
            <button class="nav-btn activo" data-seccion="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-btn" data-seccion="bitacora">
                <i class="fas fa-book"></i> Bit谩cora Diaria
            </button>
            <button class="nav-btn" data-seccion="calendario">
                <i class="far fa-calendar-alt"></i> Calendario
            </button>
            <button class="nav-btn" data-seccion="tareas">
                <i class="fas fa-tasks"></i> Gesti贸n de Tareas
            </button>
            <button class="nav-btn" data-seccion="archivos">
                <i class="fas fa-folder-open"></i> Archivos y Evidencias
            </button>
            <button class="nav-btn" data-seccion="informes">
                <i class="fas fa-chart-bar"></i> Informes y Exportaci贸n
            </button>
            <button class="nav-btn" data-seccion="enlaces">
                <i class="fas fa-external-link-alt"></i> Enlaces Institucionales
            </button>
        </nav>

        <!-- SECCIN: DASHBOARD -->
        <section id="dashboard" class="seccion-contenido visible">
            <h2 class="titulo-seccion"><i class="fas fa-tachometer-alt"></i> Dashboard General</h2>
            
            <div class="panel-estadisticas">
                <div class="tarjeta-estadistica">
                    <i class="fas fa-file-alt"></i>
                    <div class="valor-estadistica" id="total-bitacoras">0</div>
                    <div class="etiqueta-estadistica">Bit谩coras Registradas</div>
                </div>
                <div class="tarjeta-estadistica">
                    <i class="fas fa-tasks"></i>
                    <div class="valor-estadistica" id="total-tareas">0</div>
                    <div class="etiqueta-estadistica">Tareas Activas</div>
                </div>
                <div class="tarjeta-estadistica">
                    <i class="fas fa-file-upload"></i>
                    <div class="valor-estadistica" id="total-archivos">0</div>
                    <div class="etiqueta-estadistica">Archivos Adjuntos</div>
                </div>
                <div class="tarjeta-estadistica">
                    <i class="fas fa-business-time"></i>
                    <div class="valor-estadistica" id="horas-teletrabajo">0h</div>
                    <div class="etiqueta-estadistica">Horas Teletrabajo</div>
                </div>
                <div class="tarjeta-estadistica">
                    <i class="fas fa-building"></i>
                    <div class="valor-estadistica" id="horas-presencial">0h</div>
                    <div class="etiqueta-estadistica">Horas Presencial</div>
                </div>
                <div class="tarjeta-estadistica">
                    <i class="fas fa-calendar-check"></i>
                    <div class="valor-estadistica" id="dias-activos">0</div>
                    <div class="etiqueta-estadistica">D铆as con Actividad</div>
                </div>
            </div>

            <div class="contenedor-filtros">
                <h3><i class="fas fa-filter"></i> Filtros R谩pidos de Actividad</h3>
                <div class="filtros-tiempo">
                    <button class="btn-filtro activo" data-filtro="hoy">
                        <i class="fas fa-sun"></i> Hoy
                    </button>
                    <button class="btn-filtro" data-filtro="ayer">
                        <i class="fas fa-calendar-day"></i> Ayer
                    </button>
                    <button class="btn-filtro" data-filtro="semana">
                        <i class="fas fa-calendar-week"></i> Esta Semana
                    </button>
                    <button class="btn-filtro" data-filtro="mes">
                        <i class="fas fa-calendar-alt"></i> Este Mes
                    </button>
                    <button class="btn-filtro" data-filtro="teletrabajo">
                        <i class="fas fa-laptop-house"></i> Solo Teletrabajo
                    </button>
                    <button class="btn-filtro" data-filtro="presencial">
                        <i class="fas fa-building"></i> Solo Presencial
                    </button>
                </div>
                <div class="filtros-avanzados">
                    <select class="seleccion" id="filtro-funcion">
                        <option value="">Todas las funciones institucionales</option>
                        <option value="orientacion">Orientaciones curriculares</option>
                        <option value="evaluacion">Evaluaci贸n de aprendizajes</option>
                        <option value="seguimiento">Seguimiento curricular</option>
                        <option value="coordinacion">Coordinaciones interdepartamentales</option>
                        <option value="formacion">Eventos de formaci贸n docente</option>
                        <option value="monitoreo">Monitoreo y acompa帽amiento</option>
                        <option value="informes">Informes para jefatura</option>
                    </select>
                    <div class="buscador-tiempo-real">
                        <input type="text" class="entrada" id="buscador-actividades" placeholder="Buscar en actividades, tareas, archivos...">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-top: 30px;">
                <div>
                    <h3><i class="fas fa-history"></i> Actividad Reciente</h3>
                    <div id="lista-actividad-reciente" class="lista-tareas" style="max-height: 400px;">
                        <div class="estado-vacio">
                            <i class="fas fa-stream"></i>
                            <p>No hay actividad reciente para mostrar</p>
                            <p class="formatos-permitidos">Las actividades aparecer谩n aqu铆 autom谩ticamente</p>
                        </div>
                    </div>
                </div>
                <div>
                    <h3><i class="fas fa-bolt"></i> Acciones R谩pidas</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
                        <button class="boton boton-principal" id="btnBitacoraRapida">
                            <i class="fas fa-plus-circle"></i> Nueva Bit谩cora para Hoy
                        </button>
                        <button class="boton boton-exito" id="btnTareaRapida">
                            <i class="fas fa-tasks"></i> Agregar Tarea R谩pida
                        </button>
                        <button class="boton boton-advertencia" id="btnExportarDashboard">
                            <i class="fas fa-file-export"></i> Exportar Resumen Semanal
                        </button>
                        <button class="boton boton-secundario" id="btnRespaldoManual">
                            <i class="fas fa-database"></i> Crear Respaldo Manual
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCIN: BITCORA DIARIA -->
        <section id="bitacora" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-book"></i> Bit谩cora Diaria Oficial</h2>
            <p style="margin-bottom: 25px; color: var(--color-texto-secundario);">Registro detallado de actividades para respaldo documental del teletrabajo y trabajo presencial.</p>
            
            <div class="formulario-bitacora">
                <div class="grupo-form">
                    <label class="etiqueta"><i class="far fa-calendar"></i> Fecha de la Actividad</label>
                    <input type="date" class="entrada" id="fecha-bitacora" required>
                </div>
                <div class="grupo-form">
                    <label class="etiqueta"><i class="fas fa-user-clock"></i> Modalidad de Trabajo</label>
                    <select class="seleccion" id="modalidad-bitacora" required>
                        <option value="">Seleccione modalidad</option>
                        <option value="teletrabajo">Teletrabajo</option>
                        <option value="presencial">Trabajo Presencial</option>
                        <option value="mixto">Modalidad Mixta</option>
                    </select>
                </div>
                <div class="grupo-form">
                    <label class="etiqueta"><i class="fas fa-briefcase"></i> Funci贸n Institucional</label>
                    <select class="seleccion" id="funcion-bitacora" required>
                        <option value="">Seleccione funci贸n</option>
                        <option value="orientacion">Orientaciones curriculares</option>
                        <option value="evaluacion">Evaluaci贸n de aprendizajes</option>
                        <option value="seguimiento">Seguimiento curricular</option>
                        <option value="coordinacion">Coordinaciones interdepartamentales</option>
                        <option value="formacion">Eventos de formaci贸n docente</option>
                        <option value="monitoreo">Monitoreo y acompa帽amiento</option>
                        <option value="informes">Informes para jefatura</option>
                        <option value="investigacion">Investigaci贸n educativa</option>
                        <option value="desarrollo">Desarrollo de recursos t茅cnicos</option>
                    </select>
                </div>
                <div class="grupo-form-grande">
                    <label class="etiqueta"><i class="fas fa-clipboard-list"></i> Descripci贸n Detallada de la Actividad</label>
                    <textarea class="area-texto" id="descripcion-bitacora" placeholder="Describa detalladamente qu茅 se hizo, con qu茅 prop贸sito, resultados obtenidos, personas involucradas, horas dedicadas, y cualquier otro detalle relevante para el respaldo documental..." required></textarea>
                </div>
                <div class="grupo-form">
                    <label class="etiqueta"><i class="far fa-clock"></i> Horas Dedicadas</label>
                    <input type="number" class="entrada" id="horas-bitacora" min="0.5" max="24" step="0.5" placeholder="Ej: 3.5" required>
                </div>
                <div class="grupo-form">
                    <label class="etiqueta"><i class="fas fa-hashtag"></i> Referencia/Proyecto (Opcional)</label>
                    <input type="text" class="entrada" id="referencia-bitacora" placeholder="C贸digo de proyecto, n煤mero de oficio, etc.">
                </div>
            </div>

            <div class="zona-subida" id="zonaSubidaBitacora">
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="info-subida">Arrastre archivos de evidencia aqu铆 o haga clic para seleccionar</div>
                <div class="formatos-permitidos" id="formatosPermitidosBitacora">
                    Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, PPT, PPTX, TXT, CSV, ODT, ODS, ODP, ZIP, RAR, 7Z (M谩x. 50MB por archivo)
                </div>
                <input type="file" id="inputArchivosBitacora" multiple style="display: none;" 
                       accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.bmp,.svg,.webp,.ppt,.pptx,.txt,.csv,.rtf,.odt,.ods,.odp,.zip,.rar,.7z">
            </div>

            <div id="vistaPreviaBitacora" class="vista-previa-archivos" style="display: none;">
                <!-- Los archivos se mostrar谩n aqu铆 din谩micamente -->
            </div>

            <div class="grupo-botones-bitacora">
                <button class="boton boton-principal" id="btnGuardarBitacora">
                    <i class="fas fa-save"></i> Guardar Bit谩cora
                </button>
                <button class="boton boton-secundario" id="btnLimpiarBitacora">
                    <i class="fas fa-eraser"></i> Limpiar Formulario
                </button>
                <button class="boton boton-exito" id="btnCopiarBitacora">
                    <i class="far fa-copy"></i> Copiar para Correo
                </button>
            </div>

            <h3 style="margin-top: 40px;"><i class="fas fa-history"></i> Bit谩coras Anteriores</h3>
            <div id="lista-bitacoras" class="lista-tareas" style="max-height: 500px; margin-top: 20px;">
                <div class="estado-vacio">
                    <i class="fas fa-book"></i>
                    <p>No hay bit谩coras registradas a煤n</p>
                </div>
            </div>
        </section>

        <!-- SECCIN: CALENDARIO -->
        <section id="calendario" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="far fa-calendar-alt"></i> Calendario Din谩mico de Actividades</h2>
            <p style="margin-bottom: 25px; color: var(--color-texto-secundario);">Vista estilo Outlook/Teams con marcado visual de d铆as con tareas, bit谩coras y archivos. Haga clic en cualquier d铆a para ver o crear actividades.</p>
            
            <div class="contenedor-calendario">
                <div class="encabezado-calendario">
                    <div class="controles-mes">
                        <button class="btn-control-mes" id="btnMesAnterior" title="Mes anterior">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="mes-anio-actual" id="mesAnioActual">Enero 2026</div>
                        <button class="btn-control-mes" id="btnMesSiguiente" title="Mes siguiente">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <button class="btn-hoy" id="btnIrHoy">
                        <i class="fas fa-calendar-day"></i> Ir a Hoy
                    </button>
                </div>

                <div class="cuadricula-dias-semana">
                    <div class="dia-semana">Dom</div>
                    <div class="dia-semana">Lun</div>
                    <div class="dia-semana">Mar</div>
                    <div class="dia-semana">Mi茅</div>
                    <div class="dia-semana">Jue</div>
                    <div class="dia-semana">Vie</div>
                    <div class="dia-semana">S谩b</div>
                </div>

                <div class="cuadricula-mes" id="cuadriculaMes">
                    <!-- Los d铆as del mes se generar谩n din谩micamente con JavaScript -->
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 25px; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 12px; height: 12px; background: var(--mep-verde); border-radius: 50%;"></div>
                    <span style="font-size: 0.9rem;">Tareas</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 12px; height: 12px; background: var(--mep-naranja); border-radius: 50%;"></div>
                    <span style="font-size: 0.9rem;">Bit谩coras</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 12px; height: 12px; background: var(--mep-azul-secundario); border-radius: 50%;"></div>
                    <span style="font-size: 0.9rem;">Archivos</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div style="width: 12px; height: 12px; background: var(--mep-azul-principal); border-radius: 50%; border: 2px solid var(--mep-azul-principal);"></div>
                    <span style="font-size: 0.9rem;">Hoy</span>
                </div>
            </div>

            <div id="detalle-dia-seleccionado" style="margin-top: 40px; display: none;">
                <h3><i class="far fa-calendar-check"></i> Actividades para <span id="fecha-seleccionada-texto">[Fecha]</span></h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 20px;">
                    <div>
                        <h4><i class="fas fa-tasks"></i> Tareas</h4>
                        <div id="tareas-del-dia" class="lista-tareas" style="max-height: 300px;">
                            <div class="estado-vacio" style="padding: 30px;">
                                <p>No hay tareas para esta fecha</p>
                                <button class="boton boton-exito" style="margin-top: 15px;" id="btnNuevaTareaDesdeCalendario">
                                    <i class="fas fa-plus"></i> Crear Tarea
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4><i class="fas fa-book"></i> Bit谩coras</h4>
                        <div id="bitacoras-del-dia" class="lista-tareas" style="max-height: 300px;">
                            <div class="estado-vacio" style="padding: 30px;">
                                <p>No hay bit谩coras para esta fecha</p>
                                <button class="boton boton-principal" style="margin-top: 15px;" id="btnNuevaBitacoraDesdeCalendario">
                                    <i class="fas fa-plus"></i> Crear Bit谩cora
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4><i class="fas fa-file"></i> Archivos Adjuntos</h4>
                        <div id="archivos-del-dia" class="vista-previa-archivos" style="margin-top: 0; max-height: 300px; overflow-y: auto;">
                            <div class="estado-vacio" style="padding: 30px;">
                                <p>No hay archivos para esta fecha</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCIN: GESTIN DE TAREAS -->
        <section id="tareas" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-tasks"></i> Sistema de Gesti贸n de Tareas</h2>
            
            <div class="contenedor-tareas">
                <div class="formulario-tarea">
                    <h3><i class="fas fa-plus-circle"></i> Crear Nueva Tarea</h3>
                    <div class="formulario-bitacora">
                        <div class="grupo-form">
                            <label class="etiqueta"><i class="fas fa-heading"></i> T铆tulo de la Tarea</label>
                            <input type="text" class="entrada" id="titulo-tarea" placeholder="Ej: Revisi贸n de malla curricular de Matem谩ticas" required>
                        </div>
                        <div class="grupo-form">
                            <label class="etiqueta"><i class="far fa-calendar"></i> Fecha de Vencimiento</label>
                            <input type="date" class="entrada" id="fecha-vencimiento-tarea" required>
                        </div>
                        <div class="grupo-form">
                            <label class="etiqueta"><i class="fas fa-briefcase"></i> Funci贸n Institucional</label>
                            <select class="seleccion" id="funcion-tarea">
                                <option value="">Seleccione funci贸n</option>
                                <option value="orientacion">Orientaciones curriculares</option>
                                <option value="evaluacion">Evaluaci贸n de aprendizajes</option>
                                <option value="seguimiento">Seguimiento curricular</option>
                                <option value="coordinacion">Coordinaciones interdepartamentales</option>
                                <option value="formacion">Eventos de formaci贸n docente</option>
                                <option value="monitoreo">Monitoreo y acompa帽amiento</option>
                                <option value="informes">Informes para jefatura</option>
                            </select>
                        </div>
                        <div class="grupo-form">
                            <label class="etiqueta"><i class="fas fa-flag"></i> Prioridad</label>
                            <select class="seleccion" id="prioridad-tarea">
                                <option value="baja">Baja</option>
                                <option value="media" selected>Media</option>
                                <option value="alta">Alta</option>
                                <option value="urgente">Urgente</option>
                            </select>
                        </div>
                        <div class="grupo-form">
                            <label class="etiqueta"><i class="fas fa-clipboard-list"></i> Descripci贸n</label>
                            <textarea class="area-texto" id="descripcion-tarea" placeholder="Describa los detalles de la tarea, objetivos, criterios de completaci贸n..." rows="4"></textarea>
                        </div>
                        <div class="grupo-form">
                            <label class="etiqueta"><i class="fas fa-tag"></i> Estado</label>
                            <select class="seleccion" id="estado-tarea">
                                <option value="pendiente">Pendiente</option>
                                <option value="en-progreso">En Progreso</option>
                                <option value="completada">Completada</option>
                            </select>
                        </div>
                    </div>
                    <button class="boton boton-principal" id="btnGuardarTarea" style="margin-top: 25px; width: 100%;">
                        <i class="fas fa-save"></i> Guardar Tarea
                    </button>
                </div>

                <div class="lista-tareas">
                    <h3><i class="fas fa-list-ul"></i> Tareas Activas</h3>
                    <div class="filtros-tiempo" style="margin: 20px 0;">
                        <button class="btn-filtro activo" data-filtro-tareas="todas">Todas</button>
                        <button class="btn-filtro" data-filtro-tareas="pendientes">Pendientes</button>
                        <button class="btn-filtro" data-filtro-tareas="completadas">Completadas</button>
                        <button class="btn-filtro" data-filtro-tareas="vencidas">Vencidas</button>
                    </div>
                    <div id="lista-tareas-activas">
                        <div class="estado-vacio">
                            <i class="fas fa-tasks"></i>
                            <p>No hay tareas registradas</p>
                            <p class="formatos-permitidos">Cree su primera tarea usando el formulario a la izquierda</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCIN: ARCHIVOS Y EVIDENCIAS -->
        <section id="archivos" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-folder-open"></i> Gesti贸n de Archivos y Evidencias</h2>
            <p style="margin-bottom: 25px; color: var(--color-texto-secundario);">Sistema de archivos organizado por fecha con vista previa, drag & drop, y b煤squeda avanzada.</p>
            
            <div class="contenedor-filtros">
                <div class="filtros-tiempo">
                    <button class="btn-filtro activo" data-filtro-archivos="todos">
                        <i class="fas fa-layer-group"></i> Todos los Archivos
                    </button>
                    <button class="btn-filtro" data-filtro-archivos="hoy">
                        <i class="fas fa-sun"></i> Subidos Hoy
                    </button>
                    <button class="btn-filtro" data-filtro-archivos="semana">
                        <i class="fas fa-calendar-week"></i> Esta Semana
                    </button>
                    <button class="btn-filtro" data-filtro-archivos="pdf">
                        <i class="fas fa-file-pdf"></i> Solo PDF
                    </button>
                    <button class="btn-filtro" data-filtro-archivos="imagenes">
                        <i class="fas fa-image"></i> Solo Im谩genes
                    </button>
                    <button class="btn-filtro" data-filtro-archivos="documentos">
                        <i class="fas fa-file-word"></i> Solo Documentos
                    </button>
                    <button class="btn-filtro" data-filtro-archivos="hojas">
                        <i class="fas fa-file-excel"></i> Solo Hojas C谩lculo
                    </button>
                    <button class="btn-filtro" data-filtro-archivos="presentaciones">
                        <i class="fas fa-file-powerpoint"></i> Solo Presentaciones
                    </button>
                </div>
                <div class="buscador-tiempo-real">
                    <input type="text" class="entrada" id="buscador-archivos" placeholder="Buscar por nombre de archivo, tipo, fecha...">
                    <i class="fas fa-search"></i>
                </div>
            </div>

            <div class="zona-subida" id="zonaSubidaGeneral">
                <i class="fas fa-cloud-upload-alt"></i>
                <div class="info-subida">Arrastre y suelte archivos aqu铆 o haga clic para seleccionar</div>
                <div class="formatos-permitidos" id="formatosPermitidosGeneral">
                    Formatos permitidos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, CSV, TXT, PPT, PPTX, ODT, ODS, ODP, RTF, ZIP, RAR, 7Z (M谩x. 50MB por archivo)
                </div>
                <input type="file" id="inputArchivosGeneral" multiple style="display: none;" 
                       accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.bmp,.svg,.webp,.csv,.txt,.ppt,.pptx,.odt,.ods,.odp,.rtf,.zip,.rar,.7z">
            </div>

            <div id="vistaPreviaGeneral" class="vista-previa-archivos">
                <div class="estado-vacio">
                    <i class="fas fa-folder-open"></i>
                    <p>No hay archivos en el sistema</p>
                    <p class="formatos-permitidos">Suba archivos usando el 谩rea de arrastre arriba o desde las bit谩coras</p>
                </div>
            </div>
        </section>

        <!-- SECCIN: INFORMES Y EXPORTACIN -->
        <section id="informes" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-chart-bar"></i> Sistema de Informes Institucionales</h2>
            <p style="margin-bottom: 25px; color: var(--color-texto-secundario);">Genere informes autom谩ticos para respaldo documental, teletrabajo y presentaci贸n a jefatura.</p>
            
            <div class="opciones-informe">
                <div class="tarjeta-informe" data-tipo-informe="diario">
                    <i class="fas fa-calendar-day"></i>
                    <h3>Informe Diario</h3>
                    <p>Resumen detallado de actividades de un d铆a espec铆fico</p>
                </div>
                <div class="tarjeta-informe" data-tipo-informe="semanal">
                    <i class="fas fa-calendar-week"></i>
                    <h3>Informe Semanal</h3>
                    <p>Consolidado de actividades de la semana laboral</p>
                </div>
                <div class="tarjeta-informe" data-tipo-informe="mensual">
                    <i class="fas fa-calendar-alt"></i>
                    <h3>Informe Mensual</h3>
                    <p>Reporte completo de actividades del mes</p>
                </div>
                <div class="tarjeta-informe" data-tipo-informe="teletrabajo">
                    <i class="fas fa-laptop-house"></i>
                    <h3>Informe de Teletrabajo</h3>
                    <p>Actividades realizadas en modalidad de teletrabajo</p>
                </div>
                <div class="tarjeta-informe" data-tipo-informe="presencial">
                    <i class="fas fa-building"></i>
                    <h3>Informe Presencial</h3>
                    <p>Actividades realizadas de manera presencial</p>
                </div>
                <div class="tarjeta-informe" data-tipo-informe="funcion">
                    <i class="fas fa-briefcase"></i>
                    <h3>Informe por Funci贸n</h3>
                    <p>Actividades agrupadas por funci贸n institucional</p>
                </div>
            </div>

            <div class="contenedor-exportacion">
                <h3><i class="fas fa-file-export"></i> Exportar Informe</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div>
                        <label class="etiqueta"><i class="far fa-calendar"></i> Fecha Inicial</label>
                        <input type="date" class="entrada" id="fecha-inicio-informe" value="2026-01-01">
                    </div>
                    <div>
                        <label class="etiqueta"><i class="far fa-calendar"></i> Fecha Final</label>
                        <input type="date" class="entrada" id="fecha-fin-informe" value="2026-01-31">
                    </div>
                    <div>
                        <label class="etiqueta"><i class="fas fa-filter"></i> Tipo de Informe</label>
                        <select class="seleccion" id="tipo-informe-seleccionado">
                            <option value="diario">Diario</option>
                            <option value="semanal" selected>Semanal</option>
                            <option value="mensual">Mensual</option>
                            <option value="teletrabajo">Teletrabajo</option>
                            <option value="presencial">Presencial</option>
                            <option value="funcion">Por Funci贸n</option>
                            <option value="completo">Completo</option>
                        </select>
                    </div>
                </div>
                
                <div class="botones-exportacion">
                    <button class="boton boton-principal" id="btnGenerarInforme">
                        <i class="fas fa-chart-bar"></i> Previsualizar Informe
                    </button>
                    <button class="boton boton-exito" id="btnExportarExcel">
                        <i class="fas fa-file-excel"></i> Exportar a Excel
                    </button>
                    <button class="boton boton-peligro" id="btnExportarPDF">
                        <i class="fas fa-file-pdf"></i> Exportar a PDF
                    </button>
                    <button class="boton boton-secundario" id="btnCopiarInforme">
                        <i class="far fa-copy"></i> Copiar para Correo
                    </button>
                    <button class="boton" id="btnImprimirInforme" style="background: #4a5568; color: white;">
                        <i class="fas fa-print"></i> Imprimir Informe
                    </button>
                </div>
            </div>

            <div id="vistaPreviaInforme" style="margin-top: 40px; display: none;">
                <h3><i class="fas fa-eye"></i> Vista Previa del Informe</h3>
                <div style="background: white; border-radius: 18px; padding: 30px; margin-top: 20px; border: 1px solid #e2e8f0; max-height: 500px; overflow-y: auto;">
                    <div id="contenido-informe">
                        <!-- El contenido del informe se generar谩 aqu铆 -->
                    </div>
                </div>
            </div>
        </section>

        <!-- SECCIN: ENLACES INSTITUCIONALES -->
        <section id="enlaces" class="seccion-contenido">
            <h2 class="titulo-seccion"><i class="fas fa-external-link-alt"></i> Panel de Enlaces Institucionales</h2>
            <p style="margin-bottom: 25px; color: var(--color-texto-secundario);">Accesos directos a plataformas y sistemas del DRTE MEP. Todos los enlaces abren en nueva pesta帽a.</p>
            
            <div class="panel-enlaces">
                <a href="https://outlook.office365.com" class="enlace-institucional" target="_blank">
                    <i class="fas fa-envelope"></i>
                    <span>Correo Institucional MEP</span>
                    <small>Outlook 365</small>
                </a>
                <a href="https://www.onenote.com" class="enlace-institucional" target="_blank">
                    <i class="fas fa-sticky-note"></i>
                    <span>OneNote Institucional</span>
                    <small>Notas y planeamiento</small>
                </a>
                <a href="https://sharepoint.com" class="enlace-institucional" target="_blank">
                    <i class="fas fa-folder-tree"></i>
                    <span>SharePoint DRTE</span>
                    <small>Repositorio documental</small>
                </a>
                <a href="https://www.youtube.com" class="enlace-institucional" target="_blank">
                    <i class="fab fa-youtube"></i>
                    <span>YouTube (Investigaci贸n)</span>
                    <small>Recursos educativos</small>
                </a>
                <a href="https://www.symbaloo.com" class="enlace-institucional" target="_blank">
                    <i class="fas fa-th-large"></i>
                    <span>Symbaloo DRTE</span>
                    <small>Enlaces organizados</small>
                </a>
                <a href="https://sistemas.mep.go.cr" class="enlace-institucional" target="_blank">
                    <i class="fas fa-network-wired"></i>
                    <span>Sistema PNFT</span>
                    <small>Plataforma nacional</small>
                </a>
                <a href="https://repositorio.mep.go.cr" class="enlace-institucional" target="_blank">
                    <i class="fas fa-archive"></i>
                    <span>Repositorios Documentales</span>
                    <small>Archivos hist贸ricos</small>
                </a>
                <a href="https://curriculum.mep.go.cr" class="enlace-institucional" target="_blank">
                    <i class="fas fa-project-diagram"></i>
                    <span>Dise帽o de Malla Curricular</span>
                    <small>Plataforma curricular</small>
                </a>
                <a href="https://drive.google.com" class="enlace-institucional" target="_blank">
                    <i class="fas fa-hdd"></i>
                    <span>Google Drive Institucional</span>
                    <small>Almacenamiento en la nube</small>
                </a>
                <a href="https://meet.google.com" class="enlace-institucional" target="_blank">
                    <i class="fas fa-video"></i>
                    <span>Google Meet</span>
                    <small>Videoconferencias</small>
                </a>
                <a href="https://teams.microsoft.com" class="enlace-institucional" target="_blank">
                    <i class="fab fa-microsoft"></i>
                    <span>Microsoft Teams</span>
                    <small>Colaboraci贸n</small>
                </a>
                <a href="https://web.microsoftstream.com" class="enlace-institucional" target="_blank">
                    <i class="fas fa-video"></i>
                    <span>Microsoft Stream</span>
                    <small>Videos institucionales</small>
                </a>
            </div>
            
            <div style="margin-top: 40px; background: var(--gradiente-glass); backdrop-filter: blur(10px); border-radius: 18px; padding: 25px; border: 1px solid var(--color-borde);">
                <h3><i class="fas fa-info-circle"></i> Notas de Uso del Sistema</h3>
                <ul style="margin-top: 15px; padding-left: 20px; color: var(--color-texto-secundario); line-height: 1.8;">
                    <li>El sistema funciona completamente <strong>offline</strong>. Todos los datos se guardan en su navegador.</li>
                    <li>Para respaldo, exporte regularmente sus datos usando las opciones de exportaci贸n a Excel o PDF.</li>
                    <li>Los archivos adjuntos se almacenan en IndexedDB del navegador. Para mayor seguridad, mantenga copias en su computadora.</li>
                    <li>Use el bot贸n "Copiar para Correo" para generar formatos listos para enviar por correo institucional.</li>
                    <li>El sistema est谩 optimizado para Chrome, Edge y Firefox. Para uso m贸vil, se recomienda modo escritorio.</li>
                    <li>Para asistencia t茅cnica, contacte al departamento de sistemas del DRTE MEP.</li>
                </ul>
            </div>
        </section>
    </div>

    <!-- NOTIFICACIONES FLOTANTES -->
    <div id="contenedorNotificaciones"></div>

    <!-- MODAL PARA VISUALIZAR ARCHIVOS -->
    <div id="modalArchivo" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 20000; align-items: center; justify-content: center; padding: 20px;">
        <div style="background: white; border-radius: 20px; max-width: 900px; width: 100%; max-height: 90vh; overflow: hidden; position: relative;">
            <div style="padding: 25px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: var(--mep-azul-principal);" id="tituloModalArchivo">Vista Previa</h3>
                <button id="btnCerrarModal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #718096;">&times;</button>
            </div>
            <div style="padding: 30px; max-height: calc(90vh - 100px); overflow-y: auto;" id="contenidoModalArchivo">
                <!-- Contenido del archivo se cargar谩 aqu铆 -->
            </div>
        </div>
    </div>

    <!-- MODAL DE CONFIRMACIN PARA ELIMINAR -->
    <div id="modalConfirmacion" class="modal">
        <div class="modal-contenido">
            <div class="modal-encabezado">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminaci贸n</h3>
                <button class="modal-cerrar" id="btnCerrarModalConfirmacion">&times;</button>
            </div>
            <div class="modal-cuerpo">
                <i class="fas fa-trash-alt"></i>
                <p id="mensajeConfirmacion">驴Est谩 seguro que desea eliminar este elemento? Esta acci贸n no se puede deshacer.</p>
                <div class="modal-acciones">
                    <button class="boton boton-secundario" id="btnCancelarEliminar">Cancelar</button>
                    <button class="boton boton-peligro" id="btnConfirmarEliminar">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENEDOR PARA IMPRESIN (OCULTO POR DEFECTO) -->
    <div id="contenedor-impresion" style="display: none;"></div>

    <script>
        // ===== CONFIGURACIN INICIAL Y CONSTANTES =====
        const SISTEMA_VERSION = '3.0';
        const SISTEMA_NOMBRE = 'DRTE MEP - Sistema Integral de Agenda y Evidencias';
        
        // ===== SISTEMA DE ESTADO GLOBAL (SINGLETON) =====
        class EstadoSistema {
            static instancia;
            
            constructor() {
                if (EstadoSistema.instancia) {
                    return EstadoSistema.instancia;
                }
                
                this.datos = {
                    bitacoras: JSON.parse(localStorage.getItem('drte_bitacoras')) || [],
                    tareas: JSON.parse(localStorage.getItem('drte_tareas')) || [],
                    archivos: JSON.parse(localStorage.getItem('drte_archivos')) || []
                };
                
                this.config = JSON.parse(localStorage.getItem('drte_config')) || { 
                    tema: 'claro',
                    ultimoRespaldo: null
                };
                
                // FORMATOS PERMITIDOS COMPLETOS (TODOS los formatos MEP)
                this.FORMATOS_PERMITIDOS = [
                    // Documentos
                    'application/pdf',
                    'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'application/vnd.oasis.opendocument.text',
                    'text/plain',
                    'text/rtf',
                    
                    // Hojas de c谩lculo
                    'application/vnd.ms-excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/vnd.oasis.opendocument.spreadsheet',
                    'text/csv',
                    
                    // Presentaciones
                    'application/vnd.ms-powerpoint',
                    'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                    'application/vnd.oasis.opendocument.presentation',
                    
                    // Im谩genes
                    'image/jpeg',
                    'image/png',
                    'image/gif',
                    'image/bmp',
                    'image/svg+xml',
                    'image/webp',
                    
                    // Comprimidos
                    'application/zip',
                    'application/x-rar-compressed',
                    'application/x-7z-compressed'
                ];
                
                this.EXTENSIONES_PERMITIDAS = [
                    '.pdf', '.doc', '.docx', '.xls', '.xlsx', '.jpg', '.jpeg', '.png', '.gif',
                    '.bmp', '.svg', '.webp', '.ppt', '.pptx', '.txt', '.csv', '.rtf', '.odt',
                    '.ods', '.odp', '.zip', '.rar', '.7z'
                ];
                
                this.fechaActualCR = this.obtenerFechaCR();
                this.fechaSeleccionada = this.formatearFechaCR();
                this.mesCalendario = this.fechaActualCR.getMonth();
                this.anioCalendario = this.fechaActualCR.getFullYear();
                
                // Para eliminaci贸n con modal
                this.elementoAEliminar = null;
                this.tipoAEliminar = null;
                this.contextoAEliminar = null;
                
                EstadoSistema.instancia = this;
            }
            
            static obtener() {
                if (!EstadoSistema.instancia) {
                    EstadoSistema.instancia = new EstadoSistema();
                }
                return EstadoSistema.instancia;
            }
            
            obtenerFechaCR() {
                const ahora = new Date();
                const offsetCR = -6;
                const utc = ahora.getTime() + (ahora.getTimezoneOffset() * 60000);
                return new Date(utc + (3600000 * offsetCR));
            }
            
            formatearFechaCR(fecha = null) {
                const fechaObj = fecha ? new Date(fecha) : this.obtenerFechaCR();
                return fechaObj.toISOString().split('T')[0];
            }
            
            formatearFechaLegible(fecha = null) {
                const fechaObj = fecha ? new Date(fecha) : this.obtenerFechaCR();
                const opciones = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    timeZone: 'America/Costa_Rica'
                };
                return fechaObj.toLocaleDateString('es-CR', opciones);
            }
            
            guardarDatos() {
                localStorage.setItem('drte_bitacoras', JSON.stringify(this.datos.bitacoras));
                localStorage.setItem('drte_tareas', JSON.stringify(this.datos.tareas));
                localStorage.setItem('drte_archivos', JSON.stringify(this.datos.archivos));
                localStorage.setItem('drte_config', JSON.stringify(this.config));
            }
            
            obtenerDiaSemana(fecha) {
                const dias = ['Domingo', 'Lunes', 'Martes', 'Mi茅rcoles', 'Jueves', 'Viernes', 'S谩bado'];
                return dias[fecha.getDay()];
            }
            
            obtenerNombreMes(mes) {
                const meses = [
                    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                ];
                return meses[mes];
            }
            
            generarId(tipo) {
                return `${tipo}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }
        }
        
        // ===== INICIALIZACIN DEL SISTEMA =====
        const estado = EstadoSistema.obtener();
        let db = null; // Para IndexedDB
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                inicializarSistema();
                configurarNavegacion();
                configurarEventListeners();
                actualizarDashboard();
                inicializarCalendario();
                cargarBitacoras();
                cargarTareas();
                cargarArchivos();
                actualizarFechaHoraCR();
                
                // Inicializar IndexedDB
                await inicializarIndexedDB();
                
                console.log(' Sistema DRTE MEP inicializado correctamente');
                mostrarNotificacion('Sistema cargado exitosamente', 'exito', 3000);
                
            } catch (error) {
                console.error('Error inicializando sistema:', error);
                mostrarNotificacion('Error al inicializar el sistema', 'error');
            }
        });
        
        // ===== SISTEMA HBRIDO DE ALMACENAMIENTO =====
        async function inicializarIndexedDB() {
            return new Promise((resolve) => {
                if (!window.indexedDB) {
                    console.log("IndexedDB no soportado, usando solo localStorage");
                    resolve(false);
                    return;
                }
                
                const request = indexedDB.open('DRTE_ArchivosGrandes', 2);
                
                request.onerror = () => {
                    console.warn("Error abriendo IndexedDB");
                    resolve(false);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log(" IndexedDB inicializado para archivos grandes");
                    resolve(true);
                };
                
                request.onupgradeneeded = (event) => {
                    const database = event.target.result;
                    if (!database.objectStoreNames.contains('archivos')) {
                        const store = database.createObjectStore('archivos', { keyPath: 'id' });
                        store.createIndex('fechaSubida', 'fechaSubida', { unique: false });
                        store.createIndex('nombre', 'nombre', { unique: false });
                        store.createIndex('tipo', 'tipo', { unique: false });
                    }
                };
            });
        }
        
        async function guardarArchivoEnIndexedDB(archivo) {
            if (!db) return null;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['archivos'], 'readwrite');
                const store = transaction.objectStore('archivos');
                const request = store.put(archivo);
                
                request.onsuccess = () => resolve(archivo.id);
                request.onerror = reject;
            });
        }
        
        async function obtenerArchivoDeIndexedDB(id) {
            if (!db) return null;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(['archivos'], 'readonly');
                const store = transaction.objectStore('archivos');
                const request = store.get(id);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = reject;
            });
        }
        
        // ===== FUNCIONES DE INICIALIZACIN =====
        function inicializarSistema() {
            console.log(` Inicializando ${SISTEMA_NOMBRE} v${SISTEMA_VERSION}`);
            
            // Configurar tema
            document.body.setAttribute('data-tema', estado.config.tema);
            document.getElementById('controlTema').innerHTML = estado.config.tema === 'claro' 
                ? '<i class="fas fa-moon"></i>' 
                : '<i class="fas fa-sun"></i>';
            
            // Configurar fecha actual en inputs
            const fechaActual = estado.formatearFechaCR();
            document.getElementById('fecha-bitacora').value = fechaActual;
            document.getElementById('fecha-vencimiento-tarea').value = fechaActual;
            
            // Configurar fechas de informe (mes actual)
            const primerDiaMes = new Date(estado.anioCalendario, estado.mesCalendario, 1);
            const ultimoDiaMes = new Date(estado.anioCalendario, estado.mesCalendario + 1, 0);
            
            document.getElementById('fecha-inicio-informe').value = estado.formatearFechaCR(primerDiaMes);
            document.getElementById('fecha-fin-informe').value = estado.formatearFechaCR(ultimoDiaMes);
        }
        
        function configurarNavegacion() {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const seccionId = btn.getAttribute('data-seccion');
                    
                    // Actualizar botones activos
                    navButtons.forEach(b => b.classList.remove('activo'));
                    btn.classList.add('activo');
                    
                    // Mostrar secci贸n correspondiente
                    document.querySelectorAll('.seccion-contenido').forEach(sec => {
                        sec.classList.remove('visible');
                    });
                    document.getElementById(seccionId).classList.add('visible');
                    
                    // Acciones espec铆ficas por secci贸n
                    if (seccionId === 'calendario') {
                        renderizarCalendario();
                    } else if (seccionId === 'dashboard') {
                        actualizarDashboard();
                    } else if (seccionId === 'archivos') {
                        aplicarFiltroArchivos('todos');
                    }
                });
            });
        }
        
        function configurarEventListeners() {
            // Control de tema claro/oscuro
            document.getElementById('controlTema').addEventListener('click', () => {
                const temaActual = document.body.getAttribute('data-tema');
                const nuevoTema = temaActual === 'claro' ? 'oscuro' : 'claro';
                
                document.body.setAttribute('data-tema', nuevoTema);
                document.getElementById('controlTema').innerHTML = nuevoTema === 'claro' 
                    ? '<i class="fas fa-moon"></i>' 
                    : '<i class="fas fa-sun"></i>';
                
                estado.config.tema = nuevoTema;
                estado.guardarDatos();
                
                mostrarNotificacion('Tema cambiado a ' + (nuevoTema === 'claro' ? 'claro' : 'oscuro'), 'info');
            });
            
            // ===== BITCORA =====
            document.getElementById('btnGuardarBitacora').addEventListener('click', guardarBitacora);
            document.getElementById('btnLimpiarBitacora').addEventListener('click', limpiarFormularioBitacora);
            document.getElementById('btnCopiarBitacora').addEventListener('click', copiarBitacoraParaCorreo);
            
            // Subida de archivos para bit谩cora
            const zonaSubidaBitacora = document.getElementById('zonaSubidaBitacora');
            const inputArchivosBitacora = document.getElementById('inputArchivosBitacora');
            
            zonaSubidaBitacora.addEventListener('click', () => inputArchivosBitacora.click());
            inputArchivosBitacora.addEventListener('change', (e) => manejarSubidaArchivos(e, 'bitacora'));
            
            configurarDragAndDrop(zonaSubidaBitacora, inputArchivosBitacora, 'bitacora');
            
            // ===== ARCHIVOS GENERALES =====
            const zonaSubidaGeneral = document.getElementById('zonaSubidaGeneral');
            const inputArchivosGeneral = document.getElementById('inputArchivosGeneral');
            
            zonaSubidaGeneral.addEventListener('click', () => inputArchivosGeneral.click());
            inputArchivosGeneral.addEventListener('change', (e) => manejarSubidaArchivos(e, 'general'));
            
            configurarDragAndDrop(zonaSubidaGeneral, inputArchivosGeneral, 'general');
            
            // ===== TAREAS =====
            document.getElementById('btnGuardarTarea').addEventListener('click', guardarTarea);
            
            // Filtros de tareas
            document.querySelectorAll('[data-filtro-tareas]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-filtro-tareas]').forEach(b => b.classList.remove('activo'));
                    btn.classList.add('activo');
                    const filtro = btn.getAttribute('data-filtro-tareas');
                    filtrarTareas(filtro);
                });
            });
            
            // ===== CALENDARIO =====
            document.getElementById('btnMesAnterior').addEventListener('click', () => {
                estado.mesCalendario--;
                if (estado.mesCalendario < 0) {
                    estado.mesCalendario = 11;
                    estado.anioCalendario--;
                }
                renderizarCalendario();
            });
            
            document.getElementById('btnMesSiguiente').addEventListener('click', () => {
                estado.mesCalendario++;
                if (estado.mesCalendario > 11) {
                    estado.mesCalendario = 0;
                    estado.anioCalendario++;
                }
                renderizarCalendario();
            });
            
            document.getElementById('btnIrHoy').addEventListener('click', () => {
                estado.fechaActualCR = estado.obtenerFechaCR();
                estado.mesCalendario = estado.fechaActualCR.getMonth();
                estado.anioCalendario = estado.fechaActualCR.getFullYear();
                estado.fechaSeleccionada = estado.formatearFechaCR();
                renderizarCalendario();
                mostrarDetalleDia(estado.fechaSeleccionada);
            });
            
            // ===== FILTROS DASHBOARD =====
            document.querySelectorAll('[data-filtro]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-filtro]').forEach(b => b.classList.remove('activo'));
                    btn.classList.add('activo');
                    const filtro = btn.getAttribute('data-filtro');
                    aplicarFiltroDashboard(filtro);
                });
            });
            
            // ===== FILTROS ARCHIVOS =====
            document.querySelectorAll('[data-filtro-archivos]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-filtro-archivos]').forEach(b => b.classList.remove('activo'));
                    btn.classList.add('activo');
                    const filtro = btn.getAttribute('data-filtro-archivos');
                    aplicarFiltroArchivos(filtro);
                });
            });
            
            // ===== BUSCADORES =====
            document.getElementById('buscador-actividades').addEventListener('input', (e) => {
                buscarEnTiempoReal(e.target.value, 'actividades');
            });
            
            document.getElementById('buscador-archivos').addEventListener('input', (e) => {
                buscarEnTiempoReal(e.target.value, 'archivos');
            });
            
            // ===== INFORMES =====
            document.querySelectorAll('.tarjeta-informe').forEach(tarjeta => {
                tarjeta.addEventListener('click', () => {
                    const tipoInforme = tarjeta.getAttribute('data-tipo-informe');
                    document.getElementById('tipo-informe-seleccionado').value = tipoInforme;
                    mostrarNotificacion(`Tipo de informe cambiado a: ${tipoInforme}`, 'info');
                });
            });
            
            document.getElementById('btnGenerarInforme').addEventListener('click', generarInforme);
            document.getElementById('btnExportarExcel').addEventListener('click', exportarAExcel);
            document.getElementById('btnExportarPDF').addEventListener('click', exportarAPDF);
            document.getElementById('btnCopiarInforme').addEventListener('click', copiarInformeParaCorreo);
            document.getElementById('btnImprimirInforme').addEventListener('click', imprimirInforme);
            
            // ===== ACCIONES RPIDAS DASHBOARD =====
            document.getElementById('btnBitacoraRapida').addEventListener('click', () => {
                cambiarSeccion('bitacora');
            });
            
            document.getElementById('btnTareaRapida').addEventListener('click', () => {
                cambiarSeccion('tareas');
            });
            
            document.getElementById('btnRespaldoManual').addEventListener('click', crearRespaldoManual);
            
            // ===== MODALES =====
            document.getElementById('btnCerrarModal').addEventListener('click', () => {
                document.getElementById('modalArchivo').style.display = 'none';
            });
            
            document.getElementById('modalArchivo').addEventListener('click', (e) => {
                if (e.target.id === 'modalArchivo') {
                    document.getElementById('modalArchivo').style.display = 'none';
                }
            });
            
            // Modal de confirmaci贸n
            document.getElementById('btnCerrarModalConfirmacion').addEventListener('click', cerrarModalConfirmacion);
            document.getElementById('btnCancelarEliminar').addEventListener('click', cerrarModalConfirmacion);
            document.getElementById('btnConfirmarEliminar').addEventListener('click', confirmarEliminacion);
            
            document.getElementById('modalConfirmacion').addEventListener('click', (e) => {
                if (e.target.id === 'modalConfirmacion') {
                    cerrarModalConfirmacion();
                }
            });
        }
        
        function configurarDragAndDrop(zona, input, tipo) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                zona.addEventListener(eventName, prevenirComportamiento, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                zona.addEventListener(eventName, () => {
                    zona.classList.add('drag-over');
                }, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                zona.addEventListener(eventName, () => {
                    zona.classList.remove('drag-over');
                }, false);
            });
            
            zona.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                const files = dt.files;
                input.files = files;
                manejarSubidaArchivos({ target: { files } }, tipo);
            });
        }
        
        function prevenirComportamiento(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        // ===== FUNCIONES DE BITCORA =====
        function guardarBitacora() {
            const fecha = document.getElementById('fecha-bitacora').value;
            const modalidad = document.getElementById('modalidad-bitacora').value;
            const funcion = document.getElementById('funcion-bitacora').value;
            const descripcion = document.getElementById('descripcion-bitacora').value.trim();
            const horas = parseFloat(document.getElementById('horas-bitacora').value) || 0;
            const referencia = document.getElementById('referencia-bitacora').value.trim();
            
            // Validaciones
            if (!fecha || !modalidad || !funcion || !descripcion || horas <= 0) {
                mostrarNotificacion('Complete todos los campos obligatorios y aseg煤rese de ingresar horas v谩lidas', 'error');
                return;
            }
            
            // Obtener archivos adjuntos
            const archivosAdjuntos = [];
            const elementosArchivos = document.querySelectorAll('#vistaPreviaBitacora .tarjeta-archivo');
            elementosArchivos.forEach(el => {
                const idArchivo = el.getAttribute('data-id-archivo');
                if (idArchivo) archivosAdjuntos.push(idArchivo);
            });
            
            // Crear bit谩cora
            const nuevaBitacora = {
                id: estado.generarId('bit'),
                fecha: fecha,
                modalidad: modalidad,
                funcion: funcion,
                descripcion: descripcion,
                horas: horas,
                referencia: referencia,
                archivos: archivosAdjuntos,
                fechaCreacion: new Date().toISOString(),
                fechaModificacion: new Date().toISOString()
            };
            
            estado.datos.bitacoras.push(nuevaBitacora);
            estado.guardarDatos();
            
            mostrarNotificacion('Bit谩cora guardada exitosamente', 'exito');
            cargarBitacoras();
            actualizarDashboard();
            
            // Limpiar formulario
            limpiarFormularioBitacora();
            
            // Actualizar calendario si est谩 visible
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
                mostrarDetalleDia(fecha);
            }
        }
        
        function limpiarFormularioBitacora() {
            if (confirm('驴Est谩 seguro de limpiar el formulario? Se perder谩n los datos no guardados.')) {
                document.getElementById('descripcion-bitacora').value = '';
                document.getElementById('horas-bitacora').value = '';
                document.getElementById('referencia-bitacora').value = '';
                document.getElementById('vistaPreviaBitacora').style.display = 'none';
                document.getElementById('vistaPreviaBitacora').innerHTML = '';
                mostrarNotificacion('Formulario limpiado correctamente', 'info');
            }
        }
        
        function cargarBitacoras() {
            const contenedor = document.getElementById('lista-bitacoras');
            const bitacoras = estado.datos.bitacoras;
            
            if (bitacoras.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio">
                        <i class="fas fa-book"></i>
                        <p>No hay bit谩coras registradas a煤n</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por fecha (m谩s reciente primero)
            bitacoras.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
            
            let html = '';
            const idsUsados = new Set(); // Para evitar duplicados
            
            bitacoras.forEach(bitacora => {
                if (idsUsados.has(bitacora.id)) return; // Evitar duplicados
                idsUsados.add(bitacora.id);
                
                const fechaLegible = estado.formatearFechaLegible(bitacora.fecha);
                const iconoModalidad = bitacora.modalidad === 'teletrabajo' 
                    ? '<i class="fas fa-laptop-house" title="Teletrabajo"></i>' 
                    : bitacora.modalidad === 'presencial' 
                    ? '<i class="fas fa-building" title="Presencial"></i>' 
                    : '<i class="fas fa-blender-phone" title="Mixto"></i>';
                
                const funcionTexto = obtenerTextoFuncion(bitacora.funcion);
                
                html += `
                    <div class="tarea-item" data-id="${bitacora.id}">
                        <div class="tarea-titulo">
                            ${iconoModalidad} ${funcionTexto}
                            <span class="badge ${bitacora.modalidad === 'teletrabajo' ? 'badge-teletrabajo' : 'badge-presencial'}">
                                ${bitacora.modalidad === 'teletrabajo' ? 'Teletrabajo' : bitacora.modalidad === 'presencial' ? 'Presencial' : 'Mixto'}
                            </span>
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-calendar"></i> ${fechaLegible} | 
                            <i class="far fa-clock"></i> ${bitacora.horas} horas
                        </div>
                        <div class="tarea-descripcion">${bitacora.descripcion.substring(0, 300)}${bitacora.descripcion.length > 300 ? '...' : ''}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div>
                                ${bitacora.archivos.length > 0 
                                    ? `<i class="fas fa-paperclip"></i> ${bitacora.archivos.length} archivo(s) adjunto(s)` 
                                    : '<span style="color: var(--color-texto-secundario);"><i class="fas fa-paperclip"></i> Sin archivos adjuntos</span>'
                                }
                            </div>
                            <div>
                                <button class="btn-accion-archivo" onclick="editarBitacora('${bitacora.id}')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-accion-archivo btn-eliminar" onclick="solicitarEliminarBitacora('${bitacora.id}')" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function editarBitacora(id) {
            const bitacora = estado.datos.bitacoras.find(b => b.id === id);
            if (!bitacora) return;
            
            // Llenar formulario
            document.getElementById('fecha-bitacora').value = bitacora.fecha;
            document.getElementById('modalidad-bitacora').value = bitacora.modalidad;
            document.getElementById('funcion-bitacora').value = bitacora.funcion;
            document.getElementById('descripcion-bitacora').value = bitacora.descripcion;
            document.getElementById('horas-bitacora').value = bitacora.horas;
            document.getElementById('referencia-bitacora').value = bitacora.referencia || '';
            
            // Cambiar bot贸n guardar
            const btnGuardar = document.getElementById('btnGuardarBitacora');
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Actualizar Bit谩cora';
            btnGuardar.onclick = () => actualizarBitacora(id);
            
            // Agregar bot贸n cancelar
            const btnCancelar = document.createElement('button');
            btnCancelar.className = 'boton boton-advertencia';
            btnCancelar.innerHTML = '<i class="fas fa-times"></i> Cancelar Edici贸n';
            btnCancelar.onclick = cancelarEdicionBitacora;
            
            document.querySelector('.grupo-botones-bitacora').appendChild(btnCancelar);
            
            cambiarSeccion('bitacora');
            mostrarNotificacion(`Editando bit谩cora del ${estado.formatearFechaLegible(bitacora.fecha)}`, 'info');
        }
        
        function actualizarBitacora(id) {
            const fecha = document.getElementById('fecha-bitacora').value;
            const modalidad = document.getElementById('modalidad-bitacora').value;
            const funcion = document.getElementById('funcion-bitacora').value;
            const descripcion = document.getElementById('descripcion-bitacora').value.trim();
            const horas = parseFloat(document.getElementById('horas-bitacora').value) || 0;
            const referencia = document.getElementById('referencia-bitacora').value.trim();
            
            if (!fecha || !modalidad || !funcion || !descripcion || horas <= 0) {
                mostrarNotificacion('Complete todos los campos obligatorios', 'error');
                return;
            }
            
            const index = estado.datos.bitacoras.findIndex(b => b.id === id);
            if (index === -1) {
                mostrarNotificacion('Bit谩cora no encontrada', 'error');
                return;
            }
            
            // Obtener archivos adjuntos actualizados
            const archivosAdjuntos = [];
            const elementosArchivos = document.querySelectorAll('#vistaPreviaBitacora .tarjeta-archivo');
            elementosArchivos.forEach(el => {
                const idArchivo = el.getAttribute('data-id-archivo');
                if (idArchivo) archivosAdjuntos.push(idArchivo);
            });
            
            estado.datos.bitacoras[index] = {
                ...estado.datos.bitacoras[index],
                fecha: fecha,
                modalidad: modalidad,
                funcion: funcion,
                descripcion: descripcion,
                horas: horas,
                referencia: referencia,
                archivos: archivosAdjuntos,
                fechaModificacion: new Date().toISOString()
            };
            
            estado.guardarDatos();
            mostrarNotificacion('Bit谩cora actualizada exitosamente', 'exito');
            
            // Restaurar interfaz
            cargarBitacoras();
            actualizarDashboard();
            cancelarEdicionBitacora();
        }
        
        function cancelarEdicionBitacora() {
            const btnGuardar = document.getElementById('btnGuardarBitacora');
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Guardar Bit谩cora';
            btnGuardar.onclick = guardarBitacora;
            
            const btnCancelar = document.querySelector('.grupo-botones-bitacora .boton-advertencia');
            if (btnCancelar) btnCancelar.remove();
            
            // Restablecer formulario
            document.getElementById('fecha-bitacora').value = estado.formatearFechaCR();
            document.getElementById('modalidad-bitacora').value = '';
            document.getElementById('funcion-bitacora').value = '';
            document.getElementById('descripcion-bitacora').value = '';
            document.getElementById('horas-bitacora').value = '';
            document.getElementById('referencia-bitacora').value = '';
            document.getElementById('vistaPreviaBitacora').style.display = 'none';
            document.getElementById('vistaPreviaBitacora').innerHTML = '';
        }
        
        function solicitarEliminarBitacora(id) {
            const bitacora = estado.datos.bitacoras.find(b => b.id === id);
            if (!bitacora) return;
            
            estado.elementoAEliminar = id;
            estado.tipoAEliminar = 'bitacora';
            estado.contextoAEliminar = null;
            
            document.getElementById('mensajeConfirmacion').textContent = 
                `驴Est谩 seguro de eliminar la bit谩cora del ${estado.formatearFechaLegible(bitacora.fecha)}? Esta acci贸n no se puede deshacer.`;
            
            document.getElementById('modalConfirmacion').style.display = 'flex';
        }
        
        function eliminarBitacora(id) {
            const index = estado.datos.bitacoras.findIndex(b => b.id === id);
            if (index === -1) return;
            
            const bitacora = estado.datos.bitacoras[index];
            
            // Eliminar archivos asociados
            bitacora.archivos.forEach(archivoId => {
                eliminarArchivoCompleto(archivoId);
            });
            
            estado.datos.bitacoras.splice(index, 1);
            estado.guardarDatos();
            
            mostrarNotificacion('Bit谩cora eliminada exitosamente', 'exito');
            cargarBitacoras();
            actualizarDashboard();
            
            // Actualizar calendario si est谩 visible
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
                if (estado.fechaSeleccionada === bitacora.fecha) {
                    mostrarDetalleDia(bitacora.fecha);
                }
            }
        }
        
        function copiarBitacoraParaCorreo() {
            const fecha = document.getElementById('fecha-bitacora').value;
            const modalidad = document.getElementById('modalidad-bitacora').value;
            const funcion = document.getElementById('funcion-bitacora').value;
            const descripcion = document.getElementById('descripcion-bitacora').value;
            const horas = document.getElementById('horas-bitacora').value;
            
            if (!fecha || !modalidad || !funcion || !descripcion.trim() || !horas) {
                mostrarNotificacion('Complete la bit谩cora antes de copiarla para correo', 'error');
                return;
            }
            
            const modalidadTexto = modalidad === 'teletrabajo' ? 'Teletrabajo' : 
                                 modalidad === 'presencial' ? 'Trabajo Presencial' : 'Modalidad Mixta';
            
            const funcionTexto = obtenerTextoFuncion(funcion);
            
            const textoCorreo = `Bit谩cora DRTE MEP - ${estado.formatearFechaLegible(fecha)}

Fecha: ${estado.formatearFechaLegible(fecha)}
Modalidad: ${modalidadTexto}
Funci贸n Institucional: ${funcionTexto}
Horas dedicadas: ${horas}

Descripci贸n de la actividad:
${descripcion}

---
Sistema Integral de Gesti贸n DRTE MEP
Asesor Nacional: Kevin S谩nchez Bogar铆n
Departamento de Investigaci贸n, Desarrollo e Implementaci贸n`;

            copiarAlPortapapeles(textoCorreo, 'Bit谩cora copiada al portapapeles para correo');
        }
        
        // ===== FUNCIONES DE ARCHIVOS =====
        async function manejarSubidaArchivos(event, tipo) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            let archivosProcesados = 0;
            const archivosErrores = [];
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Validar formato
                if (!validarFormatoArchivo(file)) {
                    archivosErrores.push(`"${file.name}" - Formato no permitido`);
                    continue;
                }
                
                // Validar tama帽o (50MB m谩ximo)
                if (file.size > 50 * 1024 * 1024) {
                    archivosErrores.push(`"${file.name}" - Excede 50MB`);
                    continue;
                }
                
                try {
                    const archivoProcesado = await procesarArchivo(file, tipo);
                    mostrarArchivoEnVistaPrevia(archivoProcesado, tipo);
                    archivosProcesados++;
                } catch (error) {
                    console.error('Error procesando archivo:', error);
                    archivosErrores.push(`"${file.name}" - Error de procesamiento`);
                }
            }
            
            // Mostrar resultados
            if (archivosProcesados > 0) {
                mostrarNotificacion(`${archivosProcesados} archivo(s) subido(s) exitosamente`, 'exito');
                actualizarDashboard();
            }
            
            if (archivosErrores.length > 0) {
                mostrarNotificacion(`Errores en ${archivosErrores.length} archivo(s): ${archivosErrores.join(', ')}`, 'error');
            }
            
            // Limpiar input
            event.target.value = '';
        }
        
        function validarFormatoArchivo(file) {
            // Validar por tipo MIME
            if (estado.FORMATOS_PERMITIDOS.includes(file.type)) {
                return true;
            }
            
            // Validar por extensi贸n
            const nombreArchivo = file.name.toLowerCase();
            return estado.EXTENSIONES_PERMITIDAS.some(ext => nombreArchivo.endsWith(ext));
        }
        
        async function procesarArchivo(file, tipo) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = async function(e) {
                    try {
                        const contenido = e.target.result;
                        const idArchivo = estado.generarId('arch');
                        
                        // Crear objeto archivo
                        const nuevoArchivo = {
                            id: idArchivo,
                            nombre: file.name,
                            tipo: file.type,
                            tama帽o: file.size,
                            fechaSubida: new Date().toISOString(),
                            fechaArchivo: tipo === 'bitacora' 
                                ? document.getElementById('fecha-bitacora').value 
                                : estado.formatearFechaCR(),
                            relacion: tipo === 'bitacora' ? 'bitacora' : 'general',
                            // Archivos grandes (>5MB) van a IndexedDB
                            contenido: file.size > 5 * 1024 * 1024 ? 'INDEXEDDB::' + idArchivo : contenido,
                            almacenamiento: file.size > 5 * 1024 * 1024 ? 'indexedDB' : 'localStorage'
                        };
                        
                        // Si es archivo grande, guardar en IndexedDB
                        if (file.size > 5 * 1024 * 1024) {
                            const archivoCompleto = {
                                id: idArchivo,
                                blob: contenido,
                                tipo: file.type,
                                nombre: file.name,
                                tama帽o: file.size,
                                fechaSubida: nuevoArchivo.fechaSubida
                            };
                            
                            await guardarArchivoEnIndexedDB(archivoCompleto);
                        }
                        
                        // Guardar referencia
                        estado.datos.archivos.push(nuevoArchivo);
                        estado.guardarDatos();
                        
                        resolve(nuevoArchivo);
                        
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = () => {
                    reject(new Error(`Error leyendo "${file.name}"`));
                };
                
                // Leer como DataURL para archivos peque帽os, ArrayBuffer para grandes
                if (file.size > 5 * 1024 * 1024) {
                    reader.readAsArrayBuffer(file);
                } else {
                    reader.readAsDataURL(file);
                }
            });
        }
        
        function mostrarArchivoEnVistaPrevia(archivo, tipo) {
            const contenedorId = tipo === 'bitacora' ? 'vistaPreviaBitacora' : 'vistaPreviaGeneral';
            const contenedor = document.getElementById(contenedorId);
            
            // Mostrar contenedor si estaba oculto
            contenedor.style.display = 'grid';
            
            // Determinar tipo y clase CSS
            const { claseIcono, icono } = determinarTipoArchivo(archivo);
            
            // Formatear tama帽o
            const tama帽oFormateado = formatearTama帽o(archivo.tama帽o);
            
            // Crear tarjeta
            const tarjetaHTML = `
                <div class="tarjeta-archivo" data-id-archivo="${archivo.id}">
                    <div class="icono-archivo ${claseIcono}">
                        <i class="${icono}"></i>
                    </div>
                    <div class="nombre-archivo" title="${archivo.nombre}">${archivo.nombre.length > 30 ? archivo.nombre.substring(0, 30) + '...' : archivo.nombre}</div>
                    <div class="detalles-archivo">
                        ${estado.formatearFechaLegible(archivo.fechaArchivo)}<br>
                        ${tama帽oFormateado}${archivo.almacenamiento === 'indexedDB' ? ' ' : ''}
                    </div>
                    <div class="acciones-archivo">
                        <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')" title="Ver">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')" title="Descargar">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn-accion-archivo btn-eliminar" onclick="solicitarEliminarArchivo('${archivo.id}', '${tipo}')" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Agregar al inicio
            contenedor.innerHTML = tarjetaHTML + contenedor.innerHTML;
        }
        
        function cargarArchivos() {
            const contenedor = document.getElementById('vistaPreviaGeneral');
            const archivos = estado.datos.archivos;
            
            if (archivos.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio">
                        <i class="fas fa-folder-open"></i>
                        <p>No hay archivos en el sistema</p>
                        <p class="formatos-permitidos">Suba archivos usando el 谩rea de arrastre arriba o desde las bit谩coras</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por fecha (m谩s reciente primero)
            archivos.sort((a, b) => new Date(b.fechaSubida) - new Date(a.fechaSubida));
            
            let html = '';
            const idsUsados = new Set();
            
            archivos.forEach(archivo => {
                if (idsUsados.has(archivo.id)) return;
                idsUsados.add(archivo.id);
                
                const { claseIcono, icono } = determinarTipoArchivo(archivo);
                const tama帽oFormateado = formatearTama帽o(archivo.tama帽o);
                
                html += `
                    <div class="tarjeta-archivo" data-id-archivo="${archivo.id}">
                        <div class="icono-archivo ${claseIcono}">
                            <i class="${icono}"></i>
                        </div>
                        <div class="nombre-archivo" title="${archivo.nombre}">${archivo.nombre.length > 30 ? archivo.nombre.substring(0, 30) + '...' : archivo.nombre}</div>
                        <div class="detalles-archivo">
                            ${estado.formatearFechaLegible(archivo.fechaArchivo)}<br>
                            ${tama帽oFormateado}${archivo.almacenamiento === 'indexedDB' ? ' ' : ''}
                        </div>
                        <div class="acciones-archivo">
                            <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')" title="Ver">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')" title="Descargar">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn-accion-archivo btn-eliminar" onclick="solicitarEliminarArchivo('${archivo.id}', 'general')" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function determinarTipoArchivo(archivo) {
            let claseIcono = 'otro';
            let icono = 'fas fa-file';
            
            if (archivo.tipo.includes('pdf')) {
                claseIcono = 'pdf';
                icono = 'fas fa-file-pdf';
            } else if (archivo.tipo.includes('word') || archivo.nombre.match(/\.(doc|docx|odt|rtf)$/i)) {
                claseIcono = 'word';
                icono = 'fas fa-file-word';
            } else if (archivo.tipo.includes('excel') || archivo.nombre.match(/\.(xls|xlsx|csv|ods)$/i)) {
                claseIcono = 'excel';
                icono = 'fas fa-file-excel';
            } else if (archivo.tipo.includes('powerpoint') || archivo.nombre.match(/\.(ppt|pptx|odp)$/i)) {
                claseIcono = 'powerpoint';
                icono = 'fas fa-file-powerpoint';
            } else if (archivo.tipo.includes('image')) {
                claseIcono = 'imagen';
                icono = 'fas fa-file-image';
            } else if (archivo.tipo.includes('zip') || archivo.nombre.match(/\.(zip|rar|7z)$/i)) {
                claseIcono = 'zip';
                icono = 'fas fa-file-archive';
            } else if (archivo.tipo.includes('text') || archivo.nombre.match(/\.(txt)$/i)) {
                icono = 'fas fa-file-alt';
            }
            
            return { claseIcono, icono };
        }
        
        function formatearTama帽o(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        async function verArchivo(id) {
            try {
                const archivo = estado.datos.archivos.find(a => a.id === id);
                if (!archivo) {
                    mostrarNotificacion("Archivo no encontrado", "error");
                    return;
                }
                
                let contenidoParaMostrar = archivo.contenido;
                
                // Si est谩 en IndexedDB, obtenerlo
                if (archivo.contenido.startsWith('INDEXEDDB::')) {
                    const idIndexedDB = archivo.contenido.split('::')[1];
                    const archivoCompleto = await obtenerArchivoDeIndexedDB(idIndexedDB);
                    
                    if (archivoCompleto && archivoCompleto.blob) {
                        const blob = new Blob([archivoCompleto.blob], { type: archivo.tipo });
                        contenidoParaMostrar = await new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.readAsDataURL(blob);
                        });
                    } else {
                        mostrarNotificacion("No se pudo cargar el archivo desde la base de datos", "error");
                        return;
                    }
                }
                
                const modal = document.getElementById('modalArchivo');
                const titulo = document.getElementById('tituloModalArchivo');
                const contenido = document.getElementById('contenidoModalArchivo');
                
                titulo.textContent = `Vista Previa: ${archivo.nombre}`;
                
                if (archivo.tipo.includes('image')) {
                    contenido.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${contenidoParaMostrar}" alt="${archivo.nombre}" style="max-width: 100%; max-height: 70vh; border-radius: 10px;">
                            <p style="margin-top: 15px; color: var(--color-texto-secundario);">
                                <i class="fas fa-info-circle"></i> ${archivo.nombre} (${formatearTama帽o(archivo.tama帽o)})
                            </p>
                        </div>
                    `;
                } else if (archivo.tipo.includes('pdf')) {
                    contenido.innerHTML = `
                        <div style="text-align: center;">
                            <iframe src="${contenidoParaMostrar}" width="100%" height="600" style="border: none; border-radius: 10px;"></iframe>
                            <p style="margin-top: 15px; color: var(--color-texto-secundario);">
                                <i class="fas fa-info-circle"></i> ${archivo.nombre} - PDF
                            </p>
                        </div>
                    `;
                } else {
                    contenido.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <i class="${determinarTipoArchivo(archivo).icono}" style="font-size: 5rem; margin-bottom: 20px;"></i>
                            <h4>${archivo.nombre}</h4>
                            <p>Tipo: ${archivo.tipo}</p>
                            <p>Tama帽o: ${formatearTama帽o(archivo.tama帽o)}</p>
                            <p>Almacenamiento: ${archivo.almacenamiento}</p>
                            <button class="boton boton-principal" onclick="descargarArchivo('${archivo.id}')" style="margin-top: 20px;">
                                <i class="fas fa-download"></i> Descargar Archivo
                            </button>
                        </div>
                    `;
                }
                
                modal.style.display = 'flex';
                
            } catch (error) {
                console.error('Error al ver archivo:', error);
                mostrarNotificacion('Error al cargar el archivo', 'error');
            }
        }
        
        async function descargarArchivo(id) {
            try {
                const archivo = estado.datos.archivos.find(a => a.id === id);
                if (!archivo) {
                    mostrarNotificacion('Archivo no encontrado', 'error');
                    return;
                }
                
                let blob = null;
                
                // Si est谩 en IndexedDB, obtenerlo
                if (archivo.contenido.startsWith('INDEXEDDB::')) {
                    const idIndexedDB = archivo.contenido.split('::')[1];
                    const archivoCompleto = await obtenerArchivoDeIndexedDB(idIndexedDB);
                    
                    if (archivoCompleto && archivoCompleto.blob) {
                        blob = new Blob([archivoCompleto.blob], { type: archivo.tipo });
                    }
                } else {
                    // Archivo peque帽o
                    const byteString = atob(archivo.contenido.split(',')[1]);
                    const mimeString = archivo.contenido.split(',')[0].split(':')[1].split(';')[0];
                    const ab = new ArrayBuffer(byteString.length);
                    const ia = new Uint8Array(ab);
                    for (let i = 0; i < byteString.length; i++) {
                        ia[i] = byteString.charCodeAt(i);
                    }
                    blob = new Blob([ab], { type: mimeString });
                }
                
                if (!blob) {
                    mostrarNotificacion('Error al obtener archivo', 'error');
                    return;
                }
                
                // Crear enlace de descarga
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = archivo.nombre;
                document.body.appendChild(a);
                a.click();
                
                // Limpiar
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                mostrarNotificacion(`Descargando "${archivo.nombre}"`, 'info');
                
            } catch (error) {
                console.error('Error al descargar archivo:', error);
                mostrarNotificacion('Error al descargar archivo', 'error');
            }
        }
        
        function solicitarEliminarArchivo(id, contexto) {
            const archivo = estado.datos.archivos.find(a => a.id === id);
            if (!archivo) return;
            
            estado.elementoAEliminar = id;
            estado.tipoAEliminar = 'archivo';
            estado.contextoAEliminar = contexto;
            
            document.getElementById('mensajeConfirmacion').textContent = 
                `驴Est谩 seguro de eliminar el archivo "${archivo.nombre}"? Esta acci贸n no se puede deshacer.`;
            
            document.getElementById('modalConfirmacion').style.display = 'flex';
        }
        
        function eliminarArchivoCompleto(id) {
            const archivo = estado.datos.archivos.find(a => a.id === id);
            if (!archivo) return;
            
            // Si est谩 en IndexedDB, eliminarlo tambi茅n
            if (archivo.contenido.startsWith('INDEXEDDB::') && db) {
                const idIndexedDB = archivo.contenido.split('::')[1];
                const transaction = db.transaction(['archivos'], 'readwrite');
                const store = transaction.objectStore('archivos');
                store.delete(idIndexedDB);
            }
            
            // Eliminar de bit谩coras si est谩 asociado
            estado.datos.bitacoras.forEach(bitacora => {
                const archivoIndex = bitacora.archivos.indexOf(id);
                if (archivoIndex !== -1) {
                    bitacora.archivos.splice(archivoIndex, 1);
                }
            });
            
            // Eliminar archivo
            const index = estado.datos.archivos.findIndex(a => a.id === id);
            if (index !== -1) {
                estado.datos.archivos.splice(index, 1);
                estado.guardarDatos();
            }
        }
        
        function eliminarArchivo(id, contexto) {
            eliminarArchivoCompleto(id);
            
            // Actualizar vista
            if (contexto === 'bitacora') {
                const elemento = document.querySelector(`#vistaPreviaBitacora [data-id-archivo="${id}"]`);
                if (elemento) elemento.remove();
                
                if (document.querySelectorAll('#vistaPreviaBitacora .tarjeta-archivo').length === 0) {
                    document.getElementById('vistaPreviaBitacora').style.display = 'none';
                }
            } else {
                cargarArchivos();
            }
            
            actualizarDashboard();
            mostrarNotificacion('Archivo eliminado exitosamente', 'exito');
        }
        
        // ===== FUNCIONES DE TAREAS =====
        function guardarTarea() {
            const titulo = document.getElementById('titulo-tarea').value.trim();
            const fechaVencimiento = document.getElementById('fecha-vencimiento-tarea').value;
            const funcion = document.getElementById('funcion-tarea').value;
            const prioridad = document.getElementById('prioridad-tarea').value;
            const descripcion = document.getElementById('descripcion-tarea').value.trim();
            const estadoTarea = document.getElementById('estado-tarea').value;
            
            // Validaciones
            if (!titulo || !fechaVencimiento) {
                mostrarNotificacion('Complete el t铆tulo y fecha de vencimiento', 'error');
                return;
            }
            
            // Crear tarea
            const nuevaTarea = {
                id: estado.generarId('tarea'),
                titulo: titulo,
                fechaVencimiento: fechaVencimiento,
                funcion: funcion || '',
                prioridad: prioridad,
                descripcion: descripcion,
                estado: estadoTarea,
                fechaCreacion: new Date().toISOString(),
                fechaModificacion: new Date().toISOString(),
                completada: estadoTarea === 'completada'
            };
            
            estado.datos.tareas.push(nuevaTarea);
            estado.guardarDatos();
            
            mostrarNotificacion('Tarea guardada exitosamente', 'exito');
            cargarTareas();
            actualizarDashboard();
            
            // Limpiar formulario
            document.getElementById('titulo-tarea').value = '';
            document.getElementById('fecha-vencimiento-tarea').value = estado.formatearFechaCR();
            document.getElementById('funcion-tarea').value = '';
            document.getElementById('prioridad-tarea').value = 'media';
            document.getElementById('descripcion-tarea').value = '';
            document.getElementById('estado-tarea').value = 'pendiente';
            
            // Actualizar calendario si est谩 visible
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
                mostrarDetalleDia(fechaVencimiento);
            }
        }
        
        function cargarTareas() {
            const contenedor = document.getElementById('lista-tareas-activas');
            const tareas = estado.datos.tareas;
            
            if (tareas.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio">
                        <i class="fas fa-tasks"></i>
                        <p>No hay tareas registradas</p>
                        <p class="formatos-permitidos">Cree su primera tarea usando el formulario a la izquierda</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por fecha de vencimiento
            tareas.sort((a, b) => new Date(a.fechaVencimiento) - new Date(b.fechaVencimiento));
            
            let html = '';
            const idsUsados = new Set();
            
            tareas.forEach(tarea => {
                if (idsUsados.has(tarea.id)) return;
                idsUsados.add(tarea.id);
                
                const fechaLegible = estado.formatearFechaLegible(tarea.fechaVencimiento);
                const fechaCreacionLegible = estado.formatearFechaLegible(tarea.fechaCreacion);
                
                // Determinar estado y clase
                const { claseEstado, textoEstado } = determinarEstadoTarea(tarea);
                
                // Color de prioridad
                const colorPrioridad = {
                    'baja': '#718096',
                    'media': '#d69e2e',
                    'alta': '#ed8936',
                    'urgente': '#c53030'
                }[tarea.prioridad] || '#718096';
                
                html += `
                    <div class="tarea-item ${claseEstado}" data-id="${tarea.id}">
                        <div class="tarea-titulo">
                            ${tarea.titulo}
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="etiqueta-estado ${tarea.estado === 'pendiente' ? 'etiqueta-pendiente' : tarea.estado === 'completada' ? 'etiqueta-completada' : 'etiqueta-en-progreso'}">
                                    ${textoEstado}
                                </span>
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${colorPrioridad};" title="Prioridad ${tarea.prioridad}"></div>
                            </div>
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-calendar"></i> Vence: ${fechaLegible} | 
                            <i class="far fa-clock"></i> Creada: ${fechaCreacionLegible}
                        </div>
                        <div class="tarea-descripcion">${tarea.descripcion || 'Sin descripci贸n'}</div>
                        <div class="tarea-acciones">
                            <button class="btn-accion-archivo" onclick="marcarTareaCompletada('${tarea.id}')" title="${tarea.estado === 'completada' ? 'Marcar como pendiente' : 'Marcar como completada'}">
                                <i class="fas ${tarea.estado === 'completada' ? 'fa-undo' : 'fa-check'}"></i>
                            </button>
                            <button class="btn-accion-archivo" onclick="editarTarea('${tarea.id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-eliminar-tarea" onclick="solicitarEliminarTarea('${tarea.id}')">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function determinarEstadoTarea(tarea) {
            let claseEstado = '';
            let textoEstado = '';
            
            if (tarea.estado === 'completada') {
                claseEstado = 'completada';
                textoEstado = 'Completada';
            } else if (tarea.estado === 'en-progreso') {
                claseEstado = 'en-progreso';
                textoEstado = 'En Progreso';
            } else {
                const hoy = new Date(estado.formatearFechaCR());
                const fechaVenc = new Date(tarea.fechaVencimiento);
                if (fechaVenc < hoy) {
                    claseEstado = 'pendiente vencida';
                    textoEstado = 'Vencida';
                } else {
                    claseEstado = 'pendiente';
                    textoEstado = 'Pendiente';
                }
            }
            
            return { claseEstado, textoEstado };
        }
        
        function marcarTareaCompletada(id) {
            const tarea = estado.datos.tareas.find(t => t.id === id);
            if (!tarea) return;
            
            const nuevoEstado = tarea.estado === 'completada' ? 'pendiente' : 'completada';
            
            tarea.estado = nuevoEstado;
            tarea.completada = nuevoEstado === 'completada';
            tarea.fechaModificacion = new Date().toISOString();
            
            estado.guardarDatos();
            cargarTareas();
            actualizarDashboard();
            
            // Actualizar calendario
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
                mostrarDetalleDia(tarea.fechaVencimiento);
            }
            
            mostrarNotificacion(`Tarea marcada como ${nuevoEstado}`, 'exito');
        }
        
        function editarTarea(id) {
            const tarea = estado.datos.tareas.find(t => t.id === id);
            if (!tarea) return;
            
            // Llenar formulario
            document.getElementById('titulo-tarea').value = tarea.titulo;
            document.getElementById('fecha-vencimiento-tarea').value = tarea.fechaVencimiento;
            document.getElementById('funcion-tarea').value = tarea.funcion || '';
            document.getElementById('prioridad-tarea').value = tarea.prioridad || 'media';
            document.getElementById('descripcion-tarea').value = tarea.descripcion || '';
            document.getElementById('estado-tarea').value = tarea.estado || 'pendiente';
            
            // Cambiar bot贸n
            const btnGuardar = document.getElementById('btnGuardarTarea');
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Actualizar Tarea';
            btnGuardar.onclick = () => actualizarTarea(id);
            
            // Agregar bot贸n cancelar
            const btnCancelar = document.createElement('button');
            btnCancelar.className = 'boton boton-advertencia';
            btnCancelar.innerHTML = '<i class="fas fa-times"></i> Cancelar Edici贸n';
            btnCancelar.style.marginTop = '15px';
            btnCancelar.onclick = cancelarEdicionTarea;
            
            document.querySelector('.formulario-tarea').appendChild(btnCancelar);
            
            cambiarSeccion('tareas');
            mostrarNotificacion(`Editando tarea: ${tarea.titulo}`, 'info');
        }
        
        function actualizarTarea(id) {
            const titulo = document.getElementById('titulo-tarea').value.trim();
            const fechaVencimiento = document.getElementById('fecha-vencimiento-tarea').value;
            const funcion = document.getElementById('funcion-tarea').value;
            const prioridad = document.getElementById('prioridad-tarea').value;
            const descripcion = document.getElementById('descripcion-tarea').value.trim();
            const estadoTarea = document.getElementById('estado-tarea').value;
            
            if (!titulo || !fechaVencimiento) {
                mostrarNotificacion('Complete el t铆tulo y fecha de vencimiento', 'error');
                return;
            }
            
            const index = estado.datos.tareas.findIndex(t => t.id === id);
            if (index === -1) {
                mostrarNotificacion('Tarea no encontrada', 'error');
                return;
            }
            
            estado.datos.tareas[index] = {
                ...estado.datos.tareas[index],
                titulo: titulo,
                fechaVencimiento: fechaVencimiento,
                funcion: funcion || '',
                prioridad: prioridad,
                descripcion: descripcion,
                estado: estadoTarea,
                completada: estadoTarea === 'completada',
                fechaModificacion: new Date().toISOString()
            };
            
            estado.guardarDatos();
            mostrarNotificacion('Tarea actualizada exitosamente', 'exito');
            
            cargarTareas();
            actualizarDashboard();
            cancelarEdicionTarea();
        }
        
        function cancelarEdicionTarea() {
            const btnGuardar = document.getElementById('btnGuardarTarea');
            btnGuardar.innerHTML = '<i class="fas fa-save"></i> Guardar Tarea';
            btnGuardar.onclick = guardarTarea;
            
            const btnCancelar = document.querySelector('.formulario-tarea .boton-advertencia');
            if (btnCancelar) btnCancelar.remove();
            
            // Limpiar formulario
            document.getElementById('titulo-tarea').value = '';
            document.getElementById('fecha-vencimiento-tarea').value = estado.formatearFechaCR();
            document.getElementById('funcion-tarea').value = '';
            document.getElementById('prioridad-tarea').value = 'media';
            document.getElementById('descripcion-tarea').value = '';
            document.getElementById('estado-tarea').value = 'pendiente';
        }
        
        function solicitarEliminarTarea(id) {
            const tarea = estado.datos.tareas.find(t => t.id === id);
            if (!tarea) return;
            
            estado.elementoAEliminar = id;
            estado.tipoAEliminar = 'tarea';
            estado.contextoAEliminar = null;
            
            document.getElementById('mensajeConfirmacion').textContent = 
                `驴Est谩 seguro de eliminar la tarea "${tarea.titulo}"? Esta acci贸n no se puede deshacer.`;
            
            document.getElementById('modalConfirmacion').style.display = 'flex';
        }
        
        function eliminarTarea(id) {
            const index = estado.datos.tareas.findIndex(t => t.id === id);
            if (index === -1) return;
            
            const tarea = estado.datos.tareas[index];
            estado.datos.tareas.splice(index, 1);
            estado.guardarDatos();
            
            mostrarNotificacion('Tarea eliminada exitosamente', 'exito');
            cargarTareas();
            actualizarDashboard();
            
            // Actualizar calendario
            if (document.getElementById('calendario').classList.contains('visible')) {
                renderizarCalendario();
            }
        }
        
        function filtrarTareas(filtro) {
            const tareas = estado.datos.tareas;
            let tareasFiltradas = [];
            
            const hoy = new Date(estado.formatearFechaCR());
            
            switch(filtro) {
                case 'pendientes':
                    tareasFiltradas = tareas.filter(t => t.estado !== 'completada');
                    break;
                case 'completadas':
                    tareasFiltradas = tareas.filter(t => t.estado === 'completada');
                    break;
                case 'vencidas':
                    tareasFiltradas = tareas.filter(t => {
                        const fechaVenc = new Date(t.fechaVencimiento);
                        return fechaVenc < hoy && t.estado !== 'completada';
                    });
                    break;
                default:
                    tareasFiltradas = tareas;
                    break;
            }
            
            mostrarTareasFiltradas(tareasFiltradas, filtro);
        }
        
        function mostrarTareasFiltradas(tareasFiltradas, filtro) {
            const contenedor = document.getElementById('lista-tareas-activas');
            
            if (tareasFiltradas.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio">
                        <i class="fas fa-tasks"></i>
                        <p>No hay tareas con el filtro "${filtro}"</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            const idsUsados = new Set();
            
            tareasFiltradas.forEach(tarea => {
                if (idsUsados.has(tarea.id)) return;
                idsUsados.add(tarea.id);
                
                const fechaLegible = estado.formatearFechaLegible(tarea.fechaVencimiento);
                const { claseEstado, textoEstado } = determinarEstadoTarea(tarea);
                
                const colorPrioridad = {
                    'baja': '#718096',
                    'media': '#d69e2e',
                    'alta': '#ed8936',
                    'urgente': '#c53030'
                }[tarea.prioridad] || '#718096';
                
                html += `
                    <div class="tarea-item ${claseEstado}" data-id="${tarea.id}">
                        <div class="tarea-titulo">
                            ${tarea.titulo}
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="etiqueta-estado ${tarea.estado === 'pendiente' ? 'etiqueta-pendiente' : tarea.estado === 'completada' ? 'etiqueta-completada' : 'etiqueta-en-progreso'}">
                                    ${textoEstado}
                                </span>
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${colorPrioridad};" title="Prioridad ${tarea.prioridad}"></div>
                            </div>
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-calendar"></i> Vence: ${fechaLegible}
                        </div>
                        <div class="tarea-descripcion">${tarea.descripcion || 'Sin descripci贸n'}</div>
                        <div class="tarea-acciones">
                            <button class="btn-accion-archivo" onclick="marcarTareaCompletada('${tarea.id}')" title="${tarea.estado === 'completada' ? 'Marcar como pendiente' : 'Marcar como completada'}">
                                <i class="fas ${tarea.estado === 'completada' ? 'fa-undo' : 'fa-check'}"></i>
                            </button>
                            <button class="btn-accion-archivo" onclick="editarTarea('${tarea.id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-eliminar-tarea" onclick="solicitarEliminarTarea('${tarea.id}')">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        // ===== FUNCIONES DE CALENDARIO =====
        function inicializarCalendario() {
            renderizarCalendario();
            
            // Seleccionar d铆a actual
            setTimeout(() => {
                mostrarDetalleDia(estado.fechaSeleccionada);
            }, 100);
        }
        
        function renderizarCalendario() {
            const cuadricula = document.getElementById('cuadriculaMes');
            const mesAnioActual = document.getElementById('mesAnioActual');
            
            mesAnioActual.textContent = `${estado.obtenerNombreMes(estado.mesCalendario)} ${estado.anioCalendario}`;
            
            const primerDia = new Date(estado.anioCalendario, estado.mesCalendario, 1);
            const ultimoDia = new Date(estado.anioCalendario, estado.mesCalendario + 1, 0);
            const primerDiaSemana = primerDia.getDay();
            const diasEnMes = ultimoDia.getDate();
            
            const fechaActual = estado.formatearFechaCR();
            
            cuadricula.innerHTML = '';
            
            // D铆as del mes anterior
            for (let i = 0; i < primerDiaSemana; i++) {
                const diaAnterior = new Date(estado.anioCalendario, estado.mesCalendario, -i);
                const celda = crearCeldaDia(diaAnterior.getDate(), true);
                cuadricula.appendChild(celda);
            }
            
            // D铆as del mes actual
            for (let dia = 1; dia <= diasEnMes; dia++) {
                const fechaCompleta = `${estado.anioCalendario}-${String(estado.mesCalendario + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                const esHoy = fechaCompleta === fechaActual;
                
                // Contar actividades (usando Set para evitar duplicados)
                const idsTareas = new Set();
                const idsBitacoras = new Set();
                const idsArchivos = new Set();
                
                estado.datos.tareas.forEach(t => {
                    if (t.fechaVencimiento === fechaCompleta) idsTareas.add(t.id);
                });
                
                estado.datos.bitacoras.forEach(b => {
                    if (b.fecha === fechaCompleta) idsBitacoras.add(b.id);
                });
                
                estado.datos.archivos.forEach(a => {
                    if (a.fechaArchivo === fechaCompleta) idsArchivos.add(a.id);
                });
                
                const tieneTareas = idsTareas.size > 0;
                const tieneBitacoras = idsBitacoras.size > 0;
                const tieneArchivos = idsArchivos.size > 0;
                
                const celda = crearCeldaDia(dia, false, esHoy, tieneTareas, tieneBitacoras, tieneArchivos, fechaCompleta);
                cuadricula.appendChild(celda);
            }
            
            // D铆as del siguiente mes
            const celdasTotales = 42;
            const celdasPuestas = primerDiaSemana + diasEnMes;
            const diasSiguienteMes = celdasTotales - celdasPuestas;
            
            for (let dia = 1; dia <= diasSiguienteMes; dia++) {
                const celda = crearCeldaDia(dia, true);
                cuadricula.appendChild(celda);
            }
        }
        
        function crearCeldaDia(dia, esFueraMes, esHoy = false, tieneTareas = false, tieneBitacoras = false, tieneArchivos = false, fechaCompleta = null) {
            const celda = document.createElement('div');
            celda.className = 'celda-dia';
            celda.innerHTML = `
                <div class="numero-dia">${dia}</div>
                <div class="indicadores-actividad">
                    ${tieneTareas ? '<div class="punto-actividad punto-tarea"></div>' : ''}
                    ${tieneBitacoras ? '<div class="punto-actividad punto-bitacora"></div>' : ''}
                    ${tieneArchivos ? '<div class="punto-actividad punto-archivo"></div>' : ''}
                </div>
            `;
            
            if (esFueraMes) celda.classList.add('fuera-mes');
            if (esHoy) celda.classList.add('hoy');
            
            if (fechaCompleta) {
                celda.setAttribute('data-fecha', fechaCompleta);
                celda.addEventListener('click', () => {
                    estado.fechaSeleccionada = fechaCompleta;
                    mostrarDetalleDia(fechaCompleta);
                });
            }
            
            return celda;
        }
        
        function mostrarDetalleDia(fecha) {
            document.getElementById('fecha-seleccionada-texto').textContent = estado.formatearFechaLegible(fecha);
            document.getElementById('detalle-dia-seleccionado').style.display = 'block';
            
            // Usar Sets para evitar duplicados
            const idsTareas = new Set();
            const idsBitacoras = new Set();
            const idsArchivos = new Set();
            
            const tareasDia = estado.datos.tareas.filter(t => {
                if (t.fechaVencimiento === fecha && !idsTareas.has(t.id)) {
                    idsTareas.add(t.id);
                    return true;
                }
                return false;
            });
            
            const bitacorasDia = estado.datos.bitacoras.filter(b => {
                if (b.fecha === fecha && !idsBitacoras.has(b.id)) {
                    idsBitacoras.add(b.id);
                    return true;
                }
                return false;
            });
            
            const archivosDia = estado.datos.archivos.filter(a => {
                if (a.fechaArchivo === fecha && !idsArchivos.has(a.id)) {
                    idsArchivos.add(a.id);
                    return true;
                }
                return false;
            });
            
            // Mostrar tareas con botones eliminar
            mostrarTareasDelDia(tareasDia, fecha);
            
            // Mostrar bit谩coras con botones eliminar
            mostrarBitacorasDelDia(bitacorasDia, fecha);
            
            // Mostrar archivos
            mostrarArchivosDelDia(archivosDia);
        }
        
        function mostrarTareasDelDia(tareasDia, fecha) {
            const contenedor = document.getElementById('tareas-del-dia');
            
            if (tareasDia.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio" style="padding: 30px;">
                        <p>No hay tareas para esta fecha</p>
                        <button class="boton boton-exito" style="margin-top: 15px;" onclick="crearTareaDesdeCalendario('${fecha}')">
                            <i class="fas fa-plus"></i> Crear Tarea
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            tareasDia.forEach(tarea => {
                const prioridadColor = {
                    'baja': '#718096',
                    'media': '#d69e2e',
                    'alta': '#ed8936',
                    'urgente': '#c53030'
                }[tarea.prioridad] || '#718096';
                
                html += `
                    <div class="tarea-item ${tarea.estado === 'completada' ? 'completada' : 'pendiente'}" style="margin-bottom: 15px;">
                        <div class="tarea-titulo">
                            ${tarea.titulo}
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: ${prioridadColor};" title="Prioridad ${tarea.prioridad}"></div>
                        </div>
                        <div class="tarea-descripcion">${tarea.descripcion || 'Sin descripci贸n'}</div>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                            <span class="etiqueta-estado ${tarea.estado === 'pendiente' ? 'etiqueta-pendiente' : tarea.estado === 'completada' ? 'etiqueta-completada' : 'etiqueta-en-progreso'}">
                                ${tarea.estado === 'pendiente' ? 'Pendiente' : tarea.estado === 'completada' ? 'Completada' : 'En Progreso'}
                            </span>
                            <div>
                                <button class="btn-accion-archivo" onclick="editarTarea('${tarea.id}')" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-eliminar-mini" onclick="solicitarEliminarTareaDesdeCalendario('${tarea.id}', '${fecha}')" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            contenedor.innerHTML = html;
        }
        
        function mostrarBitacorasDelDia(bitacorasDia, fecha) {
            const contenedor = document.getElementById('bitacoras-del-dia');
            
            if (bitacorasDia.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio" style="padding: 30px;">
                        <p>No hay bit谩coras para esta fecha</p>
                        <button class="boton boton-principal" style="margin-top: 15px;" onclick="crearBitacoraDesdeCalendario('${fecha}')">
                            <i class="fas fa-plus"></i> Crear Bit谩cora
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            bitacorasDia.forEach(bitacora => {
                const funcionTexto = obtenerTextoFuncion(bitacora.funcion);
                
                html += `
                    <div class="tarea-item" style="margin-bottom: 15px;">
                        <div class="tarea-titulo">
                            ${funcionTexto}
                            <span class="badge ${bitacora.modalidad === 'teletrabajo' ? 'badge-teletrabajo' : 'badge-presencial'}">
                                ${bitacora.modalidad === 'teletrabajo' ? 'Teletrabajo' : bitacora.modalidad === 'presencial' ? 'Presencial' : 'Mixto'}
                            </span>
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-clock"></i> ${bitacora.horas} horas
                        </div>
                        <div class="tarea-descripcion">${bitacora.descripcion.substring(0, 150)}${bitacora.descripcion.length > 150 ? '...' : ''}</div>
                        <div style="margin-top: 10px; display: flex; justify-content: space-between;">
                            <button class="btn-accion-archivo" onclick="editarBitacora('${bitacora.id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-eliminar-mini" onclick="solicitarEliminarBitacoraDesdeCalendario('${bitacora.id}', '${fecha}')" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            contenedor.innerHTML = html;
        }
        
        function mostrarArchivosDelDia(archivosDia) {
            const contenedor = document.getElementById('archivos-del-dia');
            
            if (archivosDia.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio" style="padding: 30px;">
                        <p>No hay archivos para esta fecha</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            archivosDia.forEach(archivo => {
                const { claseIcono, icono } = determinarTipoArchivo(archivo);
                const tama帽oFormateado = formatearTama帽o(archivo.tama帽o);
                
                html += `
                    <div class="tarjeta-archivo" style="margin-bottom: 15px;">
                        <div class="icono-archivo ${claseIcono}">
                            <i class="${icono}"></i>
                        </div>
                        <div class="nombre-archivo" title="${archivo.nombre}">${archivo.nombre.length > 20 ? archivo.nombre.substring(0, 20) + '...' : archivo.nombre}</div>
                        <div class="detalles-archivo">
                            ${tama帽oFormateado}${archivo.almacenamiento === 'indexedDB' ? ' ' : ''}
                        </div>
                        <div class="acciones-archivo">
                            <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')" title="Ver">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')" title="Descargar">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn-accion-archivo btn-eliminar" onclick="solicitarEliminarArchivo('${archivo.id}', 'calendario')" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            contenedor.innerHTML = html;
        }
        
        function crearTareaDesdeCalendario(fecha) {
            cambiarSeccion('tareas');
            document.getElementById('fecha-vencimiento-tarea').value = fecha;
            mostrarNotificacion(`Creando tarea para el ${estado.formatearFechaLegible(fecha)}`, 'info');
        }
        
        function crearBitacoraDesdeCalendario(fecha) {
            cambiarSeccion('bitacora');
            document.getElementById('fecha-bitacora').value = fecha;
            mostrarNotificacion(`Creando bit谩cora para el ${estado.formatearFechaLegible(fecha)}`, 'info');
        }
        
        function solicitarEliminarTareaDesdeCalendario(id, fecha) {
            estado.elementoAEliminar = id;
            estado.tipoAEliminar = 'tarea';
            estado.contextoAEliminar = fecha;
            
            const tarea = estado.datos.tareas.find(t => t.id === id);
            if (!tarea) return;
            
            document.getElementById('mensajeConfirmacion').textContent = 
                `驴Est谩 seguro de eliminar la tarea "${tarea.titulo}" del ${estado.formatearFechaLegible(fecha)}? Esta acci贸n no se puede deshacer.`;
            
            document.getElementById('modalConfirmacion').style.display = 'flex';
        }
        
        function solicitarEliminarBitacoraDesdeCalendario(id, fecha) {
            estado.elementoAEliminar = id;
            estado.tipoAEliminar = 'bitacora';
            estado.contextoAEliminar = fecha;
            
            const bitacora = estado.datos.bitacoras.find(b => b.id === id);
            if (!bitacora) return;
            
            document.getElementById('mensajeConfirmacion').textContent = 
                `驴Est谩 seguro de eliminar la bit谩cora del ${estado.formatearFechaLegible(fecha)}? Esta acci贸n no se puede deshacer.`;
            
            document.getElementById('modalConfirmacion').style.display = 'flex';
        }
        
        // ===== FUNCIONES DEL DASHBOARD =====
        function actualizarDashboard() {
            // Calcular estad铆sticas
            const totalBitacoras = estado.datos.bitacoras.length;
            const totalTareas = estado.datos.tareas.filter(t => t.estado !== 'completada').length;
            const totalArchivos = estado.datos.archivos.length;
            
            let horasTeletrabajo = 0;
            let horasPresencial = 0;
            estado.datos.bitacoras.forEach(b => {
                if (b.modalidad === 'teletrabajo') horasTeletrabajo += b.horas;
                else if (b.modalidad === 'presencial') horasPresencial += b.horas;
                else {
                    horasTeletrabajo += b.horas / 2;
                    horasPresencial += b.horas / 2;
                }
            });
            
            const fechasConActividad = new Set();
            estado.datos.bitacoras.forEach(b => fechasConActividad.add(b.fecha));
            estado.datos.tareas.forEach(t => fechasConActividad.add(t.fechaVencimiento));
            
            // Actualizar valores
            document.getElementById('total-bitacoras').textContent = totalBitacoras;
            document.getElementById('total-tareas').textContent = totalTareas;
            document.getElementById('total-archivos').textContent = totalArchivos;
            document.getElementById('horas-teletrabajo').textContent = horasTeletrabajo.toFixed(1) + 'h';
            document.getElementById('horas-presencial').textContent = horasPresencial.toFixed(1) + 'h';
            document.getElementById('dias-activos').textContent = fechasConActividad.size;
            
            actualizarActividadReciente();
        }
        
        function actualizarActividadReciente() {
            const contenedor = document.getElementById('lista-actividad-reciente');
            
            const actividades = [];
            const idsUsados = new Set();
            
            // Agregar bit谩coras (sin duplicados)
            estado.datos.bitacoras.forEach(b => {
                if (idsUsados.has(b.id)) return;
                idsUsados.add(b.id);
                
                actividades.push({
                    tipo: 'bitacora',
                    fecha: b.fecha,
                    fechaCreacion: b.fechaCreacion,
                    titulo: `Bit谩cora: ${obtenerTextoFuncion(b.funcion)}`,
                    descripcion: b.descripcion.substring(0, 100) + (b.descripcion.length > 100 ? '...' : ''),
                    modalidad: b.modalidad,
                    horas: b.horas,
                    id: b.id
                });
            });
            
            // Agregar tareas (sin duplicados)
            estado.datos.tareas.forEach(t => {
                if (idsUsados.has(t.id)) return;
                idsUsados.add(t.id);
                
                actividades.push({
                    tipo: 'tarea',
                    fecha: t.fechaVencimiento,
                    fechaCreacion: t.fechaCreacion,
                    titulo: `Tarea: ${t.titulo}`,
                    descripcion: t.descripcion || 'Sin descripci贸n',
                    prioridad: t.prioridad,
                    estado: t.estado,
                    id: t.id
                });
            });
            
            // Ordenar y tomar las 10 m谩s recientes
            actividades.sort((a, b) => new Date(b.fechaCreacion) - new Date(a.fechaCreacion));
            const actividadesRecientes = actividades.slice(0, 10);
            
            if (actividadesRecientes.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio">
                        <i class="fas fa-stream"></i>
                        <p>No hay actividad reciente para mostrar</p>
                        <p class="formatos-permitidos">Las actividades aparecer谩n aqu铆 autom谩ticamente</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            actividadesRecientes.forEach(actividad => {
                const fechaLegible = estado.formatearFechaLegible(actividad.fecha);
                const icono = actividad.tipo === 'bitacora' 
                    ? (actividad.modalidad === 'teletrabajo' ? 'fas fa-laptop-house' : 'fas fa-building') 
                    : (actividad.estado === 'completada' ? 'fas fa-check-circle' : 'fas fa-tasks');
                
                const color = actividad.tipo === 'bitacora' 
                    ? (actividad.modalidad === 'teletrabajo' ? 'var(--mep-verde)' : 'var(--mep-naranja)') 
                    : (actividad.estado === 'completada' ? 'var(--mep-verde)' : 'var(--mep-azul-principal)');
                
                html += `
                    <div class="tarea-item" style="margin-bottom: 15px;">
                        <div class="tarea-titulo">
                            <i class="${icono}" style="color: ${color};"></i> ${actividad.titulo}
                        </div>
                        <div class="tarea-fecha">
                            <i class="far fa-calendar"></i> ${fechaLegible}
                            ${actividad.tipo === 'bitacora' ? ` | <i class="far fa-clock"></i> ${actividad.horas} horas` : ''}
                        </div>
                        <div class="tarea-descripcion">${actividad.descripcion}</div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function aplicarFiltroDashboard(filtro) {
            const hoy = new Date(estado.formatearFechaCR());
            const ayer = new Date(hoy);
            ayer.setDate(ayer.getDate() - 1);
            
            const inicioSemana = new Date(hoy);
            inicioSemana.setDate(hoy.getDate() - hoy.getDay() + 1);
            const finSemana = new Date(inicioSemana);
            finSemana.setDate(inicioSemana.getDate() + 6);
            
            const inicioMes = new Date(hoy.getFullYear(), hoy.getMonth(), 1);
            const finMes = new Date(hoy.getFullYear(), hoy.getMonth() + 1, 0);
            
            let actividadesFiltradas = [];
            const idsUsados = new Set();
            
            // Filtrar bit谩coras
            estado.datos.bitacoras.forEach(b => {
                if (idsUsados.has(b.id)) return;
                
                const fechaBitacora = new Date(b.fecha);
                let incluir = false;
                
                switch(filtro) {
                    case 'hoy':
                        incluir = b.fecha === estado.formatearFechaCR();
                        break;
                    case 'ayer':
                        incluir = b.fecha === estado.formatearFechaCR(ayer);
                        break;
                    case 'semana':
                        incluir = fechaBitacora >= inicioSemana && fechaBitacora <= finSemana;
                        break;
                    case 'mes':
                        incluir = fechaBitacora >= inicioMes && fechaBitacora <= finMes;
                        break;
                    case 'teletrabajo':
                        incluir = b.modalidad === 'teletrabajo';
                        break;
                    case 'presencial':
                        incluir = b.modalidad === 'presencial';
                        break;
                    default:
                        incluir = true;
                }
                
                if (incluir) {
                    idsUsados.add(b.id);
                    actividadesFiltradas.push({
                        tipo: 'bitacora',
                        objeto: b
                    });
                }
            });
            
            mostrarNotificacion(`Filtro aplicado: ${filtro}`, 'info');
        }
        
        function aplicarFiltroArchivos(filtro) {
            const archivos = estado.datos.archivos;
            let archivosFiltrados = [];
            const hoy = new Date(estado.formatearFechaCR());
            
            const inicioSemana = new Date(hoy);
            inicioSemana.setDate(hoy.getDate() - hoy.getDay() + 1);
            const finSemana = new Date(inicioSemana);
            finSemana.setDate(inicioSemana.getDate() + 6);
            
            archivos.forEach(archivo => {
                let incluir = false;
                const fechaArchivo = new Date(archivo.fechaArchivo);
                
                switch(filtro) {
                    case 'hoy':
                        incluir = archivo.fechaArchivo === estado.formatearFechaCR();
                        break;
                    case 'semana':
                        incluir = fechaArchivo >= inicioSemana && fechaArchivo <= finSemana;
                        break;
                    case 'pdf':
                        incluir = archivo.tipo.includes('pdf') || archivo.nombre.toLowerCase().endsWith('.pdf');
                        break;
                    case 'imagenes':
                        incluir = archivo.tipo.includes('image') || 
                                 archivo.nombre.match(/\.(jpg|jpeg|png|gif|bmp|svg|webp)$/i);
                        break;
                    case 'documentos':
                        incluir = archivo.tipo.includes('word') || archivo.tipo.includes('text') ||
                                 archivo.nombre.match(/\.(doc|docx|odt|rtf|txt)$/i);
                        break;
                    case 'hojas':
                        incluir = archivo.tipo.includes('excel') || archivo.tipo.includes('spreadsheet') ||
                                 archivo.nombre.match(/\.(xls|xlsx|csv|ods)$/i);
                        break;
                    case 'presentaciones':
                        incluir = archivo.tipo.includes('powerpoint') || archivo.tipo.includes('presentation') ||
                                 archivo.nombre.match(/\.(ppt|pptx|odp)$/i);
                        break;
                    default: // 'todos'
                        incluir = true;
                        break;
                }
                
                if (incluir) archivosFiltrados.push(archivo);
            });
            
            mostrarArchivosFiltrados(archivosFiltrados);
            mostrarNotificacion(`Mostrando ${archivosFiltrados.length} archivo(s) con filtro: ${filtro}`, 'info');
        }
        
        function mostrarArchivosFiltrados(archivosFiltrados) {
            const contenedor = document.getElementById('vistaPreviaGeneral');
            
            if (archivosFiltrados.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio">
                        <i class="fas fa-search"></i>
                        <p>No hay archivos con el filtro aplicado</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            const idsUsados = new Set();
            
            archivosFiltrados.forEach(archivo => {
                if (idsUsados.has(archivo.id)) return;
                idsUsados.add(archivo.id);
                
                const { claseIcono, icono } = determinarTipoArchivo(archivo);
                const tama帽oFormateado = formatearTama帽o(archivo.tama帽o);
                
                html += `
                    <div class="tarjeta-archivo" data-id-archivo="${archivo.id}">
                        <div class="icono-archivo ${claseIcono}">
                            <i class="${icono}"></i>
                        </div>
                        <div class="nombre-archivo" title="${archivo.nombre}">${archivo.nombre.length > 30 ? archivo.nombre.substring(0, 30) + '...' : archivo.nombre}</div>
                        <div class="detalles-archivo">
                            ${estado.formatearFechaLegible(archivo.fechaArchivo)}<br>
                            ${tama帽oFormateado}${archivo.almacenamiento === 'indexedDB' ? ' ' : ''}
                        </div>
                        <div class="acciones-archivo">
                            <button class="btn-accion-archivo" onclick="verArchivo('${archivo.id}')" title="Ver">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-accion-archivo" onclick="descargarArchivo('${archivo.id}')" title="Descargar">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn-accion-archivo btn-eliminar" onclick="solicitarEliminarArchivo('${archivo.id}', 'general')" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        function buscarEnTiempoReal(termino, tipo) {
            if (!termino.trim()) {
                if (tipo === 'actividades') {
                    actualizarActividadReciente();
                } else if (tipo === 'archivos') {
                    cargarArchivos();
                }
                return;
            }
            
            termino = termino.toLowerCase();
            
            if (tipo === 'actividades') {
                const actividades = [];
                const idsUsados = new Set();
                
                // Buscar en bit谩coras
                estado.datos.bitacoras.forEach(b => {
                    if (idsUsados.has(b.id)) return;
                    
                    if (b.descripcion.toLowerCase().includes(termino) || 
                        b.funcion.toLowerCase().includes(termino) ||
                        b.modalidad.toLowerCase().includes(termino) ||
                        (b.referencia && b.referencia.toLowerCase().includes(termino))) {
                        idsUsados.add(b.id);
                        actividades.push({
                            tipo: 'bitacora',
                            objeto: b
                        });
                    }
                });
                
                // Buscar en tareas
                estado.datos.tareas.forEach(t => {
                    if (idsUsados.has(t.id)) return;
                    
                    if (t.titulo.toLowerCase().includes(termino) || 
                        t.descripcion.toLowerCase().includes(termino) ||
                        t.funcion.toLowerCase().includes(termino) ||
                        t.prioridad.toLowerCase().includes(termino)) {
                        idsUsados.add(t.id);
                        actividades.push({
                            tipo: 'tarea',
                            objeto: t
                        });
                    }
                });
                
                mostrarResultadosBusqueda(actividades, termino);
                
            } else if (tipo === 'archivos') {
                const archivosFiltrados = estado.datos.archivos.filter(a => 
                    a.nombre.toLowerCase().includes(termino) || 
                    a.tipo.toLowerCase().includes(termino) ||
                    estado.formatearFechaLegible(a.fechaArchivo).toLowerCase().includes(termino)
                );
                
                mostrarArchivosFiltrados(archivosFiltrados);
            }
        }
        
        function mostrarResultadosBusqueda(actividades, termino) {
            const contenedor = document.getElementById('lista-actividad-reciente');
            
            if (actividades.length === 0) {
                contenedor.innerHTML = `
                    <div class="estado-vacio">
                        <i class="fas fa-search"></i>
                        <p>No se encontraron actividades con: "${termino}"</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            actividades.slice(0, 15).forEach(actividad => {
                if (actividad.tipo === 'bitacora') {
                    const b = actividad.objeto;
                    const fechaLegible = estado.formatearFechaLegible(b.fecha);
                    
                    html += `
                        <div class="tarea-item">
                            <div class="tarea-titulo">
                                <i class="fas fa-book"></i> Bit谩cora: ${obtenerTextoFuncion(b.funcion)}
                                <span class="badge ${b.modalidad === 'teletrabajo' ? 'badge-teletrabajo' : 'badge-presencial'}">
                                    ${b.modalidad === 'teletrabajo' ? 'Teletrabajo' : 'Presencial'}
                                </span>
                            </div>
                            <div class="tarea-fecha">
                                <i class="far fa-calendar"></i> ${fechaLegible} | 
                                <i class="far fa-clock"></i> ${b.horas} horas
                            </div>
                            <div class="tarea-descripcion">${b.descripcion.substring(0, 150)}${b.descripcion.length > 150 ? '...' : ''}</div>
                        </div>
                    `;
                } else {
                    const t = actividad.objeto;
                    const fechaLegible = estado.formatearFechaLegible(t.fechaVencimiento);
                    
                    html += `
                        <div class="tarea-item">
                            <div class="tarea-titulo">
                                <i class="fas fa-tasks"></i> ${t.titulo}
                                <span class="etiqueta-estado ${t.estado === 'pendiente' ? 'etiqueta-pendiente' : t.estado === 'completada' ? 'etiqueta-completada' : 'etiqueta-en-progreso'}">
                                    ${t.estado === 'pendiente' ? 'Pendiente' : t.estado === 'completada' ? 'Completada' : 'En Progreso'}
                                </span>
                            </div>
                            <div class="tarea-fecha">
                                <i class="far fa-calendar"></i> Vence: ${fechaLegible}
                            </div>
                            <div class="tarea-descripcion">${t.descripcion || 'Sin descripci贸n'}</div>
                        </div>
                    `;
                }
            });
            
            contenedor.innerHTML = html;
        }
        
        // ===== FUNCIONES DE INFORMES =====
        function generarInforme() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            const tipoInforme = document.getElementById('tipo-informe-seleccionado').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas de inicio y fin para el informe', 'error');
                return;
            }
            
            // Filtrar datos usando Sets para evitar duplicados
            const idsBitacoras = new Set();
            const idsTareas = new Set();
            
            const bitacorasFiltradas = estado.datos.bitacoras.filter(b => {
                if (idsBitacoras.has(b.id)) return false;
                
                const fechaBitacora = new Date(b.fecha);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaBitacora >= inicio && fechaBitacora <= fin) {
                    idsBitacoras.add(b.id);
                    return true;
                }
                return false;
            });
            
            const tareasFiltradas = estado.datos.tareas.filter(t => {
                if (idsTareas.has(t.id)) return false;
                
                const fechaTarea = new Date(t.fechaVencimiento);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaTarea >= inicio && fechaTarea <= fin) {
                    idsTareas.add(t.id);
                    return true;
                }
                return false;
            });
            
            if (bitacorasFiltradas.length === 0 && tareasFiltradas.length === 0) {
                mostrarNotificacion('No hay actividades en el rango de fechas seleccionado', 'error');
                return;
            }
            
            // Generar contenido
            const contenidoHTML = generarContenidoInforme(bitacorasFiltradas, tareasFiltradas, fechaInicio, fechaFin, tipoInforme);
            
            // Mostrar en vista previa
            document.getElementById('contenido-informe').innerHTML = contenidoHTML;
            document.getElementById('vistaPreviaInforme').style.display = 'block';
            document.getElementById('vistaPreviaInforme').scrollIntoView({ behavior: 'smooth' });
            
            mostrarNotificacion(`Informe generado para ${bitacorasFiltradas.length} bit谩coras y ${tareasFiltradas.length} tareas`, 'exito');
        }
        
        function generarContenidoInforme(bitacoras, tareas, fechaInicio, fechaFin, tipo) {
            // Calcular estad铆sticas
            let totalHoras = 0;
            let horasTeletrabajo = 0;
            let horasPresencial = 0;
            let horasMixto = 0;
            const funcionesContador = {};
            
            bitacoras.forEach(b => {
                totalHoras += b.horas;
                
                if (b.modalidad === 'teletrabajo') horasTeletrabajo += b.horas;
                else if (b.modalidad === 'presencial') horasPresencial += b.horas;
                else horasMixto += b.horas;
                
                funcionesContador[b.funcion] = (funcionesContador[b.funcion] || 0) + 1;
            });
            
            return `
                <h2 style="color: var(--mep-azul-principal); margin-bottom: 20px;">Informe DRTE MEP</h2>
                <p><strong>Per铆odo:</strong> ${estado.formatearFechaLegible(fechaInicio)} al ${estado.formatearFechaLegible(fechaFin)}</p>
                <p><strong>Tipo de informe:</strong> ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}</p>
                <p><strong>Generado:</strong> ${estado.formatearFechaLegible()} ${new Date().toLocaleTimeString('es-CR')}</p>
                <hr style="margin: 25px 0; border-color: var(--color-borde);">
                
                <h3 style="color: var(--mep-azul-principal); margin-top: 30px;">Estad铆sticas Generales</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-azul-principal);">
                        <strong>Total de Bit谩coras</strong><br>
                        <span style="font-size: 1.5rem; font-weight: bold;">${bitacoras.length}</span>
                    </div>
                    <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-verde);">
                        <strong>Total de Horas</strong><br>
                        <span style="font-size: 1.5rem; font-weight: bold;">${totalHoras.toFixed(1)}</span>
                    </div>
                    <div style="background: #f7fafc; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-naranja);">
                        <strong>Tareas en Per铆odo</strong><br>
                        <span style="font-size: 1.5rem; font-weight: bold;">${tareas.length}</span>
                    </div>
                </div>
                
                <h3 style="color: var(--mep-azul-principal); margin-top: 30px;">Distribuci贸n por Modalidad de Trabajo</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #f0fff4; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-verde);">
                        <strong>Teletrabajo</strong><br>
                        <span style="font-size: 1.2rem; font-weight: bold;">${horasTeletrabajo.toFixed(1)} horas</span><br>
                        <span>${totalHoras > 0 ? ((horasTeletrabajo / totalHoras) * 100).toFixed(1) : 0}%</span>
                    </div>
                    <div style="background: #fef3c7; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-naranja);">
                        <strong>Presencial</strong><br>
                        <span style="font-size: 1.2rem; font-weight: bold;">${horasPresencial.toFixed(1)} horas</span><br>
                        <span>${totalHoras > 0 ? ((horasPresencial / totalHoras) * 100).toFixed(1) : 0}%</span>
                    </div>
                    <div style="background: #ebf8ff; padding: 15px; border-radius: 10px; border-left: 4px solid var(--mep-azul-principal);">
                        <strong>Mixto</strong><br>
                        <span style="font-size: 1.2rem; font-weight: bold;">${horasMixto.toFixed(1)} horas</span><br>
                        <span>${totalHoras > 0 ? ((horasMixto / totalHoras) * 100).toFixed(1) : 0}%</span>
                    </div>
                </div>
                
                <h3 style="color: var(--mep-azul-principal); margin-top: 30px;">Detalle de Actividades</h3>
                <div style="margin: 20px 0;">
                    ${bitacoras.length > 0 ? generarTablaBitacoras(bitacoras) : ''}
                    ${tareas.length > 0 ? generarTablaTareas(tareas) : ''}
                </div>
                
                ${Object.keys(funcionesContador).length > 0 ? generarResumenFunciones(funcionesContador) : ''}
                
                <hr style="margin: 40px 0; border-color: var(--color-borde);">
                <div style="text-align: right; margin-top: 50px;">
                    <p><strong>Asesor Nacional DRTE MEP</strong></p>
                    <p>Kevin S谩nchez Bogar铆n</p>
                    <p>Departamento de Investigaci贸n, Desarrollo e Implementaci贸n</p>
                    <p>${estado.formatearFechaLegible()}</p>
                </div>
            `;
        }
        
        function generarTablaBitacoras(bitacoras) {
            let html = `<h4>Bit谩coras Registradas (${bitacoras.length})</h4>`;
            html += `<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">`;
            html += `<tr style="background: #f7fafc; font-weight: bold;">
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Fecha</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Funci贸n</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Modalidad</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Horas</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Descripci贸n</td>
            </tr>`;
            
            bitacoras.forEach(b => {
                const funcionTexto = obtenerTextoFuncion(b.funcion);
                
                html += `<tr>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${estado.formatearFechaLegible(b.fecha)}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${funcionTexto}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${b.modalidad === 'teletrabajo' ? 'Teletrabajo' : b.modalidad === 'presencial' ? 'Presencial' : 'Mixto'}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${b.horas}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${b.descripcion.substring(0, 100)}${b.descripcion.length > 100 ? '...' : ''}</td>
                </tr>`;
            });
            
            html += `</table>`;
            return html;
        }
        
        function generarTablaTareas(tareas) {
            let html = `<h4 style="margin-top: 30px;">Tareas (${tareas.length})</h4>`;
            html += `<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">`;
            html += `<tr style="background: #f7fafc; font-weight: bold;">
                <td style="padding: 10px; border: 1px solid #e2e8f0;">T铆tulo</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Vence</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Prioridad</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Estado</td>
                <td style="padding: 10px; border: 1px solid #e2e8f0;">Descripci贸n</td>
            </tr>`;
            
            tareas.forEach(t => {
                html += `<tr>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${t.titulo}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${estado.formatearFechaLegible(t.fechaVencimiento)}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${t.prioridad}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${t.estado === 'pendiente' ? 'Pendiente' : t.estado === 'completada' ? 'Completada' : 'En Progreso'}</td>
                    <td style="padding: 10px; border: 1px solid #e2e8f0;">${t.descripcion ? t.descripcion.substring(0, 80) + (t.descripcion.length > 80 ? '...' : '') : 'Sin descripci贸n'}</td>
                </tr>`;
            });
            
            html += `</table>`;
            return html;
        }
        
        function generarResumenFunciones(funcionesContador) {
            let html = `<h3 style="color: var(--mep-azul-principal); margin-top: 30px;">Actividades por Funci贸n Institucional</h3><div style="margin: 20px 0;">`;
            
            Object.keys(funcionesContador).forEach(funcion => {
                const funcionTexto = obtenerTextoFuncion(funcion);
                
                html += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 10px; background: #f7fafc; border-radius: 8px;">
                        <span>${funcionTexto}</span>
                        <span style="font-weight: bold;">${funcionesContador[funcion]} actividad(es)</span>
                    </div>
                `;
            });
            
            html += `</div>`;
            return html;
        }
        
        function exportarAExcel() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas de inicio y fin para exportar', 'error');
                return;
            }
            
            // Filtrar bit谩coras (sin duplicados)
            const idsUsados = new Set();
            const bitacorasFiltradas = estado.datos.bitacoras.filter(b => {
                if (idsUsados.has(b.id)) return false;
                
                const fechaBitacora = new Date(b.fecha);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaBitacora >= inicio && fechaBitacora <= fin) {
                    idsUsados.add(b.id);
                    return true;
                }
                return false;
            });
            
            if (bitacorasFiltradas.length === 0) {
                mostrarNotificacion('No hay bit谩coras en el rango de fechas seleccionado', 'error');
                return;
            }
            
            // Crear CSV
            let csvContent = "Fecha,Modalidad,Funci贸n Institucional,Horas,Referencia,Descripci贸n\n";
            
            bitacorasFiltradas.forEach(b => {
                const funcionTexto = obtenerTextoFuncion(b.funcion);
                const modalidadTexto = b.modalidad === 'teletrabajo' ? 'Teletrabajo' : 
                                      b.modalidad === 'presencial' ? 'Presencial' : 'Mixto';
                const descripcionEscapada = b.descripcion.replace(/"/g, '""');
                
                csvContent += `"${estado.formatearFechaLegible(b.fecha)}","${modalidadTexto}","${funcionTexto}","${b.horas}","${b.referencia || ''}","${descripcionEscapada}"\n`;
            });
            
            // Descargar
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const nombreArchivo = `Informe_DRTE_${fechaInicio}_a_${fechaFin}.csv`;
            
            a.href = url;
            a.download = nombreArchivo;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            mostrarNotificacion(`Archivo CSV exportado: ${nombreArchivo}`, 'exito');
        }
        
        function exportarAPDF() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            const tipoInforme = document.getElementById('tipo-informe-seleccionado').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas de inicio y fin para exportar', 'error');
                return;
            }
            
            // Filtrar datos
            const idsBitacoras = new Set();
            const idsTareas = new Set();
            
            const bitacorasFiltradas = estado.datos.bitacoras.filter(b => {
                if (idsBitacoras.has(b.id)) return false;
                
                const fechaBitacora = new Date(b.fecha);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaBitacora >= inicio && fechaBitacora <= fin) {
                    idsBitacoras.add(b.id);
                    return true;
                }
                return false;
            });
            
            const tareasFiltradas = estado.datos.tareas.filter(t => {
                if (idsTareas.has(t.id)) return false;
                
                const fechaTarea = new Date(t.fechaVencimiento);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaTarea >= inicio && fechaTarea <= fin) {
                    idsTareas.add(t.id);
                    return true;
                }
                return false;
            });
            
            if (bitacorasFiltradas.length === 0 && tareasFiltradas.length === 0) {
                mostrarNotificacion('No hay actividades para exportar a PDF', 'error');
                return;
            }
            
            try {
                // Crear PDF con jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Logo MEP (texto simulado)
                doc.setFontSize(24);
                doc.setTextColor(0, 86, 166);
                doc.text('DRTE MEP', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text('Sistema Integral de Gesti贸n', 105, 30, { align: 'center' });
                
                // Informaci贸n del informe
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text('INFORME DE ACTIVIDADES', 105, 45, { align: 'center' });
                
                doc.setFontSize(10);
                doc.text(`Per铆odo: ${estado.formatearFechaLegible(fechaInicio)} al ${estado.formatearFechaLegible(fechaFin)}`, 20, 60);
                doc.text(`Tipo: ${tipoInforme.charAt(0).toUpperCase() + tipoInforme.slice(1)}`, 20, 67);
                doc.text(`Generado: ${estado.formatearFechaLegible()}`, 20, 74);
                
                // Estad铆sticas
                let totalHoras = 0;
                bitacorasFiltradas.forEach(b => totalHoras += b.horas);
                
                doc.setFontSize(12);
                doc.text('Estad铆sticas Generales:', 20, 90);
                
                doc.setFontSize(10);
                doc.text(` Total de bit谩coras: ${bitacorasFiltradas.length}`, 30, 100);
                doc.text(` Total de horas: ${totalHoras.toFixed(1)}`, 30, 107);
                doc.text(` Total de tareas: ${tareasFiltradas.length}`, 30, 114);
                
                // Tabla de bit谩coras
                if (bitacorasFiltradas.length > 0) {
                    doc.addPage();
                    doc.setFontSize(12);
                    doc.text('Bit谩coras Registradas:', 20, 20);
                    
                    const headers = [['Fecha', 'Funci贸n', 'Modalidad', 'Horas']];
                    const data = bitacorasFiltradas.map(b => [
                        estado.formatearFechaLegible(b.fecha),
                        obtenerTextoFuncion(b.funcion).substring(0, 30),
                        b.modalidad === 'teletrabajo' ? 'Teletrabajo' : b.modalidad === 'presencial' ? 'Presencial' : 'Mixto',
                        b.horas.toString()
                    ]);
                    
                    doc.autoTable({
                        startY: 30,
                        head: headers,
                        body: data,
                        theme: 'grid',
                        headStyles: { fillColor: [0, 86, 166] },
                        margin: { left: 20 }
                    });
                }
                
                // Tabla de tareas
                if (tareasFiltradas.length > 0) {
                    doc.addPage();
                    doc.setFontSize(12);
                    doc.text('Tareas Registradas:', 20, 20);
                    
                    const headers = [['T铆tulo', 'Vence', 'Prioridad', 'Estado']];
                    const data = tareasFiltradas.map(t => [
                        t.titulo.substring(0, 30),
                        estado.formatearFechaLegible(t.fechaVencimiento),
                        t.prioridad,
                        t.estado === 'pendiente' ? 'Pendiente' : t.estado === 'completada' ? 'Completada' : 'En Progreso'
                    ]);
                    
                    doc.autoTable({
                        startY: 30,
                        head: headers,
                        body: data,
                        theme: 'grid',
                        headStyles: { fillColor: [0, 86, 166] },
                        margin: { left: 20 }
                    });
                }
                
                // Firma
                const pageCount = doc.internal.getNumberOfPages();
                doc.setPage(pageCount);
                const pageHeight = doc.internal.pageSize.height;
                
                doc.setFontSize(10);
                doc.text('_________________________________', 105, pageHeight - 40, { align: 'center' });
                doc.text('Asesor Nacional DRTE MEP', 105, pageHeight - 35, { align: 'center' });
                doc.text('Kevin S谩nchez Bogar铆n', 105, pageHeight - 30, { align: 'center' });
                doc.text('Departamento de Investigaci贸n, Desarrollo e Implementaci贸n', 105, pageHeight - 25, { align: 'center' });
                
                // Guardar PDF
                const nombreArchivo = `Informe_DRTE_${fechaInicio}_a_${fechaFin}.pdf`;
                doc.save(nombreArchivo);
                
                mostrarNotificacion(`PDF exportado: ${nombreArchivo}`, 'exito');
                
            } catch (error) {
                console.error('Error exportando a PDF:', error);
                mostrarNotificacion('Error al exportar a PDF', 'error');
            }
        }
        
        function copiarInformeParaCorreo() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas de inicio y fin para el informe', 'error');
                return;
            }
            
            // Filtrar bit谩coras (sin duplicados)
            const idsUsados = new Set();
            const bitacorasFiltradas = estado.datos.bitacoras.filter(b => {
                if (idsUsados.has(b.id)) return false;
                
                const fechaBitacora = new Date(b.fecha);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaBitacora >= inicio && fechaBitacora <= fin) {
                    idsUsados.add(b.id);
                    return true;
                }
                return false;
            });
            
            if (bitacorasFiltradas.length === 0) {
                mostrarNotificacion('No hay bit谩coras en el rango de fechas seleccionado', 'error');
                return;
            }
            
            // Calcular estad铆sticas
            let totalHoras = 0;
            let horasTeletrabajo = 0;
            let horasPresencial = 0;
            let horasMixto = 0;
            
            bitacorasFiltradas.forEach(b => {
                totalHoras += b.horas;
                
                if (b.modalidad === 'teletrabajo') horasTeletrabajo += b.horas;
                else if (b.modalidad === 'presencial') horasPresencial += b.horas;
                else horasMixto += b.horas;
            });
            
            // Crear texto
            const textoCorreo = `INFORME DE ACTIVIDADES DRTE MEP

Per铆odo: ${estado.formatearFechaLegible(fechaInicio)} al ${estado.formatearFechaLegible(fechaFin)}
Generado: ${estado.formatearFechaLegible()} ${new Date().toLocaleTimeString('es-CR')}

RESUMEN ESTADSTICO
Total de bit谩coras: ${bitacorasFiltradas.length}
Total de horas: ${totalHoras.toFixed(1)}
- Teletrabajo: ${horasTeletrabajo.toFixed(1)} horas (${totalHoras > 0 ? ((horasTeletrabajo / totalHoras) * 100).toFixed(1) : 0}%)
- Presencial: ${horasPresencial.toFixed(1)} horas (${totalHoras > 0 ? ((horasPresencial / totalHoras) * 100).toFixed(1) : 0}%)
- Mixto: ${horasMixto.toFixed(1)} horas (${totalHoras > 0 ? ((horasMixto / totalHoras) * 100).toFixed(1) : 0}%)

DETALLE DE ACTIVIDADES
${bitacorasFiltradas.map(b => {
    const funcionTexto = obtenerTextoFuncion(b.funcion);
    
    return ` ${estado.formatearFechaLegible(b.fecha)} - ${funcionTexto} (${b.modalidad === 'teletrabajo' ? 'Teletrabajo' : b.modalidad === 'presencial' ? 'Presencial' : 'Mixto'}): ${b.horas} horas
   ${b.descripcion.substring(0, 100)}${b.descripcion.length > 100 ? '...' : ''}`;
}).join('\n')}

---
Sistema Integral de Gesti贸n DRTE MEP
Asesor Nacional: Kevin S谩nchez Bogar铆n
Departamento de Investigaci贸n, Desarrollo e Implementaci贸n`;

            copiarAlPortapapeles(textoCorreo, 'Informe copiado al portapapeles para correo');
        }
        
        function imprimirInforme() {
            const fechaInicio = document.getElementById('fecha-inicio-informe').value;
            const fechaFin = document.getElementById('fecha-fin-informe').value;
            const tipoInforme = document.getElementById('tipo-informe-seleccionado').value;
            
            if (!fechaInicio || !fechaFin) {
                mostrarNotificacion('Seleccione fechas de inicio y fin para imprimir', 'error');
                return;
            }
            
            // Filtrar datos
            const idsBitacoras = new Set();
            const idsTareas = new Set();
            
            const bitacorasFiltradas = estado.datos.bitacoras.filter(b => {
                if (idsBitacoras.has(b.id)) return false;
                
                const fechaBitacora = new Date(b.fecha);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaBitacora >= inicio && fechaBitacora <= fin) {
                    idsBitacoras.add(b.id);
                    return true;
                }
                return false;
            });
            
            const tareasFiltradas = estado.datos.tareas.filter(t => {
                if (idsTareas.has(t.id)) return false;
                
                const fechaTarea = new Date(t.fechaVencimiento);
                const inicio = new Date(fechaInicio);
                const fin = new Date(fechaFin);
                
                if (fechaTarea >= inicio && fechaTarea <= fin) {
                    idsTareas.add(t.id);
                    return true;
                }
                return false;
            });
            
            if (bitacorasFiltradas.length === 0 && tareasFiltradas.length === 0) {
                mostrarNotificacion('No hay actividades para imprimir', 'error');
                return;
            }
            
            // Crear contenido para impresi贸n
            const contenidoImpresion = document.getElementById('contenedor-impresion');
            
            let totalHoras = 0;
            bitacorasFiltradas.forEach(b => totalHoras += b.horas);
            
            contenidoImpresion.innerHTML = `
                <div class="header-impresion">
                    <h1 style="color: #0056a6; margin-bottom: 10px;">DRTE MEP</h1>
                    <h2 style="color: #333; margin-bottom: 5px;">Sistema Integral de Gesti贸n</h2>
                    <h3 style="color: #666;">Informe de Actividades</h3>
                </div>
                
                <div class="fecha-impresion">
                    Generado: ${estado.formatearFechaLegible()} ${new Date().toLocaleTimeString('es-CR')}
                </div>
                
                <div style="margin-bottom: 30px;">
                    <p><strong>Per铆odo:</strong> ${estado.formatearFechaLegible(fechaInicio)} al ${estado.formatearFechaLegible(fechaFin)}</p>
                    <p><strong>Tipo de informe:</strong> ${tipoInforme.charAt(0).toUpperCase() + tipoInforme.slice(1)}</p>
                </div>
                
                <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                    <h4 style="margin-top: 0; color: #0056a6;">Estad铆sticas Generales</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #0056a6;">${bitacorasFiltradas.length}</div>
                            <div>Bit谩coras</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #00a859;">${totalHoras.toFixed(1)}</div>
                            <div>Horas totales</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f26522;">${tareasFiltradas.length}</div>
                            <div>Tareas</div>
                        </div>
                    </div>
                </div>
                
                ${bitacorasFiltradas.length > 0 ? `
                    <h4 style="color: #0056a6; margin-top: 40px;">Bit谩coras Registradas (${bitacorasFiltradas.length})</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Funci贸n</th>
                                <th>Modalidad</th>
                                <th>Horas</th>
                                <th>Descripci贸n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${bitacorasFiltradas.map(b => `
                                <tr>
                                    <td>${estado.formatearFechaLegible(b.fecha)}</td>
                                    <td>${obtenerTextoFuncion(b.funcion)}</td>
                                    <td>${b.modalidad === 'teletrabajo' ? 'Teletrabajo' : b.modalidad === 'presencial' ? 'Presencial' : 'Mixto'}</td>
                                    <td>${b.horas}</td>
                                    <td>${b.descripcion.substring(0, 80)}${b.descripcion.length > 80 ? '...' : ''}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                ` : ''}
                
                ${tareasFiltradas.length > 0 ? `
                    <h4 style="color: #0056a6; margin-top: 40px;">Tareas (${tareasFiltradas.length})</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>T铆tulo</th>
                                <th>Vence</th>
                                <th>Prioridad</th>
                                <th>Estado</th>
                                <th>Descripci贸n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tareasFiltradas.map(t => `
                                <tr>
                                    <td>${t.titulo}</td>
                                    <td>${estado.formatearFechaLegible(t.fechaVencimiento)}</td>
                                    <td>${t.prioridad}</td>
                                    <td>${t.estado === 'pendiente' ? 'Pendiente' : t.estado === 'completada' ? 'Completada' : 'En Progreso'}</td>
                                    <td>${t.descripcion ? t.descripcion.substring(0, 60) + (t.descripcion.length > 60 ? '...' : '') : 'Sin descripci贸n'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                ` : ''}
                
                <div class="firma-impresion">
                    <p>_________________________________</p>
                    <p><strong>Asesor Nacional DRTE MEP</strong></p>
                    <p>Kevin S谩nchez Bogar铆n</p>
                    <p>Departamento de Investigaci贸n, Desarrollo e Implementaci贸n</p>
                </div>
            `;
            
            // Imprimir
            contenidoImpresion.style.display = 'block';
            window.print();
            contenidoImpresion.style.display = 'none';
            
            mostrarNotificacion('Informe listo para imprimir', 'info');
        }
        
        // ===== FUNCIONES DE UTILIDAD =====
        function mostrarNotificacion(mensaje, tipo = 'info', duracion = 5000) {
            const contenedor = document.getElementById('contenedorNotificaciones');
            const id = 'notificacion_' + Date.now();
            
            const notificacion = document.createElement('div');
            notificacion.id = id;
            notificacion.className = `notificacion ${tipo}`;
            notificacion.innerHTML = `
                <i class="fas ${tipo === 'exito' ? 'fa-check-circle' : tipo === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${mensaje}</span>
            `;
            
            contenedor.appendChild(notificacion);
            
            setTimeout(() => {
                const notif = document.getElementById(id);
                if (notif) {
                    notif.classList.add('deslizar-salida');
                    setTimeout(() => {
                        if (notif.parentNode) notif.parentNode.removeChild(notif);
                    }, 400);
                }
            }, duracion);
        }
        
        function actualizarFechaHoraCR() {
            const elemento = document.getElementById('fecha-hora-cr');
            const actualizar = () => {
                const fechaCR = estado.obtenerFechaCR();
                const opciones = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZone: 'America/Costa_Rica'
                };
                elemento.textContent = fechaCR.toLocaleDateString('es-CR', opciones);
            };
            
            actualizar();
            setInterval(actualizar, 60000);
        }
        
        function cambiarSeccion(seccionId) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('activo'));
            document.querySelector(`[data-seccion="${seccionId}"]`).classList.add('activo');
            
            document.querySelectorAll('.seccion-contenido').forEach(sec => {
                sec.classList.remove('visible');
            });
            document.getElementById(seccionId).classList.add('visible');
        }
        
        function obtenerTextoFuncion(funcion) {
            const funciones = {
                'orientacion': 'Orientaciones curriculares',
                'evaluacion': 'Evaluaci贸n de aprendizajes',
                'seguimiento': 'Seguimiento curricular',
                'coordinacion': 'Coordinaciones interdepartamentales',
                'formacion': 'Eventos de formaci贸n docente',
                'monitoreo': 'Monitoreo y acompa帽amiento',
                'informes': 'Informes para jefatura',
                'investigacion': 'Investigaci贸n educativa',
                'desarrollo': 'Desarrollo de recursos t茅cnicos'
            };
            
            return funciones[funcion] || funcion;
        }
        
        function copiarAlPortapapeles(texto, mensajeExito) {
            navigator.clipboard.writeText(texto).then(() => {
                mostrarNotificacion(mensajeExito, 'exito');
            }).catch(err => {
                console.error('Error al copiar: ', err);
                mostrarNotificacion('Error al copiar al portapapeles', 'error');
            });
        }
        
        function crearRespaldoManual() {
            const datosRespaldo = {
                version: SISTEMA_VERSION,
                fechaRespaldo: new Date().toISOString(),
                datos: estado.datos,
                configuracion: estado.config
            };
            
            const jsonRespaldo = JSON.stringify(datosRespaldo, null, 2);
            const blob = new Blob([jsonRespaldo], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const nombreArchivo = `Respaldo_DRTE_${estado.formatearFechaCR().replace(/-/g, '')}_${Date.now()}.json`;
            
            a.href = url;
            a.download = nombreArchivo;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            mostrarNotificacion(`Respaldo creado: ${nombreArchivo}`, 'exito');
        }
        
        // ===== FUNCIONES DEL MODAL DE CONFIRMACIN =====
        function cerrarModalConfirmacion() {
            document.getElementById('modalConfirmacion').style.display = 'none';
            estado.elementoAEliminar = null;
            estado.tipoAEliminar = null;
            estado.contextoAEliminar = null;
        }
        
        function confirmarEliminacion() {
            if (!estado.elementoAEliminar || !estado.tipoAEliminar) {
                cerrarModalConfirmacion();
                return;
            }
            
            const id = estado.elementoAEliminar;
            const tipo = estado.tipoAEliminar;
            const contexto = estado.contextoAEliminar;
            
            switch(tipo) {
                case 'bitacora':
                    eliminarBitacora(id);
                    break;
                case 'tarea':
                    eliminarTarea(id);
                    break;
                case 'archivo':
                    eliminarArchivo(id, contexto);
                    break;
            }
            
            cerrarModalConfirmacion();
        }
        
        // ===== EXPORTAR FUNCIONES AL SCOPE GLOBAL =====
        window.verArchivo = verArchivo;
        window.descargarArchivo = descargarArchivo;
        window.solicitarEliminarArchivo = solicitarEliminarArchivo;
        
        window.editarBitacora = editarBitacora;
        window.solicitarEliminarBitacora = solicitarEliminarBitacora;
        window.solicitarEliminarBitacoraDesdeCalendario = solicitarEliminarBitacoraDesdeCalendario;
        
        window.marcarTareaCompletada = marcarTareaCompletada;
        window.editarTarea = editarTarea;
        window.solicitarEliminarTarea = solicitarEliminarTarea;
        window.solicitarEliminarTareaDesdeCalendario = solicitarEliminarTareaDesdeCalendario;
        
        window.crearTareaDesdeCalendario = crearTareaDesdeCalendario;
        window.crearBitacoraDesdeCalendario = crearBitacoraDesdeCalendario;
        
        window.generarInforme = generarInforme;
        window.exportarAExcel = exportarAExcel;
        window.exportarAPDF = exportarAPDF;
        window.copiarInformeParaCorreo = copiarInformeParaCorreo;
        window.imprimirInforme = imprimirInforme;
        
        window.crearRespaldoManual = crearRespaldoManual;
    </script>
</body>
</html>
