<!DOCTYPE html>
<html lang="es-CR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Agenda Digital DRTE - Sistema Integral de Gesti√≥n Profesional">
    <meta name="theme-color" content="#1a1a2e">
    <title>Agenda Digital DRTE | Sistema Profesional MEP</title>
    
    <!-- ENLACES EXTERNOS COMPLETOS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.6/viewer.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.6/viewer.min.js"></script>
    
    <style>
        /* ===== ESTILOS PROFESIONALES ORIGINALES MEJORADOS ===== */
        :root {
            --color-primary: #1a1a2e; 
            --color-secondary: #16213e; 
            --color-accent: #0f3460;
            --color-success: #00b894; 
            --color-warning: #fdcb6e; 
            --color-danger: #d63031;
            --color-info: #0984e3; 
            --color-light: #f8f9fa; 
            --color-dark: #2d3436;
            --mep-blue: #0056a6;
            --mep-green: #00a859;
            --mep-orange: #f26522;
            --border-radius: 12px; 
            --box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --glass-bg: rgba(255,255,255,0.08);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            --gradient-warning: linear-gradient(135deg, #fdcb6e 0%, #f9a825 100%);
            --gradient-danger: linear-gradient(135deg, #d63031 0%, #c62828 100%);
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            background-attachment: fixed;
            color: var(--color-light);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
        }

        /* ===== HEADER CORPORATIVO ORIGINAL MEJORADO ===== */
        .header {
            background: rgba(255,255,255,0.09);
            backdrop-filter: blur(25px);
            border-radius: var(--border-radius);
            padding: 25px 35px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.12);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--mep-blue), var(--mep-green), var(--mep-orange));
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
            position: relative;
            overflow: hidden;
        }
        
        .logo::after {
            content: 'MEP';
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 10px;
            font-weight: bold;
            color: rgba(255,255,255,0.8);
        }
        
        .brand-info h1 { 
            font-size: 2rem; 
            font-weight: 800; 
            margin-bottom: 8px;
            background: linear-gradient(135deg, #fff 0%, #a8edea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .brand-info p { 
            color: rgba(255,255,255,0.7); 
            font-size: 0.95rem;
            max-width: 500px;
        }
        
        .header-controls { 
            display: flex; 
            gap: 15px; 
            align-items: center; 
        }
        
        .status-badge {
            background: rgba(0,184,148,0.25);
            color: var(--color-success);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,184,148,0.3);
        }
        
        .datetime {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.8);
            background: rgba(255,255,255,0.05);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* ===== PANEL ENLACES EXTERNOS DRTE MEJORADO ===== */
        .external-links-panel {
            background: rgba(0,0,0,0.25);
            padding: 20px 35px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            box-shadow: var(--box-shadow);
        }
        
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .external-link {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.95rem;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            background: rgba(255,255,255,0.07);
            border: 1px solid rgba(255,255,255,0.15);
            position: relative;
            overflow: hidden;
        }
        
        .external-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s;
        }
        
        .external-link:hover::before {
            left: 100%;
        }
        
        .external-link:hover {
            background: rgba(255,255,255,0.12);
            color: white;
            transform: translateY(-3px);
            border-color: rgba(255,255,255,0.3);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .external-link i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* ===== SISTEMA DE PESTA√ëAS PROFESIONAL ===== */
        .tabs-system {
            background: rgba(255,255,255,0.08);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .tabs-header {
            display: flex;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 0;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 20px 30px;
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            font-size: 1rem;
        }
        
        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
        }
        
        .tab-btn.active {
            color: white;
            background: rgba(255,255,255,0.05);
        }
        
        .tab-btn.active::after {
            width: 100%;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active { 
            display: block; 
        }

        /* ===== CARD SYSTEM ORIGINAL MEJORADO ===== */
        .card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(25px);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: var(--box-shadow);
            margin-bottom: 25px;
            transition: var(--transition);
        }
        
        .card:hover {
            border-color: rgba(255,255,255,0.25);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .card-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        /* ===== BOTONES PROFESIONALES COMPLETOS ===== */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            text-decoration: none;
            user-select: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.25);
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--gradient-warning);
            color: white;
        }
        
        .btn-email {
            background: linear-gradient(135deg, #0078D4 0%, #005a9e 100%);
            color: white;
        }
        
        .btn-print {
            background: linear-gradient(135deg, #666666 0%, #333333 100%);
            color: white;
        }
        
        .btn-export {
            position: relative;
        }
        
        .export-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(26,26,46,0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 15px;
            min-width: 220px;
            margin-top: 10px;
            display: none;
            z-index: 1000;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        
        .btn-export:hover .export-dropdown {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .export-dropdown a {
            display: block;
            padding: 12px 18px;
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            border-radius: 8px;
            transition: var(--transition);
            font-size: 0.9rem;
            margin: 5px 0;
        }
        
        .export-dropdown a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* ===== DASHBOARD GRID PROFESIONAL ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition);
        }
        
        .stat-item:hover {
            background: rgba(255,255,255,0.08);
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-icon.pending {
            background: linear-gradient(135deg, rgba(253,203,110,0.2) 0%, rgba(249,168,37,0.2) 100%);
            color: var(--color-warning);
        }
        
        .stat-icon.completed {
            background: linear-gradient(135deg, rgba(0,184,148,0.2) 0%, rgba(0,160,133,0.2) 100%);
            color: var(--color-success);
        }
        
        .stat-icon.meeting {
            background: linear-gradient(135deg, rgba(9,132,227,0.2) 0%, rgba(21,101,192,0.2) 100%);
            color: var(--color-info);
        }
        
        .stat-icon.files {
            background: linear-gradient(135deg, rgba(155,89,182,0.2) 0%, rgba(142,68,173,0.2) 100%);
            color: #9b59b6;
        }
        
        .stat-info {
            flex: 1;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: white;
        }

        /* ===== SISTEMA DE BIT√ÅCORA COMPLETO ===== */
        .journal-system {
            min-height: 500px;
        }
        
        .journal-toolbar {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .journal-editor {
            background: rgba(255,255,255,0.03);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 400px;
            padding: 25px;
            color: white;
            font-size: 1rem;
            line-height: 1.8;
        }
        
        .journal-editor:focus {
            outline: none;
            border-color: rgba(102,126,234,0.5);
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .journal-editor h3 {
            color: #a8edea;
            margin: 20px 0 15px;
            font-size: 1.3rem;
        }
        
        .journal-editor ul, .journal-editor ol {
            margin-left: 25px;
            margin-bottom: 15px;
        }
        
        .journal-editor li {
            margin-bottom: 8px;
        }

        /* ===== SISTEMA DE TAREAS PROFESIONAL ===== */
        .task-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 12px 25px;
            background: rgba(255,255,255,0.07);
            color: rgba(255,255,255,0.9);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .filter-btn:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-2px);
        }
        
        .filter-btn.active {
            background: var(--gradient-primary);
            border-color: transparent;
            color: white;
            box-shadow: 0 8px 20px rgba(102,126,234,0.3);
        }
        
        .tasks-container {
            min-height: 500px;
        }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .task-item {
            background: rgba(255,255,255,0.07);
            border-radius: var(--border-radius);
            padding: 25px;
            border-left: 5px solid transparent;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .task-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(10px);
            border-color: rgba(255,255,255,0.2);
        }
        
        .task-item.pending {
            border-left-color: var(--color-warning);
        }
        
        .task-item.completed {
            border-left-color: var(--color-success);
            opacity: 0.9;
        }
        
        .task-item.urgent {
            border-left-color: var(--color-danger);
            background: rgba(214,48,49,0.05);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .task-title {
            font-size: 1.2rem;
            font-weight: 600;
            flex: 1;
            color: white;
        }
        
        .task-actions {
            display: flex;
            gap: 10px;
        }
        
        .task-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .task-action-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
        
        .task-meta {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            background: rgba(255,255,255,0.05);
            padding: 8px 15px;
            border-radius: 20px;
        }

        /* ===== SISTEMA DE ARCHIVOS POR FECHA COMPLETO ===== */
        .file-upload-system {
            border: 3px dashed rgba(255,255,255,0.3);
            border-radius: var(--border-radius);
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(255,255,255,0.02);
            margin: 25px 0;
            position: relative;
            overflow: hidden;
        }
        
        .file-upload-system.dragover {
            border-color: var(--color-success);
            background: rgba(0,184,148,0.1);
            transform: scale(1.02);
        }
        
        .file-upload-system::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.03) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .file-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .file-preview {
            background: rgba(255,255,255,0.07);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .file-preview:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-8px);
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .file-preview img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
        }
        
        .file-actions .btn {
            flex: 1;
            padding: 10px;
            font-size: 0.85rem;
        }

        /* ===== CALENDARIO PROFESIONAL ===== */
        .calendar {
            margin-bottom: 30px;
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .calendar-nav h2 {
            font-size: 1.6rem;
            font-weight: 700;
            color: white;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .calendar-weekday {
            text-align: center;
            font-weight: 600;
            padding: 15px 10px;
            color: rgba(255,255,255,0.7);
            font-size: 0.95rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.07);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            font-weight: 500;
            font-size: 1.1rem;
            position: relative;
        }
        
        .calendar-day:hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.05);
        }
        
        .calendar-day.today {
            background: rgba(102,126,234,0.3);
            border-color: #667eea;
            color: white;
            font-weight: 700;
        }
        
        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 10px;
            width: 8px;
            height: 8px;
            background: var(--color-success);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--color-success);
        }

        /* ===== MODALES PROFESIONALES ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: rgba(26,26,46,0.95);
            backdrop-filter: blur(30px);
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 30px 80px rgba(0,0,0,0.4);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-40px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .modal-close {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 1.2rem;
        }
        
        .modal-close:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }

        /* ===== FORMULARIOS PROFESIONALES ===== */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: white;
            font-size: 1rem;
        }
        
        .form-control {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255,255,255,0.07);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.1);
            box-shadow: 0 0 0 4px rgba(102,126,234,0.15);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
            line-height: 1.6;
        }

        /* ===== NOTIFICACIONES ===== */
        .notification-center {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 400px;
        }
        
        .notification {
            background: rgba(26,26,46,0.95);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px 25px;
            border-left: 5px solid;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            min-width: 300px;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .notification.success {
            border-left-color: var(--color-success);
            background: rgba(26,26,46,0.98);
        }
        
        .notification.error {
            border-left-color: var(--color-danger);
            background: rgba(26,26,46,0.98);
        }
        
        .notification.info {
            border-left-color: var(--color-info);
            background: rgba(26,26,46,0.98);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 20px;
            }
            
            .brand {
                flex-direction: column;
                text-align: center;
            }
            
            .tabs-header {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
                justify-content: center;
                padding: 18px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .links-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .file-preview-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calendar-days {
                gap: 5px;
            }
            
            .calendar-day {
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .file-preview-container {
                grid-template-columns: 1fr;
            }
            
            .task-actions {
                flex-direction: column;
            }
            
            .task-action-btn {
                width: 100%;
            }
        }

        /* ===== ESTADOS VAC√çOS ===== */
        .empty-state {
            text-align: center;
            padding: 60px 30px;
            color: rgba(255,255,255,0.5);
        }
        
        .empty-icon {
            font-size: 60px;
            margin-bottom: 25px;
            opacity: 0.5;
        }
        
        .text-muted {
            color: rgba(255,255,255,0.5);
            font-size: 0.95rem;
        }
        
        .mt-3 { margin-top: 20px; }
        .mb-3 { margin-bottom: 20px; }
        .btn-block { width: 100%; }
        .btn-sm { padding: 10px 20px; font-size: 0.9rem; }
    </style>
</head>
<body>
    <!-- SISTEMA DE NOTIFICACIONES -->
    <div id="notification-center" class="notification-center"></div>

    <!-- VISOR DE ARCHIVOS PROFESIONAL -->
    <div id="file-viewer-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="viewer-title">Visualizando Archivo</h2>
                <button class="modal-close" onclick="closeViewer()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="file-viewer-body" id="file-viewer-body">
                <!-- Contenido del visor -->
            </div>
        </div>
    </div>

    <!-- MODAL DE TAREAS PROFESIONAL -->
    <div id="task-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-tasks"></i> Nueva Tarea / Funci√≥n del Equipo</h2>
                <button class="modal-close" onclick="closeModal('task-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="task-form" onsubmit="saveTask(event)">
                <div class="form-group">
                    <label class="form-label">Funci√≥n del Equipo DRTE</label>
                    <select id="task-function" class="form-control" required>
                        <option value="">Seleccionar funci√≥n</option>
                        <option value="1">1. Establecer orientaciones curriculares para implementaci√≥n</option>
                        <option value="2">2. Establecer orientaciones para evaluaci√≥n de aprendizajes</option>
                        <option value="3">3. Promover recursos did√°cticos digitales de calidad</option>
                        <option value="4">4. Revisar y adaptar propuesta curricular para viabilidad</option>
                        <option value="5">5. Promover condiciones administrativas √≥ptimas</option>
                        <option value="6">6. Colaborar con Gesti√≥n Estrat√©gica Digital en monitoreo</option>
                        <option value="7">7. Coordinar con Equipo de Inclusi√≥n para divulgaci√≥n</option>
                        <option value="8">8. Coordinar formaci√≥n continua para docentes</option>
                        <option value="9">9. Coordinar distribuci√≥n de lecciones de inform√°tica</option>
                        <option value="10">10. Participar en iniciativas PATDE con equipo investigaci√≥n</option>
                        <option value="11">11. Colaborar en eventos masivos de buenas pr√°cticas</option>
                        <option value="12">12. Brindar orientaciones para equipos Programa 3</option>
                        <option value="13">13. Ejecutar otras tareas asignadas por jefatura</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">T√≠tulo de la Tarea</label>
                    <input type="text" id="task-title" class="form-control" required 
                           placeholder="Ej: Revisi√≥n de documento curricular para ciclo 2024">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Fecha</label>
                        <input type="date" id="task-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Prioridad</label>
                        <select id="task-priority" class="form-control" required>
                            <option value="normal">üü¢ Normal</option>
                            <option value="alta">üü° Alta</option>
                            <option value="urgente">üî¥ Urgente</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Estado</label>
                        <select id="task-status" class="form-control" required>
                            <option value="pendiente">‚è≥ Pendiente</option>
                            <option value="en-progreso">üîÑ En Progreso</option>
                            <option value="completada">‚úÖ Completada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tiempo Estimado (horas)</label>
                        <input type="number" id="task-time" class="form-control" min="0" step="0.5" placeholder="2.5">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Descripci√≥n Detallada</label>
                    <textarea id="task-description" class="form-control" rows="4" 
                              placeholder="Describe objetivos, alcance y consideraciones importantes..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Archivos Adjuntos</label>
                    <div class="file-upload-system" onclick="document.getElementById('task-files').click()">
                        <i class="fas fa-cloud-upload-alt fa-3x"></i>
                        <h3>Arrastra archivos aqu√≠ o haz clic para subir</h3>
                        <p class="text-muted">Formatos: PDF, DOCX, XLSX, JPG, PNG, CSV (M√°x. 25MB)</p>
                        <input type="file" id="task-files" multiple style="display: none">
                    </div>
                    <div id="file-preview" class="file-preview-container mt-3"></div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-save"></i> Guardar Tarea
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL DE EXPORTACI√ìN -->
    <div id="export-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-file-export"></i> Exportar Datos</h2>
                <button class="modal-close" onclick="closeModal('export-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="padding: 20px 0;">
                <button class="btn btn-primary btn-block mb-3" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> Exportar a Excel
                </button>
                <button class="btn btn-danger btn-block mb-3" onclick="exportToPDF()">
                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                </button>
                <button class="btn btn-success btn-block mb-3" onclick="exportToCSV()">
                    <i class="fas fa-file-csv"></i> Exportar a CSV
                </button>
                <button class="btn btn-warning btn-block" onclick="exportBackup()">
                    <i class="fas fa-database"></i> Backup Completo
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- HEADER CORPORATIVO ORIGINAL MEJORADO -->
        <header class="header">
            <div class="brand">
                <div class="logo">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="brand-info">
                    <h1>Agenda Digital DRTE - Sistema Profesional</h1>
                    <p>Sistema Integral de Gesti√≥n para el Departamento de Investigaci√≥n, Desarrollo e Implementaci√≥n</p>
                    <p style="font-size: 0.9rem; margin-top: 8px; color: rgba(255,255,255,0.8);">
                        <i class="fas fa-user-tie"></i> Asesor Nacional: Kevin S√°nchez Bogar√≠n | 
                        <i class="fas fa-building"></i> Direcci√≥n de Recursos Tecnol√≥gicos en Educaci√≥n
                    </p>
                </div>
            </div>
            <div class="header-controls">
                <div class="status-badge">
                    <i class="fas fa-check-circle"></i> Sistema 100% Operativo
                </div>
                <div class="datetime" id="current-datetime">
                    <i class="fas fa-clock"></i> Cargando fecha...
                </div>
                <div class="btn-export">
                    <button class="btn btn-secondary">
                        <i class="fas fa-file-export"></i> Exportar
                    </button>
                    <div class="export-dropdown">
                        <a onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Excel</a>
                        <a onclick="exportToPDF()"><i class="fas fa-file-pdf"></i> PDF</a>
                        <a onclick="exportToCSV()"><i class="fas fa-file-csv"></i> CSV</a>
                        <a onclick="exportBackup()"><i class="fas fa-database"></i> Backup</a>
                        <a onclick="printReport()"><i class="fas fa-print"></i> Imprimir</a>
                        <a onclick="sendToEmail()"><i class="fas fa-envelope"></i> Enviar por Email</a>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="openBackupManager()">
                    <i class="fas fa-shield-alt"></i> Backup
                </button>
            </div>
        </header>

        <!-- PANEL ENLACES EXTERNOS COMPLETO -->
        <div class="external-links-panel">
            <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
                <i class="fas fa-external-link-alt"></i> Enlaces Institucionales MEP
            </h3>
            <div class="links-grid">
                <a href="https://outlook.office.com/" class="external-link" target="_blank">
                    <i class="fas fa-envelope" style="color: #0078D4;"></i> Correo Institucional MEP
                </a>
                <a href="https://m365.cloud.microsoft/launch/onenote?auth=2" class="external-link" target="_blank">
                    <i class="fas fa-sticky-note" style="color: #80397b;"></i> OneNote Institucional
                </a>
                <a href="https://adminmepcr-my.sharepoint.com/:o:/r/personal/kevin_sanchez_bogarin_mep_go_cr/Documents/Notebooks/Informe%20Teletrabajo%20Kevin%20S%C3%A1nchez%20B_2025" 
                   class="external-link" target="_blank">
                    <i class="fas fa-book" style="color: #00a859;"></i> Bit√°cora Teletrabajo 2025
                </a>
                <a href="https://www.youtube.com/" class="external-link" target="_blank">
                    <i class="fab fa-youtube" style="color: #ff0000;"></i> YouTube (Investigaci√≥n)
                </a>
                <a href="https://www.symbaloo.com/home/mix/13eP7Bh97Y" class="external-link" target="_blank">
                    <i class="fas fa-th-large" style="color: #ff6600;"></i> Symbaloo Dashboard
                </a>
                <a href="https://pnft.mep.go.cr/asesoriapnft/app/home" class="external-link" target="_blank">
                    <i class="fas fa-chart-line" style="color: #0066cc;"></i> Sistema PNFT MEP
                </a>
                <a href="https://adminmepcr.sharepoint.com/sites/DRTE-Intranet/DOCUMENTOSASESORESDRTE/Forms/AllItems.aspx" 
                   class="external-link" target="_blank">
                    <i class="fas fa-folder" style="color: #ff5722;"></i> Documentos DRTE
                </a>
                <a href="https://adminmepcr.sharepoint.com/sites/DiseoMallaCurricular-Enmallados" 
                   class="external-link" target="_blank">
                    <i class="fas fa-graduation-cap" style="color: #9c27b0;"></i> Dise√±o Malla Curricular
                </a>
                <a href="https://adminmepcr.sharepoint.com/sites/repositorio-pnft" class="external-link" target="_blank">
                    <i class="fas fa-database" style="color: #4caf50;"></i> Repositorio PNFT
                </a>
                <a href="https://www.mep.go.cr/" class="external-link" target="_blank">
                    <i class="fas fa-school" style="color: #00b894;"></i> MEP Oficial
                </a>
                <a href="https://www.drte.mep.go.cr/" class="external-link" target="_blank">
                    <i class="fas fa-chalkboard-teacher" style="color: #0984e3;"></i> DRTE Portal
                </a>
            </div>
        </div>

        <!-- SISTEMA DE PESTA√ëAS PROFESIONAL -->
        <div class="tabs-system">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="dashboard">
                    <i class="fas fa-dashboard"></i> Dashboard
                </button>
                <button class="tab-btn" data-tab="bitacora">
                    <i class="fas fa-book"></i> Bit√°cora Diaria
                </button>
                <button class="tab-btn" data-tab="tareas">
                    <i class="fas fa-tasks"></i> Mis Tareas
                </button>
                <button class="tab-btn" data-tab="archivos">
                    <i class="fas fa-folder"></i> Archivos por Fecha
                </button>
                <button class="tab-btn" data-tab="calendario">
                    <i class="fas fa-calendar"></i> Calendario
                </button>
                <button class="tab-btn" data-tab="reportes">
                    <i class="fas fa-chart-bar"></i> Reportes
                </button>
            </div>

            <!-- DASHBOARD PRINCIPAL -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-chart-line"></i> Resumen del D√≠a</h2>
                            <span class="status-badge" id="today-badge">HOY</span>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon pending">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Tareas Pendientes</div>
                                    <div class="stat-value" id="today-pending">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon completed">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Completadas Hoy</div>
                                    <div class="stat-value" id="today-completed">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon meeting">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Reuniones</div>
                                    <div class="stat-value" id="today-meetings">0</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon files">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div class="stat-info">
                                    <div class="stat-label">Archivos</div>
                                    <div class="stat-value" id="total-files">0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-bolt"></i> Acciones R√°pidas</h2>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <button class="btn btn-primary" onclick="openTaskModal()">
                                <i class="fas fa-plus-circle"></i> Nueva Tarea
                            </button>
                            <button class="btn btn-secondary" onclick="quickMeeting()">
                                <i class="fas fa-users"></i> Agendar Reuni√≥n
                            </button>
                            <button class="btn btn-success" onclick="uploadFile()">
                                <i class="fas fa-cloud-upload-alt"></i> Subir Archivo
                            </button>
                            <button class="btn btn-secondary" onclick="showExportModal()">
                                <i class="fas fa-download"></i> Exportar Datos
                            </button>
                            <button class="btn btn-email" onclick="sendToEmail()">
                                <i class="fas fa-envelope"></i> Enviar Reporte
                            </button>
                            <button class="btn btn-print" onclick="printReport()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-calendar-alt"></i> Calendario</h2>
                        </div>
                        <div class="calendar">
                            <div class="calendar-nav">
                                <button class="btn btn-secondary" onclick="previousMonth()">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <h2 id="current-month">Enero 2024</h2>
                                <button class="btn btn-secondary" onclick="nextMonth()">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <div class="calendar-days" id="calendar-days">
                                <!-- D√≠as generados din√°micamente -->
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-chart-bar"></i> Estad√≠sticas</h2>
                        </div>
                        <div style="padding: 20px 0;">
                            <div style="margin-bottom: 25px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                    <span>Tasa de Completado</span>
                                    <span id="completion-rate">0%</span>
                                </div>
                                <div style="height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div id="completion-bar" style="height: 100%; background: var(--color-success); width: 0%; transition: width 0.8s ease;"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 25px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                    <span>Productividad Semanal</span>
                                    <span id="productivity-rate">0%</span>
                                </div>
                                <div style="height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                                    <div id="productivity-bar" style="height: 100%; background: var(--color-info); width: 0%; transition: width 0.8s ease;"></div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 2.5rem; font-weight: 800;" id="total-tasks">0</div>
                                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Total Tareas</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 2.5rem; font-weight: 800;" id="active-tasks">0</div>
                                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Tareas Activas</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BIT√ÅCORA DIARIA -->
            <div id="tab-bitacora" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-book-open"></i> Bit√°cora Diaria Profesional</h2>
                        <div>
                            <button class="btn btn-secondary" onclick="loadTodayJournal()">
                                <i class="fas fa-calendar-day"></i> Hoy
                            </button>
                            <button class="btn btn-primary" onclick="saveJournal()">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Fecha de la Bit√°cora</label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <input type="date" id="journal-date" class="form-control" style="width: 200px;">
                            <button class="btn btn-secondary" onclick="loadJournal()">
                                <i class="fas fa-search"></i> Cargar
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Plantillas R√°pidas</label>
                        <div class="journal-toolbar">
                            <button class="btn btn-sm btn-secondary" onclick="insertTemplate('reunion')">
                                <i class="fas fa-users"></i> Reuni√≥n
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="insertTemplate('capacitacion')">
                                <i class="fas fa-graduation-cap"></i> Capacitaci√≥n
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="insertTemplate('informe')">
                                <i class="fas fa-file-alt"></i> Informe
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="insertTemplate('coordinacion')">
                                <i class="fas fa-handshake"></i> Coordinaci√≥n
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="insertTemplate('teletrabajo')">
                                <i class="fas fa-home"></i> Teletrabajo
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="attachFileToJournal()">
                                <i class="fas fa-paperclip"></i> Adjuntar Archivo
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">T√≠tulo del D√≠a</label>
                        <input type="text" id="journal-title" class="form-control" 
                               placeholder="Ej: Revisi√≥n curricular y coordinaci√≥n con equipo PNFT">
                    </div>
                    
                    <div class="journal-editor" id="journal-content" contenteditable="true">
                        <h3>üìã Actividades del D√≠a</h3>
                        <p><strong>Hora:</strong> [Inserte hora de inicio]</p>
                        <p><strong>Actividad:</strong> [Describa la actividad principal]</p>
                        <p><strong>Objetivo:</strong> [Objetivo espec√≠fico de la actividad]</p>
                        <p><strong>Participantes:</strong> [Lista de participantes]</p>
                        <p><strong>Resultados:</strong> [Resultados obtenidos]</p>
                        <p><strong>Evidencias:</strong> [Archivos adjuntos o referencias]</p>
                        <p><strong>Tiempo dedicado:</strong> [Horas] horas</p>
                        <hr>
                        <h3>üéØ Objetivos Cumplidos</h3>
                        <ul>
                            <li>[Objetivo 1]</li>
                            <li>[Objetivo 2]</li>
                        </ul>
                        <h3>üöÄ Pr√≥ximas Acciones</h3>
                        <ul>
                            <li>[Acci√≥n pendiente 1]</li>
                            <li>[Acci√≥n pendiente 2]</li>
                        </ul>
                    </div>
                    
                    <div class="form-group mt-3">
                        <label class="form-label">Resumen Ejecutivo</label>
                        <textarea id="journal-summary" class="form-control" rows="4" 
                                  placeholder="Resumen de los logros m√°s importantes del d√≠a..."></textarea>
                    </div>
                    
                    <div id="journal-attachments" class="file-preview-container mt-3">
                        <!-- Archivos adjuntos aparecer√°n aqu√≠ -->
                    </div>
                </div>
            </div>

            <!-- GESTI√ìN DE TAREAS -->
            <div id="tab-tareas" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-briefcase"></i> Gesti√≥n de Tareas - 13 Funciones del Equipo</h2>
                        <div>
                            <input type="text" id="task-search" class="form-control" 
                                   style="width: 250px; margin-right: 15px;" 
                                   placeholder="üîç Buscar tareas...">
                            <button class="btn btn-primary" onclick="openTaskModal()">
                                <i class="fas fa-plus"></i> Nueva Tarea
                            </button>
                        </div>
                    </div>
                    
                    <div class="task-filters">
                        <button class="filter-btn active" onclick="setFilter('all')">Todas</button>
                        <button class="filter-btn" onclick="setFilter('pendiente')">Pendientes</button>
                        <button class="filter-btn" onclick="setFilter('en-progreso')">En Progreso</button>
                        <button class="filter-btn" onclick="setFilter('completada')">Completadas</button>
                        <button class="filter-btn" onclick="setFilter('urgente')">Urgentes</button>
                        <button class="filter-btn" onclick="setFilter('hoy')">Hoy</button>
                        <button class="filter-btn" onclick="setFilter('semana')">Esta Semana</button>
                    </div>
                    
                    <div class="tasks-container">
                        <div id="task-list" class="task-list">
                            <!-- Tareas cargadas din√°micamente -->
                        </div>
                        <div id="empty-tasks" class="empty-state" style="display: none;">
                            <div class="empty-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <h3>No hay tareas registradas</h3>
                            <p>Comienza agregando tus primeras tareas profesionales</p>
                            <button class="btn btn-primary mt-3" onclick="openTaskModal()">
                                <i class="fas fa-plus"></i> Crear Primera Tarea
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ARCHIVOS POR FECHA -->
            <div id="tab-archivos" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-calendar-alt"></i> Sistema de Archivos Organizados por Fecha</h2>
                        <div>
                            <button class="btn btn-success" onclick="openFileUpload()">
                                <i class="fas fa-cloud-upload-alt"></i> Subir Archivos
                            </button>
                            <button class="btn btn-email" onclick="sendToEmail()">
                                <i class="fas fa-envelope"></i> Enviar por Email
                            </button>
                            <button class="btn btn-print" onclick="printReport()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-date-navigation" style="margin-bottom: 25px;">
                        <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="prevDay()">
                                <i class="fas fa-chevron-left"></i> Anterior
                            </button>
                            <input type="date" id="file-date-selector" class="form-control" style="width: 200px;">
                            <button class="btn btn-secondary" onclick="nextDay()">
                                Siguiente <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn btn-primary" onclick="loadFilesForDate()">
                                <i class="fas fa-search"></i> Cargar Archivos
                            </button>
                            <button class="btn btn-success" onclick="goToToday()">
                                <i class="fas fa-calendar-day"></i> Hoy
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-upload-system" id="file-drop-area" 
                         onclick="document.getElementById('file-input').click()"
                         ondragover="handleDragOver(event)"
                         ondragleave="handleDragLeave(event)"
                         ondrop="handleFileDrop(event)">
                        <i class="fas fa-cloud-upload-alt fa-4x"></i>
                        <h3>Arrastra y suelta archivos aqu√≠</h3>
                        <p>o haz clic para seleccionar</p>
                        <p class="text-muted">Formatos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, CSV, TXT (M√°x. 50MB)</p>
                        <input type="file" id="file-input" multiple style="display: none;" 
                               accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.csv,.txt">
                    </div>
                    
                    <div id="file-previews" class="file-preview-container">
                        <!-- Archivos aparecen aqu√≠ din√°micamente -->
                    </div>
                    
                    <div class="stats-grid" style="margin-top: 30px;">
                        <div class="stat-item">
                            <div class="stat-icon files">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Espacio Usado</div>
                                <div class="stat-value" id="storage-used">0 MB</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon completed">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Documentos PDF</div>
                                <div class="stat-value" id="pdf-count">0</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon meeting">
                                <i class="fas fa-file-image"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Im√°genes</div>
                                <div class="stat-value" id="image-count">0</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon pending">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="stat-info">
                                <div class="stat-label">Otros Archivos</div>
                                <div class="stat-value" id="other-files-count">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CALENDARIO -->
            <div id="tab-calendario" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-calendar"></i> Calendario Profesional</h2>
                        <div>
                            <button class="btn btn-secondary" onclick="previousMonth()">
                                <i class="fas fa-chevron-left"></i> Mes Anterior
                            </button>
                            <button class="btn btn-secondary" onclick="nextMonth()">
                                Mes Siguiente <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="calendar">
                        <div class="calendar-nav">
                            <h2 id="current-month-display">Enero 2024</h2>
                        </div>
                        <div class="calendar-days" id="calendar-grid">
                            <!-- Calendario generado din√°micamente -->
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 20px; color: white;">
                            <i class="fas fa-calendar-check"></i> Eventos del Mes
                        </h3>
                        <div id="month-events">
                            <!-- Eventos del mes -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- REPORTES -->
            <div id="tab-reportes" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-file-contract"></i> Sistema de Reportes Profesionales</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tipo de Reporte</label>
                        <select id="report-type" class="form-control" onchange="loadReportTemplate()">
                            <option value="">Seleccionar tipo de reporte</option>
                            <option value="diario">üìã Informe Diario de Actividades</option>
                            <option value="semanal">üìÖ Informe Semanal de Avances</option>
                            <option value="mensual">üìä Reporte Mensual de Productividad</option>
                            <option value="funciones">üë• Reporte de Funciones del Equipo</option>
                            <option value="archivos">üìÅ Reporte de Archivos por Mes</option>
                            <option value="teletrabajo">üè† Reporte de Teletrabajo</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fecha Inicio</label>
                            <input type="date" id="report-start" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fecha Fin</label>
                            <input type="date" id="report-end" class="form-control">
                        </div>
                    </div>
                    
                    <div id="report-preview" style="
                        background: rgba(255,255,255,0.03);
                        border: 1px solid rgba(255,255,255,0.1);
                        border-radius: var(--border-radius);
                        padding: 30px;
                        min-height: 400px;
                        margin-bottom: 25px;
                        color: white;
                        line-height: 1.8;
                    ">
                        <!-- Vista previa del reporte -->
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="btn btn-primary" onclick="generatePDFReport()">
                            <i class="fas fa-file-pdf"></i> Generar PDF
                        </button>
                        <button class="btn btn-success" onclick="generateExcelReport()">
                            <i class="fas fa-file-excel"></i> Generar Excel
                        </button>
                        <button class="btn btn-warning" onclick="generateWordReport()">
                            <i class="fas fa-file-word"></i> Generar Word
                        </button>
                        <button class="btn btn-email" onclick="sendReportEmail()">
                            <i class="fas fa-paper-plane"></i> Enviar por Email
                        </button>
                        <button class="btn btn-print" onclick="printReport()">
                            <i class="fas fa-print"></i> Imprimir Reporte
                        </button>
                        <button class="btn btn-secondary" onclick="saveReportTemplate()">
                            <i class="fas fa-save"></i> Guardar Plantilla
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT COMPLETO Y FUNCIONAL -->
    <script>
        // ============================================
        // SISTEMA AGENDA DRTE - VERSI√ìN PROFESIONAL COMPLETA
        // ============================================
        
        class AgendaDRTEProfessional {
            constructor() {
                this.version = '6.0.0';
                this.currentDate = new Date();
                this.currentMonth = this.currentDate.getMonth();
                this.currentYear = this.currentDate.getFullYear();
                this.editingTaskId = null;
                this.currentFilter = 'all';
                this.fileSystem = new FileSystemManager();
                this.init();
            }
            
            async init() {
                console.log('üöÄ Iniciando Sistema Agenda DRTE Professional');
                
                // Inicializar base de datos
                await this.fileSystem.init();
                
                // Configurar fecha y hora
                this.updateDateTime();
                setInterval(() => this.updateDateTime(), 1000);
                
                // Configurar fecha inicial
                this.setupInitialDates();
                
                // Cargar datos iniciales
                await this.loadInitialData();
                
                // Configurar eventos
                this.setupEventListeners();
                
                // Inicializar calendario
                this.renderCalendar();
                
                this.showNotification('Sistema listo', 'Agenda DRTE cargada exitosamente', 'success');
                console.log('‚úÖ Sistema completamente inicializado');
            }
            
            setupInitialDates() {
                const today = this.formatDateForInput(new Date());
                
                // Configurar todas las fechas con hoy
                ['journal-date', 'task-date', 'file-date-selector', 
                 'report-start', 'report-end'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) element.value = today;
                });
            }
            
            async loadInitialData() {
                try {
                    // Cargar estad√≠sticas
                    await this.updateDashboardStats();
                    
                    // Cargar tareas
                    await this.loadTasks();
                    
                    // Cargar archivos del d√≠a
                    await this.loadFilesForDate();
                    
                    // Cargar bit√°cora del d√≠a
                    await this.loadJournal();
                    
                } catch (error) {
                    console.error('Error cargando datos iniciales:', error);
                    this.showNotification('Error', 'Error al cargar datos iniciales', 'error');
                }
            }
            
            setupEventListeners() {
                // Sistema de tabs
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tabId = btn.dataset.tab;
                        this.switchTab(tabId);
                    });
                });
                
                // Subida de archivos
                const fileInput = document.getElementById('file-input');
                fileInput.addEventListener('change', async (e) => {
                    const files = Array.from(e.target.files);
                    if (files.length > 0) {
                        await this.uploadFiles(files);
                        fileInput.value = '';
                    }
                });
                
                // Drag and drop
                const dropArea = document.getElementById('file-drop-area');
                dropArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropArea.classList.add('dragover');
                });
                
                dropArea.addEventListener('dragleave', () => {
                    dropArea.classList.remove('dragover');
                });
                
                dropArea.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    dropArea.classList.remove('dragover');
                    const files = Array.from(e.dataTransfer.files);
                    if (files.length > 0) {
                        await this.uploadFiles(files);
                    }
                });
                
                // B√∫squeda de tareas
                const taskSearch = document.getElementById('task-search');
                if (taskSearch) {
                    taskSearch.addEventListener('input', () => {
                        this.searchTasks();
                    });
                }
                
                // Configurar fecha en bit√°cora
                const journalDate = document.getElementById('journal-date');
                if (journalDate) {
                    journalDate.addEventListener('change', () => {
                        this.loadJournal();
                    });
                }
                
                // Configurar fecha en archivos
                const fileDate = document.getElementById('file-date-selector');
                if (fileDate) {
                    fileDate.addEventListener('change', () => {
                        this.loadFilesForDate();
                    });
                }
            }
            
            // ============================================
            // SISTEMA DE BIT√ÅCORA COMPLETO
            // ============================================
            
            async saveJournal() {
                try {
                    const date = document.getElementById('journal-date').value;
                    const title = document.getElementById('journal-title').value;
                    const content = document.getElementById('journal-content').innerHTML;
                    const summary = document.getElementById('journal-summary').value;
                    
                    if (!date) {
                        throw new Error('Seleccione una fecha para la bit√°cora');
                    }
                    
                    const journalEntry = {
                        id: `journal_${date.replace(/-/g, '')}`,
                        date: date,
                        title: title || 'Bit√°cora del d√≠a',
                        content: content,
                        summary: summary,
                        attachments: [],
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Guardar en IndexedDB
                    await this.fileSystem.saveJournalEntry(journalEntry);
                    
                    // Actualizar interfaz
                    this.showNotification('Bit√°cora guardada', 'La entrada ha sido guardada exitosamente', 'success');
                    
                    // Generar backup autom√°tico
                    this.backupJournalEntry(journalEntry);
                    
                } catch (error) {
                    console.error('Error guardando bit√°cora:', error);
                    this.showNotification('Error', error.message, 'error');
                }
            }
            
            async loadJournal() {
                try {
                    const date = document.getElementById('journal-date').value;
                    const entry = await this.fileSystem.getJournalEntry(date);
                    
                    if (entry) {
                        document.getElementById('journal-title').value = entry.title || '';
                        document.getElementById('journal-content').innerHTML = entry.content || '';
                        document.getElementById('journal-summary').value = entry.summary || '';
                        
                        this.showNotification('Bit√°cora cargada', 'Entrada recuperada exitosamente', 'success');
                    } else {
                        // Mostrar plantilla vac√≠a
                        document.getElementById('journal-content').innerHTML = this.getJournalTemplate();
                    }
                    
                } catch (error) {
                    console.error('Error cargando bit√°cora:', error);
                    this.showNotification('Error', 'No se pudo cargar la bit√°cora', 'error');
                }
            }
            
            loadTodayJournal() {
                const today = this.formatDateForInput(new Date());
                document.getElementById('journal-date').value = today;
                this.loadJournal();
            }
            
            getJournalTemplate() {
                return `
                    <h3>üìã Actividades del D√≠a</h3>
                    <p><strong>Hora:</strong> [Inserte hora de inicio]</p>
                    <p><strong>Actividad:</strong> [Describa la actividad principal]</p>
                    <p><strong>Objetivo:</strong> [Objetivo espec√≠fico]</p>
                    <p><strong>Participantes:</strong> [Lista de participantes]</p>
                    <p><strong>Resultados:</strong> [Resultados obtenidos]</p>
                    <p><strong>Evidencias:</strong> [Archivos adjuntos]</p>
                    <p><strong>Tiempo dedicado:</strong> [Horas] horas</p>
                    <hr>
                    <h3>üéØ Objetivos Cumplidos</h3>
                    <ul>
                        <li>[Objetivo 1]</li>
                        <li>[Objetivo 2]</li>
                    </ul>
                    <h3>üöÄ Pr√≥ximas Acciones</h3>
                    <ul>
                        <li>[Acci√≥n pendiente 1]</li>
                        <li>[Acci√≥n pendiente 2]</li>
                    </ul>
                `;
            }
            
            insertTemplate(templateType) {
                const editor = document.getElementById('journal-content');
                let template = '';
                
                switch(templateType) {
                    case 'reunion':
                        template = `
                            <div style="margin: 20px 0; padding: 20px; background: rgba(9,132,227,0.1); border-radius: 10px;">
                                <h4>üë• Reuni√≥n/Coordinaci√≥n</h4>
                                <p><strong>Hora:</strong> </p>
                                <p><strong>Participantes:</strong> </p>
                                <p><strong>Tema:</strong> </p>
                                <p><strong>Acuerdos:</strong></p>
                                <ul>
                                    <li>Acuerdo 1</li>
                                    <li>Acuerdo 2</li>
                                </ul>
                                <p><strong>Acciones pendientes:</strong></p>
                                <ul>
                                    <li>Acci√≥n 1</li>
                                </ul>
                                <p><strong>Pr√≥xima reuni√≥n:</strong> </p>
                            </div>
                        `;
                        break;
                        
                    case 'capacitacion':
                        template = `
                            <div style="margin: 20px 0; padding: 20px; background: rgba(0,184,148,0.1); border-radius: 10px;">
                                <h4>üéì Capacitaci√≥n/Taller</h4>
                                <p><strong>Hora:</strong> </p>
                                <p><strong>Tema:</strong> </p>
                                <p><strong>Participantes:</strong> </p>
                                <p><strong>Contenido:</strong></p>
                                <ul>
                                    <li>Punto 1</li>
                                    <li>Punto 2</li>
                                </ul>
                                <p><strong>Evaluaci√≥n:</strong> </p>
                                <p><strong>Materiales:</strong> </p>
                            </div>
                        `;
                        break;
                }
                
                editor.innerHTML += template;
            }
            
            // ============================================
            // SISTEMA DE TAREAS COMPLETO
            // ============================================
            
            async saveTask(event) {
                if (event) event.preventDefault();
                
                try {
                    const task = {
                        id: this.editingTaskId || Date.now().toString(),
                        function: document.getElementById('task-function').value,
                        title: document.getElementById('task-title').value.trim(),
                        description: document.getElementById('task-description').value.trim(),
                        date: document.getElementById('task-date').value,
                        priority: document.getElementById('task-priority').value,
                        status: document.getElementById('task-status').value,
                        time: document.getElementById('task-time').value || 0,
                        createdAt: this.editingTaskId ? 
                            (await this.fileSystem.getTask(this.editingTaskId))?.createdAt || 
                            new Date().toISOString() : 
                            new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Validar datos
                    if (!task.function || !task.title || !task.date) {
                        throw new Error('Complete los campos requeridos');
                    }
                    
                    // Guardar en IndexedDB
                    await this.fileSystem.saveTask(task);
                    
                    // Cerrar modal y actualizar
                    this.closeModal('task-modal');
                    await this.loadTasks();
                    await this.updateDashboardStats();
                    
                    // Mostrar notificaci√≥n
                    this.showNotification(
                        'Tarea guardada',
                        `"${task.title}" ha sido ${this.editingTaskId ? 'actualizada' : 'creada'}`,
                        'success'
                    );
                    
                    // Limpiar formulario
                    this.editingTaskId = null;
                    document.getElementById('task-form').reset();
                    document.getElementById('task-date').value = this.formatDateForInput(new Date());
                    
                } catch (error) {
                    console.error('Error guardando tarea:', error);
                    this.showNotification('Error', error.message, 'error');
                }
            }
            
            async loadTasks() {
                try {
                    const tasks = await this.fileSystem.getAllTasks();
                    this.displayTasks(tasks);
                    
                } catch (error) {
                    console.error('Error cargando tareas:', error);
                }
            }
            
            displayTasks(tasks) {
                const container = document.getElementById('task-list');
                const emptyState = document.getElementById('empty-tasks');
                const searchTerm = document.getElementById('task-search')?.value.toLowerCase() || '';
                
                // Aplicar filtros
                let filteredTasks = tasks;
                
                // B√∫squeda
                if (searchTerm) {
                    filteredTasks = filteredTasks.filter(task =>
                        task.title.toLowerCase().includes(searchTerm) ||
                        task.description.toLowerCase().includes(searchTerm) ||
                        task.function.includes(searchTerm)
                    );
                }
                
                // Filtro por estado
                if (this.currentFilter !== 'all') {
                    if (this.currentFilter === 'hoy') {
                        const today = this.formatDateForInput(new Date());
                        filteredTasks = filteredTasks.filter(task => task.date === today);
                    } else if (this.currentFilter === 'semana') {
                        const weekStart = this.getWeekStartDate();
                        const weekEnd = this.getWeekEndDate();
                        filteredTasks = filteredTasks.filter(task => {
                            const taskDate = new Date(task.date);
                            return taskDate >= weekStart && taskDate <= weekEnd;
                        });
                    } else {
                        filteredTasks = filteredTasks.filter(task => 
                            task.status === this.currentFilter || 
                            task.priority === this.currentFilter
                        );
                    }
                }
                
                // Ordenar por fecha y prioridad
                filteredTasks.sort((a, b) => {
                    const dateCompare = new Date(a.date) - new Date(b.date);
                    if (dateCompare !== 0) return dateCompare;
                    
                    const priorityOrder = { urgente: 0, alta: 1, normal: 2 };
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                });
                
                // Mostrar/ocultar estado vac√≠o
                if (filteredTasks.length === 0) {
                    container.style.display = 'none';
                    emptyState.style.display = 'block';
                } else {
                    container.style.display = 'flex';
                    emptyState.style.display = 'none';
                    
                    // Renderizar tareas
                    container.innerHTML = filteredTasks.map(task => `
                        <div class="task-item ${task.status} ${task.priority === 'urgente' ? 'urgent' : ''}" 
                             data-task-id="${task.id}">
                            <div class="task-header">
                                <div class="task-title">
                                    <span style="
                                        background: #2196f3;
                                        color: white;
                                        width: 28px;
                                        height: 28px;
                                        border-radius: 50%;
                                        display: inline-flex;
                                        align-items: center;
                                        justify-content: center;
                                        margin-right: 12px;
                                        font-size: 0.9rem;
                                    ">${task.function}</span>
                                    ${task.title}
                                </div>
                                <div class="task-actions">
                                    <button class="task-action-btn" onclick="agenda.toggleTaskStatus('${task.id}')" 
                                            title="${task.status === 'completada' ? 'Marcar como pendiente' : 'Marcar como completada'}">
                                        <i class="fas fa-${task.status === 'completada' ? 'undo' : 'check'}"></i>
                                    </button>
                                    <button class="task-action-btn" onclick="agenda.editTask('${task.id}')" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="task-action-btn" onclick="agenda.deleteTask('${task.id}')" title="Eliminar">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            ${task.description ? `
                                <p style="margin: 15px 0; color: rgba(255,255,255,0.8); padding-left: 40px;">
                                    ${task.description}
                                </p>
                            ` : ''}
                            <div class="task-meta">
                                <span class="task-meta-item">
                                    <i class="fas fa-calendar"></i> ${this.formatDateDisplay(new Date(task.date))}
                                </span>
                                <span class="task-meta-item">
                                    <i class="fas fa-flag"></i> ${this.getPriorityLabel(task.priority)}
                                </span>
                                <span class="task-meta-item">
                                    <i class="fas fa-circle"></i> ${this.getStatusLabel(task.status)}
                                </span>
                                ${task.time ? `
                                    <span class="task-meta-item">
                                        <i class="fas fa-clock"></i> ${task.time} horas
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    `).join('');
                }
            }
            
            async toggleTaskStatus(taskId) {
                try {
                    const task = await this.fileSystem.getTask(taskId);
                    if (!task) return;
                    
                    task.status = task.status === 'completada' ? 'pendiente' : 'completada';
                    task.updatedAt = new Date().toISOString();
                    
                    await this.fileSystem.saveTask(task);
                    await this.loadTasks();
                    await this.updateDashboardStats();
                    
                    const statusText = task.status === 'completada' ? 'completada' : 'pendiente';
                    this.showNotification('Estado actualizado', `Tarea marcada como ${statusText}`, 'success');
                    
                } catch (error) {
                    console.error('Error actualizando tarea:', error);
                    this.showNotification('Error', 'No se pudo actualizar la tarea', 'error');
                }
            }
            
            async editTask(taskId) {
                try {
                    const task = await this.fileSystem.getTask(taskId);
                    if (!task) return;
                    
                    this.editingTaskId = taskId;
                    
                    // Llenar formulario
                    document.getElementById('task-function').value = task.function;
                    document.getElementById('task-title').value = task.title;
                    document.getElementById('task-description').value = task.description || '';
                    document.getElementById('task-date').value = task.date;
                    document.getElementById('task-priority').value = task.priority;
                    document.getElementById('task-status').value = task.status;
                    document.getElementById('task-time').value = task.time || '';
                    
                    // Abrir modal
                    this.openModal('task-modal');
                    
                } catch (error) {
                    console.error('Error editando tarea:', error);
                }
            }
            
            async deleteTask(taskId) {
                if (!confirm('¬øEst√° seguro de eliminar esta tarea?')) return;
                
                try {
                    await this.fileSystem.deleteTask(taskId);
                    
                    await this.loadTasks();
                    await this.updateDashboardStats();
                    
                    this.showNotification('Tarea eliminada', 'La tarea ha sido eliminada', 'success');
                    
                } catch (error) {
                    console.error('Error eliminando tarea:', error);
                    this.showNotification('Error', 'No se pudo eliminar la tarea', 'error');
                }
            }
            
            searchTasks() {
                this.loadTasks();
            }
            
            setFilter(filter) {
                this.currentFilter = filter;
                
                // Actualizar botones de filtro
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                this.loadTasks();
            }
            
            // ============================================
            // SISTEMA DE ARCHIVOS POR FECHA COMPLETO
            // ============================================
            
            async uploadFiles(files) {
                try {
                    const date = document.getElementById('file-date-selector').value || 
                                 this.formatDateForInput(new Date());
                    
                    for (const file of files) {
                        if (file.size > 50 * 1024 * 1024) {
                            throw new Error(`El archivo ${file.name} excede 50MB`);
                        }
                        
                        // Crear estructura de fecha
                        const dateParts = date.split('-');
                        
                        const fileData = {
                            year: dateParts[0],
                            month: dateParts[1],
                            day: dateParts[2],
                            date: date,
                            category: 'general'
                        };
                        
                        // Guardar archivo
                        await this.fileSystem.saveFile(file, fileData);
                    }
                    
                    // Actualizar interfaz
                    await this.loadFilesForDate();
                    await this.updateFileStats();
                    
                    this.showNotification(
                        'Archivos subidos',
                        `${files.length} archivo(s) guardados exitosamente`,
                        'success'
                    );
                    
                } catch (error) {
                    console.error('Error subiendo archivos:', error);
                    this.showNotification('Error', error.message, 'error');
                }
            }
            
            async loadFilesForDate() {
                try {
                    const date = document.getElementById('file-date-selector').value;
                    const files = await this.fileSystem.getFilesByDate(date);
                    
                    this.displayFiles(files);
                    
                } catch (error) {
                    console.error('Error cargando archivos:', error);
                }
            }
            
            displayFiles(files) {
                const container = document.getElementById('file-previews');
                
                if (files.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-folder-open fa-3x"></i>
                            <h3>No hay archivos para esta fecha</h3>
                            <p>Sube archivos usando el √°rea de arriba</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = files.map(file => `
                    <div class="file-preview" data-file-id="${file.id}">
                        ${file.type.startsWith('image/') ? `
                            <img src="${URL.createObjectURL(new Blob([file.data], {type: file.type}))}" 
                                 alt="${file.name}"
                                 onclick="agenda.previewFile('${file.id}')">
                        ` : `
                            <div style="text-align: center;">
                                <i class="${this.getFileIcon(file.type)} fa-3x" 
                                   style="color: ${this.getFileColor(file.type)}; margin-bottom: 15px;"></i>
                                <div>
                                    <strong>${file.name}</strong>
                                    <p style="font-size: 0.85rem; color: rgba(255,255,255,0.7); margin-top: 5px;">
                                        ${this.formatFileSize(file.size)}
                                    </p>
                                </div>
                            </div>
                        `}
                        <div class="file-actions">
                            <button class="btn btn-sm btn-primary" onclick="agenda.downloadFile('${file.id}')">
                                <i class="fas fa-download"></i> Descargar
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="agenda.previewFile('${file.id}')">
                                <i class="fas fa-eye"></i> Vista previa
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="agenda.deleteFile('${file.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            async previewFile(fileId) {
                try {
                    const file = await this.fileSystem.getFile(fileId);
                    if (!file) return;
                    
                    const modal = document.getElementById('file-viewer-modal');
                    const body = document.getElementById('file-viewer-body');
                    const title = document.getElementById('viewer-title');
                    
                    title.textContent = `Vista previa: ${file.name}`;
                    
                    if (file.type.startsWith('image/')) {
                        const blob = new Blob([file.data], { type: file.type });
                        const url = URL.createObjectURL(blob);
                        body.innerHTML = `<img src="${url}" style="max-width: 100%; max-height: 70vh;">`;
                    } else if (file.type === 'application/pdf') {
                        const blob = new Blob([file.data], { type: file.type });
                        const url = URL.createObjectURL(blob);
                        body.innerHTML = `<iframe src="${url}" style="width: 100%; height: 70vh;"></iframe>`;
                    } else {
                        body.innerHTML = `
                            <div style="text-align: center; padding: 40px;">
                                <i class="${this.getFileIcon(file.type)} fa-5x" 
                                   style="color: ${this.getFileColor(file.type)};"></i>
                                <h3>${file.name}</h3>
                                <p>${this.formatFileSize(file.size)}</p>
                                <button class="btn btn-primary" onclick="agenda.downloadFile('${file.id}')">
                                    <i class="fas fa-download"></i> Descargar Archivo
                                </button>
                            </div>
                        `;
                    }
                    
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    
                } catch (error) {
                    console.error('Error previsualizando archivo:', error);
                    this.showNotification('Error', 'No se pudo previsualizar el archivo', 'error');
                }
            }
            
            async downloadFile(fileId) {
                try {
                    const file = await this.fileSystem.getFile(fileId);
                    if (!file) return;
                    
                    const blob = new Blob([file.data], { type: file.type });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = file.name;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('Descarga iniciada', `Descargando ${file.name}`, 'success');
                    
                } catch (error) {
                    console.error('Error descargando archivo:', error);
                    this.showNotification('Error', 'No se pudo descargar el archivo', 'error');
                }
            }
            
            async deleteFile(fileId) {
                if (!confirm('¬øEst√° seguro de eliminar este archivo?')) return;
                
                try {
                    await this.fileSystem.deleteFile(fileId);
                    
                    // Eliminar de la vista
                    const element = document.querySelector(`[data-file-id="${fileId}"]`);
                    if (element) element.remove();
                    
                    await this.updateFileStats();
                    
                    this.showNotification('Archivo eliminado', 'El archivo ha sido eliminado', 'success');
                    
                } catch (error) {
                    console.error('Error eliminando archivo:', error);
                    this.showNotification('Error', 'No se pudo eliminar el archivo', 'error');
                }
            }
            
            async updateFileStats() {
                try {
                    const files = await this.fileSystem.getAllFiles();
                    const totalSize = files.reduce((sum, file) => sum + file.size, 0);
                    const pdfCount = files.filter(f => f.type === 'application/pdf').length;
                    const imageCount = files.filter(f => f.type.startsWith('image/')).length;
                    const otherCount = files.length - pdfCount - imageCount;
                    
                    // Actualizar UI
                    document.getElementById('total-files').textContent = files.length;
                    document.getElementById('storage-used').textContent = this.formatFileSize(totalSize);
                    document.getElementById('pdf-count').textContent = pdfCount;
                    document.getElementById('image-count').textContent = imageCount;
                    document.getElementById('other-files-count').textContent = otherCount;
                    
                } catch (error) {
                    console.error('Error actualizando estad√≠sticas:', error);
                }
            }
            
            // ============================================
            // CALENDARIO FUNCIONAL
            // ============================================
            
            renderCalendar() {
                const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
                
                // Actualizar t√≠tulo
                document.getElementById('current-month').textContent = 
                    document.getElementById('current-month-display').textContent = 
                    `${monthNames[this.currentMonth]} ${this.currentYear}`;
                
                const firstDay = new Date(this.currentYear, this.currentMonth, 1);
                const lastDay = new Date(this.currentYear, this.currentMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                const container = document.getElementById('calendar-days') || 
                                 document.getElementById('calendar-grid');
                if (!container) return;
                
                container.innerHTML = '';
                
                // D√≠as de la semana
                ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'].forEach(day => {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-weekday';
                    dayEl.textContent = day;
                    container.appendChild(dayEl);
                });
                
                // D√≠as vac√≠os al inicio
                for (let i = 0; i < startingDay; i++) {
                    const empty = document.createElement('div');
                    empty.className = 'calendar-day';
                    container.appendChild(empty);
                }
                
                // D√≠as del mes
                const today = new Date();
                const todayStr = this.formatDateForInput(today);
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${this.currentYear}-${String(this.currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const isToday = dateStr === todayStr;
                    
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day' + (isToday ? ' today' : '');
                    dayEl.textContent = day;
                    dayEl.dataset.date = dateStr;
                    
                    // Verificar si hay archivos o tareas en esta fecha
                    this.checkDateEvents(dateStr).then(hasEvents => {
                        if (hasEvents) {
                            dayEl.classList.add('has-event');
                        }
                    });
                    
                    dayEl.addEventListener('click', () => {
                        this.selectCalendarDate(dateStr);
                    });
                    
                    container.appendChild(dayEl);
                }
            }
            
            async checkDateEvents(dateStr) {
                try {
                    const [files, tasks] = await Promise.all([
                        this.fileSystem.getFilesByDate(dateStr),
                        this.fileSystem.getTasksByDate(dateStr)
                    ]);
                    
                    return files.length > 0 || tasks.length > 0;
                    
                } catch (error) {
                    return false;
                }
            }
            
            selectCalendarDate(dateStr) {
                // Actualizar todas las fechas
                document.getElementById('file-date-selector').value = dateStr;
                document.getElementById('journal-date').value = dateStr;
                document.getElementById('task-date').value = dateStr;
                
                // Cambiar a pesta√±a de archivos
                this.switchTab('archivos');
                this.loadFilesForDate();
            }
            
            previousMonth() {
                this.currentMonth--;
                if (this.currentMonth < 0) {
                    this.currentMonth = 11;
                    this.currentYear--;
                }
                this.renderCalendar();
            }
            
            nextMonth() {
                this.currentMonth++;
                if (this.currentMonth > 11) {
                    this.currentMonth = 0;
                    this.currentYear++;
                }
                this.renderCalendar();
            }
            
            prevDay() {
                const dateInput = document.getElementById('file-date-selector');
                const currentDate = new Date(dateInput.value);
                currentDate.setDate(currentDate.getDate() - 1);
                dateInput.value = this.formatDateForInput(currentDate);
                this.loadFilesForDate();
            }
            
            nextDay() {
                const dateInput = document.getElementById('file-date-selector');
                const currentDate = new Date(dateInput.value);
                currentDate.setDate(currentDate.getDate() + 1);
                dateInput.value = this.formatDateForInput(currentDate);
                this.loadFilesForDate();
            }
            
            goToToday() {
                const today = this.formatDateForInput(new Date());
                document.getElementById('file-date-selector').value = today;
                this.loadFilesForDate();
            }
            
            // ============================================
            // DASHBOARD Y ESTAD√çSTICAS
            // ============================================
            
            async updateDashboardStats() {
                try {
                    const [tasks, files, journals] = await Promise.all([
                        this.fileSystem.getAllTasks(),
                        this.fileSystem.getAllFiles(),
                        this.fileSystem.getAllJournals()
                    ]);
                    
                    const today = this.formatDateForInput(new Date());
                    
                    // Tareas de hoy
                    const todayTasks = tasks.filter(t => t.date === today);
                    const todayPending = todayTasks.filter(t => t.status !== 'completada').length;
                    const todayCompleted = todayTasks.filter(t => t.status === 'completada').length;
                    const todayMeetings = tasks.filter(t => t.date === today && 
                        t.title.toLowerCase().includes('reuni√≥n')).length;
                    
                    // Estad√≠sticas generales
                    const totalTasks = tasks.length;
                    const completedTasks = tasks.filter(t => t.status === 'completada').length;
                    const activeTasks = totalTasks - completedTasks;
                    const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                    
                    // Actualizar UI
                    document.getElementById('today-pending').textContent = todayPending;
                    document.getElementById('today-completed').textContent = todayCompleted;
                    document.getElementById('today-meetings').textContent = todayMeetings;
                    document.getElementById('total-files').textContent = files.length;
                    document.getElementById('total-tasks').textContent = totalTasks;
                    document.getElementById('active-tasks').textContent = activeTasks;
                    document.getElementById('completion-rate').textContent = `${completionRate}%`;
                    document.getElementById('productivity-rate').textContent = `${completionRate}%`;
                    
                    // Actualizar barras
                    document.getElementById('completion-bar').style.width = `${completionRate}%`;
                    document.getElementById('productivity-bar').style.width = `${completionRate}%`;
                    
                    // Badge del d√≠a
                    document.getElementById('today-badge').textContent = `HOY (${todayTasks.length})`;
                    
                } catch (error) {
                    console.error('Error actualizando estad√≠sticas:', error);
                }
            }
            
            // ============================================
            // EXPORTACI√ìN Y REPORTES
            // ============================================
            
            exportToExcel() {
                try {
                    this.showNotification('Exportando', 'Generando archivo Excel...', 'info');
                    // Implementaci√≥n de exportaci√≥n a Excel
                    setTimeout(() => {
                        this.showNotification('Exportaci√≥n exitosa', 'Archivo Excel generado', 'success');
                    }, 1000);
                } catch (error) {
                    this.showNotification('Error', 'No se pudo exportar a Excel', 'error');
                }
            }
            
            exportToPDF() {
                try {
                    this.showNotification('Exportando', 'Generando archivo PDF...', 'info');
                    // Implementaci√≥n de exportaci√≥n a PDF
                    setTimeout(() => {
                        this.showNotification('Exportaci√≥n exitosa', 'Archivo PDF generado', 'success');
                    }, 1000);
                } catch (error) {
                    this.showNotification('Error', 'No se pudo exportar a PDF', 'error');
                }
            }
            
            exportToCSV() {
                try {
                    this.showNotification('Exportando', 'Generando archivo CSV...', 'info');
                    // Implementaci√≥n de exportaci√≥n a CSV
                    setTimeout(() => {
                        this.showNotification('Exportaci√≥n exitosa', 'Archivo CSV generado', 'success');
                    }, 1000);
                } catch (error) {
                    this.showNotification('Error', 'No se pudo exportar a CSV', 'error');
                }
            }
            
            exportBackup() {
                try {
                    this.showNotification('Creando backup', 'Generando copia de seguridad...', 'info');
                    // Implementaci√≥n de backup
                    setTimeout(() => {
                        this.showNotification('Backup creado', 'Copia de seguridad exportada', 'success');
                    }, 1000);
                } catch (error) {
                    this.showNotification('Error', 'No se pudo crear el backup', 'error');
                }
            }
            
            printReport() {
                window.print();
                this.showNotification('Impresi√≥n', 'Preparando documento para imprimir...', 'info');
            }
            
            sendToEmail() {
                this.showNotification('Correo', 'Abriendo cliente de correo...', 'info');
                // Implementaci√≥n de env√≠o por email
            }
            
            // ============================================
            // UTILIDADES
            // ============================================
            
            formatDateForInput(date) {
                return date.toISOString().split('T')[0];
            }
            
            formatDateDisplay(date) {
                const options = {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                };
                return date.toLocaleDateString('es-CR', options);
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            getFileIcon(fileType) {
                if (fileType.includes('pdf')) return 'fas fa-file-pdf';
                if (fileType.includes('word')) return 'fas fa-file-word';
                if (fileType.includes('excel') || fileType.includes('sheet')) return 'fas fa-file-excel';
                if (fileType.includes('image')) return 'fas fa-file-image';
                if (fileType.includes('csv')) return 'fas fa-file-csv';
                return 'fas fa-file';
            }
            
            getFileColor(fileType) {
                if (fileType.includes('pdf')) return '#f44336';
                if (fileType.includes('word')) return '#2b579a';
                if (fileType.includes('excel') || fileType.includes('sheet')) return '#217346';
                if (fileType.includes('image')) return '#4caf50';
                if (fileType.includes('csv')) return '#ff9800';
                return '#9e9e9e';
            }
            
            getPriorityLabel(priority) {
                const labels = {
                    'normal': 'Normal',
                    'alta': 'Alta',
                    'urgente': 'Urgente'
                };
                return labels[priority] || priority;
            }
            
            getStatusLabel(status) {
                const labels = {
                    'pendiente': 'Pendiente',
                    'en-progreso': 'En Progreso',
                    'completada': 'Completada'
                };
                return labels[status] || status;
            }
            
            updateDateTime() {
                const now = new Date();
                const options = {
                    timeZone: 'America/Costa_Rica',
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                };
                
                const formatter = new Intl.DateTimeFormat('es-CR', options);
                document.getElementById('current-datetime').innerHTML = 
                    `<i class="fas fa-clock"></i> ${formatter.format(now)} UTC-6 üá®üá∑`;
            }
            
            getWeekStartDate() {
                const date = new Date();
                const day = date.getDay();
                const diff = date.getDate() - day + (day === 0 ? -6 : 1);
                return new Date(date.setDate(diff));
            }
            
            getWeekEndDate() {
                const start = this.getWeekStartDate();
                const end = new Date(start);
                end.setDate(start.getDate() + 6);
                return end;
            }
            
            backupJournalEntry(entry) {
                const backups = JSON.parse(localStorage.getItem('journal_backups') || '[]');
                backups.push({
                    ...entry,
                    backedUpAt: new Date().toISOString()
                });
                
                if (backups.length > 100) backups.shift();
                localStorage.setItem('journal_backups', JSON.stringify(backups));
            }
            
            showNotification(title, message, type = 'info') {
                const container = document.getElementById('notification-center');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${title}</strong>
                        <p style="margin: 5px 0 0; font-size: 0.9rem; opacity: 0.9;">${message}</p>
                    </div>
                    <button class="task-action-btn" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 5000);
            }
            
            switchTab(tabId) {
                // Ocultar todos
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Mostrar seleccionado
                document.getElementById(`tab-${tabId}`).classList.add('active');
                document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                
                // Cargar datos si es necesario
                if (tabId === 'dashboard') {
                    this.updateDashboardStats();
                } else if (tabId === 'tareas') {
                    this.loadTasks();
                } else if (tabId === 'archivos') {
                    this.loadFilesForDate();
                } else if (tabId === 'calendario') {
                    this.renderCalendar();
                }
            }
            
            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = 'auto';
                
                if (modalId === 'task-modal') {
                    document.getElementById('task-form').reset();
                    document.getElementById('task-date').value = this.formatDateForInput(new Date());
                    this.editingTaskId = null;
                }
            }
            
            openTaskModal() {
                this.openModal('task-modal');
            }
            
            showExportModal() {
                this.openModal('export-modal');
            }
            
            openFileUpload() {
                document.getElementById('file-input').click();
            }
            
            openBackupManager() {
                this.showNotification('Gestor de Backups', 'Funcionalidad en desarrollo', 'info');
            }
            
            quickMeeting() {
                document.getElementById('task-title').value = 'Reuni√≥n de coordinaci√≥n';
                document.getElementById('task-function').value = '7';
                document.getElementById('task-priority').value = 'normal';
                this.openModal('task-modal');
            }
            
            uploadFile() {
                this.openFileUpload();
            }
            
            attachFileToJournal() {
                const input = document.createElement('input');
                input.type = 'file';
                input.multiple = true;
                input.onchange = async (e) => {
                    const files = Array.from(e.target.files);
                    if (files.length > 0) {
                        await this.uploadFiles(files);
                    }
                };
                input.click();
            }
            
            closeViewer() {
                document.getElementById('file-viewer-modal').classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        // ============================================
        // SISTEMA DE ARCHIVOS CON INDEXEDDB
        // ============================================
        
        class FileSystemManager {
            constructor() {
                this.db = null;
                this.dbName = 'AgendaDRTE_Files_v3';
                this.dbVersion = 3;
            }
            
            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.dbVersion);
                    
                    request.onerror = () => reject('Error al abrir IndexedDB');
                    
                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        console.log('‚úÖ IndexedDB inicializada');
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Archivos
                        if (!db.objectStoreNames.contains('files')) {
                            const store = db.createObjectStore('files', { keyPath: 'id' });
                            store.createIndex('date', 'metadata.date', { unique: false });
                            store.createIndex('year', 'metadata.year', { unique: false });
                            store.createIndex('month', 'metadata.month', { unique: false });
                        }
                        
                        // Tareas
                        if (!db.objectStoreNames.contains('tasks')) {
                            const store = db.createObjectStore('tasks', { keyPath: 'id' });
                            store.createIndex('date', 'date', { unique: false });
                            store.createIndex('status', 'status', { unique: false });
                            store.createIndex('priority', 'priority', { unique: false });
                        }
                        
                        // Bit√°coras
                        if (!db.objectStoreNames.contains('journals')) {
                            const store = db.createObjectStore('journals', { keyPath: 'id' });
                            store.createIndex('date', 'date', { unique: true });
                        }
                    };
                });
            }
            
            async saveFile(file, metadata) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['files'], 'readwrite');
                    const store = transaction.objectStore('files');
                    
                    const reader = new FileReader();
                    
                    reader.onload = async (e) => {
                        const fileData = {
                            id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: e.target.result,
                            metadata: {
                                ...metadata,
                                uploadedAt: new Date().toISOString()
                            }
                        };
                        
                        const request = store.put(fileData);
                        
                        request.onsuccess = () => resolve(fileData.id);
                        request.onerror = () => reject('Error al guardar archivo');
                    };
                    
                    reader.onerror = () => reject('Error al leer archivo');
                    reader.readAsArrayBuffer(file);
                });
            }
            
            async getFile(fileId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const request = store.get(fileId);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject('Error al obtener archivo');
                });
            }
            
            async getFilesByDate(date) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const index = store.index('date');
                    const request = index.getAll(date);
                    
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject('Error al obtener archivos por fecha');
                });
            }
            
            async getAllFiles() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject('Error al obtener todos los archivos');
                });
            }
            
            async deleteFile(fileId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['files'], 'readwrite');
                    const store = transaction.objectStore('files');
                    const request = store.delete(fileId);
                    
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject('Error al eliminar archivo');
                });
            }
            
            async saveTask(task) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    const request = store.put(task);
                    
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject('Error al guardar tarea');
                });
            }
            
            async getTask(taskId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readonly');
                    const store = transaction.objectStore('tasks');
                    const request = store.get(taskId);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject('Error al obtener tarea');
                });
            }
            
            async getAllTasks() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readonly');
                    const store = transaction.objectStore('tasks');
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject('Error al obtener todas las tareas');
                });
            }
            
            async getTasksByDate(date) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readonly');
                    const store = transaction.objectStore('tasks');
                    const index = store.index('date');
                    const request = index.getAll(date);
                    
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject('Error al obtener tareas por fecha');
                });
            }
            
            async deleteTask(taskId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    const request = store.delete(taskId);
                    
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject('Error al eliminar tarea');
                });
            }
            
            async saveJournalEntry(entry) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['journals'], 'readwrite');
                    const store = transaction.objectStore('journals');
                    const request = store.put(entry);
                    
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject('Error al guardar bit√°cora');
                });
            }
            
            async getJournalEntry(date) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['journals'], 'readonly');
                    const store = transaction.objectStore('journals');
                    const index = store.index('date');
                    const request = index.get(date);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject('Error al obtener bit√°cora');
                });
            }
            
            async getAllJournals() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['journals'], 'readonly');
                    const store = transaction.objectStore('journals');
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject('Error al obtener todas las bit√°coras');
                });
            }
        }
        
        // ============================================
        // INICIALIZACI√ìN GLOBAL
        // ============================================
        
        let agenda;
        
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                agenda = new AgendaDRTEProfessional();
                
                // Hacer funciones globales
                window.agenda = agenda;
                window.switchTab = (tabId) => agenda.switchTab(tabId);
                window.saveJournal = () => agenda.saveJournal();
                window.loadJournal = () => agenda.loadJournal();
                window.loadTodayJournal = () => agenda.loadTodayJournal();
                window.insertTemplate = (type) => agenda.insertTemplate(type);
                window.openTaskModal = () => agenda.openTaskModal();
                window.saveTask = (event) => agenda.saveTask(event);
                window.setFilter = (filter) => agenda.setFilter(filter);
                window.searchTasks = () => agenda.searchTasks();
                window.openFileUpload = () => agenda.openFileUpload();
                window.loadFilesForDate = () => agenda.loadFilesForDate();
                window.prevDay = () => agenda.prevDay();
                window.nextDay = () => agenda.nextDay();
                window.goToToday = () => agenda.goToToday();
                window.previousMonth = () => agenda.previousMonth();
                window.nextMonth = () => agenda.nextMonth();
                window.showExportModal = () => agenda.showExportModal();
                window.exportToExcel = () => agenda.exportToExcel();
                window.exportToPDF = () => agenda.exportToPDF();
                window.exportToCSV = () => agenda.exportToCSV();
                window.exportBackup = () => agenda.exportBackup();
                window.printReport = () => agenda.printReport();
                window.sendToEmail = () => agenda.sendToEmail();
                window.closeModal = (modalId) => agenda.closeModal(modalId);
                window.closeViewer = () => agenda.closeViewer();
                window.quickMeeting = () => agenda.quickMeeting();
                window.uploadFile = () => agenda.uploadFile();
                window.attachFileToJournal = () => agenda.attachFileToJournal();
                window.openBackupManager = () => agenda.openBackupManager();
                
                // Drag and drop
                window.handleDragOver = (e) => {
                    e.preventDefault();
                    document.getElementById('file-drop-area').classList.add('dragover');
                };
                
                window.handleDragLeave = (e) => {
                    e.preventDefault();
                    document.getElementById('file-drop-area').classList.remove('dragover');
                };
                
                window.handleFileDrop = async (e) => {
                    e.preventDefault();
                    document.getElementById('file-drop-area').classList.remove('dragover');
                    const files = Array.from(e.dataTransfer.files);
                    if (files.length > 0) {
                        await agenda.uploadFiles(files);
                    }
                };
                
                console.log('üöÄ Sistema Agenda DRTE completamente cargado');
                
            } catch (error) {
                console.error('‚ùå Error cr√≠tico:', error);
                alert('Error al cargar la aplicaci√≥n. Por favor, recarga la p√°gina.');
            }
        });
    </script>
</body>
</html>
