<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRTE MEP - Sistema Inteligente de Gestión</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* SISTEMA DE DISEÑO PROFESIONAL - INSPIRADO EN MONDAY.COM Y ACTITIME */
        :root {
            /* Paleta de colores profesional moderna */
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --primary-light: #4895ef;
            --secondary-color: #7209b7;
            --accent-color: #4cc9f0;
            --success-color: #4ade80;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #0ea5e9;
            --purple-color: #8b5cf6;
            --pink-color: #ec4899;
            --teal-color: #14b8a6;
            
            /* Colores de fondo y superficie */
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --bg-surface: #ffffff;
            --bg-sidebar: #1e293b;
            --bg-card: #ffffff;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            /* Colores de texto */
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-light: #94a3b8;
            --text-on-dark: #f1f5f9;
            --text-muted: #64748b;
            
            /* Bordes y sombras */
            --border-color: #e2e8f0;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.07);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.07);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
            --shadow-card: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06);
            
            /* Transiciones */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Espaciado */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
        }

        /* RESET Y CONFIGURACIÓN BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            height: 100%;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(67, 97, 238, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(114, 9, 183, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(76, 201, 240, 0.08) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        /* ANIMACIONES */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(67, 97, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* LAYOUT PRINCIPAL - SISTEMA DE GRID MODERNO */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr;
            min-height: 100vh;
            position: relative;
            background: var(--bg-primary);
        }

        /* HEADER DINÁMICO Y PROFESIONAL */
        .header {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-xl);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: all var(--transition-normal);
            height: 70px;
            animation: slideIn 0.5s ease;
        }

        .header.scrolled {
            box-shadow: var(--shadow-lg);
            background: rgba(255, 255, 255, 0.98);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .logo-container:hover {
            transform: translateX(5px);
        }

        .logo {
            width: 42px;
            height: 42px;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
            position: relative;
            overflow: hidden;
        }

        .logo::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0) 50%
            );
            transform: rotate(30deg);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-text h1 {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .logo-text .subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 0.5px;
            margin-top: -2px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .quick-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .header-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .header-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .header-btn.primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
        }

        .notification-badge {
            position: relative;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color var(--transition-fast);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--bg-secondary);
        }

        .notification-badge:hover {
            color: var(--primary-color);
            background: var(--border-color);
        }

        .badge-count {
            position: absolute;
            top: -2px;
            right: -2px;
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
            font-size: 0.7rem;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem 0.5rem 0.75rem;
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 1px solid transparent;
        }

        .user-profile:hover {
            background: white;
            border-color: var(--border-color);
            box-shadow: var(--shadow-sm);
            transform: translateY(-1px);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .avatar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            transform: translateX(-100%);
        }

        .user-profile:hover .avatar::after {
            animation: shimmer 2s infinite;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* SIDEBAR MODERNA CON ANIMACIONES */
        .sidebar {
            background: linear-gradient(180deg, var(--bg-sidebar) 0%, #0f172a 100%);
            padding: var(--spacing-xl) 0;
            position: sticky;
            top: 70px;
            height: calc(100vh - 70px);
            overflow-y: auto;
            z-index: 900;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-section {
            padding: 0 var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .section-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-md);
            padding-left: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-label::before {
            content: '';
            width: 4px;
            height: 4px;
            background: var(--accent-color);
            border-radius: 50%;
            display: block;
        }

        .nav-list {
            list-style: none;
            margin-bottom: var(--spacing-xl);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: 0.875rem var(--spacing-lg);
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all var(--transition-normal);
            border-left: 3px solid transparent;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius-sm);
            margin-bottom: 2px;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            color: white;
            background: rgba(255, 255, 255, 0.08);
            border-left-color: var(--primary-color);
            transform: translateX(5px);
        }

        .nav-item.active {
            color: white;
            background: linear-gradient(90deg, rgba(67, 97, 238, 0.2), rgba(67, 97, 238, 0.1));
            border-left-color: var(--primary-color);
            font-weight: 600;
            box-shadow: inset 2px 0 8px rgba(67, 97, 238, 0.3);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.7);
            transition: color var(--transition-fast);
        }

        .nav-item:hover i {
            color: white;
        }

        .nav-item.active i {
            color: var(--accent-color);
        }

        .nav-item .badge {
            margin-left: auto;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        /* ASISTENTE IA AVANZADO - INSPIRADO EN READ.AI */
        .assistant-container {
            margin: var(--spacing-xl) var(--spacing-lg);
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.15), rgba(114, 9, 183, 0.1));
            border-radius: var(--border-radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .assistant-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
        }

        .assistant-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        }

        .assistant-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            position: relative;
            z-index: 1;
        }

        .assistant-avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 4px 15px rgba(76, 201, 240, 0.4);
            position: relative;
            animation: float 3s ease-in-out infinite;
        }

        .assistant-avatar::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            border-radius: 50%;
            z-index: -1;
            opacity: 0.5;
            filter: blur(4px);
        }

        .assistant-title h4 {
            color: white;
            font-weight: 700;
            margin-bottom: 0.25rem;
            font-size: 1.1rem;
        }

        .assistant-title p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .assistant-messages {
            height: 250px;
            overflow-y: auto;
            margin-bottom: var(--spacing-md);
            padding-right: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .assistant-messages::-webkit-scrollbar {
            width: 4px;
        }

        .assistant-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .assistant-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        .assistant-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .message {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            animation: fadeIn 0.3s ease;
            position: relative;
            backdrop-filter: blur(5px);
            border: 1px solid transparent;
        }

        .message.ai {
            background: rgba(255, 255, 255, 0.12);
            border-left: 3px solid var(--accent-color);
            color: white;
            margin-right: 2rem;
        }

        .message.user {
            background: linear-gradient(90deg, rgba(67, 97, 238, 0.25), rgba(67, 97, 238, 0.15));
            border-left: 3px solid var(--primary-color);
            color: white;
            margin-left: 2rem;
            text-align: right;
        }

        .message .sender {
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .message .content {
            font-size: 0.9rem;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message .timestamp {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: right;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.25rem;
        }

        .assistant-input-container {
            position: relative;
            margin-top: var(--spacing-md);
            z-index: 1;
        }

        .assistant-input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 3rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: var(--border-radius-lg);
            color: white;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all var(--transition-fast);
            backdrop-filter: blur(10px);
        }

        .assistant-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.25);
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .assistant-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .assistant-input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            transition: color var(--transition-fast);
        }

        .assistant-input:focus + .assistant-input-icon {
            color: var(--accent-color);
        }

        .assistant-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }

        .assistant-action {
            padding: 0.5rem 0.875rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assistant-action:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            border-color: var(--accent-color);
        }

        /* CONTENIDO PRINCIPAL DINÁMICO */
        .main-content {
            padding: var(--spacing-xl);
            overflow-y: auto;
            background: transparent;
            position: relative;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        /* DASHBOARD DINÁMICO Y PROFESIONAL */
        .dashboard-welcome {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            color: white;
            margin-bottom: var(--spacing-xl);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.6s ease;
        }

        .dashboard-welcome::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path fill="rgba(255,255,255,0.05)" d="M0,0 L100,0 L100,100 Z"/></svg>');
            background-size: cover;
        }

        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-lg);
            position: relative;
            z-index: 1;
        }

        .welcome-text h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }

        .welcome-text p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            max-width: 600px;
        }

        .current-time {
            background: rgba(255, 255, 255, 0.15);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .current-time .time {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .current-time .date {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            animation: fadeIn 0.7s ease;
        }

        .stat-card {
            background: var(--bg-surface);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
        }

        .stat-card.growing::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-icon.tasks {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
        }

        .stat-icon.events {
            background: linear-gradient(135deg, var(--info-color), #0ea5e9);
        }

        .stat-icon.bitacoras {
            background: linear-gradient(135deg, var(--success-color), #10b981);
        }

        .stat-icon.productivity {
            background: linear-gradient(135deg, var(--warning-color), #f59e0b);
        }

        .stat-content {
            display: flex;
            flex-direction: column;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 0.25rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .stat-progress {
            width: 100%;
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease-in-out;
        }

        .progress-bar.success { background: linear-gradient(90deg, var(--success-color), #10b981); }
        .progress-bar.warning { background: linear-gradient(90deg, var(--warning-color), #f59e0b); }
        .progress-bar.danger { background: linear-gradient(90deg, var(--danger-color), #dc2626); }
        .progress-bar.info { background: linear-gradient(90deg, var(--info-color), #0ea5e9); }

        .dashboard-quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            animation: fadeIn 0.8s ease;
        }

        .quick-action-card {
            background: var(--bg-surface);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .quick-action-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .quick-action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(67, 97, 238, 0.05));
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .quick-action-card:hover::before {
            opacity: 1;
        }

        .quick-action-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: var(--primary-color);
            transition: all var(--transition-fast);
        }

        .quick-action-card:hover .quick-action-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: scale(1.1) rotate(5deg);
        }

        .quick-action-content h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .quick-action-content p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .recent-activity {
            background: var(--bg-surface);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            animation: fadeIn 0.9s ease;
        }

        .activity-list {
            margin-top: var(--spacing-lg);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            transition: background var(--transition-fast);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-item:hover {
            background: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* BOTONES MEJORADOS - INSPIRADO EN MONDAY.COM */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            outline: none;
            user-select: none;
            letter-spacing: 0.3px;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 6px rgba(67, 97, 238, 0.2);
            border: 1px solid transparent;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.3);
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary-color));
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(67, 97, 238, 0.2);
        }

        .btn-secondary {
            background: var(--bg-surface);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #10b981);
            color: white;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-icon:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: rotate(15deg) scale(1.1);
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn-group .btn {
            border-radius: var(--border-radius-sm);
        }

        .btn-group .btn:first-child {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .btn-group .btn:last-child {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        .btn-group .btn:not(:first-child):not(:last-child) {
            border-radius: 0;
        }

        /* CALENDARIO AVANZADO - COMPLETO Y FUNCIONAL */
        .calendar-container {
            background: var(--bg-surface);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            margin-bottom: var(--spacing-xl);
            animation: fadeIn 0.5s ease;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .calendar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 300px;
            text-align: center;
        }

        .calendar-view-selector {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-surface);
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
        }

        .view-btn {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            border-radius: var(--border-radius-sm);
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .view-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .view-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .calendar-grid {
            display: grid;
            background: var(--bg-surface);
            min-height: 500px;
        }

        /* Vista mensual */
        .calendar-month {
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-week {
            grid-template-columns: 60px repeat(7, 1fr);
        }

        .calendar-day-view {
            grid-template-columns: 1fr;
        }

        .calendar-day-header {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-day-header:last-child {
            border-right: none;
        }

        .calendar-day {
            min-height: 120px;
            padding: 0.75rem;
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-surface);
            position: relative;
            transition: all var(--transition-fast);
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day:hover {
            background: var(--bg-secondary);
        }

        .calendar-day.other-month {
            background: #fafafa;
            color: var(--text-light);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.05));
            border-left: 3px solid var(--primary-color);
        }

        .calendar-day.today .day-number {
            color: var(--primary-color);
            font-weight: 800;
            background: var(--primary-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .day-number {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            display: inline-block;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
        }

        .event-list {
            margin-top: 0.5rem;
        }

        .event-item {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            margin-bottom: 0.25rem;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: all var(--transition-fast);
            border-left: 3px solid;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .event-item:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .event-reunion { border-color: var(--primary-color); background: #dbeafe; color: #1e40af; }
        .event-informe { border-color: var(--success-color); background: #dcfce7; color: #166534; }
        .event-teletrabajo { border-color: var(--purple-color); background: #f3e8ff; color: #6b21a8; }
        .event-oficina { border-color: var(--warning-color); background: #fef3c7; color: #92400e; }
        .event-capacitacion { border-color: var(--info-color); background: #e0f2fe; color: #0c4a6e; }

        /* Vista semanal */
        .time-slot {
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            min-height: 60px;
            position: relative;
        }

        .time-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 500;
            position: absolute;
            top: -10px;
            left: 0;
            background: white;
            padding: 0 0.5rem;
        }

        .week-event {
            position: absolute;
            border-radius: var(--border-radius-sm);
            padding: 0.5rem;
            font-size: 0.8rem;
            overflow: hidden;
            cursor: pointer;
            border-left: 3px solid;
            box-shadow: var(--shadow-sm);
        }

        /* GESTIÓN DE TAREAS MEJORADA */
        .tasks-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--spacing-lg);
            animation: fadeIn 0.6s ease;
        }

        .task-card {
            background: var(--bg-surface);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            animation: slideIn 0.5s ease;
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
        }

        .task-card.priority-alta::before { 
            background: linear-gradient(90deg, var(--danger-color), #ef4444); 
        }
        .task-card.priority-media::before { 
            background: linear-gradient(90deg, var(--warning-color), #f59e0b); 
        }
        .task-card.priority-baja::before { 
            background: linear-gradient(90deg, var(--success-color), #10b981); 
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .task-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            flex: 1;
            line-height: 1.4;
            word-break: break-word;
        }

        .task-priority {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 1rem;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-alta-badge { 
            background: linear-gradient(135deg, #fee2e2, #fecaca); 
            color: #991b1b; 
            border: 1px solid #fca5a5;
        }
        .priority-media-badge { 
            background: linear-gradient(135deg, #fef3c7, #fde68a); 
            color: #92400e; 
            border: 1px solid #fbbf24;
        }
        .priority-baja-badge { 
            background: linear-gradient(135deg, #d1fae5, #a7f3d0); 
            color: #065f46; 
            border: 1px solid #34d399;
        }

        .task-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            max-height: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .task-date {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .task-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .task-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .task-btn.edit:hover { 
            background: linear-gradient(135deg, #dbeafe, #bfdbfe); 
            color: var(--primary-color); 
        }
        .task-btn.delete:hover { 
            background: linear-gradient(135deg, #fee2e2, #fecaca); 
            color: var(--danger-color); 
        }
        .task-btn.complete:hover { 
            background: linear-gradient(135deg, #d1fae5, #a7f3d0); 
            color: var(--success-color); 
        }

        /* PLAN SEMANAL MEJORADO */
        .weekly-plan-container {
            background: var(--bg-surface);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-xl);
            animation: fadeIn 0.6s ease;
        }

        .date-range-selector {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .date-range-input {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .date-input {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 0.9rem;
            color: var(--text-primary);
            background: var(--bg-surface);
            transition: all var(--transition-fast);
            min-width: 200px;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .week-days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .week-day {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            transition: all var(--transition-fast);
        }

        .week-day:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--border-color);
        }

        .day-name {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .day-date {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .day-tasks {
            min-height: 100px;
        }

        .day-task {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            cursor: move;
            transition: all var(--transition-fast);
        }

        .day-task:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        .task-time {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .weekly-objectives {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
        }

        .objectives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }

        .objective-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            transition: all var(--transition-fast);
        }

        .objective-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .objective-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .objective-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .objective-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-weight: 600;
        }

        .status-pending { background: #fef3c7; color: #92400e; }
        .status-in-progress { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: #065f46; }

        /* MODALES MEJORADOS */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-surface);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-close {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 1.2rem;
        }

        .modal-close:hover {
            background: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: var(--spacing-lg);
        }

        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
        }

        /* FORMULARIOS MEJORADOS */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-label .required {
            color: var(--danger-color);
            font-size: 1.2rem;
            line-height: 1;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-surface);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            transition: all var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
            background: white;
        }

        .form-control::placeholder {
            color: var(--text-light);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
            font-family: inherit;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%234761ee'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1rem;
            padding-right: 3rem;
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            appearance: none;
            cursor: pointer;
            position: relative;
            transition: all var(--transition-fast);
        }

        .form-check-input:checked {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-check-input:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .form-check-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        /* NOTIFICACIONES MEJORADAS */
        .notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-width: 400px;
        }

        .notification {
            background: var(--bg-surface);
            border-radius: var(--border-radius);
            padding: 1rem 1.25rem;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification-success { border-left-color: var(--success-color); }
        .notification-error { border-left-color: var(--danger-color); }
        .notification-info { border-left-color: var(--info-color); }
        .notification-warning { border-left-color: var(--warning-color); }

        .notification-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .notification-success .notification-icon { 
            background: rgba(74, 222, 128, 0.1); 
            color: var(--success-color); 
        }
        .notification-error .notification-icon { 
            background: rgba(239, 68, 68, 0.1); 
            color: var(--danger-color); 
        }
        .notification-info .notification-icon { 
            background: rgba(14, 165, 233, 0.1); 
            color: var(--info-color); 
        }
        .notification-warning .notification-icon { 
            background: rgba(245, 158, 11, 0.1); 
            color: var(--warning-color); 
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }

        .notification-message {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1rem;
            transition: color var(--transition-fast);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .notification-close:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        /* RESPONSIVE DESIGN MEJORADO */
        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 250px 1fr;
            }
            
            .calendar-title {
                min-width: 250px;
            }
        }

        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar {
                display: none;
                position: fixed;
                top: 70px;
                left: 0;
                width: 280px;
                height: calc(100vh - 70px);
                z-index: 999;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.2);
                animation: slideIn 0.3s ease;
            }
            
            .sidebar.active {
                display: block;
            }
            
            .mobile-menu-btn {
                display: flex !important;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
                border-radius: var(--border-radius);
                background: var(--bg-secondary);
                border: 1px solid var(--border-color);
                color: var(--text-primary);
                font-size: 1.2rem;
                cursor: pointer;
                transition: all var(--transition-fast);
            }
            
            .mobile-menu-btn:hover {
                background: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .tasks-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .week-days-grid {
                grid-template-columns: repeat(2, 1fr);
                overflow-x: auto;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 1rem;
                flex-wrap: wrap;
                height: auto;
                padding: 1rem;
                gap: 1rem;
            }
            
            .quick-actions {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 1rem;
            }
            
            .header-btn {
                flex: 1;
                justify-content: center;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .dashboard-quick-actions {
                grid-template-columns: 1fr;
            }
            
            .calendar-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .calendar-nav {
                justify-content: center;
            }
            
            .calendar-title {
                text-align: center;
                min-width: auto;
            }
            
            .calendar-view-selector {
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 0.5rem;
                max-height: calc(100vh - 1rem);
            }
        }

        @media (max-width: 576px) {
            .welcome-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .current-time {
                width: 100%;
                text-align: center;
            }
            
            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .section-actions {
                justify-content: center;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .date-range-selector {
                flex-direction: column;
                align-items: stretch;
            }
            
            .date-input {
                min-width: auto;
            }
            
            .week-days-grid {
                grid-template-columns: 1fr;
            }
        }

        /* LOADER ANIMADO */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* MOBILE MENU BUTTON */
        .mobile-menu-btn {
            display: none;
        }

        /* UTILITY CLASSES */
        .text-success { color: var(--success-color); }
        .text-danger { color: var(--danger-color); }
        .text-warning { color: var(--warning-color); }
        .text-info { color: var(--info-color); }
        .text-primary { color: var(--primary-color); }
        .text-muted { color: var(--text-muted); }

        .bg-success { background: var(--success-color); }
        .bg-danger { background: var(--danger-color); }
        .bg-warning { background: var(--warning-color); }
        .bg-info { background: var(--info-color); }

        .d-none { display: none !important; }
        .d-flex { display: flex !important; }
        .d-block { display: block !important; }
        .d-grid { display: grid !important; }

        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        .p-1 { padding: 0.5rem; }
        .p-2 { padding: 1rem; }
        .p-3 { padding: 1.5rem; }
        .p-4 { padding: 2rem; }

        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }

        .w-100 { width: 100%; }
        .h-100 { height: 100%; }

        .cursor-pointer { cursor: pointer; }
        .cursor-move { cursor: move; }

        .position-relative { position: relative; }
        .position-absolute { position: absolute; }
        .position-sticky { position: sticky; }

        .overflow-hidden { overflow: hidden; }
        .overflow-auto { overflow: auto; }

        .border-0 { border: 0 !important; }
        .border-top { border-top: 1px solid var(--border-color); }
        .border-bottom { border-bottom: 1px solid var(--border-color); }

        .shadow-sm { box-shadow: var(--shadow-sm); }
        .shadow-md { box-shadow: var(--shadow-md); }
        .shadow-lg { box-shadow: var(--shadow-lg); }

        .rounded { border-radius: var(--border-radius); }
        .rounded-sm { border-radius: var(--border-radius-sm); }
        .rounded-lg { border-radius: var(--border-radius-lg); }

        .flex-1 { flex: 1; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-column { flex-direction: column; }
        .align-items-center { align-items: center; }
        .justify-content-between { justify-content: space-between; }
        .justify-content-center { justify-content: center; }

        /* PRINT STYLES */
        @media print {
            .sidebar, .header, .modal, .notification-container,
            .btn, .assistant-container, .mobile-menu-btn {
                display: none !important;
            }
            
            .main-content {
                padding: 0;
                background: white;
            }
            
            .content-section {
                display: block !important;
                animation: none;
            }
            
            .stat-card, .calendar-container, .task-card {
                break-inside: avoid;
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
        }
    </style>
</head>
<body>
    <!-- NOTIFICACIONES -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- APP CONTAINER -->
    <div class="app-container">
        <!-- HEADER DINÁMICO -->
        <header class="header" id="mainHeader">
            <div class="logo-container" onclick="navigateTo('dashboard')">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <i class="fas fa-tasks"></i>
                </div>
                <div class="logo-text">
                    <h1>DRTE MEP</h1>
                    <div class="subtitle">Sistema Inteligente de Gestión</div>
                </div>
            </div>

            <div class="header-actions">
                <div class="quick-actions">
                    <button class="header-btn" onclick="openQuickTask()">
                        <i class="fas fa-plus-circle"></i> Tarea Rápida
                    </button>
                    <button class="header-btn" onclick="openQuickEvent()">
                        <i class="fas fa-calendar-plus"></i> Evento
                    </button>
                    <button class="header-btn primary" onclick="openQuickBitacora()">
                        <i class="fas fa-file-alt"></i> Bitácora
                    </button>
                </div>

                <div class="notification-badge" onclick="showNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="badge-count" id="notificationCount">3</span>
                </div>

                <div class="user-profile" id="userProfile">
                    <div class="avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name">Asesor Nacional</div>
                        <div class="user-role">MEP Costa Rica</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- SIDEBAR INTELIGENTE -->
        <aside class="sidebar" id="sidebar">
            <!-- ASISTENTE IA AVANZADO -->
            <div class="assistant-container">
                <div class="assistant-header">
                    <div class="assistant-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="assistant-title">
                        <h4>Asistente DRTE</h4>
                        <p>
                            <span class="status-indicator"></span>
                            Inteligencia Artificial Activa
                        </p>
                    </div>
                </div>

                <div class="assistant-messages" id="assistantMessages">
                    <div class="message ai">
                        <div class="sender">
                            <i class="fas fa-robot"></i> Asistente DRTE
                        </div>
                        <div class="content">¡Hola! Soy tu asistente de IA. Puedo ayudarte con tareas, eventos, bitácoras y análisis de productividad. ¿En qué puedo asistirte hoy?</div>
                        <div class="timestamp">
                            <i class="far fa-clock"></i>
                            <span id="currentTime">00:00</span>
                        </div>
                    </div>
                </div>

                <div class="assistant-input-container">
                    <i class="fas fa-paper-plane assistant-input-icon"></i>
                    <input type="text" class="assistant-input" id="assistantInput" 
                           placeholder="Pregunta algo o da una instrucción..." 
                           autocomplete="off"
                           onkeypress="if(event.key === 'Enter') handleAssistantQuery()">
                </div>

                <div class="assistant-actions">
                    <div class="assistant-action" onclick="quickCommand('tareas-hoy')">
                        <i class="fas fa-tasks"></i> Tareas Hoy
                    </div>
                    <div class="assistant-action" onclick="quickCommand('eventos-hoy')">
                        <i class="fas fa-calendar-day"></i> Eventos Hoy
                    </div>
                    <div class="assistant-action" onclick="quickCommand('informe-rapido')">
                        <i class="fas fa-chart-line"></i> Informe Rápido
                    </div>
                    <div class="assistant-action" onclick="quickCommand('productividad')">
                        <i class="fas fa-bolt"></i> Productividad
                    </div>
                </div>
            </div>

            <!-- NAVEGACIÓN PRINCIPAL -->
            <div class="nav-section">
                <div class="section-label">Navegación Principal</div>
                <ul class="nav-list">
                    <li>
                        <a class="nav-item active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard Inteligente</span>
                            <span class="badge" id="dashboardBadge">Live</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" data-section="calendario">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Calendario Avanzado</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" data-section="tareas">
                            <i class="fas fa-tasks"></i>
                            <span>Gestión de Tareas</span>
                            <span class="badge" id="pendingTasksBadge">0</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" data-section="bitacoras">
                            <i class="fas fa-book"></i>
                            <span>Bitácoras y Planes</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" data-section="informes">
                            <i class="fas fa-chart-bar"></i>
                            <span>Análisis e Informes</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" data-section="enlaces">
                            <i class="fas fa-link"></i>
                            <span>Enlaces Rápidos</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="nav-section">
                <div class="section-label">Herramientas Rápidas</div>
                <ul class="nav-list">
                    <li>
                        <a class="nav-item" onclick="generarInforme('diario')">
                            <i class="fas fa-file-export"></i>
                            <span>Informe Diario</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" onclick="generarInforme('semanal')">
                            <i class="fas fa-file-contract"></i>
                            <span>Informe Semanal</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" onclick="generarInforme('mensual')">
                            <i class="fas fa-file-invoice"></i>
                            <span>Informe Mensual</span>
                        </a>
                    </li>
                    <li>
                        <a class="nav-item" data-section="configuracion">
                            <i class="fas fa-cog"></i>
                            <span>Configuración</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- CONTENIDO PRINCIPAL -->
        <main class="main-content" id="mainContent">
            <!-- DASHBOARD DINÁMICO -->
            <section id="dashboard" class="content-section active">
                <!-- Bienvenida Dinámica -->
                <div class="dashboard-welcome">
                    <div class="welcome-header">
                        <div class="welcome-text">
                            <h2 id="welcomeTitle">¡Buenos días, Asesor Nacional!</h2>
                            <p id="welcomeMessage">Aquí tienes un resumen de tus actividades y productividad del día.</p>
                        </div>
                        <div class="current-time">
                            <div class="time" id="currentDashboardTime">00:00</div>
                            <div class="date" id="currentDashboardDate">1 de enero de 2026</div>
                        </div>
                    </div>

                    <!-- Estadísticas en Tiempo Real -->
                    <div class="dashboard-stats">
                        <div class="stat-card growing" onclick="navigateTo('tareas')">
                            <div class="stat-icon tasks">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalTareas">0</div>
                                <div class="stat-label">Tareas Pendientes</div>
                                <div class="stat-progress">
                                    <div class="progress-bar danger" id="tasksProgress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="navigateTo('calendario')">
                            <div class="stat-icon events">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="eventosHoy">0</div>
                                <div class="stat-label">Eventos Hoy</div>
                                <div class="stat-progress">
                                    <div class="progress-bar info" id="eventsProgress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="navigateTo('bitacoras')">
                            <div class="stat-icon bitacoras">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalBitacoras">0</div>
                                <div class="stat-label">Bitácoras Activas</div>
                                <div class="stat-progress">
                                    <div class="progress-bar success" id="bitacorasProgress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card" onclick="navigateTo('informes')">
                            <div class="stat-icon productivity">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="productividad">0%</div>
                                <div class="stat-label">Productividad</div>
                                <div class="stat-progress">
                                    <div class="progress-bar success" id="productivityProgress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Acciones Rápidas -->
                <div class="dashboard-quick-actions">
                    <div class="quick-action-card" onclick="openTaskModal()">
                        <div class="quick-action-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>Nueva Tarea</h4>
                            <p>Agrega una tarea rápida a tu lista</p>
                        </div>
                    </div>

                    <div class="quick-action-card" onclick="openEventModal()">
                        <div class="quick-action-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>Nuevo Evento</h4>
                            <p>Programa una reunión o actividad</p>
                        </div>
                    </div>

                    <div class="quick-action-card" onclick="openBitacoraModal('diaria')">
                        <div class="quick-action-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>Bitácora Diaria</h4>
                            <p>Registra tus actividades de hoy</p>
                        </div>
                    </div>

                    <div class="quick-action-card" onclick="generarInforme('diario')">
                        <div class="quick-action-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>Informe Diario</h4>
                            <p>Genera reporte de actividades</p>
                        </div>
                    </div>
                </div>

                <!-- Actividad Reciente -->
                <div class="recent-activity">
                    <h3 class="section-title">
                        <i class="fas fa-history"></i>
                        Actividad Reciente
                    </h3>
                    <div class="activity-list" id="recentActivityList">
                        <!-- Se llena dinámicamente -->
                    </div>
                </div>
            </section>

            <!-- CALENDARIO COMPLETO -->
            <section id="calendario" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        Calendario Avanzado
                    </h2>
                    <div class="section-actions">
                        <div class="calendar-view-selector">
                            <button class="view-btn" data-view="month" onclick="changeCalendarView('month')">Mes</button>
                            <button class="view-btn" data-view="week" onclick="changeCalendarView('week')">Semana</button>
                            <button class="view-btn active" data-view="day" onclick="changeCalendarView('day')">Día</button>
                        </div>
                        <button class="btn btn-primary" onclick="openEventModal()">
                            <i class="fas fa-plus"></i> Nuevo Evento
                        </button>
                    </div>
                </div>

                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="btn-icon" onclick="prevCalendarPeriod()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 class="calendar-title" id="calendarTitle">Enero 2026</h3>
                            <button class="btn-icon" onclick="nextCalendarPeriod()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <button class="btn btn-secondary" onclick="goToToday()">
                            <i class="fas fa-calendar-day"></i> Hoy
                        </button>
                    </div>
                    
                    <div class="calendar-grid" id="calendarView">
                        <!-- Calendario se renderiza dinámicamente -->
                    </div>
                </div>
            </section>

            <!-- GESTIÓN DE TAREAS COMPLETA -->
            <section id="tareas" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-tasks"></i>
                        Gestión de Tareas
                    </h2>
                    <div class="section-actions">
                        <div class="filter-group">
                            <select class="form-control" id="taskFilter" onchange="filterTasks()" style="width: auto;">
                                <option value="all">Todas las tareas</option>
                                <option value="pending">Pendientes</option>
                                <option value="in-progress">En progreso</option>
                                <option value="completed">Completadas</option>
                                <option value="high">Alta prioridad</option>
                                <option value="today">Para hoy</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="openTaskModal()">
                            <i class="fas fa-plus"></i> Nueva Tarea
                        </button>
                    </div>
                </div>

                <div class="tasks-container" id="tasksContainer">
                    <!-- Tareas se cargan dinámicamente -->
                </div>
            </section>

            <!-- BITÁCORAS Y PLANES MEJORADOS -->
            <section id="bitacoras" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-book"></i>
                        Bitácoras y Planificación
                    </h2>
                    <div class="section-actions">
                        <button class="btn btn-secondary" onclick="openBitacoraModal('diaria')">
                            <i class="fas fa-plus"></i> Bitácora Diaria
                        </button>
                        <button class="btn btn-primary" onclick="openWeeklyPlanModal()">
                            <i class="fas fa-calendar-week"></i> Plan Semanal
                        </button>
                    </div>
                </div>

                <!-- Plan Semanal Mejorado -->
                <div class="weekly-plan-container">
                    <div class="date-range-selector">
                        <div class="date-range-input">
                            <label class="form-label">Seleccionar Semana:</label>
                            <input type="week" class="form-control" id="weekSelector" onchange="loadWeeklyPlan()">
                        </div>
                        <button class="btn btn-primary" onclick="saveWeeklyPlan()">
                            <i class="fas fa-save"></i> Guardar Plan
                        </button>
                    </div>

                    <div class="week-days-grid" id="weekDaysGrid">
                        <!-- Días de la semana se cargan dinámicamente -->
                    </div>

                    <div class="weekly-objectives">
                        <h3 class="section-title">
                            <i class="fas fa-bullseye"></i>
                            Objetivos de la Semana
                        </h3>
                        <textarea class="form-control" id="weeklyObjectives" rows="4" 
                                  placeholder="Define los objetivos principales para esta semana..."></textarea>
                        
                        <div class="objectives-grid" id="objectivesGrid">
                            <!-- Objetivos se cargan dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Historial de Bitácoras -->
                <div class="recent-activity mt-4">
                    <h3 class="section-title">
                        <i class="fas fa-history"></i>
                        Historial de Bitácoras
                    </h3>
                    <div class="activity-list" id="bitacorasHistory">
                        <!-- Bitácoras se cargan dinámicamente -->
                    </div>
                </div>
            </section>

            <!-- ANÁLISIS E INFORMES -->
            <section id="informes" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Análisis e Informes
                    </h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="generarInformeCompleto()">
                            <i class="fas fa-file-export"></i> Generar Informe Completo
                        </button>
                    </div>
                </div>

                <!-- Métricas de Productividad -->
                <div class="dashboard-stats">
                    <div class="stat-card" onclick="generarInforme('diario')">
                        <div class="stat-icon tasks">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">Diario</div>
                            <div class="stat-label">Informe del Día</div>
                        </div>
                    </div>

                    <div class="stat-card" onclick="generarInforme('semanal')">
                        <div class="stat-icon events">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">Semanal</div>
                            <div class="stat-label">Resumen Semanal</div>
                        </div>
                    </div>

                    <div class="stat-card" onclick="generarInforme('mensual')">
                        <div class="stat-icon bitacoras">
                            <i class="fas fa-calendar-month"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">Mensual</div>
                            <div class="stat-label">Reporte Mensual</div>
                        </div>
                    </div>

                    <div class="stat-card" onclick="exportAllData()">
                        <div class="stat-icon productivity">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-number">Exportar</div>
                            <div class="stat-label">Todos los Datos</div>
                        </div>
                    </div>
                </div>

                <!-- Configuración de Informes Automáticos -->
                <div class="calendar-container mt-4">
                    <div class="p-4">
                        <h3 class="section-title mb-3">
                            <i class="fas fa-cogs"></i>
                            Informe Automático de las 8 AM
                        </h3>
                        
                        <div class="form-group">
                            <label class="form-label">
                                Activar informe automático diario
                                <span class="required">*</span>
                            </label>
                            <div class="d-flex align-items-center gap-2 mt-1">
                                <label class="switch">
                                    <input type="checkbox" id="autoReportToggle" checked>
                                    <span class="slider"></span>
                                </label>
                                <span id="reportStatus" class="text-success">
                                    <i class="fas fa-check-circle"></i> Activado
                                </span>
                            </div>
                            <small class="text-muted">El sistema generará y enviará automáticamente un informe diario a las 8:00 AM</small>
                        </div>

                        <div class="form-group mt-3">
                            <label class="form-label">Correos destinatarios</label>
                            <input type="text" class="form-control" id="reportRecipients" 
                                   placeholder="correo@ejemplo.com, otro@ejemplo.com"
                                   value="asesor@mep.go.cr, supervisor@mep.go.cr">
                        </div>

                        <div class="d-flex gap-2 mt-3">
                            <button class="btn btn-primary" onclick="testAutoReport()">
                                <i class="fas fa-play-circle"></i> Probar Ahora
                            </button>
                            <button class="btn btn-success" onclick="generatePDFReport()">
                                <i class="fas fa-file-pdf"></i> Generar PDF
                            </button>
                            <button class="btn btn-secondary" onclick="saveReportConfig()">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ENLACES RÁPIDOS -->
            <section id="enlaces" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-link"></i>
                        Enlaces Rápidos
                    </h2>
                    <button class="btn btn-primary" onclick="openLinkModal()">
                        <i class="fas fa-plus"></i> Agregar Enlace
                    </button>
                </div>

                <div class="dashboard-quick-actions" id="enlacesGrid">
                    <!-- Enlaces se cargan dinámicamente -->
                </div>
            </section>

            <!-- CONFIGURACIÓN -->
            <section id="configuracion" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i>
                        Configuración del Sistema
                    </h2>
                </div>

                <div class="calendar-container">
                    <div class="p-4">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Tema del sistema</label>
                                <select class="form-control" id="themeSelect" onchange="changeTheme()">
                                    <option value="light">Claro</option>
                                    <option value="dark">Oscuro</option>
                                    <option value="auto">Automático</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Idioma</label>
                                <select class="form-control" id="languageSelect">
                                    <option value="es">Español</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Notificaciones</label>
                            <div class="d-flex flex-column gap-1 mt-1">
                                <label class="form-check">
                                    <input type="checkbox" class="form-check-input" id="notifyTasks" checked>
                                    <span class="form-check-label">Recordatorios de tareas</span>
                                </label>
                                <label class="form-check">
                                    <input type="checkbox" class="form-check-input" id="notifyEvents" checked>
                                    <span class="form-check-label">Recordatorios de eventos</span>
                                </label>
                                <label class="form-check">
                                    <input type="checkbox" class="form-check-input" id="notifyReports" checked>
                                    <span class="form-check-label">Informes automáticos</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group mt-3">
                            <label class="form-label">Copia de seguridad automática</label>
                            <select class="form-control" id="backupFrequency">
                                <option value="daily">Diariamente</option>
                                <option value="weekly">Semanalmente</option>
                                <option value="monthly">Mensualmente</option>
                                <option value="never">Nunca</option>
                            </select>
                        </div>

                        <div class="d-flex gap-2 mt-4">
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Guardar Configuración
                            </button>
                            <button class="btn btn-secondary" onclick="resetSettings()">
                                <i class="fas fa-undo"></i> Restablecer
                            </button>
                            <button class="btn btn-danger" onclick="clearAllData()">
                                <i class="fas fa-trash"></i> Borrar Datos
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALES COMPLETOS Y FUNCIONALES -->
    <!-- Modal para Tareas (COMPLETO) -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="taskModalTitle">
                    <i class="fas fa-tasks"></i> Nueva Tarea
                </h3>
                <button class="modal-close" onclick="closeModal('taskModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="taskForm" onsubmit="saveTask(); return false;">
                    <input type="hidden" id="taskId" value="">
                    
                    <div class="form-group">
                        <label class="form-label">
                            Título de la tarea
                            <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="taskTitle" 
                               placeholder="Ingrese el título de la tarea" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="taskDescription" rows="3" 
                                  placeholder="Describa la tarea en detalle..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Prioridad</label>
                            <select class="form-control" id="taskPriority" required>
                                <option value="alta">Alta</option>
                                <option value="media" selected>Media</option>
                                <option value="baja">Baja</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Estado</label>
                            <select class="form-control" id="taskStatus" required>
                                <option value="pendiente">Pendiente</option>
                                <option value="en-proceso">En proceso</option>
                                <option value="completada">Completada</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fecha de inicio</label>
                            <input type="date" class="form-control" id="taskStartDate" 
                                   value="<?php echo date('Y-m-d'); ?>">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fecha límite</label>
                            <input type="date" class="form-control" id="taskDueDate" 
                                   value="<?php echo date('Y-m-d', strtotime('+7 days')); ?>">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Categorías</label>
                        <div class="d-flex flex-wrap gap-1">
                            <span class="badge cursor-pointer" onclick="toggleTag('urgente')">Urgente</span>
                            <span class="badge cursor-pointer" onclick="toggleTag('informe')">Informe</span>
                            <span class="badge cursor-pointer" onclick="toggleTag('reunion')">Reunión</span>
                            <span class="badge cursor-pointer" onclick="toggleTag('seguimiento')">Seguimiento</span>
                            <span class="badge cursor-pointer" onclick="toggleTag('planificacion')">Planificación</span>
                        </div>
                        <input type="text" class="form-control mt-2" id="taskTags" 
                               placeholder="Otras etiquetas (separadas por comas)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Recordatorio</label>
                        <select class="form-control" id="taskReminder">
                            <option value="">Sin recordatorio</option>
                            <option value="15">15 minutos antes</option>
                            <option value="30">30 minutos antes</option>
                            <option value="60">1 hora antes</option>
                            <option value="1440">1 día antes</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('taskModal')">
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="saveTask()">
                    <i class="fas fa-save"></i> Guardar Tarea
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Eventos (COMPLETO) -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="eventModalTitle">
                    <i class="fas fa-calendar-plus"></i> Nuevo Evento
                </h3>
                <button class="modal-close" onclick="closeModal('eventModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="eventForm" onsubmit="saveEvent(); return false;">
                    <input type="hidden" id="eventId" value="">
                    
                    <div class="form-group">
                        <label class="form-label">
                            Título del evento
                            <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="eventTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tipo de evento</label>
                        <select class="form-control" id="eventType">
                            <option value="reunion">Reunión</option>
                            <option value="informe">Informe</option>
                            <option value="teletrabajo">Teletrabajo</option>
                            <option value="oficina">Oficina</option>
                            <option value="capacitacion">Capacitación</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                Fecha y hora de inicio
                                <span class="required">*</span>
                            </label>
                            <input type="datetime-local" class="form-control" id="eventStart" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Fecha y hora de fin
                                <span class="required">*</span>
                            </label>
                            <input type="datetime-local" class="form-control" id="eventEnd" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción</label>
                        <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ubicación / Enlace</label>
                        <input type="text" class="form-control" id="eventLocation" 
                               placeholder="Sala de reuniones o enlace de videoconferencia">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Recordatorio</label>
                        <select class="form-control" id="eventReminder">
                            <option value="none">Sin recordatorio</option>
                            <option value="5">5 minutos antes</option>
                            <option value="15" selected>15 minutos antes</option>
                            <option value="30">30 minutos antes</option>
                            <option value="60">1 hora antes</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Color del evento</label>
                        <div class="d-flex gap-1">
                            <div class="color-option" data-color="#4361ee" onclick="selectEventColor('#4361ee')"></div>
                            <div class="color-option" data-color="#7209b7" onclick="selectEventColor('#7209b7')"></div>
                            <div class="color-option" data-color="#4cc9f0" onclick="selectEventColor('#4cc9f0')"></div>
                            <div class="color-option" data-color="#4ade80" onclick="selectEventColor('#4ade80')"></div>
                            <div class="color-option" data-color="#f59e0b" onclick="selectEventColor('#f59e0b')"></div>
                        </div>
                        <input type="hidden" id="eventColor" value="#4361ee">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('eventModal')">
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="saveEvent()">
                    <i class="fas fa-save"></i> Guardar Evento
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Bitácoras Diarias (COMPLETO) -->
    <div class="modal" id="bitacoraModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="bitacoraModalTitle">
                    <i class="fas fa-file-alt"></i> Bitácora Diaria
                </h3>
                <button class="modal-close" onclick="closeModal('bitacoraModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="bitacoraForm" onsubmit="saveBitacora(); return false;">
                    <input type="hidden" id="bitacoraId" value="">
                    <input type="hidden" id="bitacoraTipo" value="diaria">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                Fecha
                                <span class="required">*</span>
                            </label>
                            <input type="date" class="form-control" id="bitacoraFecha" required 
                                   value="<?php echo date('Y-m-d'); ?>">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                Modalidad
                                <span class="required">*</span>
                            </label>
                            <select class="form-control" id="bitacoraModalidad" required>
                                <option value="teletrabajo">Teletrabajo</option>
                                <option value="oficina">Oficina</option>
                                <option value="hibrido">Híbrido</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            Actividades realizadas
                            <span class="required">*</span>
                        </label>
                        <textarea class="form-control" id="bitacoraActividades" rows="4" required
                                  placeholder="Describa las actividades realizadas durante el día, separadas por punto y aparte..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                Horas invertidas
                                <span class="required">*</span>
                            </label>
                            <input type="number" class="form-control" id="bitacoraHoras" 
                                   min="0" max="24" step="0.5" required value="8">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nivel de productividad</label>
                            <select class="form-control" id="bitacoraProductividad">
                                <option value="alta">Alta</option>
                                <option value="media" selected>Media</option>
                                <option value="baja">Baja</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observaciones y comentarios</label>
                        <textarea class="form-control" id="bitacoraObservaciones" rows="3"
                                  placeholder="Observaciones adicionales, dificultades encontradas, logros, etc."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Archivos adjuntos</label>
                        <div class="file-upload">
                            <input type="file" id="bitacoraFiles" multiple style="display: none;">
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('bitacoraFiles').click()">
                                <i class="fas fa-paperclip"></i> Adjuntar archivos
                            </button>
                            <div id="fileList" class="mt-2"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('bitacoraModal')">
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="saveBitacora()">
                    <i class="fas fa-save"></i> Guardar Bitácora
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Plan Semanal (COMPLETO) -->
    <div class="modal" id="weeklyPlanModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-calendar-week"></i> Planificación Semanal
                </h3>
                <button class="modal-close" onclick="closeModal('weeklyPlanModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="date-range-selector">
                    <div class="date-range-input">
                        <label class="form-label">Semana del:</label>
                        <input type="date" class="form-control" id="weekStartDate" 
                               value="<?php echo date('Y-m-d', strtotime('monday this week')); ?>">
                    </div>
                    <div class="date-range-input">
                        <label class="form-label">al:</label>
                        <input type="date" class="form-control" id="weekEndDate" 
                               value="<?php echo date('Y-m-d', strtotime('sunday this week')); ?>" readonly>
                    </div>
                </div>
                
                <div class="week-days-grid mt-3" id="weeklyPlanDays">
                    <!-- Días de la semana se cargan dinámicamente -->
                </div>
                
                <div class="form-group mt-3">
                    <label class="form-label">Objetivos principales de la semana</label>
                    <textarea class="form-control" id="weeklyPlanObjectives" rows="3"
                              placeholder="¿Cuáles son los objetivos principales que deseas alcanzar esta semana?"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Recursos necesarios</label>
                    <textarea class="form-control" id="weeklyPlanResources" rows="2"
                              placeholder="¿Qué recursos necesitas para cumplir con estos objetivos?"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Métrica de éxito</label>
                    <input type="text" class="form-control" id="weeklyPlanMetric"
                           placeholder="¿Cómo medirás el éxito de esta semana?">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('weeklyPlanModal')">
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="saveWeeklyPlanModal()">
                    <i class="fas fa-save"></i> Guardar Plan Semanal
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Enlaces (COMPLETO) -->
    <div class="modal" id="linkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-link"></i> Agregar Enlace Rápido
                </h3>
                <button class="modal-close" onclick="closeModal('linkModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="linkForm" onsubmit="saveLink(); return false;">
                    <div class="form-group">
                        <label class="form-label">
                            URL del enlace
                            <span class="required">*</span>
                        </label>
                        <input type="url" class="form-control" id="linkUrl" required
                               placeholder="https://ejemplo.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nombre del enlace</label>
                        <input type="text" class="form-control" id="linkName" 
                               placeholder="Dejar en blanco para auto-detectar">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Categoría</label>
                        <select class="form-control" id="linkCategory">
                            <option value="trabajo">Trabajo</option>
                            <option value="comunicacion">Comunicación</option>
                            <option value="herramientas">Herramientas</option>
                            <option value="recursos">Recursos</option>
                            <option value="personal">Personal</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Icono personalizado</label>
                        <div class="d-flex align-items-center gap-2">
                            <div id="iconPreview" style="font-size: 1.5rem; color: var(--primary-color);">
                                <i class="fas fa-external-link-alt"></i>
                            </div>
                            <input type="text" class="form-control flex-1" id="linkIcon" 
                                   placeholder="fas fa-envelope (clase de FontAwesome)">
                        </div>
                        <small class="text-muted">Deja en blanco para auto-detectar el icono</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Color del icono</label>
                        <input type="color" class="form-control" id="linkColor" value="#4361ee" style="height: 40px;">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('linkModal')">
                    Cancelar
                </button>
                <button class="btn btn-primary" onclick="saveLink()">
                    <i class="fas fa-plus"></i> Agregar Enlace
                </button>
            </div>
        </div>
    </div>

    <!-- ESTILOS ADICIONALES PARA MODALES -->
    <style>
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-fast);
        }
        
        .color-option:hover {
            transform: scale(1.1);
            border-color: var(--border-color);
        }
        
        .color-option.selected {
            border-color: var(--text-primary);
            transform: scale(1.2);
        }
        
        .color-option[data-color="#4361ee"] { background-color: #4361ee; }
        .color-option[data-color="#7209b7"] { background-color: #7209b7; }
        .color-option[data-color="#4cc9f0"] { background-color: #4cc9f0; }
        .color-option[data-color="#4ade80"] { background-color: #4ade80; }
        .color-option[data-color="#f59e0b"] { background-color: #f59e0b; }
        
        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            text-align: center;
            transition: all var(--transition-fast);
        }
        
        .file-upload:hover {
            border-color: var(--primary-color);
            background: var(--bg-secondary);
        }
        
        .file-list {
            margin-top: var(--spacing-md);
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-sm);
        }
        
        .file-name {
            font-size: 0.9rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .file-size {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .tag-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .tag {
            padding: 0.25rem 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .tag:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .tag.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: transparent;
        }
    </style>

    <script>
        // ==============================================
        // SISTEMA INTEGRAL DRTE MEP v4.0
        // SISTEMA COMPLETO Y 100% FUNCIONAL
        // ==============================================

        // CLASE PRINCIPAL DEL SISTEMA
        class SistemaDRTE {
            constructor() {
                this.initialize();
            }
            
            initialize() {
                console.log('🚀 Inicializando Sistema DRTE MEP v4.0...');
                
                // Cargar todos los datos
                this.loadAllData();
                
                // Configurar fecha y hora en tiempo real
                this.startRealTimeClock();
                
                // Inicializar todos los componentes
                this.initEventListeners();
                this.initAssistant();
                this.initCalendar();
                this.initDashboard();
                this.initTasks();
                this.initBitacoras();
                this.initEnlaces();
                
                // Configurar sistema de notificaciones
                this.initNotifications();
                
                // Cargar datos iniciales
                this.loadInitialData();
                
                // Configurar informe automático
                this.setupAutoReport();
                
                // Actualizar dashboard en tiempo real
                this.startDashboardUpdates();
                
                console.log('✅ Sistema DRTE MEP v4.0 inicializado correctamente');
            }
            
            loadAllData() {
                // Cargar datos desde localStorage o usar valores por defecto
                this.tareas = JSON.parse(localStorage.getItem('drte_tareas')) || this.getDefaultTasks();
                this.eventos = JSON.parse(localStorage.getItem('drte_eventos')) || this.getDefaultEvents();
                this.bitacoras = JSON.parse(localStorage.getItem('drte_bitacoras')) || this.getDefaultBitacoras();
                this.enlaces = JSON.parse(localStorage.getItem('drte_enlaces')) || this.getDefaultLinks();
                this.planesSemanales = JSON.parse(localStorage.getItem('drte_planes_semanales')) || [];
                this.configuracion = JSON.parse(localStorage.getItem('drte_config')) || this.getDefaultConfig();
                
                console.log('📊 Datos cargados:', {
                    tareas: this.tareas.length,
                    eventos: this.eventos.length,
                    bitacoras: this.bitacoras.length,
                    enlaces: this.enlaces.length,
                    planesSemanales: this.planesSemanales.length
                });
            }
            
            getDefaultTasks() {
                return [
                    {
                        id: 1,
                        titulo: "Revisar y aprobar informes mensuales del departamento",
                        descripcion: "Revisar los informes mensuales presentados por los coordinadores y emitir aprobación",
                        prioridad: "alta",
                        estado: "pendiente",
                        fechaCreacion: "2026-01-15",
                        fechaInicio: "2026-01-15",
                        fechaLimite: "2026-01-20",
                        etiquetas: ["informe", "revision", "urgente", "aprobacion"],
                        recordatorio: "1440",
                        completada: false,
                        tiempoEstimado: 4,
                        tiempoReal: 0
                    },
                    {
                        id: 2,
                        titulo: "Preparar presentación para reunión de coordinación",
                        descripcion: "Elaborar presentación con los indicadores de gestión del trimestre",
                        prioridad: "media",
                        estado: "en-proceso",
                        fechaCreacion: "2026-01-14",
                        fechaInicio: "2026-01-14",
                        fechaLimite: "2026-01-18",
                        etiquetas: ["presentacion", "reunion", "coordinacion"],
                        recordatorio: "60",
                        completada: false,
                        tiempoEstimado: 6,
                        tiempoReal: 3
                    },
                    {
                        id: 3,
                        titulo: "Actualizar base de datos de contactos institucionales",
                        descripcion: "Verificar y actualizar los contactos de todas las instituciones colaboradoras",
                        prioridad: "baja",
                        estado: "pendiente",
                        fechaCreacion: "2026-01-10",
                        fechaInicio: "2026-01-10",
                        fechaLimite: "2026-01-31",
                        etiquetas: ["base de datos", "contactos", "actualizacion"],
                        recordatorio: "",
                        completada: false,
                        tiempoEstimado: 8,
                        tiempoReal: 0
                    }
                ];
            }
            
            getDefaultEvents() {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                return [
                    {
                        id: 1,
                        titulo: "Reunión de planificación trimestral",
                        tipo: "reunion",
                        inicio: `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}T09:00`,
                        fin: `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}T11:00`,
                        descripcion: "Reunión con el equipo para planificar actividades del próximo trimestre",
                        ubicacion: "Sala de reuniones principal",
                        recordatorio: "15",
                        color: "#4361ee",
                        completado: false
                    },
                    {
                        id: 2,
                        titulo: "Entrega de informe de gestión",
                        tipo: "informe",
                        inicio: `${tomorrow.getFullYear()}-${String(tomorrow.getMonth()+1).padStart(2,'0')}-${String(tomorrow.getDate()).padStart(2,'0')}T14:00`,
                        fin: `${tomorrow.getFullYear()}-${String(tomorrow.getMonth()+1).padStart(2,'0')}-${String(tomorrow.getDate()).padStart(2,'0')}T16:00`,
                        descripcion: "Presentación del informe de gestión mensual ante la dirección",
                        ubicacion: "Oficina del Director",
                        recordatorio: "30",
                        color: "#4ade80",
                        completado: false
                    }
                ];
            }
            
            getDefaultBitacoras() {
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                return [
                    {
                        id: 1,
                        tipo: "diaria",
                        fecha: yesterday.toISOString().split('T')[0],
                        modalidad: "teletrabajo",
                        actividades: "1. Revisión de informes pendientes\n2. Reunión con equipo de coordinación\n3. Elaboración de presentación ejecutiva\n4. Respuesta a correos institucionales",
                        horas: 7.5,
                        productividad: "media",
                        observaciones: "Avance satisfactorio en todas las actividades programadas",
                        archivos: []
                    },
                    {
                        id: 2,
                        tipo: "diaria",
                        fecha: today.toISOString().split('T')[0],
                        modalidad: "oficina",
                        actividades: "1. Reunión de planificación estratégica\n2. Revisión de presupuesto del departamento\n3. Capacitación en nueva plataforma institucional\n4. Seguimiento a proyectos en ejecución",
                        horas: 8,
                        productividad: "alta",
                        observaciones: "",
                        archivos: []
                    }
                ];
            }
            
            getDefaultLinks() {
                return [
                    {
                        id: 1,
                        nombre: "Outlook MEP",
                        url: "https://outlook.office.com",
                        icono: "fas fa-envelope",
                        categoria: "comunicacion",
                        color: "#4361ee"
                    },
                    {
                        id: 2,
                        nombre: "Microsoft Teams",
                        url: "https://teams.microsoft.com",
                        icono: "fas fa-users",
                        categoria: "comunicacion",
                        color: "#7209b7"
                    },
                    {
                        id: 3,
                        nombre: "Portal MEP Oficial",
                        url: "https://www.mep.go.cr",
                        icono: "fas fa-graduation-cap",
                        categoria: "trabajo",
                        color: "#4cc9f0"
                    },
                    {
                        id: 4,
                        nombre: "Google Drive",
                        url: "https://drive.google.com",
                        icono: "fab fa-google-drive",
                        categoria: "herramientas",
                        color: "#4ade80"
                    },
                    {
                        id: 5,
                        nombre: "Symbaloo",
                        url: "https://www.symbaloo.com",
                        icono: "fas fa-th",
                        categoria: "herramientas",
                        color: "#f59e0b"
                    },
                    {
                        id: 6,
                        nombre: "Microsoft Copilot",
                        url: "https://copilot.microsoft.com",
                        icono: "fas fa-robot",
                        categoria: "herramientas",
                        color: "#8b5cf6"
                    }
                ];
            }
            
            getDefaultConfig() {
                return {
                    tema: "light",
                    idioma: "es",
                    notificaciones: {
                        tareas: true,
                        eventos: true,
                        informes: true
                    },
                    backup: "weekly",
                    autoReport: {
                        enabled: true,
                        time: "08:00",
                        recipients: "asesor@mep.go.cr, supervisor@mep.go.cr",
                        format: "pdf"
                    },
                    dashboard: {
                        autoRefresh: true,
                        showMetrics: true,
                        showRecent: true
                    }
                };
            }
            
            saveAllData() {
                try {
                    localStorage.setItem('drte_tareas', JSON.stringify(this.tareas));
                    localStorage.setItem('drte_eventos', JSON.stringify(this.eventos));
                    localStorage.setItem('drte_bitacoras', JSON.stringify(this.bitacoras));
                    localStorage.setItem('drte_enlaces', JSON.stringify(this.enlaces));
                    localStorage.setItem('drte_planes_semanales', JSON.stringify(this.planesSemanales));
                    localStorage.setItem('drte_config', JSON.stringify(this.configuracion));
                    
                    console.log('💾 Datos guardados correctamente');
                    return true;
                } catch (error) {
                    console.error('❌ Error guardando datos:', error);
                    this.showNotification('Error al guardar los datos', 'error');
                    return false;
                }
            }
            
            startRealTimeClock() {
                // Actualizar reloj en tiempo real
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
                
                // Actualizar fecha en tiempo real
                this.updateDate();
                setInterval(() => this.updateDate(), 60000);
            }
            
            updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('es-ES', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                // Actualizar en el dashboard
                const dashboardTime = document.getElementById('currentDashboardTime');
                if (dashboardTime) {
                    dashboardTime.textContent = timeString;
                }
                
                // Actualizar en el asistente
                const assistantTime = document.getElementById('currentTime');
                if (assistantTime) {
                    assistantTime.textContent = timeString.split(':').slice(0, 2).join(':');
                }
            }
            
            updateDate() {
                const now = new Date();
                const dateString = now.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Actualizar en el dashboard
                const dashboardDate = document.getElementById('currentDashboardDate');
                if (dashboardDate) {
                    dashboardDate.textContent = dateString;
                }
                
                // Actualizar saludo dinámico
                this.updateWelcomeMessage();
            }
            
            updateWelcomeMessage() {
                const now = new Date();
                const hour = now.getHours();
                let greeting = "";
                
                if (hour < 12) {
                    greeting = "¡Buenos días";
                } else if (hour < 19) {
                    greeting = "¡Buenas tardes";
                } else {
                    greeting = "¡Buenas noches";
                }
                
                // Agregar nombre del usuario
                greeting += ", Asesor Nacional!";
                
                // Actualizar título
                const welcomeTitle = document.getElementById('welcomeTitle');
                if (welcomeTitle) {
                    welcomeTitle.textContent = greeting;
                }
                
                // Actualizar mensaje según la hora
                let message = "";
                if (hour < 12) {
                    message = "Esperamos que tengas un día productivo. Aquí tienes un resumen de tus actividades.";
                } else if (hour < 15) {
                    message = "Esperamos que tu jornada esté siendo productiva. Revisa tus tareas pendientes.";
                } else if (hour < 19) {
                    message = "Finaliza tu día de manera productiva. Revisa lo que has logrado hoy.";
                } else {
                    message = "Tu día de trabajo ha terminado. Revisa tus logros y planifica para mañana.";
                }
                
                const welcomeMessage = document.getElementById('welcomeMessage');
                if (welcomeMessage) {
                    welcomeMessage.textContent = message;
                }
            }
            
            initEventListeners() {
                console.log('🎯 Configurando event listeners...');
                
                // Navegación principal
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.getAttribute('data-section');
                        this.navigateTo(section);
                    });
                });
                
                // Botón menú móvil
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                if (mobileMenuBtn) {
                    mobileMenuBtn.addEventListener('click', () => {
                        this.toggleMobileMenu();
                    });
                }
                
                // Cerrar menú al hacer clic fuera
                document.addEventListener('click', (e) => {
                    const sidebar = document.getElementById('sidebar');
                    const menuBtn = document.getElementById('mobileMenuBtn');
                    
                    if (sidebar && menuBtn && !sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
                        sidebar.classList.remove('active');
                    }
                });
                
                // Scroll del header
                window.addEventListener('scroll', () => {
                    this.handleHeaderScroll();
                });
                
                // Selección de fechas en plan semanal
                const weekStartDate = document.getElementById('weekStartDate');
                if (weekStartDate) {
                    weekStartDate.addEventListener('change', () => {
                        this.updateWeekEndDate();
                        this.loadWeeklyPlan();
                    });
                }
                
                console.log('✅ Event listeners configurados');
            }
            
            toggleMobileMenu() {
                const sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    sidebar.classList.toggle('active');
                }
            }
            
            handleHeaderScroll() {
                const header = document.getElementById('mainHeader');
                if (header) {
                    if (window.scrollY > 10) {
                        header.classList.add('scrolled');
                    } else {
                        header.classList.remove('scrolled');
                    }
                }
            }
            
            navigateTo(section) {
                console.log(`📍 Navegando a: ${section}`);
                
                // Actualizar navegación activa
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeNav = document.querySelector(`[data-section="${section}"]`);
                if (activeNav) {
                    activeNav.classList.add('active');
                }
                
                // Ocultar todas las secciones
                document.querySelectorAll('.content-section').forEach(sec => {
                    sec.classList.remove('active');
                });
                
                // Mostrar sección seleccionada
                const targetSection = document.getElementById(section);
                if (targetSection) {
                    targetSection.classList.add('active');
                    
                    // Cargar datos específicos de la sección
                    switch(section) {
                        case 'dashboard':
                            this.updateDashboard();
                            break;
                        case 'calendario':
                            this.renderCalendar();
                            break;
                        case 'tareas':
                            this.renderTasks();
                            break;
                        case 'bitacoras':
                            this.renderBitacoras();
                            this.loadWeeklyPlan();
                            break;
                        case 'enlaces':
                            this.renderEnlaces();
                            break;
                        case 'informes':
                            this.renderInformes();
                            break;
                        case 'configuracion':
                            this.loadSettings();
                            break;
                    }
                }
                
                // Cerrar menú en móvil
                this.toggleMobileMenu();
            }
            
            initDashboard() {
                console.log('📊 Inicializando dashboard...');
                
                // Actualizar estadísticas iniciales
                this.updateDashboardStats();
                
                // Cargar actividad reciente
                this.loadRecentActivity();
                
                // Iniciar actualizaciones automáticas
                if (this.configuracion.dashboard?.autoRefresh) {
                    setInterval(() => {
                        this.updateDashboardStats();
                        this.loadRecentActivity();
                    }, 30000); // Actualizar cada 30 segundos
                }
                
                // Configurar botones de acción rápida
                this.setupQuickActions();
                
                console.log('✅ Dashboard inicializado');
            }
            
            updateDashboardStats() {
                console.log('📈 Actualizando estadísticas del dashboard...');
                
                // Calcular estadísticas
                const tareasPendientes = this.tareas.filter(t => 
                    t.estado !== 'completada' && !t.completada
                ).length;
                
                const hoy = new Date().toISOString().split('T')[0];
                const eventosHoy = this.eventos.filter(e => 
                    e.inicio.startsWith(hoy)
                ).length;
                
                const totalBitacoras = this.bitacoras.filter(b => 
                    b.tipo === 'diaria'
                ).length;
                
                // Calcular productividad
                const tareasCompletadas = this.tareas.filter(t => 
                    t.estado === 'completada' || t.completada
                ).length;
                const productividad = this.tareas.length > 0 
                    ? Math.round((tareasCompletadas / this.tareas.length) * 100) 
                    : 0;
                
                // Actualizar UI
                this.updateElementText('totalTareas', tareasPendientes);
                this.updateElementText('eventosHoy', eventosHoy);
                this.updateElementText('totalBitacoras', totalBitacoras);
                this.updateElementText('productividad', `${productividad}%`);
                this.updateElementText('pendingTasksBadge', tareasPendientes);
                
                // Actualizar barras de progreso
                this.updateProgressBar('tasksProgress', (tareasPendientes / Math.max(this.tareas.length, 1)) * 100);
                this.updateProgressBar('eventsProgress', (eventosHoy / 10) * 100); // Máximo 10 eventos
                this.updateProgressBar('bitacorasProgress', (totalBitacoras / 30) * 100); // Máximo 30 bitácoras
                this.updateProgressBar('productivityProgress', productividad);
                
                console.log('📊 Estadísticas actualizadas:', {
                    tareasPendientes,
                    eventosHoy,
                    totalBitacoras,
                    productividad
                });
            }
            
            updateElementText(elementId, text) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = text;
                }
            }
            
            updateProgressBar(elementId, percentage) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.style.width = `${Math.min(100, Math.max(0, percentage))}%`;
                }
            }
            
            loadRecentActivity() {
                const container = document.getElementById('recentActivityList');
                if (!container) return;
                
                // Combinar todas las actividades
                const activities = [];
                
                // Agregar tareas recientes
                this.tareas.slice(0, 3).forEach(tarea => {
                    activities.push({
                        type: 'task',
                        title: tarea.titulo,
                        time: tarea.fechaCreacion,
                        status: tarea.estado,
                        priority: tarea.prioridad
                    });
                });
                
                // Agregar eventos recientes
                this.eventos.slice(0, 2).forEach(evento => {
                    activities.push({
                        type: 'event',
                        title: evento.titulo,
                        time: evento.inicio,
                        typeEvent: evento.tipo
                    });
                });
                
                // Agregar bitácoras recientes
                this.bitacoras.slice(0, 2).forEach(bitacora => {
                    activities.push({
                        type: 'bitacora',
                        title: `Bitácora ${bitacora.fecha}`,
                        time: bitacora.fecha,
                        modality: bitacora.modalidad
                    });
                });
                
                // Ordenar por fecha (más recientes primero)
                activities.sort((a, b) => new Date(b.time) - new Date(a.time));
                
                // Renderizar
                container.innerHTML = '';
                activities.slice(0, 5).forEach(activity => {
                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    
                    let icon = '';
                    let content = '';
                    
                    switch(activity.type) {
                        case 'task':
                            icon = `<div class="activity-icon" style="background: ${this.getPriorityColor(activity.priority)}">
                                       <i class="fas fa-tasks"></i>
                                    </div>`;
                            content = `
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-time">Tarea · ${activity.status} · ${this.formatDate(activity.time)}</div>
                            `;
                            break;
                            
                        case 'event':
                            icon = `<div class="activity-icon" style="background: ${this.getEventTypeColor(activity.typeEvent)}">
                                       <i class="fas fa-calendar"></i>
                                    </div>`;
                            content = `
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-time">Evento · ${this.formatDateTime(activity.time)}</div>
                            `;
                            break;
                            
                        case 'bitacora':
                            icon = `<div class="activity-icon" style="background: var(--info-color)">
                                       <i class="fas fa-book"></i>
                                    </div>`;
                            content = `
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-time">Bitácora · ${activity.modality} · ${this.formatDate(activity.time)}</div>
                            `;
                            break;
                    }
                    
                    item.innerHTML = `
                        ${icon}
                        <div class="activity-content">
                            ${content}
                        </div>
                    `;
                    
                    container.appendChild(item);
                });
            }
            
            getPriorityColor(priority) {
                switch(priority) {
                    case 'alta': return 'var(--danger-color)';
                    case 'media': return 'var(--warning-color)';
                    case 'baja': return 'var(--success-color)';
                    default: return 'var(--primary-color)';
                }
            }
            
            getEventTypeColor(type) {
                switch(type) {
                    case 'reunion': return 'var(--primary-color)';
                    case 'informe': return 'var(--success-color)';
                    case 'teletrabajo': return 'var(--purple-color)';
                    case 'oficina': return 'var(--warning-color)';
                    case 'capacitacion': return 'var(--info-color)';
                    default: return 'var(--accent-color)';
                }
            }
            
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', {
                    day: 'numeric',
                    month: 'short'
                });
            }
            
            formatDateTime(dateTimeString) {
                const date = new Date(dateTimeString);
                return date.toLocaleString('es-ES', {
                    day: 'numeric',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            setupQuickActions() {
                // Los botones de acción rápida ya están configurados en el HTML
                console.log('⚡ Acciones rápidas configuradas');
            }
            
            initCalendar() {
                console.log('📅 Inicializando calendario...');
                
                // Configurar calendario inicial
                this.currentCalendarDate = new Date();
                this.calendarView = 'month'; // month, week, day
                
                // Renderizar calendario inicial
                this.renderCalendar();
                
                console.log('✅ Calendario inicializado');
            }
            
            renderCalendar() {
                console.log('🎨 Renderizando calendario...');
                
                const container = document.getElementById('calendarView');
                const title = document.getElementById('calendarTitle');
                
                if (!container || !title) return;
                
                // Limpiar contenedor
                container.innerHTML = '';
                container.className = 'calendar-grid';
                
                switch(this.calendarView) {
                    case 'month':
                        this.renderMonthView(container, title);
                        break;
                    case 'week':
                        this.renderWeekView(container, title);
                        break;
                    case 'day':
                        this.renderDayView(container, title);
                        break;
                }
                
                console.log('✅ Calendario renderizado');
            }
            
            renderMonthView(container, title) {
                // Configurar título
                const monthNames = [
                    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                ];
                title.textContent = `${monthNames[this.currentCalendarDate.getMonth()]} ${this.currentCalendarDate.getFullYear()}`;
                
                // Configurar grid para vista mensual
                container.classList.add('calendar-month');
                
                // Días de la semana
                const days = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
                days.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    container.appendChild(dayHeader);
                });
                
                // Calcular primer día del mes
                const firstDay = new Date(this.currentCalendarDate.getFullYear(), this.currentCalendarDate.getMonth(), 1);
                const lastDay = new Date(this.currentCalendarDate.getFullYear(), this.currentCalendarDate.getMonth() + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startDay = firstDay.getDay();
                
                // Días del mes anterior
                const prevMonthLastDay = new Date(this.currentCalendarDate.getFullYear(), this.currentCalendarDate.getMonth(), 0).getDate();
                for (let i = startDay - 1; i >= 0; i--) {
                    const day = document.createElement('div');
                    day.className = 'calendar-day other-month';
                    day.innerHTML = `<div class="day-number">${prevMonthLastDay - i}</div>`;
                    container.appendChild(day);
                }
                
                // Días del mes actual
                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDate = new Date(this.currentCalendarDate.getFullYear(), this.currentCalendarDate.getMonth(), day);
                    const isToday = currentDate.toDateString() === today.toDateString();
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    if (isToday) dayElement.classList.add('today');
                    
                    // Número del día
                    dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                    
                    // Eventos para este día
                    const dayEvents = this.getEventsForDate(currentDate);
                    dayEvents.forEach(event => {
                        const eventElement = document.createElement('div');
                        eventElement.className = `event-item event-${event.tipo}`;
                        eventElement.textContent = event.titulo;
                        eventElement.title = `${event.titulo}\n${new Date(event.inicio).toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}`;
                        eventElement.onclick = () => this.viewEventDetails(event.id);
                        dayElement.appendChild(eventElement);
                    });
                    
                    container.appendChild(dayElement);
                }
                
                // Días del próximo mes
                const totalCells = 42; // 6 semanas * 7 días
                const daysSoFar = startDay + daysInMonth;
                const nextMonthDays = totalCells - daysSoFar;
                
                for (let day = 1; day <= nextMonthDays; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day other-month';
                    dayElement.innerHTML = `<div class="day-number">${day}</div>`;
                    container.appendChild(dayElement);
                }
            }
            
            renderWeekView(container, title) {
                // Configurar título
                const weekStart = this.getWeekStartDate(this.currentCalendarDate);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 6);
                
                title.textContent = `Semana ${this.getWeekNumber(this.currentCalendarDate)} - ${weekStart.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })} al ${weekEnd.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}`;
                
                // Configurar grid para vista semanal
                container.classList.add('calendar-week');
                
                // Columna de horas
                const timeHeader = document.createElement('div');
                timeHeader.className = 'calendar-day-header';
                timeHeader.textContent = 'Hora';
                container.appendChild(timeHeader);
                
                // Días de la semana
                const days = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
                days.forEach((day, index) => {
                    const dayDate = new Date(weekStart);
                    dayDate.setDate(dayDate.getDate() + index);
                    
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.innerHTML = `
                        <div>${day}</div>
                        <div style="font-size: 1.2rem; font-weight: 700;">${dayDate.getDate()}</div>
                    `;
                    container.appendChild(dayHeader);
                });
                
                // Filas de horas (de 8:00 a 20:00)
                for (let hour = 8; hour <= 20; hour++) {
                    // Celda de hora
                    const timeCell = document.createElement('div');
                    timeCell.className = 'time-slot';
                    timeCell.innerHTML = `<div class="time-label">${hour}:00</div>`;
                    container.appendChild(timeCell);
                    
                    // Celdas para cada día
                    for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                        const dayDate = new Date(weekStart);
                        dayDate.setDate(dayDate.getDate() + dayIndex);
                        dayDate.setHours(hour, 0, 0, 0);
                        
                        const dayCell = document.createElement('div');
                        dayCell.className = 'time-slot';
                        
                        // Eventos para esta hora y día
                        const hourEvents = this.getEventsForDateAndHour(dayDate, hour);
                        hourEvents.forEach(event => {
                            const eventElement = document.createElement('div');
                            eventElement.className = 'week-event';
                            eventElement.style.background = event.color || '#4361ee';
                            eventElement.style.color = 'white';
                            eventElement.style.top = '5px';
                            eventElement.style.left = '5px';
                            eventElement.style.right = '5px';
                            eventElement.style.height = '50px';
                            eventElement.textContent = event.titulo;
                            eventElement.onclick = () => this.viewEventDetails(event.id);
                            dayCell.appendChild(eventElement);
                        });
                        
                        container.appendChild(dayCell);
                    }
                }
            }
            
            renderDayView(container, title) {
                // Configurar título
                title.textContent = this.currentCalendarDate.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Configurar grid para vista diaria
                container.classList.add('calendar-day-view');
                
                // Eventos del día
                const dayEvents = this.getEventsForDate(this.currentCalendarDate);
                
                if (dayEvents.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--text-muted);">
                            <i class="fas fa-calendar-day" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No hay eventos programados para hoy</h3>
                            <p>Agrega nuevos eventos para organizar tu día</p>
                            <button class="btn btn-primary mt-2" onclick="openEventModal()">
                                <i class="fas fa-plus"></i> Agregar Evento
                            </button>
                        </div>
                    `;
                } else {
                    dayEvents.sort((a, b) => new Date(a.inicio) - new Date(b.inicio));
                    
                    dayEvents.forEach(event => {
                        const eventElement = document.createElement('div');
                        eventElement.className = 'event-item';
                        eventElement.style.margin = '1rem';
                        eventElement.style.padding = '1.5rem';
                        eventElement.style.background = `${event.color}20`;
                        eventElement.style.borderLeft = `4px solid ${event.color}`;
                        
                        const startTime = new Date(event.inicio);
                        const endTime = new Date(event.fin);
                        
                        eventElement.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h4 style="margin: 0 0 0.5rem 0; color: var(--text-primary);">${event.titulo}</h4>
                                    <div style="display: flex; align-items: center; gap: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                                        <span><i class="far fa-clock"></i> ${startTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })} - ${endTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}</span>
                                        <span><i class="fas fa-map-marker-alt"></i> ${event.ubicacion || 'Sin ubicación'}</span>
                                    </div>
                                </div>
                                <span class="badge" style="background: ${event.color};">${event.tipo}</span>
                            </div>
                            ${event.descripcion ? `<p style="margin-top: 1rem; color: var(--text-secondary);">${event.descripcion}</p>` : ''}
                        `;
                        
                        eventElement.onclick = () => this.viewEventDetails(event.id);
                        container.appendChild(eventElement);
                    });
                }
            }
            
            getEventsForDate(date) {
                const dateString = date.toISOString().split('T')[0];
                return this.eventos.filter(event => 
                    event.inicio.startsWith(dateString)
                );
            }
            
            getEventsForDateAndHour(date, hour) {
                const dateString = date.toISOString().split('T')[0];
                return this.eventos.filter(event => {
                    const eventDate = new Date(event.inicio);
                    return event.inicio.startsWith(dateString) && eventDate.getHours() === hour;
                });
            }
            
            getWeekStartDate(date) {
                const day = date.getDay();
                const diff = date.getDate() - day;
                return new Date(date.setDate(diff));
            }
            
            getWeekNumber(date) {
                const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
                const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
                return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
            }
            
            changeCalendarView(view) {
                this.calendarView = view;
                
                // Actualizar botones activos
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeBtn = document.querySelector(`[data-view="${view}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
                
                // Renderizar nueva vista
                this.renderCalendar();
            }
            
            prevCalendarPeriod() {
                switch(this.calendarView) {
                    case 'month':
                        this.currentCalendarDate.setMonth(this.currentCalendarDate.getMonth() - 1);
                        break;
                    case 'week':
                        this.currentCalendarDate.setDate(this.currentCalendarDate.getDate() - 7);
                        break;
                    case 'day':
                        this.currentCalendarDate.setDate(this.currentCalendarDate.getDate() - 1);
                        break;
                }
                this.renderCalendar();
            }
            
            nextCalendarPeriod() {
                switch(this.calendarView) {
                    case 'month':
                        this.currentCalendarDate.setMonth(this.currentCalendarDate.getMonth() + 1);
                        break;
                    case 'week':
                        this.currentCalendarDate.setDate(this.currentCalendarDate.getDate() + 7);
                        break;
                    case 'day':
                        this.currentCalendarDate.setDate(this.currentCalendarDate.getDate() + 1);
                        break;
                }
                this.renderCalendar();
            }
            
            goToToday() {
                this.currentCalendarDate = new Date();
                this.renderCalendar();
            }
            
            viewEventDetails(eventId) {
                const event = this.eventos.find(e => e.id == eventId);
                if (event) {
                    const startTime = new Date(event.inicio);
                    const endTime = new Date(event.fin);
                    
                    let details = `EVENTO: ${event.titulo}\n\n`;
                    details += `📅 Fecha: ${startTime.toLocaleDateString('es-ES')}\n`;
                    details += `⏰ Hora: ${startTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })} - ${endTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}\n`;
                    details += `📍 Ubicación: ${event.ubicacion || 'No especificada'}\n`;
                    details += `📋 Tipo: ${event.tipo}\n`;
                    details += `🔔 Recordatorio: ${event.recordatorio === 'none' ? 'No' : `${event.recordatorio} minutos antes`}\n`;
                    
                    if (event.descripcion) {
                        details += `\n📝 Descripción:\n${event.descripcion}\n`;
                    }
                    
                    // Mostrar opciones
                    details += `\n¿Qué deseas hacer?\n`;
                    details += `1. Editar evento\n`;
                    details += `2. Eliminar evento\n`;
                    details += `3. Marcar como completado\n`;
                    details += `4. Cerrar`;
                    
                    const action = prompt(details, '4');
                    
                    switch(action) {
                        case '1':
                            this.openEventModal(eventId);
                            break;
                        case '2':
                            if (confirm('¿Estás seguro de eliminar este evento?')) {
                                this.deleteEvent(eventId);
                            }
                            break;
                        case '3':
                            event.completado = true;
                            this.saveAllData();
                            this.showNotification('Evento marcado como completado', 'success');
                            this.renderCalendar();
                            break;
                    }
                }
            }
            
            initTasks() {
                console.log('📋 Inicializando gestión de tareas...');
                
                // Renderizar tareas iniciales
                this.renderTasks();
                
                // Configurar filtros
                this.setupTaskFilters();
                
                console.log('✅ Gestión de tareas inicializada');
            }
            
            renderTasks(filter = 'all') {
                const container = document.getElementById('tasksContainer');
                if (!container) return;
                
                let filteredTasks = [...this.tareas];
                
                // Aplicar filtro
                switch(filter) {
                    case 'pending':
                        filteredTasks = filteredTasks.filter(t => 
                            t.estado === 'pendiente' && !t.completada
                        );
                        break;
                    case 'in-progress':
                        filteredTasks = filteredTasks.filter(t => 
                            t.estado === 'en-proceso'
                        );
                        break;
                    case 'completed':
                        filteredTasks = filteredTasks.filter(t => 
                            t.estado === 'completada' || t.completada
                        );
                        break;
                    case 'high':
                        filteredTasks = filteredTasks.filter(t => 
                            t.prioridad === 'alta'
                        );
                        break;
                    case 'today':
                        const today = new Date().toISOString().split('T')[0];
                        filteredTasks = filteredTasks.filter(t => 
                            t.fechaLimite === today
                        );
                        break;
                }
                
                // Ordenar por prioridad y fecha
                filteredTasks.sort((a, b) => {
                    const priorityOrder = { alta: 1, media: 2, baja: 3 };
                    if (priorityOrder[a.prioridad] !== priorityOrder[b.prioridad]) {
                        return priorityOrder[a.prioridad] - priorityOrder[b.prioridad];
                    }
                    return new Date(a.fechaLimite) - new Date(b.fechaLimite);
                });
                
                // Limpiar contenedor
                container.innerHTML = '';
                
                // Si no hay tareas
                if (filteredTasks.length === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                            <i class="fas fa-tasks" style="font-size: 3rem; color: var(--text-light); margin-bottom: 1rem;"></i>
                            <h4>No hay tareas</h4>
                            <p>${filter === 'all' ? 'Comienza agregando tu primera tarea' : 'No hay tareas con este filtro'}</p>
                            <button class="btn btn-primary mt-2" onclick="openTaskModal()">
                                <i class="fas fa-plus"></i> Crear tarea
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Renderizar cada tarea
                filteredTasks.forEach(task => {
                    const taskCard = this.createTaskCard(task);
                    container.appendChild(taskCard);
                });
            }
            
            createTaskCard(task) {
                const taskCard = document.createElement('div');
                taskCard.className = `task-card priority-${task.prioridad}`;
                
                // Configurar datos de la tarea
                const dueDate = task.fechaLimite ? 
                    new Date(task.fechaLimite).toLocaleDateString('es-ES') : 
                    'Sin fecha límite';
                
                const statusText = {
                    'pendiente': 'Pendiente',
                    'en-proceso': 'En proceso',
                    'completada': 'Completada'
                }[task.estado] || task.estado;
                
                const priorityText = {
                    'alta': 'Alta',
                    'media': 'Media',
                    'baja': 'Baja'
                }[task.prioridad] || task.prioridad;
                
                const priorityBadgeClass = {
                    'alta': 'priority-alta-badge',
                    'media': 'priority-media-badge',
                    'baja': 'priority-baja-badge'
                }[task.prioridad] || '';
                
                // Crear HTML de la tarjeta
                taskCard.innerHTML = `
                    <div class="task-header">
                        <h4 class="task-title">${task.titulo}</h4>
                        <span class="task-priority ${priorityBadgeClass}">${priorityText}</span>
                    </div>
                    
                    <p class="task-description">${task.descripcion || 'Sin descripción'}</p>
                    
                    ${task.etiquetas && task.etiquetas.length > 0 ? `
                        <div class="tag-selector mb-2">
                            ${task.etiquetas.map(tag => `
                                <span class="tag">${tag}</span>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="task-meta">
                        <div class="task-date">
                            <i class="far fa-calendar"></i>
                            <span>${dueDate}</span>
                            <span style="margin-left: 1rem;">
                                <i class="fas fa-flag"></i>
                                <span>${statusText}</span>
                            </span>
                        </div>
                        <div class="task-actions">
                            <button class="task-btn edit" onclick="editTask(${task.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="task-btn delete" onclick="deleteTask(${task.id})" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                            ${!task.completada ? `
                                <button class="task-btn complete" onclick="completeTask(${task.id})" title="Completar">
                                    <i class="fas fa-check"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                return taskCard;
            }
            
            setupTaskFilters() {
                const filterSelect = document.getElementById('taskFilter');
                if (filterSelect) {
                    filterSelect.addEventListener('change', (e) => {
                        this.renderTasks(e.target.value);
                    });
                }
            }
            
            openTaskModal(taskId = null) {
                const modal = document.getElementById('taskModal');
                const title = document.getElementById('taskModalTitle');
                const form = document.getElementById('taskForm');
                
                if (taskId) {
                    // Modo edición
                    const task = this.tareas.find(t => t.id == taskId);
                    if (task) {
                        title.innerHTML = `<i class="fas fa-edit"></i> Editar Tarea`;
                        document.getElementById('taskId').value = task.id;
                        document.getElementById('taskTitle').value = task.titulo;
                        document.getElementById('taskDescription').value = task.descripcion || '';
                        document.getElementById('taskPriority').value = task.prioridad;
                        document.getElementById('taskStatus').value = task.estado;
                        document.getElementById('taskStartDate').value = task.fechaInicio || '';
                        document.getElementById('taskDueDate').value = task.fechaLimite || '';
                        document.getElementById('taskTags').value = task.etiquetas ? task.etiquetas.join(', ') : '';
                        document.getElementById('taskReminder').value = task.recordatorio || '';
                    }
                } else {
                    // Modo creación
                    title.innerHTML = `<i class="fas fa-plus-circle"></i> Nueva Tarea`;
                    form.reset();
                    document.getElementById('taskId').value = '';
                    
                    // Establecer valores por defecto
                    const today = new Date().toISOString().split('T')[0];
                    const nextWeek = new Date();
                    nextWeek.setDate(nextWeek.getDate() + 7);
                    const nextWeekStr = nextWeek.toISOString().split('T')[0];
                    
                    document.getElementById('taskStartDate').value = today;
                    document.getElementById('taskDueDate').value = nextWeekStr;
                    document.getElementById('taskPriority').value = 'media';
                    document.getElementById('taskStatus').value = 'pendiente';
                }
                
                modal.classList.add('active');
            }
            
            saveTask() {
                console.log('💾 Guardando tarea...');
                
                const taskId = document.getElementById('taskId').value;
                const taskData = {
                    titulo: document.getElementById('taskTitle').value.trim(),
                    descripcion: document.getElementById('taskDescription').value.trim(),
                    prioridad: document.getElementById('taskPriority').value,
                    estado: document.getElementById('taskStatus').value,
                    fechaInicio: document.getElementById('taskStartDate').value,
                    fechaLimite: document.getElementById('taskDueDate').value,
                    recordatorio: document.getElementById('taskReminder').value,
                    etiquetas: document.getElementById('taskTags').value
                        .split(',')
                        .map(tag => tag.trim())
                        .filter(tag => tag)
                };
                
                // Validaciones
                if (!taskData.titulo) {
                    this.showNotification('El título de la tarea es requerido', 'error');
                    return;
                }
                
                if (taskData.fechaInicio && taskData.fechaLimite) {
                    if (new Date(taskData.fechaInicio) > new Date(taskData.fechaLimite)) {
                        this.showNotification('La fecha de inicio no puede ser posterior a la fecha límite', 'error');
                        return;
                    }
                }
                
                if (taskId) {
                    // Actualizar tarea existente
                    const index = this.tareas.findIndex(t => t.id == taskId);
                    if (index !== -1) {
                        // Mantener datos existentes
                        const existingTask = this.tareas[index];
                        taskData.id = existingTask.id;
                        taskData.fechaCreacion = existingTask.fechaCreacion;
                        taskData.completada = taskData.estado === 'completada' || existingTask.completada;
                        taskData.tiempoEstimado = existingTask.tiempoEstimado || 0;
                        taskData.tiempoReal = existingTask.tiempoReal || 0;
                        
                        this.tareas[index] = taskData;
                        console.log('✏️ Tarea actualizada:', taskData);
                    }
                } else {
                    // Crear nueva tarea
                    taskData.id = Date.now();
                    taskData.fechaCreacion = new Date().toISOString().split('T')[0];
                    taskData.completada = taskData.estado === 'completada';
                    taskData.tiempoEstimado = 0;
                    taskData.tiempoReal = 0;
                    
                    this.tareas.push(taskData);
                    console.log('🆕 Nueva tarea creada:', taskData);
                }
                
                // Guardar y actualizar
                if (this.saveAllData()) {
                    this.closeModal('taskModal');
                    this.renderTasks();
                    this.updateDashboardStats();
                    this.showNotification(
                        taskId ? 'Tarea actualizada correctamente' : 'Tarea creada correctamente',
                        'success'
                    );
                }
            }
            
            editTask(taskId) {
                this.openTaskModal(taskId);
            }
            
            deleteTask(taskId) {
                if (confirm('¿Estás seguro de eliminar esta tarea?')) {
                    this.tareas = this.tareas.filter(t => t.id != taskId);
                    
                    if (this.saveAllData()) {
                        this.renderTasks();
                        this.updateDashboardStats();
                        this.showNotification('Tarea eliminada correctamente', 'success');
                    }
                }
            }
            
            completeTask(taskId) {
                const task = this.tareas.find(t => t.id == taskId);
                if (task) {
                    task.estado = 'completada';
                    task.completada = true;
                    
                    if (this.saveAllData()) {
                        this.renderTasks();
                        this.updateDashboardStats();
                        this.showNotification('¡Tarea completada!', 'success');
                    }
                }
            }
            
            initBitacoras() {
                console.log('📝 Inicializando sistema de bitácoras...');
                
                // Renderizar bitácoras iniciales
                this.renderBitacoras();
                
                // Cargar plan semanal
                this.loadWeeklyPlan();
                
                console.log('✅ Sistema de bitácoras inicializado');
            }
            
            renderBitacoras() {
                const historyContainer = document.getElementById('bitacorasHistory');
                if (!historyContainer) return;
                
                // Filtrar bitácoras diarias y ordenar por fecha
                const diarias = this.bitacoras
                    .filter(b => b.tipo === 'diaria')
                    .sort((a, b) => new Date(b.fecha) - new Date(a.fecha))
                    .slice(0, 5); // Mostrar solo las 5 más recientes
                
                // Limpiar contenedor
                historyContainer.innerHTML = '';
                
                if (diarias.length === 0) {
                    historyContainer.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                            <i class="fas fa-book" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                            <p>No hay bitácoras registradas</p>
                            <button class="btn btn-primary mt-2" onclick="openBitacoraModal('diaria')">
                                <i class="fas fa-plus"></i> Crear primera bitácora
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Renderizar cada bitácora
                diarias.forEach(bitacora => {
                    const activityItem = document.createElement('div');
                    activityItem.className = 'activity-item';
                    
                    const fecha = new Date(bitacora.fecha);
                    const fechaStr = fecha.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    const modalidadText = {
                        'teletrabajo': 'Teletrabajo',
                        'oficina': 'Oficina',
                        'hibrido': 'Híbrido'
                    }[bitacora.modalidad] || bitacora.modalidad;
                    
                    activityItem.innerHTML = `
                        <div class="activity-icon" style="background: var(--info-color)">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Bitácora del ${fechaStr}</div>
                            <div class="activity-time">
                                ${modalidadText} · ${bitacora.horas} horas · 
                                Productividad ${bitacora.productividad}
                            </div>
                        </div>
                        <button class="btn btn-secondary btn-sm" onclick="viewBitacora(${bitacora.id})">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    `;
                    
                    historyContainer.appendChild(activityItem);
                });
            }
            
            loadWeeklyPlan() {
                console.log('📅 Cargando plan semanal...');
                
                const weekSelector = document.getElementById('weekSelector');
                const weekDaysGrid = document.getElementById('weekDaysGrid');
                const objectivesGrid = document.getElementById('objectivesGrid');
                
                if (!weekSelector || !weekDaysGrid) return;
                
                // Obtener semana seleccionada
                let weekStartDate;
                if (weekSelector.value) {
                    const [year, week] = weekSelector.value.split('-W');
                    weekStartDate = this.getDateOfISOWeek(week, year);
                } else {
                    weekStartDate = new Date();
                    weekStartDate.setDate(weekStartDate.getDate() - weekStartDate.getDay() + 1); // Lunes de esta semana
                }
                
                // Actualizar selector de semana
                const year = weekStartDate.getFullYear();
                const weekNumber = this.getWeekNumber(weekStartDate);
                weekSelector.value = `${year}-W${weekNumber.toString().padStart(2, '0')}`;
                
                // Generar días de la semana
                const days = [];
                for (let i = 0; i < 7; i++) {
                    const dayDate = new Date(weekStartDate);
                    dayDate.setDate(dayDate.getDate() + i);
                    days.push(dayDate);
                }
                
                // Renderizar días
                weekDaysGrid.innerHTML = '';
                days.forEach((dayDate, index) => {
                    const dayName = ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'][index];
                    const dateStr = dayDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
                    
                    // Tareas para este día
                    const dayTasks = this.tareas.filter(task => {
                        if (!task.fechaLimite) return false;
                        const taskDate = new Date(task.fechaLimite);
                        return taskDate.toDateString() === dayDate.toDateString();
                    });
                    
                    // Eventos para este día
                    const dayEvents = this.eventos.filter(event => {
                        const eventDate = new Date(event.inicio);
                        return eventDate.toDateString() === dayDate.toDateString();
                    });
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'week-day';
                    
                    let tasksHTML = '';
                    dayTasks.slice(0, 3).forEach(task => {
                        tasksHTML += `
                            <div class="day-task" draggable="true" data-task-id="${task.id}">
                                <strong>${task.titulo}</strong>
                                <span class="task-time">${task.prioridad} · ${task.estado}</span>
                            </div>
                        `;
                    });
                    
                    if (dayTasks.length > 3) {
                        tasksHTML += `<div class="text-muted text-center">+${dayTasks.length - 3} más</div>`;
                    }
                    
                    dayElement.innerHTML = `
                        <div class="day-header">
                            <div class="day-name">${dayName}</div>
                            <div class="day-date">${dateStr}</div>
                        </div>
                        <div class="day-tasks">
                            ${tasksHTML || '<div class="text-muted text-center">Sin tareas</div>'}
                        </div>
                        ${dayEvents.length > 0 ? 
                            `<div class="mt-2 text-info"><i class="fas fa-calendar"></i> ${dayEvents.length} evento(s)</div>` : ''}
                    `;
                    
                    weekDaysGrid.appendChild(dayElement);
                });
                
                // Renderizar objetivos si existe el contenedor
                if (objectivesGrid) {
                    this.renderWeeklyObjectives(objectivesGrid);
                }
                
                console.log('✅ Plan semanal cargado');
            }
            
            getDateOfISOWeek(week, year) {
                const simple = new Date(year, 0, 1 + (week - 1) * 7);
                const dow = simple.getDay();
                const ISOweekStart = simple;
                if (dow <= 4) {
                    ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
                } else {
                    ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
                }
                return ISOweekStart;
            }
            
            renderWeeklyObjectives(container) {
                const objectives = [
                    { id: 1, titulo: "Completar informe trimestral", status: "in-progress", progress: 75 },
                    { id: 2, titulo: "Revisar presupuesto del departamento", status: "pending", progress: 0 },
                    { id: 3, titulo: "Capacitación del equipo", status: "completed", progress: 100 },
                    { id: 4, titulo: "Actualizar base de datos", status: "in-progress", progress: 40 }
                ];
                
                container.innerHTML = '';
                objectives.forEach(obj => {
                    const objectiveCard = document.createElement('div');
                    objectiveCard.className = 'objective-card';
                    
                    const statusClass = {
                        'pending': 'status-pending',
                        'in-progress': 'status-in-progress',
                        'completed': 'status-completed'
                    }[obj.status] || '';
                    
                    objectiveCard.innerHTML = `
                        <div class="objective-header">
                            <div class="objective-title">${obj.titulo}</div>
                            <span class="objective-status ${statusClass}">${obj.status === 'in-progress' ? 'En progreso' : 
                                                                           obj.status === 'completed' ? 'Completado' : 'Pendiente'}</span>
                        </div>
                        <div class="progress-bar mt-2" style="height: 6px;">
                            <div class="progress-bar-fill" style="width: ${obj.progress}%; background: var(--${obj.status === 'completed' ? 'success' : 
                                                                                                               obj.status === 'in-progress' ? 'primary' : 'warning'}-color);"></div>
                        </div>
                        <div class="text-right mt-1" style="font-size: 0.8rem; color: var(--text-muted);">
                            ${obj.progress}% completado
                        </div>
                    `;
                    
                    container.appendChild(objectiveCard);
                });
            }
            
            updateWeekEndDate() {
                const startDateInput = document.getElementById('weekStartDate');
                const endDateInput = document.getElementById('weekEndDate');
                
                if (!startDateInput || !endDateInput) return;
                
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + 6);
                
                endDateInput.value = endDate.toISOString().split('T')[0];
            }
            
            openWeeklyPlanModal() {
                const modal = document.getElementById('weeklyPlanModal');
                if (modal) {
                    modal.classList.add('active');
                    this.loadWeeklyPlanModal();
                }
            }
            
            loadWeeklyPlanModal() {
                // Cargar datos del plan semanal actual
                const weekStartDate = document.getElementById('weekStartDate');
                const weekEndDate = document.getElementById('weekEndDate');
                const objectives = document.getElementById('weeklyPlanObjectives');
                const resources = document.getElementById('weeklyPlanResources');
                const metric = document.getElementById('weeklyPlanMetric');
                
                if (!weekStartDate) return;
                
                // Establecer semana actual por defecto
                const today = new Date();
                const monday = new Date(today);
                monday.setDate(monday.getDate() - monday.getDay() + 1);
                
                weekStartDate.value = monday.toISOString().split('T')[0];
                this.updateWeekEndDate();
                
                // Cargar días de la semana en el modal
                this.loadWeeklyPlanModalDays();
            }
            
            loadWeeklyPlanModalDays() {
                const container = document.getElementById('weeklyPlanDays');
                if (!container) return;
                
                const weekStartDate = document.getElementById('weekStartDate');
                if (!weekStartDate) return;
                
                const startDate = new Date(weekStartDate.value);
                const days = [];
                
                for (let i = 0; i < 7; i++) {
                    const dayDate = new Date(startDate);
                    dayDate.setDate(dayDate.getDate() + i);
                    days.push(dayDate);
                }
                
                container.innerHTML = '';
                days.forEach((dayDate, index) => {
                    const dayName = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'][index];
                    const dateStr = dayDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' });
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'week-day';
                    
                    dayElement.innerHTML = `
                        <div class="day-header">
                            <div class="day-name">${dayName}</div>
                            <div class="day-date">${dateStr}</div>
                        </div>
                        <div class="day-tasks">
                            <textarea class="form-control mt-2" rows="3" 
                                      placeholder="Actividades planeadas para este día..."></textarea>
                            <div class="d-flex justify-content-between mt-2">
                                <div>
                                    <label class="form-check">
                                        <input type="checkbox" class="form-check-input">
                                        <span class="form-check-label">Teletrabajo</span>
                                    </label>
                                </div>
                                <input type="number" class="form-control" style="width: 80px;" 
                                       min="0" max="24" step="0.5" placeholder="Horas" value="8">
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(dayElement);
                });
            }
            
            saveWeeklyPlanModal() {
                console.log('💾 Guardando plan semanal...');
                
                // Recopilar datos del plan
                const weekStartDate = document.getElementById('weekStartDate').value;
                const objectives = document.getElementById('weeklyPlanObjectives').value;
                const resources = document.getElementById('weeklyPlanResources').value;
                const metric = document.getElementById('weeklyPlanMetric').value;
                
                // Recopilar actividades por día
                const dayActivities = [];
                document.querySelectorAll('#weeklyPlanDays .week-day').forEach((dayElement, index) => {
                    const textarea = dayElement.querySelector('textarea');
                    const checkbox = dayElement.querySelector('input[type="checkbox"]');
                    const hoursInput = dayElement.querySelector('input[type="number"]');
                    
                    dayActivities.push({
                        day: index,
                        actividades: textarea.value,
                        teletrabajo: checkbox.checked,
                        horas: parseFloat(hoursInput.value) || 0
                    });
                });
                
                // Crear objeto del plan
                const weeklyPlan = {
                    id: Date.now(),
                    fechaInicio: weekStartDate,
                    fechaFin: this.calculateWeekEnd(weekStartDate),
                    objetivos: objectives,
                    recursos: resources,
                    metrica: metric,
                    actividades: dayActivities,
                    fechaCreacion: new Date().toISOString()
                };
                
                // Guardar en el sistema
                this.planesSemanales.push(weeklyPlan);
                
                if (this.saveAllData()) {
                    this.closeModal('weeklyPlanModal');
                    this.showNotification('Plan semanal guardado correctamente', 'success');
                    this.loadWeeklyPlan(); // Actualizar vista del plan
                }
            }
            
            calculateWeekEnd(startDate) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + 6);
                return date.toISOString().split('T')[0];
            }
            
            openBitacoraModal(tipo = 'diaria') {
                const modal = document.getElementById('bitacoraModal');
                const title = document.getElementById('bitacoraModalTitle');
                
                if (!modal) return;
                
                // Configurar según el tipo
                document.getElementById('bitacoraTipo').value = tipo;
                
                if (tipo === 'diaria') {
                    title.innerHTML = `<i class="fas fa-file-alt"></i> Bitácora Diaria`;
                } else if (tipo === 'semanal') {
                    title.innerHTML = `<i class="fas fa-calendar-week"></i> Plan Semanal`;
                }
                
                // Establecer fecha actual por defecto
                document.getElementById('bitacoraFecha').value = new Date().toISOString().split('T')[0];
                
                modal.classList.add('active');
            }
            
            saveBitacora() {
                console.log('💾 Guardando bitácora...');
                
                const bitacoraId = document.getElementById('bitacoraId').value;
                const tipo = document.getElementById('bitacoraTipo').value;
                
                const bitacoraData = {
                    tipo: tipo,
                    fecha: document.getElementById('bitacoraFecha').value,
                    modalidad: document.getElementById('bitacoraModalidad').value,
                    actividades: document.getElementById('bitacoraActividades').value.trim(),
                    horas: parseFloat(document.getElementById('bitacoraHoras').value) || 0,
                    productividad: document.getElementById('bitacoraProductividad').value,
                    observaciones: document.getElementById('bitacoraObservaciones').value.trim()
                };
                
                // Validaciones
                if (!bitacoraData.fecha) {
                    this.showNotification('La fecha es requerida', 'error');
                    return;
                }
                
                if (!bitacoraData.actividades) {
                    this.showNotification('Las actividades realizadas son requeridas', 'error');
                    return;
                }
                
                if (bitacoraData.horas < 0 || bitacoraData.horas > 24) {
                    this.showNotification('Las horas deben estar entre 0 y 24', 'error');
                    return;
                }
                
                if (bitacoraId) {
                    // Actualizar bitácora existente
                    const index = this.bitacoras.findIndex(b => b.id == bitacoraId);
                    if (index !== -1) {
                        bitacoraData.id = this.bitacoras[index].id;
                        bitacoraData.archivos = this.bitacoras[index].archivos || [];
                        this.bitacoras[index] = bitacoraData;
                        console.log('✏️ Bitácora actualizada:', bitacoraData);
                    }
                } else {
                    // Crear nueva bitácora
                    bitacoraData.id = Date.now();
                    bitacoraData.archivos = [];
                    this.bitacoras.push(bitacoraData);
                    console.log('🆕 Nueva bitácora creada:', bitacoraData);
                }
                
                // Guardar y actualizar
                if (this.saveAllData()) {
                    this.closeModal('bitacoraModal');
                    this.renderBitacoras();
                    this.updateDashboardStats();
                    this.showNotification(
                        bitacoraId ? 'Bitácora actualizada correctamente' : 'Bitácora creada correctamente',
                        'success'
                    );
                }
            }
            
            viewBitacora(bitacoraId) {
                const bitacora = this.bitacoras.find(b => b.id == bitacoraId);
                if (bitacora) {
                    const fecha = new Date(bitacora.fecha);
                    const fechaStr = fecha.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    
                    let detalles = `📅 BITÁCORA - ${fechaStr}\n\n`;
                    detalles += `📋 Modalidad: ${bitacora.modalidad}\n`;
                    detalles += `⏰ Horas trabajadas: ${bitacora.horas}\n`;
                    detalles += `📈 Productividad: ${bitacora.productividad}\n\n`;
                    detalles += `📝 ACTIVIDADES REALIZADAS:\n${bitacora.actividades}\n\n`;
                    
                    if (bitacora.observaciones) {
                        detalles += `💭 OBSERVACIONES:\n${bitacora.observaciones}\n`;
                    }
                    
                    alert(detalles);
                }
            }
            
            initEnlaces() {
                console.log('🔗 Inicializando enlaces rápidos...');
                this.renderEnlaces();
                console.log('✅ Enlaces rápidos inicializados');
            }
            
            renderEnlaces() {
                const container = document.getElementById('enlacesGrid');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.enlaces.forEach(enlace => {
                    const linkCard = document.createElement('div');
                    linkCard.className = 'quick-action-card';
                    linkCard.onclick = () => window.open(enlace.url, '_blank');
                    
                    linkCard.innerHTML = `
                        <div class="quick-action-icon" style="background: ${enlace.color}20; color: ${enlace.color};">
                            <i class="${enlace.icono}"></i>
                        </div>
                        <div class="quick-action-content">
                            <h4>${enlace.nombre}</h4>
                            <p>${new URL(enlace.url).hostname}</p>
                        </div>
                    `;
                    
                    container.appendChild(linkCard);
                });
            }
            
            openLinkModal() {
                const modal = document.getElementById('linkModal');
                if (modal) {
                    modal.classList.add('active');
                }
            }
            
            saveLink() {
                console.log('💾 Guardando enlace...');
                
                const url = document.getElementById('linkUrl').value;
                let nombre = document.getElementById('linkName').value.trim();
                const categoria = document.getElementById('linkCategory').value;
                const icono = document.getElementById('linkIcon').value.trim();
                const color = document.getElementById('linkColor').value;
                
                // Validaciones
                if (!url) {
                    this.showNotification('La URL es requerida', 'error');
                    return;
                }
                
                try {
                    new URL(url);
                } catch (e) {
                    this.showNotification('La URL no es válida', 'error');
                    return;
                }
                
                // Determinar nombre automáticamente si no se especifica
                if (!nombre) {
                    try {
                        const urlObj = new URL(url);
                        nombre = urlObj.hostname.replace('www.', '').split('.')[0];
                        nombre = nombre.charAt(0).toUpperCase() + nombre.slice(1);
                    } catch (e) {
                        nombre = 'Nuevo Enlace';
                    }
                }
                
                // Determinar icono automáticamente si no se especifica
                let finalIcono = icono;
                if (!finalIcono) {
                    finalIcono = this.detectIconFromUrl(url);
                }
                
                // Crear objeto del enlace
                const enlaceData = {
                    id: Date.now(),
                    nombre: nombre,
                    url: url,
                    icono: finalIcono,
                    categoria: categoria,
                    color: color
                };
                
                // Guardar en el sistema
                this.enlaces.push(enlaceData);
                
                if (this.saveAllData()) {
                    this.closeModal('linkModal');
                    this.renderEnlaces();
                    this.showNotification('Enlace agregado correctamente', 'success');
                }
            }
            
            detectIconFromUrl(url) {
                const urlLower = url.toLowerCase();
                
                // Mapeo de iconos por dominio
                const iconMap = [
                    { pattern: 'outlook|office.com', icon: 'fas fa-envelope' },
                    { pattern: 'teams|microsoft', icon: 'fas fa-users' },
                    { pattern: 'mep.go.cr', icon: 'fas fa-graduation-cap' },
                    { pattern: 'google.com|drive.google', icon: 'fab fa-google-drive' },
                    { pattern: 'github.com', icon: 'fab fa-github' },
                    { pattern: 'symbaloo.com', icon: 'fas fa-th' },
                    { pattern: 'copilot', icon: 'fas fa-robot' },
                    { pattern: 'calendar', icon: 'fas fa-calendar' },
                    { pattern: 'drive|dropbox', icon: 'fas fa-cloud' },
                    { pattern: 'meet|zoom', icon: 'fas fa-video' }
                ];
                
                for (const mapping of iconMap) {
                    if (urlLower.includes(mapping.pattern)) {
                        return mapping.icon;
                    }
                }
                
                // Icono por defecto
                return 'fas fa-external-link-alt';
            }
            
            initAssistant() {
                console.log('🤖 Inicializando asistente IA...');
                
                // Configurar input del asistente
                const assistantInput = document.getElementById('assistantInput');
                if (assistantInput) {
                    assistantInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.handleAssistantQuery();
                        }
                    });
                }
                
                // Configurar comandos rápidos
                window.quickCommand = (command) => {
                    let query = '';
                    switch(command) {
                        case 'tareas-hoy':
                            query = "¿Qué tareas tengo para hoy?";
                            break;
                        case 'eventos-hoy':
                            query = "¿Qué eventos tengo programados para hoy?";
                            break;
                        case 'informe-rapido':
                            query = "Genera un informe rápido de mis actividades";
                            break;
                        case 'productividad':
                            query = "¿Cómo va mi productividad esta semana?";
                            break;
                    }
                    
                    if (query) {
                        document.getElementById('assistantInput').value = query;
                        this.handleAssistantQuery();
                    }
                };
                
                console.log('✅ Asistente IA inicializado');
            }
            
            handleAssistantQuery() {
                const input = document.getElementById('assistantInput');
                const query = input.value.trim();
                
                if (!query) return;
                
                // Mostrar mensaje del usuario
                this.addAssistantMessage(query, 'user');
                input.value = '';
                
                // Procesar consulta
                setTimeout(() => {
                    const response = this.processAssistantQuery(query);
                    this.addAssistantMessage(response, 'ai');
                }, 800);
            }
            
            addAssistantMessage(text, sender) {
                const container = document.getElementById('assistantMessages');
                if (!container) return;
                
                const message = document.createElement('div');
                message.className = `message ${sender}`;
                
                const now = new Date();
                const timeString = now.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const senderName = sender === 'ai' ? 'Asistente DRTE' : 'Tú';
                const senderIcon = sender === 'ai' ? 'fas fa-robot' : 'fas fa-user';
                
                message.innerHTML = `
                    <div class="sender">
                        <i class="${senderIcon}"></i> ${senderName}
                    </div>
                    <div class="content">${text.replace(/\n/g, '<br>')}</div>
                    <div class="timestamp">
                        <i class="far fa-clock"></i> ${timeString}
                    </div>
                `;
                
                container.appendChild(message);
                container.scrollTop = container.scrollHeight;
            }
            
            processAssistantQuery(query) {
                const queryLower = query.toLowerCase();
                
                // Tareas
                if (queryLower.includes('tarea') || queryLower.includes('pendiente')) {
                    if (queryLower.includes('hoy') || queryLower.includes('para hoy')) {
                        const today = new Date().toISOString().split('T')[0];
                        const tasksToday = this.tareas.filter(t => 
                            t.fechaLimite === today && !t.completada
                        );
                        
                        if (tasksToday.length === 0) {
                            return "No tienes tareas pendientes para hoy. ¡Excelente! 🎉";
                        }
                        
                        let response = `Tienes ${tasksToday.length} tarea(s) pendiente(s) para hoy:\n\n`;
                        tasksToday.forEach((task, index) => {
                            response += `${index + 1}. ${task.titulo} (${task.prioridad} prioridad)\n`;
                        });
                        
                        return response;
                    }
                    
                    const pendingTasks = this.tareas.filter(t => !t.completada);
                    if (pendingTasks.length === 0) {
                        return "¡Felicidades! No tienes tareas pendientes. 🎊";
                    }
                    
                    let response = `Tienes ${pendingTasks.length} tarea(s) pendiente(s):\n\n`;
                    pendingTasks.slice(0, 5).forEach((task, index) => {
                        const dueDate = task.fechaLimite ? 
                            `Vence: ${new Date(task.fechaLimite).toLocaleDateString('es-ES')}` : 
                            'Sin fecha límite';
                        response += `${index + 1}. ${task.titulo}\n   ${dueDate}\n`;
                    });
                    
                    if (pendingTasks.length > 5) {
                        response += `\n... y ${pendingTasks.length - 5} tarea(s) más.`;
                    }
                    
                    return response;
                }
                
                // Eventos
                if (queryLower.includes('evento') || queryLower.includes('reunión') || queryLower.includes('cita')) {
                    if (queryLower.includes('hoy')) {
                        const today = new Date().toDateString();
                        const eventosHoy = this.eventos.filter(e => 
                            new Date(e.inicio).toDateString() === today
                        );
                        
                        if (eventosHoy.length === 0) {
                            return "No tienes eventos programados para hoy. 📅";
                        }
                        
                        let response = `Hoy tienes ${eventosHoy.length} evento(s):\n\n`;
                        eventosHoy.forEach((evento, index) => {
                            const time = new Date(evento.inicio).toLocaleTimeString('es-ES', {
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            response += `${index + 1}. ${evento.titulo}\n   Hora: ${time}\n`;
                        });
                        
                        return response;
                    }
                }
                
                // Bitácoras
                if (queryLower.includes('bitácora') || queryLower.includes('actividad') || queryLower.includes('ayer')) {
                    if (queryLower.includes('ayer')) {
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yesterdayStr = yesterday.toISOString().split('T')[0];
                        
                        const bitacorasAyer = this.bitacoras.filter(b => 
                            b.fecha === yesterdayStr && b.tipo === 'diaria'
                        );
                        
                        if (bitacorasAyer.length === 0) {
                            return "No registraste bitácoras ayer.";
                        }
                        
                        const totalHoras = bitacorasAyer.reduce((sum, b) => sum + b.horas, 0);
                        return `Ayer registraste ${bitacorasAyer.length} bitácora(s) con un total de ${totalHoras} horas trabajadas.`;
                    }
                }
                
                // Informes
                if (queryLower.includes('informe') || queryLower.includes('reporte')) {
                    if (queryLower.includes('rápido') || queryLower.includes('rapido')) {
                        this.generarInforme('diario');
                        return "Estoy generando tu informe diario. Se abrirá en una nueva ventana. 📊";
                    }
                    
                    if (queryLower.includes('semanal')) {
                        this.generarInforme('semanal');
                        return "Generando informe semanal... 📈";
                    }
                    
                    return "Puedo generar informes diarios, semanales o mensuales. También puedes activar el informe automático de las 8 AM en la sección de Informes.";
                }
                
                // Productividad
                if (queryLower.includes('productividad') || queryLower.includes('rendimiento')) {
                    const tareasCompletadas = this.tareas.filter(t => t.completada).length;
                    const totalTareas = this.tareas.length;
                    const productividad = totalTareas > 0 ? 
                        Math.round((tareasCompletadas / totalTareas) * 100) : 0;
                    
                    let response = `Tu productividad actual es del ${productividad}%.\n\n`;
                    
                    if (productividad >= 80) {
                        response += "¡Excelente trabajo! 🚀 Mantén ese ritmo.";
                    } else if (productividad >= 50) {
                        response += "Buen progreso. 💪 Sigue adelante.";
                    } else {
                        response += "Hay espacio para mejorar. 📝 Revisa tus tareas pendientes.";
                    }
                    
                    return response;
                }
                
                // Saludos
                if (queryLower.includes('hola') || queryLower.includes('buenos')) {
                    const now = new Date().getHours();
                    let greeting = "¡Hola!";
                    
                    if (now < 12) greeting = "¡Buenos días!";
                    else if (now < 19) greeting = "¡Buenas tardes!";
                    else greeting = "¡Buenas noches!";
                    
                    return `${greeting} Soy tu asistente DRTE. Puedo ayudarte con:\n\n• Tareas y plazos 📋\n• Eventos y calendario 📅\n• Bitácoras y registro 📝\n• Informes y análisis 📊\n\n¿En qué puedo asistirte?`;
                }
                
                // Ayuda
                if (queryLower.includes('ayuda') || queryLower.includes('qué puedes') || queryLower.includes('que puedes')) {
                    return "Puedo ayudarte con:\n\n📋 **Tareas:** '¿Qué tareas tengo hoy?'\n📅 **Eventos:** '¿Qué eventos tengo programados?'\n📝 **Bitácoras:** 'Registro de actividades de ayer'\n📊 **Informes:** 'Genera informe semanal'\n📈 **Productividad:** '¿Cómo va mi productividad?'\n\n¡Solo pregúntame!";
                }
                
                // Respuesta por defecto
                return "Entiendo tu consulta. Para ayudarte mejor, puedes preguntarme específicamente sobre tareas, eventos, bitácoras o informes. ¿En qué área necesitas asistencia?";
            }
            
            initNotifications() {
                console.log('🔔 Inicializando sistema de notificaciones...');
                
                // Actualizar contador de notificaciones
                this.updateNotificationCount();
                
                // Configurar notificaciones automáticas
                if (this.configuracion.notificaciones?.tareas) {
                    this.checkTaskReminders();
                }
                
                console.log('✅ Sistema de notificaciones inicializado');
            }
            
            updateNotificationCount() {
                const countElement = document.getElementById('notificationCount');
                if (!countElement) return;
                
                let count = 0;
                
                // Tareas vencidas
                const today = new Date().toISOString().split('T')[0];
                const overdueTasks = this.tareas.filter(t => 
                    t.fechaLimite && t.fechaLimite < today && !t.completada
                );
                count += overdueTasks.length;
                
                // Eventos próximos (en la próxima hora)
                const now = new Date();
                const nextHour = new Date(now.getTime() + 60 * 60 * 1000);
                const upcomingEvents = this.eventos.filter(e => {
                    const eventTime = new Date(e.inicio);
                    return eventTime > now && eventTime <= nextHour && !e.completado;
                });
                count += upcomingEvents.length;
                
                // Actualizar contador
                countElement.textContent = count > 99 ? '99+' : count;
                countElement.style.display = count > 0 ? 'flex' : 'none';
            }
            
            checkTaskReminders() {
                // Verificar recordatorios de tareas cada minuto
                setInterval(() => {
                    const now = new Date();
                    
                    // Tareas con recordatorio para hoy
                    this.tareas.forEach(task => {
                        if (task.recordatorio && !task.completada && task.fechaLimite) {
                            const taskDate = new Date(task.fechaLimite);
                            const reminderTime = new Date(taskDate.getTime() - parseInt(task.recordatorio) * 60000);
                            
                            // Si el recordatorio es dentro de los próximos 5 minutos
                            if (reminderTime > now && reminderTime <= new Date(now.getTime() + 5 * 60000)) {
                                this.showNotification(
                                    `Recordatorio: "${task.titulo}" vence hoy`,
                                    'warning'
                                );
                            }
                        }
                    });
                    
                    // Actualizar contador de notificaciones
                    this.updateNotificationCount();
                }, 60000); // Cada minuto
            }
            
            showNotifications() {
                const notifications = [];
                
                // Tareas vencidas
                const today = new Date().toISOString().split('T')[0];
                const overdueTasks = this.tareas.filter(t => 
                    t.fechaLimite && t.fechaLimite < today && !t.completada
                );
                
                overdueTasks.forEach(task => {
                    notifications.push({
                        type: 'danger',
                        title: 'Tarea vencida',
                        message: `"${task.titulo}" estaba programada para el ${task.fechaLimite}`
                    });
                });
                
                // Eventos próximos
                const now = new Date();
                const todayEvents = this.eventos.filter(e => {
                    const eventDate = new Date(e.inicio);
                    return eventDate.toDateString() === now.toDateString() && !e.completado;
                });
                
                todayEvents.forEach(event => {
                    const eventTime = new Date(event.inicio);
                    const timeUntil = Math.round((eventTime - now) / 60000); // minutos
                    
                    if (timeUntil <= 60 && timeUntil > 0) {
                        notifications.push({
                            type: 'info',
                            title: 'Evento próximo',
                            message: `"${event.titulo}" en ${timeUntil} minutos`
                        });
                    }
                });
                
                // Mostrar notificaciones
                if (notifications.length === 0) {
                    this.showNotification('No tienes notificaciones pendientes', 'info');
                } else {
                    notifications.forEach(notification => {
                        this.showNotification(notification.message, notification.type);
                    });
                }
            }
            
            showNotification(message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                if (!container) return;
                
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    info: 'fa-info-circle',
                    warning: 'fa-exclamation-triangle'
                };
                
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas ${icons[type] || 'fa-info-circle'}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                container.appendChild(notification);
                
                // Remover automáticamente después de 5 segundos
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }
            
            loadInitialData() {
                console.log('📥 Cargando datos iniciales...');
                
                // Actualizar dashboard
                this.updateDashboardStats();
                this.loadRecentActivity();
                
                // Renderizar tareas
                this.renderTasks();
                
                // Renderizar calendario
                this.renderCalendar();
                
                // Renderizar bitácoras
                this.renderBitacoras();
                
                // Renderizar enlaces
                this.renderEnlaces();
                
                console.log('✅ Datos iniciales cargados');
            }
            
            setupAutoReport() {
                console.log('⏰ Configurando informe automático...');
                
                const toggle = document.getElementById('autoReportToggle');
                if (toggle) {
                    // Establecer estado inicial
                    toggle.checked = this.configuracion.autoReport?.enabled || false;
                    this.updateReportStatus();
                    
                    // Configurar evento change
                    toggle.addEventListener('change', () => {
                        this.toggleAutoReport();
                    });
                }
                
                // Programar próximo informe si está activado
                if (this.configuracion.autoReport?.enabled) {
                    this.scheduleNextAutoReport();
                }
                
                console.log('✅ Informe automático configurado');
            }
            
            toggleAutoReport() {
                const toggle = document.getElementById('autoReportToggle');
                if (!toggle) return;
                
                // Actualizar configuración
                this.configuracion.autoReport = {
                    ...this.configuracion.autoReport,
                    enabled: toggle.checked
                };
                
                // Guardar configuración
                this.saveAllData();
                
                // Actualizar estado visual
                this.updateReportStatus();
                
                // Programar próximo informe si está activado
                if (toggle.checked) {
                    this.scheduleNextAutoReport();
                    this.showNotification('Informe automático activado', 'success');
                } else {
                    this.showNotification('Informe automático desactivado', 'warning');
                }
            }
            
            updateReportStatus() {
                const statusElement = document.getElementById('reportStatus');
                if (!statusElement) return;
                
                if (this.configuracion.autoReport?.enabled) {
                    statusElement.innerHTML = `<i class="fas fa-check-circle"></i> Activado`;
                    statusElement.className = 'text-success';
                } else {
                    statusElement.innerHTML = `<i class="fas fa-pause-circle"></i> Desactivado`;
                    statusElement.className = 'text-danger';
                }
            }
            
            scheduleNextAutoReport() {
                if (!this.configuracion.autoReport?.enabled) return;
                
                const now = new Date();
                const [hours, minutes] = (this.configuracion.autoReport.time || '08:00').split(':').map(Number);
                
                // Calcular próxima ejecución a las 8:00 AM
                const nextRun = new Date();
                nextRun.setHours(hours, minutes, 0, 0);
                
                // Si ya pasó la hora de hoy, programar para mañana
                if (nextRun < now) {
                    nextRun.setDate(nextRun.getDate() + 1);
                }
                
                const timeUntilNextRun = nextRun - now;
                
                console.log(`⏰ Próximo informe automático programado para: ${nextRun.toLocaleString()}`);
                
                // Programar ejecución
                setTimeout(() => {
                    if (this.configuracion.autoReport?.enabled) {
                        this.executeAutoReport();
                        // Reprogramar para el próximo día
                        this.scheduleNextAutoReport();
                    }
                }, timeUntilNextRun);
            }
            
            executeAutoReport() {
                console.log('📧 Ejecutando informe automático...');
                
                // Generar informe
                this.generarInforme('diario');
                
                // Mostrar notificación
                this.showNotification('Informe automático generado y listo para enviar', 'success');
                
                // En un sistema real, aquí se enviaría el informe por correo
                // Usando la lista de destinatarios en this.configuracion.autoReport.recipients
            }
            
            testAutoReport() {
                console.log('🧪 Probando informe automático...');
                this.generarInforme('diario');
                this.showNotification('Informe de prueba generado', 'success');
            }
            
            generatePDFReport() {
                console.log('📄 Generando PDF...');
                
                // Simular generación de PDF
                setTimeout(() => {
                    this.showNotification('PDF generado correctamente', 'success');
                    
                    // En un sistema real, aquí se generaría el PDF usando jsPDF
                    // Por ahora, simulamos la descarga
                    const link = document.createElement('a');
                    link.href = '#';
                    link.download = `informe_drte_${new Date().toISOString().split('T')[0]}.pdf`;
                    link.click();
                }, 1000);
            }
            
            saveReportConfig() {
                console.log('💾 Guardando configuración de informes...');
                
                // Actualizar configuración
                this.configuracion.autoReport.recipients = document.getElementById('reportRecipients').value;
                
                // Guardar
                if (this.saveAllData()) {
                    this.showNotification('Configuración de informes guardada', 'success');
                }
            }
            
            generarInforme(tipo) {
                console.log(`📊 Generando informe ${tipo}...`);
                
                let titulo = '';
                let contenido = '';
                
                const hoy = new Date();
                
                switch(tipo) {
                    case 'diario':
                        titulo = `INFORME DIARIO - ${hoy.toLocaleDateString('es-ES')}`;
                        contenido = this.generateDailyReport();
                        break;
                    case 'semanal':
                        titulo = `INFORME SEMANAL - Semana ${this.getWeekNumber(hoy)}`;
                        contenido = this.generateWeeklyReport();
                        break;
                    case 'mensual':
                        const mes = hoy.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
                        titulo = `INFORME MENSUAL - ${mes}`;
                        contenido = this.generateMonthlyReport();
                        break;
                }
                
                // Crear ventana de informe
                const reportWindow = window.open('', '_blank');
                reportWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${titulo}</title>
                        <style>
                            body { 
                                font-family: 'Inter', sans-serif; 
                                margin: 0; 
                                padding: 2rem; 
                                color: #333;
                                line-height: 1.6;
                            }
                            .header { 
                                text-align: center; 
                                margin-bottom: 2rem;
                                border-bottom: 2px solid #4361ee;
                                padding-bottom: 1rem;
                            }
                            .logo { 
                                font-size: 1.5rem; 
                                color: #4361ee; 
                                font-weight: bold;
                                margin-bottom: 0.5rem;
                            }
                            .section { 
                                margin-bottom: 2rem;
                            }
                            .section-title {
                                color: #4361ee;
                                border-bottom: 1px solid #e2e8f0;
                                padding-bottom: 0.5rem;
                                margin-bottom: 1rem;
                            }
                            table {
                                width: 100%;
                                border-collapse: collapse;
                                margin: 1rem 0;
                                font-size: 0.9rem;
                            }
                            th, td {
                                border: 1px solid #e2e8f0;
                                padding: 0.75rem;
                                text-align: left;
                            }
                            th {
                                background-color: #f8fafc;
                                font-weight: 600;
                            }
                            .stats-grid {
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                                gap: 1rem;
                                margin: 1rem 0;
                            }
                            .stat-card {
                                border: 1px solid #e2e8f0;
                                border-radius: 8px;
                                padding: 1rem;
                                text-align: center;
                            }
                            .stat-number {
                                font-size: 1.5rem;
                                font-weight: bold;
                                color: #4361ee;
                            }
                            .footer {
                                margin-top: 3rem;
                                padding-top: 1rem;
                                border-top: 1px solid #e2e8f0;
                                text-align: right;
                                font-size: 0.9rem;
                                color: #64748b;
                            }
                            @media print {
                                body { padding: 1rem; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <div class="logo">DRTE MEP - Sistema Inteligente de Gestión</div>
                            <h1>${titulo}</h1>
                            <p>Generado el: ${new Date().toLocaleString('es-ES')}</p>
                        </div>
                        
                        ${contenido}
                        
                        <div class="footer">
                            <p>Documento generado automáticamente por el Sistema DRTE MEP</p>
                            <p>Ministerio de Educación Pública - Costa Rica</p>
                        </div>
                        
                        <div class="no-print" style="margin-top: 2rem; text-align: center;">
                            <button onclick="window.print()" style="padding: 0.5rem 1rem; background: #4361ee; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                📄 Imprimir Informe
                            </button>
                            <button onclick="window.close()" style="padding: 0.5rem 1rem; background: #64748b; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 0.5rem;">
                                ❌ Cerrar
                            </button>
                        </div>
                    </body>
                    </html>
                `);
                reportWindow.document.close();
                
                this.showNotification(`Informe ${tipo} generado correctamente`, 'success');
            }
            
            generateDailyReport() {
                const hoy = new Date().toISOString().split('T')[0];
                
                // Tareas para hoy
                const tareasHoy = this.tareas.filter(t => t.fechaLimite === hoy);
                const tareasPendientes = tareasHoy.filter(t => !t.completada);
                
                // Eventos de hoy
                const eventosHoy = this.eventos.filter(e => e.inicio.startsWith(hoy));
                
                // Bitácoras de hoy
                const bitacorasHoy = this.bitacoras.filter(b => b.fecha === hoy && b.tipo === 'diaria');
                
                let html = `
                    <div class="section">
                        <h2 class="section-title">📊 Resumen del Día</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${tareasPendientes.length}</div>
                                <div>Tareas Pendientes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${eventosHoy.length}</div>
                                <div>Eventos Programados</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${bitacorasHoy.length}</div>
                                <div>Bitácoras Registradas</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Tareas pendientes
                if (tareasPendientes.length > 0) {
                    html += `
                        <div class="section">
                            <h2 class="section-title">📋 Tareas Pendientes para Hoy</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tarea</th>
                                        <th>Prioridad</th>
                                        <th>Estado</th>
                                        <th>Descripción</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    tareasPendientes.forEach(tarea => {
                        html += `
                            <tr>
                                <td>${tarea.titulo}</td>
                                <td>${tarea.prioridad}</td>
                                <td>${tarea.estado}</td>
                                <td>${tarea.descripcion || ''}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                // Eventos de hoy
                if (eventosHoy.length > 0) {
                    html += `
                        <div class="section">
                            <h2 class="section-title">📅 Eventos Programados para Hoy</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Evento</th>
                                        <th>Tipo</th>
                                        <th>Hora Inicio</th>
                                        <th>Hora Fin</th>
                                        <th>Ubicación</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    eventosHoy.forEach(evento => {
                        const inicio = new Date(evento.inicio);
                        const fin = new Date(evento.fin);
                        
                        html += `
                            <tr>
                                <td>${evento.titulo}</td>
                                <td>${evento.tipo}</td>
                                <td>${inicio.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}</td>
                                <td>${fin.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}</td>
                                <td>${evento.ubicacion || ''}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                return html;
            }
            
            generateWeeklyReport() {
                const hoy = new Date();
                const semanaPasada = new Date(hoy);
                semanaPasada.setDate(semanaPasada.getDate() - 7);
                
                // Calcular estadísticas semanales
                const tareasSemana = this.tareas.filter(t => {
                    const fechaTarea = new Date(t.fechaCreacion);
                    return fechaTarea >= semanaPasada && fechaTarea <= hoy;
                });
                
                const tareasCompletadas = tareasSemana.filter(t => t.completada).length;
                const productividad = tareasSemana.length > 0 ? 
                    Math.round((tareasCompletadas / tareasSemana.length) * 100) : 0;
                
                let html = `
                    <div class="section">
                        <h2 class="section-title">📊 Resumen Semanal</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${tareasSemana.length}</div>
                                <div>Tareas Totales</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${tareasCompletadas}</div>
                                <div>Tareas Completadas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${productividad}%</div>
                                <div>Productividad</div>
                            </div>
                        </div>
                    </div>
                `;
                
                return html;
            }
            
            generateMonthlyReport() {
                const hoy = new Date();
                const mesActual = hoy.getMonth();
                const añoActual = hoy.getFullYear();
                
                // Calcular estadísticas mensuales
                const tareasMes = this.tareas.filter(t => {
                    const fechaTarea = new Date(t.fechaCreacion);
                    return fechaTarea.getMonth() === mesActual && fechaTarea.getFullYear() === añoActual;
                });
                
                const tareasCompletadas = tareasMes.filter(t => t.completada).length;
                const productividad = tareasMes.length > 0 ? 
                    Math.round((tareasCompletadas / tareasMes.length) * 100) : 0;
                
                let html = `
                    <div class="section">
                        <h2 class="section-title">📊 Resumen Mensual</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${tareasMes.length}</div>
                                <div>Tareas Totales</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${tareasCompletadas}</div>
                                <div>Tareas Completadas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${productividad}%</div>
                                <div>Productividad</div>
                            </div>
                        </div>
                    </div>
                `;
                
                return html;
            }
            
            generarInformeCompleto() {
                this.generarInforme('diario');
            }
            
            startDashboardUpdates() {
                // Actualizar dashboard cada 30 segundos
                setInterval(() => {
                    if (document.getElementById('dashboard')?.classList.contains('active')) {
                        this.updateDashboardStats();
                    }
                }, 30000);
            }
            
            loadSettings() {
                console.log('⚙️ Cargando configuración...');
                
                // Cargar valores en los controles
                document.getElementById('themeSelect').value = this.configuracion.tema || 'light';
                document.getElementById('languageSelect').value = this.configuracion.idioma || 'es';
                document.getElementById('backupFrequency').value = this.configuracion.backup || 'weekly';
                
                document.getElementById('notifyTasks').checked = this.configuracion.notificaciones?.tareas ?? true;
                document.getElementById('notifyEvents').checked = this.configuracion.notificaciones?.eventos ?? true;
                document.getElementById('notifyReports').checked = this.configuracion.notificaciones?.informes ?? true;
                
                document.getElementById('reportRecipients').value = this.configuracion.autoReport?.recipients || '';
                
                console.log('✅ Configuración cargada');
            }
            
            saveSettings() {
                console.log('💾 Guardando configuración...');
                
                // Recopilar valores
                this.configuracion.tema = document.getElementById('themeSelect').value;
                this.configuracion.idioma = document.getElementById('languageSelect').value;
                this.configuracion.backup = document.getElementById('backupFrequency').value;
                
                this.configuracion.notificaciones = {
                    tareas: document.getElementById('notifyTasks').checked,
                    eventos: document.getElementById('notifyEvents').checked,
                    informes: document.getElementById('notifyReports').checked
                };
                
                this.configuracion.autoReport.recipients = document.getElementById('reportRecipients').value;
                
                // Guardar
                if (this.saveAllData()) {
                    this.showNotification('Configuración guardada correctamente', 'success');
                    console.log('✅ Configuración guardada');
                }
            }
            
            resetSettings() {
                if (confirm('¿Restablecer toda la configuración a valores predeterminados?')) {
                    this.configuracion = this.getDefaultConfig();
                    this.saveAllData();
                    this.loadSettings();
                    this.showNotification('Configuración restablecida', 'success');
                }
            }
            
            changeTheme() {
                const theme = document.getElementById('themeSelect').value;
                // Aquí se implementaría el cambio de tema
                console.log(`🎨 Cambiando tema a: ${theme}`);
                this.showNotification(`Tema cambiado a ${theme}`, 'info');
            }
            
            clearAllData() {
                if (confirm('⚠️ ¿ESTÁS SEGURO DE ELIMINAR TODOS LOS DATOS?\n\nEsta acción borrará todas las tareas, eventos, bitácoras y enlaces. No se puede deshacer.')) {
                    localStorage.clear();
                    this.initialize(); // Reiniciar el sistema
                    this.showNotification('Todos los datos han sido eliminados', 'warning');
                }
            }
            
            exportAllData() {
                console.log('💾 Exportando todos los datos...');
                
                const data = {
                    tareas: this.tareas,
                    eventos: this.eventos,
                    bitacoras: this.bitacoras,
                    enlaces: this.enlaces,
                    planesSemanales: this.planesSemanales,
                    configuracion: this.configuracion,
                    exportDate: new Date().toISOString(),
                    version: '4.0'
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `backup_drte_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.showNotification('Backup exportado correctamente', 'success');
            }
            
            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                }
            }
            
            // Funciones de utilidad para acceso global
            openQuickTask() {
                this.openTaskModal();
            }
            
            openQuickEvent() {
                this.openEventModal();
            }
            
            openQuickBitacora() {
                this.openBitacoraModal('diaria');
            }
            
            selectEventColor(color) {
                document.getElementById('eventColor').value = color;
                
                // Actualizar visualización
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                const selectedOption = document.querySelector(`[data-color="${color}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }
            
            toggleTag(tag) {
                const tagElement = document.querySelector(`.tag:contains("${tag}")`);
                if (tagElement) {
                    tagElement.classList.toggle('selected');
                }
            }
        }

        // ==============================================
        // INICIALIZACIÓN DEL SISTEMA
        // ==============================================

        // Crear instancia global del sistema
        const sistema = new SistemaDRTE();

        // Funciones globales para acceso desde HTML
        window.sistema = sistema;
        
        // Navegación
        window.navigateTo = (section) => sistema.navigateTo(section);
        
        // Tareas
        window.openTaskModal = (id) => sistema.openTaskModal(id);
        window.editTask = (id) => sistema.editTask(id);
        window.deleteTask = (id) => sistema.deleteTask(id);
        window.completeTask = (id) => sistema.completeTask(id);
        window.saveTask = () => sistema.saveTask();
        window.filterTasks = () => sistema.renderTasks(document.getElementById('taskFilter').value);
        
        // Eventos
        window.openEventModal = (id) => sistema.openEventModal(id);
        window.saveEvent = () => sistema.saveEvent();
        window.selectEventColor = (color) => sistema.selectEventColor(color);
        
        // Bitácoras
        window.openBitacoraModal = (tipo) => sistema.openBitacoraModal(tipo);
        window.saveBitacora = () => sistema.saveBitacora();
        window.viewBitacora = (id) => sistema.viewBitacora(id);
        window.openWeeklyPlanModal = () => sistema.openWeeklyPlanModal();
        window.saveWeeklyPlanModal = () => sistema.saveWeeklyPlanModal();
        window.loadWeeklyPlan = () => sistema.loadWeeklyPlan();
        window.saveWeeklyPlan = () => sistema.saveWeeklyPlanModal();
        
        // Enlaces
        window.openLinkModal = () => sistema.openLinkModal();
        window.saveLink = () => sistema.saveLink();
        
        // Informes
        window.generarInforme = (tipo) => sistema.generarInforme(tipo);
        window.generarInformeCompleto = () => sistema.generarInformeCompleto();
        window.testAutoReport = () => sistema.testAutoReport();
        window.generatePDFReport = () => sistema.generatePDFReport();
        window.saveReportConfig = () => sistema.saveReportConfig();
        
        // Calendario
        window.changeCalendarView = (view) => sistema.changeCalendarView(view);
        window.prevCalendarPeriod = () => sistema.prevCalendarPeriod();
        window.nextCalendarPeriod = () => sistema.nextCalendarPeriod();
        window.goToToday = () => sistema.goToToday();
        
        // Configuración
        window.saveSettings = () => sistema.saveSettings();
        window.resetSettings = () => sistema.resetSettings();
        window.changeTheme = () => sistema.changeTheme();
        window.clearAllData = () => sistema.clearAllData();
        window.exportAllData = () => sistema.exportAllData();
        
        // Asistente
        window.handleAssistantQuery = () => sistema.handleAssistantQuery();
        window.quickCommand = (cmd) => sistema.quickCommand(cmd);
        
        // Utilidades
        window.closeModal = (modalId) => sistema.closeModal(modalId);
        window.toggleTag = (tag) => sistema.toggleTag(tag);
        window.showNotifications = () => sistema.showNotifications();

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 DOM cargado, sistema listo');
        });

        // Manejar errores no capturados
        window.addEventListener('error', (e) => {
            console.error('❌ Error no capturado:', e.error);
            sistema.showNotification('Ocurrió un error inesperado', 'error');
        });
    </script>
</body>
</html>
