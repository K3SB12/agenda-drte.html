<!DOCTYPE html>
<html lang="es-CR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema Integral de Gesti√≥n DRTE MEP - Bit√°cora, Tareas, Archivos y Reportes">
    <title>Agenda DRTE MEP | Sistema Profesional</title>
    
    <!-- Librer√≠as -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* VARIABLES MEP */
        :root {
            --mep-blue: #0056a6;
            --mep-green: #00a859;
            --mep-orange: #f26522;
            --mep-dark: #1a1a2e;
            --mep-light: #f8f9fa;
            --border-radius: 10px;
            --box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* HEADER MEP */
        .header {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
            border-left: 5px solid var(--mep-green);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--mep-blue) 0%, var(--mep-green) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            box-shadow: 0 5px 15px rgba(0,86,166,0.3);
        }
        
        .brand-info h1 {
            color: var(--mep-blue);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .brand-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* PANEL ENLACES MEP */
        .links-panel {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--box-shadow);
        }
        
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .link-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-decoration: none;
            color: #444;
            transition: var(--transition);
            border: 1px solid #e9ecef;
        }
        
        .link-item:hover {
            background: var(--mep-blue);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,86,166,0.2);
        }
        
        .link-item i { width: 20px; text-align: center; }
        
        /* TABS PRINCIPALES */
        .tabs-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            margin-bottom: 25px;
        }
        
        .tabs-header {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 0 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 18px 25px;
            background: none;
            border: none;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .tab-btn.active {
            color: var(--mep-blue);
            border-bottom-color: var(--mep-blue);
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 25px;
            min-height: 500px;
        }
        
        .tab-content.active { display: block; }
        
        /* CARDS GENERALES */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f5;
        }
        
        .card-header h2 {
            color: var(--mep-blue);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* BOTONES MEP */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--mep-blue);
            color: white;
        }
        
        .btn-success {
            background: var(--mep-green);
            color: white;
        }
        
        .btn-warning {
            background: var(--mep-orange);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* FORMULARIOS */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: #444; }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--mep-blue);
            box-shadow: 0 0 0 3px rgba(0,86,166,0.1);
        }
        
        /* EDITOR BIT√ÅCORA */
        .journal-editor {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .journal-toolbar {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .toolbar-btn {
            padding: 8px 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        #journal-content {
            min-height: 300px;
            padding: 20px;
            outline: none;
        }
        
        /* SISTEMA ARCHIVOS */
        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: #f8f9fa;
            margin-bottom: 20px;
        }
        
        .file-upload-area.dragover {
            border-color: var(--mep-green);
            background: rgba(0,168,89,0.05);
        }
        
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .file-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: var(--transition);
        }
        
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        /* CALENDARIO */
        .calendar-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .calendar-day:hover { background: #f8f9fa; }
        .calendar-day.today { background: #e3f2fd; border-color: var(--mep-blue); }
        .calendar-day.has-files { background: #e8f5e9; border-color: var(--mep-green); }
        .calendar-day.selected { background: var(--mep-blue); color: white; }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 15px; text-align: center; }
            .tabs-header { flex-direction: column; }
            .tab-btn { width: 100%; justify-content: center; }
            .links-grid { grid-template-columns: 1fr; }
            .file-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* UTILIDADES */
        .mt-3 { margin-top: 15px; }
        .mb-3 { margin-bottom: 15px; }
        .d-flex { display: flex; }
        .gap-3 { gap: 15px; }
        .text-center { text-align: center; }
        .w-100 { width: 100%; }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER MEP -->
        <header class="header">
            <div class="brand">
                <div class="logo">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="brand-info">
                    <h1>Agenda DRTE MEP - Sistema Profesional</h1>
                    <p>Departamento de Investigaci√≥n, Desarrollo e Implementaci√≥n</p>
                    <p style="font-size: 0.85rem; color: var(--mep-blue);">
                        <i class="fas fa-user-tie"></i> Asesor: Kevin S√°nchez Bogar√≠n
                    </p>
                </div>
            </div>
            <div id="current-datetime" style="color: #666; font-size: 0.9rem;">
                <i class="fas fa-clock"></i> <span id="datetime-text">Cargando...</span>
            </div>
        </header>

        <!-- PANEL ENLACES MEP -->
        <div class="links-panel">
            <h3 style="color: var(--mep-blue); margin-bottom: 15px;">
                <i class="fas fa-external-link-alt"></i> Enlaces Institucionales MEP
            </h3>
            <div class="links-grid">
                <a href="https://outlook.office.com/" class="link-item" target="_blank">
                    <i class="fas fa-envelope" style="color: #0078D4;"></i> Correo MEP
                </a>
                <a href="https://m365.cloud.microsoft.com/launch/onenote?auth=2" class="link-item" target="_blank">
                    <i class="fas fa-sticky-note" style="color: #80397b;"></i> OneNote
                </a>
                <a href="https://adminmepcr-my.sharepoint.com/:o:/r/personal/kevin_sanchez_bogarin_mep_go_cr/Documents/Notebooks/Informe%20Teletrabajo%20Kevin%20S%C3%A1nchez%20B_2025" class="link-item" target="_blank">
                    <i class="fas fa-book" style="color: #00a859;"></i> Bit√°cora 2025
                </a>
                <a href="https://pnft.mep.go.cr/asesoriapnft/app/home" class="link-item" target="_blank">
                    <i class="fas fa-chart-line" style="color: #0066cc;"></i> Sistema PNFT
                </a>
                <a href="https://adminmepcr.sharepoint.com/sites/DRTE-Intranet/DOCUMENTOSASESORESDRTE/Forms/AllItems.aspx" class="link-item" target="_blank">
                    <i class="fas fa-folder" style="color: #ff5722;"></i> Documentos DRTE
                </a>
                <a href="https://www.symbaloo.com/home/mix/13eP7Bh97Y" class="link-item" target="_blank">
                    <i class="fas fa-th-large" style="color: #ff6600;"></i> Symbaloo
                </a>
            </div>
        </div>

        <!-- SISTEMA DE TABS PRINCIPALES -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </button>
                <button class="tab-btn" data-tab="bitacora">
                    <i class="fas fa-book"></i> Bit√°cora Diaria
                </button>
                <button class="tab-btn" data-tab="tareas">
                    <i class="fas fa-tasks"></i> Mis Tareas (13 Funciones)
                </button>
                <button class="tab-btn" data-tab="archivos">
                    <i class="fas fa-folder"></i> Archivos por Fecha
                </button>
                <button class="tab-btn" data-tab="calendario">
                    <i class="fas fa-calendar"></i> Calendario
                </button>
                <button class="tab-btn" data-tab="reportes">
                    <i class="fas fa-chart-bar"></i> Reportes
                </button>
            </div>

            <!-- DASHBOARD -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-chart-line"></i> Resumen del D√≠a</h2>
                        <span id="today-date" style="color: var(--mep-blue); font-weight: 600;"></span>
                    </div>
                    
                    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div class="stat-item" style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
                            <div class="d-flex align-items-center gap-3">
                                <div style="background: var(--mep-blue); color: white; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-tasks"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700;" id="total-tasks">0</div>
                                    <div style="color: #666;">Tareas Totales</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-item" style="background: #e8f5e9; padding: 20px; border-radius: 8px;">
                            <div class="d-flex align-items-center gap-3">
                                <div style="background: var(--mep-green); color: white; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700;" id="completed-tasks">0</div>
                                    <div style="color: #666;">Completadas Hoy</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-item" style="background: #fff3e0; padding: 20px; border-radius: 8px;">
                            <div class="d-flex align-items-center gap-3">
                                <div style="background: var(--mep-orange); color: white; width: 50px; height: 50px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700;" id="total-files">0</div>
                                    <div style="color: #666;">Archivos Totales</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: var(--mep-blue); margin-bottom: 15px;">
                            <i class="fas fa-bolt"></i> Acciones R√°pidas
                        </h3>
                        <div class="d-flex gap-3 flex-wrap">
                            <button class="btn btn-primary" onclick="switchTab('bitacora')">
                                <i class="fas fa-plus"></i> Nueva Bit√°cora
                            </button>
                            <button class="btn btn-success" onclick="switchTab('tareas')">
                                <i class="fas fa-tasks"></i> Agregar Tarea
                            </button>
                            <button class="btn btn-warning" onclick="switchTab('archivos')">
                                <i class="fas fa-upload"></i> Subir Archivos
                            </button>
                            <button class="btn btn-secondary" onclick="generateDailyReport()">
                                <i class="fas fa-file-pdf"></i> Reporte Diario
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BIT√ÅCORA DIARIA -->
            <div id="tab-bitacora" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-book-open"></i> Bit√°cora Diaria Profesional</h2>
                        <div class="d-flex gap-3">
                            <button class="btn btn-secondary" onclick="loadTodayJournal()">
                                <i class="fas fa-calendar-day"></i> Cargar Hoy
                            </button>
                            <button class="btn btn-primary" onclick="saveJournal()">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Fecha de la Bit√°cora</label>
                        <div class="d-flex gap-3">
                            <input type="date" id="journal-date" class="form-control" style="width: 200px;">
                            <button class="btn btn-secondary" onclick="loadJournal()">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">T√≠tulo del D√≠a</label>
                        <input type="text" id="journal-title" class="form-control" placeholder="Ej: Revisi√≥n curricular y coordinaci√≥n equipo">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Plantillas R√°pidas</label>
                        <div class="d-flex gap-3 flex-wrap">
                            <button class="btn btn-secondary" onclick="insertJournalTemplate('reunion')">
                                <i class="fas fa-users"></i> Reuni√≥n
                            </button>
                            <button class="btn btn-secondary" onclick="insertJournalTemplate('capacitacion')">
                                <i class="fas fa-graduation-cap"></i> Capacitaci√≥n
                            </button>
                            <button class="btn btn-secondary" onclick="insertJournalTemplate('informe')">
                                <i class="fas fa-file-alt"></i> Informe
                            </button>
                            <button class="btn btn-secondary" onclick="insertJournalTemplate('coordinacion')">
                                <i class="fas fa-handshake"></i> Coordinaci√≥n
                            </button>
                        </div>
                    </div>
                    
                    <div class="journal-editor">
                        <div class="journal-toolbar">
                            <button class="toolbar-btn" onclick="formatText('bold')">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button class="toolbar-btn" onclick="formatText('italic')">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button class="toolbar-btn" onclick="insertBulletList()">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button class="toolbar-btn" onclick="insertNumberedList()">
                                <i class="fas fa-list-ol"></i>
                            </button>
                            <button class="toolbar-btn" onclick="attachFileToJournal()">
                                <i class="fas fa-paperclip"></i> Adjuntar
                            </button>
                        </div>
                        <div id="journal-content" contenteditable="true">
                            <h3>üìã Actividades del D√≠a</h3>
                            <p><strong>Hora:</strong> [Inserte hora]</p>
                            <p><strong>Actividad:</strong> [Describa la actividad]</p>
                            <p><strong>Resultados:</strong> [Resultados obtenidos]</p>
                            <p><strong>Evidencias:</strong> [Archivos adjuntos]</p>
                            <hr>
                            <h3>üéØ Objetivos Cumplidos</h3>
                            <ul>
                                <li>[Objetivo 1]</li>
                                <li>[Objetivo 2]</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="form-group mt-3">
                        <label class="form-label">Resumen Ejecutivo</label>
                        <textarea id="journal-summary" class="form-control" rows="3" 
                                  placeholder="Resumen de los logros m√°s importantes del d√≠a..."></textarea>
                    </div>
                    
                    <div id="journal-attachments" class="mt-3">
                        <!-- Archivos adjuntos aparecer√°n aqu√≠ -->
                    </div>
                </div>
            </div>

            <!-- MIS TAREAS (13 FUNCIONES) -->
            <div id="tab-tareas" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-briefcase"></i> Mis 13 Funciones del Equipo DRTE</h2>
                        <button class="btn btn-primary" onclick="openTaskModal()">
                            <i class="fas fa-plus"></i> Nueva Tarea
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <div class="d-flex gap-3 flex-wrap">
                            <button class="btn btn-secondary active" onclick="filterTasks('all')">
                                Todas
                            </button>
                            <button class="btn btn-secondary" onclick="filterTasks('pending')">
                                Pendientes
                            </button>
                            <button class="btn btn-secondary" onclick="filterTasks('completed')">
                                Completadas
                            </button>
                            <button class="btn btn-secondary" onclick="filterTasks('urgent')">
                                Urgentes
                            </button>
                        </div>
                    </div>
                    
                    <div id="tasks-container">
                        <!-- Tareas cargadas din√°micamente -->
                    </div>
                </div>
            </div>

            <!-- ARCHIVOS POR FECHA -->
            <div id="tab-archivos" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-calendar-alt"></i> Archivos Organizados por Fecha</h2>
                        <button class="btn btn-primary" onclick="openFileUpload()">
                            <i class="fas fa-cloud-upload-alt"></i> Subir Archivos
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Seleccionar Fecha</label>
                        <div class="d-flex gap-3 align-items-center">
                            <button class="btn btn-secondary" onclick="prevDate()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <input type="date" id="file-date" class="form-control" style="width: 200px;">
                            <button class="btn btn-secondary" onclick="nextDate()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button class="btn btn-success" onclick="loadFilesForDate()">
                                <i class="fas fa-search"></i> Ver Archivos
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-upload-area" id="file-drop-area" 
                         onclick="document.getElementById('file-input').click()">
                        <i class="fas fa-cloud-upload-alt fa-3x" style="color: #ccc; margin-bottom: 15px;"></i>
                        <h4>Arrastra y suelta archivos aqu√≠</h4>
                        <p>o haz clic para seleccionar</p>
                        <p style="color: #666; font-size: 0.9rem;">
                            PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, CSV (M√°x. 25MB)
                        </p>
                        <input type="file" id="file-input" multiple style="display: none;">
                    </div>
                    
                    <div id="files-container" class="file-grid">
                        <!-- Archivos aparecer√°n aqu√≠ -->
                    </div>
                </div>
            </div>

            <!-- CALENDARIO -->
            <div id="tab-calendario" class="tab-content">
                <div class="calendar-container">
                    <div class="calendar-nav">
                        <button class="btn btn-secondary" onclick="prevMonth()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h2 id="calendar-month" style="color: var(--mep-blue);"></h2>
                        <button class="btn btn-secondary" onclick="nextMonth()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="calendar-grid" id="calendar-days">
                        <!-- D√≠as generados din√°micamente -->
                    </div>
                </div>
            </div>

            <!-- REPORTES -->
            <div id="tab-reportes" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-file-contract"></i> Sistema de Reportes Profesionales</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tipo de Reporte</label>
                        <select id="report-type" class="form-control" onchange="loadReportTemplate()">
                            <option value="">Seleccionar tipo</option>
                            <option value="diario">üìã Informe Diario de Actividades</option>
                            <option value="semanal">üìÖ Informe Semanal de Avances</option>
                            <option value="funciones">üë• Reporte de Funciones del Equipo</option>
                            <option value="archivos">üìÅ Reporte de Archivos por Mes</option>
                            <option value="productividad">üìä Reporte de Productividad</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Per√≠odo</label>
                        <div class="d-flex gap-3">
                            <input type="date" id="report-start" class="form-control">
                            <span style="align-self: center;">a</span>
                            <input type="date" id="report-end" class="form-control">
                        </div>
                    </div>
                    
                    <div id="report-preview" style="
                        background: #f8f9fa;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        padding: 20px;
                        min-height: 300px;
                        margin-bottom: 20px;
                    ">
                        <!-- Vista previa del reporte -->
                    </div>
                    
                    <div class="d-flex gap-3 flex-wrap">
                        <button class="btn btn-primary" onclick="generatePDF()">
                            <i class="fas fa-file-pdf"></i> Generar PDF
                        </button>
                        <button class="btn btn-success" onclick="generateExcel()">
                            <i class="fas fa-file-excel"></i> Generar Excel
                        </button>
                        <button class="btn btn-warning" onclick="generateWord()">
                            <i class="fas fa-file-word"></i> Generar Word
                        </button>
                        <button class="btn btn-secondary" onclick="sendReportEmail()">
                            <i class="fas fa-paper-plane"></i> Enviar por Email
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA NUEVAS TAREAS -->
    <div id="task-modal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    ">
        <div style="
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        ">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="color: var(--mep-blue);">
                    <i class="fas fa-tasks"></i> Nueva Tarea/Funci√≥n
                </h3>
                <button onclick="closeTaskModal()" style="
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    cursor: pointer;
                    color: #666;
                ">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Funci√≥n del Equipo</label>
                <select id="task-function" class="form-control">
                    <option value="">Seleccionar funci√≥n</option>
                    <option value="1">1. Establecer orientaciones curriculares</option>
                    <option value="2">2. Establecer orientaciones para evaluaci√≥n</option>
                    <option value="3">3. Promover recursos did√°cticos digitales</option>
                    <option value="4">4. Revisar y adaptar propuesta curricular</option>
                    <option value="5">5. Promover condiciones administrativas</option>
                    <option value="6">6. Colaborar con Gesti√≥n Estrat√©gica Digital</option>
                    <option value="7">7. Coordinar con Equipo de Inclusi√≥n</option>
                    <option value="8">8. Coordinar formaci√≥n continua docentes</option>
                    <option value="9">9. Coordinar distribuci√≥n de lecciones</option>
                    <option value="10">10. Participar en iniciativas PATDE</option>
                    <option value="11">11. Colaborar en eventos masivos</option>
                    <option value="12">12. Brindar orientaciones equipos Programa 3</option>
                    <option value="13">13. Ejecutar otras tareas asignadas</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">T√≠tulo de la Tarea</label>
                <input type="text" id="task-title" class="form-control" placeholder="Ej: Revisar documento curricular">
            </div>
            
            <div class="form-group">
                <label class="form-label">Descripci√≥n</label>
                <textarea id="task-description" class="form-control" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <div class="d-flex gap-3">
                    <div style="flex: 1;">
                        <label class="form-label">Fecha</label>
                        <input type="date" id="task-date" class="form-control">
                    </div>
                    <div style="flex: 1;">
                        <label class="form-label">Prioridad</label>
                        <select id="task-priority" class="form-control">
                            <option value="normal">Normal</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Estado</label>
                <select id="task-status" class="form-control">
                    <option value="pendiente">Pendiente</option>
                    <option value="en-progreso">En Progreso</option>
                    <option value="completada">Completada</option>
                </select>
            </div>
            
            <div class="d-flex gap-3 mt-3">
                <button class="btn btn-primary w-100" onclick="saveTask()">
                    <i class="fas fa-save"></i> Guardar Tarea
                </button>
                <button class="btn btn-secondary w-100" onclick="closeTaskModal()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // SISTEMA AGENDA DRTE - TODAS LAS FASES
        // ============================================
        
        class AgendaDRTE {
            constructor() {
                this.db = null;
                this.currentDate = new Date();
                this.init();
            }
            
            async init() {
                // Inicializar base de datos
                await this.initDatabase();
                
                // Configurar fecha actual
                this.updateDateTime();
                setInterval(() => this.updateDateTime(), 60000);
                
                // Configurar fecha de hoy en formularios
                const today = this.formatDateInput(new Date());
                document.getElementById('journal-date').value = today;
                document.getElementById('file-date').value = today;
                document.getElementById('task-date').value = today;
                
                // Configurar calendario
                this.generateCalendar();
                
                // Cargar datos iniciales
                this.loadDashboardStats();
                this.loadTasks();
                
                // Configurar eventos
                this.setupEventListeners();
                
                console.log('‚úÖ Sistema DRTE inicializado');
            }
            
            // ============================================
            // BASE DE DATOS INDEXEDDB
            // ============================================
            
            async initDatabase() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('AgendaDRTE_System', 3);
                    
                    request.onerror = () => reject('Error al abrir IndexedDB');
                    
                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        console.log('üìÅ Base de datos lista');
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Bit√°coras diarias
                        if (!db.objectStoreNames.contains('journals')) {
                            const store = db.createObjectStore('journals', { keyPath: 'id' });
                            store.createIndex('date', 'date', { unique: true });
                        }
                        
                        // Tareas/Funciones
                        if (!db.objectStoreNames.contains('tasks')) {
                            const store = db.createObjectStore('tasks', { keyPath: 'id' });
                            store.createIndex('date', 'date', { unique: false });
                            store.createIndex('status', 'status', { unique: false });
                        }
                        
                        // Archivos por fecha
                        if (!db.objectStoreNames.contains('files')) {
                            const store = db.createObjectStore('files', { keyPath: 'id' });
                            store.createIndex('date', 'date', { unique: false });
                        }
                    };
                });
            }
            
            // ============================================
            // BIT√ÅCORA DIARIA (COMPLETAMENTE FUNCIONAL)
            // ============================================
            
            async saveJournal() {
                try {
                    const date = document.getElementById('journal-date').value;
                    const title = document.getElementById('journal-title').value;
                    const content = document.getElementById('journal-content').innerHTML;
                    const summary = document.getElementById('journal-summary').value;
                    
                    if (!date) {
                        this.showAlert('Por favor seleccione una fecha', 'warning');
                        return;
                    }
                    
                    const journalEntry = {
                        id: `journal_${date}`,
                        date: date,
                        title: title || 'Bit√°cora del d√≠a',
                        content: content,
                        summary: summary || '',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Guardar en IndexedDB
                    const transaction = this.db.transaction(['journals'], 'readwrite');
                    const store = transaction.objectStore('journals');
                    await store.put(journalEntry);
                    
                    this.showAlert('Bit√°cora guardada exitosamente', 'success');
                    
                    // Tambi√©n guardar en localStorage como backup
                    this.backupToLocalStorage('journals', journalEntry);
                    
                } catch (error) {
                    console.error('Error guardando bit√°cora:', error);
                    this.showAlert('Error al guardar la bit√°cora', 'error');
                }
            }
            
            async loadJournal() {
                try {
                    const date = document.getElementById('journal-date').value;
                    const transaction = this.db.transaction(['journals'], 'readonly');
                    const store = transaction.objectStore('journals');
                    const index = store.index('date');
                    const request = index.get(date);
                    
                    request.onsuccess = () => {
                        const entry = request.result;
                        if (entry) {
                            document.getElementById('journal-title').value = entry.title || '';
                            document.getElementById('journal-content').innerHTML = entry.content || '';
                            document.getElementById('journal-summary').value = entry.summary || '';
                            this.showAlert('Bit√°cora cargada', 'success');
                        } else {
                            document.getElementById('journal-content').innerHTML = `
                                <h3>üìã Bit√°cora para ${this.formatDateDisplay(new Date(date))}</h3>
                                <p>No hay una entrada para esta fecha. Puedes comenzar una nueva.</p>
                                <hr>
                                <h4>üéØ Actividades sugeridas:</h4>
                                <ul>
                                    <li>Revisi√≥n de documentos curriculares</li>
                                    <li>Coordinaci√≥n con equipo DRTE</li>
                                    <li>Capacitaci√≥n a docentes</li>
                                    <li>Elaboraci√≥n de informes</li>
                                </ul>
                            `;
                        }
                    };
                    
                } catch (error) {
                    console.error('Error cargando bit√°cora:', error);
                }
            }
            
            loadTodayJournal() {
                const today = this.formatDateInput(new Date());
                document.getElementById('journal-date').value = today;
                this.loadJournal();
            }
            
            insertJournalTemplate(type) {
                let template = '';
                
                switch(type) {
                    case 'reunion':
                        template = `
                            <div class="activity-block">
                                <h4>üë• Reuni√≥n/Coordinaci√≥n</h4>
                                <p><strong>Participantes:</strong> </p>
                                <p><strong>Tema:</strong> </p>
                                <p><strong>Acuerdos:</strong></p>
                                <ul>
                                    <li>Acuerdo 1</li>
                                    <li>Acuerdo 2</li>
                                </ul>
                                <p><strong>Acciones:</strong></p>
                                <ul>
                                    <li>Acci√≥n 1</li>
                                </ul>
                            </div>
                        `;
                        break;
                        
                    case 'capacitacion':
                        template = `
                            <div class="activity-block">
                                <h4>üéì Capacitaci√≥n/Taller</h4>
                                <p><strong>Tema:</strong> </p>
                                <p><strong>Participantes:</strong> </p>
                                <p><strong>Contenido:</strong></p>
                                <ul>
                                    <li>Punto 1</li>
                                    <li>Punto 2</li>
                                </ul>
                                <p><strong>Evaluaci√≥n:</strong> </p>
                            </div>
                        `;
                        break;
                }
                
                const editor = document.getElementById('journal-content');
                editor.innerHTML += template;
            }
            
            // ============================================
            // SISTEMA DE TAREAS (13 FUNCIONES)
            // ============================================
            
            async saveTask() {
                try {
                    const functionNum = document.getElementById('task-function').value;
                    const title = document.getElementById('task-title').value;
                    const description = document.getElementById('task-description').value;
                    const date = document.getElementById('task-date').value;
                    const priority = document.getElementById('task-priority').value;
                    const status = document.getElementById('task-status').value;
                    
                    if (!functionNum || !title) {
                        this.showAlert('Complete los campos requeridos', 'warning');
                        return;
                    }
                    
                    const task = {
                        id: Date.now().toString(),
                        function: functionNum,
                        title: title,
                        description: description,
                        date: date,
                        priority: priority,
                        status: status,
                        createdAt: new Date().toISOString()
                    };
                    
                    // Guardar en IndexedDB
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    await store.put(task);
                    
                    this.closeTaskModal();
                    this.loadTasks();
                    this.loadDashboardStats();
                    
                    this.showAlert('Tarea guardada exitosamente', 'success');
                    
                } catch (error) {
                    console.error('Error guardando tarea:', error);
                    this.showAlert('Error al guardar la tarea', 'error');
                }
            }
            
            async loadTasks(filter = 'all') {
                try {
                    const transaction = this.db.transaction(['tasks'], 'readonly');
                    const store = transaction.objectStore('tasks');
                    const tasks = await store.getAll();
                    
                    let filteredTasks = tasks;
                    if (filter === 'pending') {
                        filteredTasks = tasks.filter(t => t.status !== 'completada');
                    } else if (filter === 'completed') {
                        filteredTasks = tasks.filter(t => t.status === 'completada');
                    } else if (filter === 'urgent') {
                        filteredTasks = tasks.filter(t => t.priority === 'urgente');
                    }
                    
                    this.displayTasks(filteredTasks);
                    
                } catch (error) {
                    console.error('Error cargando tareas:', error);
                }
            }
            
            displayTasks(tasks) {
                const container = document.getElementById('tasks-container');
                
                if (tasks.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="padding: 40px; color: #666;">
                            <i class="fas fa-tasks fa-3x" style="margin-bottom: 15px;"></i>
                            <h4>No hay tareas registradas</h4>
                            <p>Comienza agregando tus primeras tareas</p>
                            <button class="btn btn-primary mt-3" onclick="openTaskModal()">
                                <i class="fas fa-plus"></i> Agregar Primera Tarea
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = tasks.map(task => `
                    <div class="task-item" style="
                        background: ${task.status === 'completada' ? '#e8f5e9' : 
                                    task.priority === 'urgente' ? '#ffebee' : 
                                    task.priority === 'alta' ? '#fff3e0' : '#f8f9fa'};
                        border-left: 4px solid ${task.status === 'completada' ? '#4caf50' : 
                                              task.priority === 'urgente' ? '#f44336' : 
                                              task.priority === 'alta' ? '#ff9800' : '#2196f3'};
                        border-radius: 8px;
                        padding: 20px;
                        margin-bottom: 15px;
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span style="
                                        background: #2196f3;
                                        color: white;
                                        width: 24px;
                                        height: 24px;
                                        border-radius: 50%;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-size: 0.8rem;
                                    ">${task.function}</span>
                                    <strong style="color: #333;">${task.title}</strong>
                                    <span style="
                                        padding: 3px 10px;
                                        border-radius: 12px;
                                        font-size: 0.75rem;
                                        background: ${task.priority === 'urgente' ? '#f44336' : 
                                                   task.priority === 'alta' ? '#ff9800' : '#4caf50'};
                                        color: white;
                                    ">${task.priority}</span>
                                </div>
                                <p style="color: #666; margin-bottom: 10px;">${task.description || ''}</p>
                                <div style="display: flex; gap: 15px; font-size: 0.85rem; color: #888;">
                                    <span><i class="fas fa-calendar"></i> ${task.date}</span>
                                    <span><i class="fas fa-flag"></i> ${task.status}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button onclick="toggleTaskStatus('${task.id}')" style="
                                    background: none;
                                    border: none;
                                    color: #4caf50;
                                    cursor: pointer;
                                    font-size: 1.2rem;
                                " title="${task.status === 'completada' ? 'Marcar pendiente' : 'Marcar completada'}">
                                    <i class="fas ${task.status === 'completada' ? 'fa-undo' : 'fa-check'}"></i>
                                </button>
                                <button onclick="deleteTask('${task.id}')" style="
                                    background: none;
                                    border: none;
                                    color: #f44336;
                                    cursor: pointer;
                                    font-size: 1.2rem;
                                " title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            async toggleTaskStatus(taskId) {
                try {
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    const task = await store.get(taskId);
                    
                    if (task) {
                        task.status = task.status === 'completada' ? 'pendiente' : 'completada';
                        task.updatedAt = new Date().toISOString();
                        await store.put(task);
                        
                        this.loadTasks();
                        this.loadDashboardStats();
                    }
                } catch (error) {
                    console.error('Error actualizando tarea:', error);
                }
            }
            
            async deleteTask(taskId) {
                if (!confirm('¬øEst√° seguro de eliminar esta tarea?')) return;
                
                try {
                    const transaction = this.db.transaction(['tasks'], 'readwrite');
                    const store = transaction.objectStore('tasks');
                    await store.delete(taskId);
                    
                    this.loadTasks();
                    this.loadDashboardStats();
                    
                    this.showAlert('Tarea eliminada', 'success');
                } catch (error) {
                    console.error('Error eliminando tarea:', error);
                }
            }
            
            // ============================================
            // SISTEMA DE ARCHIVOS POR FECHA
            // ============================================
            
            async uploadFiles(files) {
                try {
                    const date = document.getElementById('file-date').value || this.formatDateInput(new Date());
                    
                    for (const file of files) {
                        const fileData = {
                            id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            date: date,
                            uploadedAt: new Date().toISOString(),
                            data: await this.readFileAsArrayBuffer(file)
                        };
                        
                        // Guardar en IndexedDB
                        const transaction = this.db.transaction(['files'], 'readwrite');
                        const store = transaction.objectStore('files');
                        await store.put(fileData);
                        
                        // Mostrar inmediatamente en la interfaz
                        this.addFilePreview(fileData);
                    }
                    
                    this.showAlert(`${files.length} archivo(s) subido(s) exitosamente`, 'success');
                    this.loadDashboardStats();
                    
                } catch (error) {
                    console.error('Error subiendo archivos:', error);
                    this.showAlert('Error al subir archivos', 'error');
                }
            }
            
            async loadFilesForDate() {
                try {
                    const date = document.getElementById('file-date').value;
                    const transaction = this.db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const index = store.index('date');
                    const files = await index.getAll(date);
                    
                    this.displayFiles(files);
                    
                } catch (error) {
                    console.error('Error cargando archivos:', error);
                }
            }
            
            displayFiles(files) {
                const container = document.getElementById('files-container');
                
                if (files.length === 0) {
                    container.innerHTML = `
                        <div class="text-center" style="grid-column: 1 / -1; padding: 40px; color: #666;">
                            <i class="fas fa-folder-open fa-3x" style="margin-bottom: 15px;"></i>
                            <h4>No hay archivos para esta fecha</h4>
                            <p>Sube archivos usando el √°rea de arriba</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = files.map(file => `
                    <div class="file-card">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <i class="${this.getFileIcon(file.type)} fa-3x" 
                               style="color: ${this.getFileColor(file.type)};"></i>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong style="display: block; margin-bottom: 5px; word-break: break-word;">
                                ${file.name}
                            </strong>
                            <div style="font-size: 0.8rem; color: #666;">
                                ${this.formatFileSize(file.size)}
                            </div>
                            <div style="font-size: 0.75rem; color: #999; margin-top: 5px;">
                                ${new Date(file.uploadedAt).toLocaleTimeString('es-CR', {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary" style="flex: 1; padding: 8px;" 
                                    onclick="downloadFile('${file.id}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-secondary" style="flex: 1; padding: 8px;"
                                    onclick="previewFile('${file.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            addFilePreview(fileData) {
                const container = document.getElementById('files-container');
                const preview = document.createElement('div');
                preview.className = 'file-card';
                preview.innerHTML = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <i class="${this.getFileIcon(fileData.type)} fa-3x" 
                           style="color: ${this.getFileColor(fileData.type)};"></i>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong style="display: block; margin-bottom: 5px; word-break: break-word;">
                            ${fileData.name}
                        </strong>
                        <div style="font-size: 0.8rem; color: #666;">
                            ${this.formatFileSize(fileData.size)}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" style="flex: 1; padding: 8px;" 
                                onclick="downloadFile('${fileData.id}')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                `;
                container.prepend(preview);
            }
            
            async downloadFile(fileId) {
                try {
                    const transaction = this.db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const file = await store.get(fileId);
                    
                    if (file) {
                        const blob = new Blob([file.data], { type: file.type });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = file.name;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }
                } catch (error) {
                    console.error('Error descargando archivo:', error);
                }
            }
            
            // ============================================
            // CALENDARIO (CORREGIDO ZONA HORARIA CR)
            // ============================================
            
            generateCalendar() {
                const now = new Date();
                const year = now.getFullYear();
                const month = now.getMonth();
                
                // Configurar zona horaria Costa Rica
                const options = { timeZone: 'America/Costa_Rica', month: 'long', year: 'numeric' };
                const monthName = now.toLocaleDateString('es-CR', options);
                document.getElementById('calendar-month').textContent = monthName;
                
                // Generar d√≠as del mes
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startDay = firstDay.getDay();
                
                const container = document.getElementById('calendar-days');
                container.innerHTML = '';
                
                // D√≠as de la semana
                ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'].forEach(day => {
                    const dayEl = document.createElement('div');
                    dayEl.textContent = day;
                    dayEl.style.fontWeight = '600';
                    dayEl.style.color = '#666';
                    container.appendChild(dayEl);
                });
                
                // Espacios vac√≠os al inicio
                for (let i = 0; i < startDay; i++) {
                    const empty = document.createElement('div');
                    container.appendChild(empty);
                }
                
                // D√≠as del mes
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'calendar-day';
                    dayEl.textContent = day;
                    
                    // Marcar d√≠a actual
                    const currentDate = new Date();
                    if (day === currentDate.getDate() && 
                        month === currentDate.getMonth() && 
                        year === currentDate.getFullYear()) {
                        dayEl.classList.add('today');
                    }
                    
                    // Marcar d√≠as con archivos (podr√≠as cargar esto din√°micamente)
                    dayEl.addEventListener('click', () => {
                        this.selectCalendarDate(year, month + 1, day);
                    });
                    
                    container.appendChild(dayEl);
                }
            }
            
            selectCalendarDate(year, month, day) {
                const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                document.getElementById('file-date').value = dateStr;
                document.getElementById('journal-date').value = dateStr;
                switchTab('archivos');
                this.loadFilesForDate();
            }
            
            prevMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                this.generateCalendar();
            }
            
            nextMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                this.generateCalendar();
            }
            
            // ============================================
            // REPORTES PROFESIONALES
            // ============================================
            
            async generateDailyReport() {
                try {
                    const today = this.formatDateInput(new Date());
                    
                    // Obtener datos del d√≠a
                    const [tasks, files, journal] = await Promise.all([
                        this.getTasksByDate(today),
                        this.getFilesByDate(today),
                        this.getJournalByDate(today)
                    ]);
                    
                    // Generar contenido del reporte
                    const reportContent = this.createReportContent(today, tasks, files, journal);
                    
                    // Generar PDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // T√≠tulo
                    doc.setFontSize(16);
                    doc.setFont('helvetica', 'bold');
                    doc.text('INFORME DIARIO DE ACTIVIDADES - DRTE MEP', 105, 20, { align: 'center' });
                    
                    // Informaci√≥n
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'normal');
                    doc.text(`Fecha: ${this.formatDateDisplay(new Date(today))}`, 20, 35);
                    doc.text(`Asesor: Kevin S√°nchez Bogar√≠n`, 20, 42);
                    doc.text(`Departamento: Investigaci√≥n, Desarrollo e Implementaci√≥n`, 20, 49);
                    
                    // Contenido
                    doc.setFontSize(11);
                    const lines = doc.splitTextToSize(reportContent, 170);
                    doc.text(lines, 20, 65);
                    
                    // Guardar PDF
                    doc.save(`Informe_DRTE_${today}.pdf`);
                    
                    this.showAlert('Reporte PDF generado exitosamente', 'success');
                    
                } catch (error) {
                    console.error('Error generando reporte:', error);
                    this.showAlert('Error al generar el reporte', 'error');
                }
            }
            
            createReportContent(date, tasks, files, journal) {
                let content = `INFORME DIARIO - ${this.formatDateDisplay(new Date(date))}\n\n`;
                
                content += `RESUMEN DE ACTIVIDADES:\n`;
                content += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
                
                if (journal) {
                    content += `${journal.summary || 'Sin resumen disponible'}\n\n`;
                }
                
                content += `TAREAS REALIZADAS:\n`;
                content += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
                
                if (tasks.length > 0) {
                    tasks.forEach((task, index) => {
                        content += `${index + 1}. ${task.title} (${task.status})\n`;
                    });
                } else {
                    content += `No hay tareas registradas para este d√≠a.\n`;
                }
                
                content += `\nARCHIVOS ADJUNTOS:\n`;
                content += `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
                
                if (files.length > 0) {
                    files.forEach(file => {
                        content += `‚Ä¢ ${file.name} (${this.formatFileSize(file.size)})\n`;
                    });
                } else {
                    content += `No hay archivos adjuntos.\n`;
                }
                
                content += `\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n`;
                content += `Generado autom√°ticamente por Sistema Agenda DRTE\n`;
                content += `MEP Costa Rica - Direcci√≥n de Recursos Tecnol√≥gicos en Educaci√≥n`;
                
                return content;
            }
            
            // ============================================
            // UTILIDADES
            // ============================================
            
            formatDateInput(date) {
                return date.toISOString().split('T')[0];
            }
            
            formatDateDisplay(date) {
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    timeZone: 'America/Costa_Rica'
                };
                return date.toLocaleDateString('es-CR', options);
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            getFileIcon(fileType) {
                if (fileType.includes('pdf')) return 'fas fa-file-pdf';
                if (fileType.includes('word')) return 'fas fa-file-word';
                if (fileType.includes('excel') || fileType.includes('sheet')) return 'fas fa-file-excel';
                if (fileType.includes('image')) return 'fas fa-file-image';
                if (fileType.includes('csv')) return 'fas fa-file-csv';
                return 'fas fa-file';
            }
            
            getFileColor(fileType) {
                if (fileType.includes('pdf')) return '#f44336';
                if (fileType.includes('word')) return '#2b579a';
                if (fileType.includes('excel') || fileType.includes('sheet')) return '#217346';
                if (fileType.includes('image')) return '#4caf50';
                if (fileType.includes('csv')) return '#ff9800';
                return '#9e9e9e';
            }
            
            async readFileAsArrayBuffer(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = (e) => reject(e);
                    reader.readAsArrayBuffer(file);
                });
            }
            
            updateDateTime() {
                const now = new Date();
                const options = {
                    timeZone: 'America/Costa_Rica',
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                };
                
                const formatter = new Intl.DateTimeFormat('es-CR', options);
                document.getElementById('datetime-text').textContent = formatter.format(now);
                
                // Actualizar fecha en dashboard
                document.getElementById('today-date').textContent = this.formatDateDisplay(now);
            }
            
            async loadDashboardStats() {
                try {
                    // Obtener conteos
                    const [tasks, files] = await Promise.all([
                        this.getAllTasks(),
                        this.getAllFiles()
                    ]);
                    
                    const completedTasks = tasks.filter(t => t.status === 'completada').length;
                    
                    // Actualizar UI
                    document.getElementById('total-tasks').textContent = tasks.length;
                    document.getElementById('completed-tasks').textContent = completedTasks;
                    document.getElementById('total-files').textContent = files.length;
                    
                } catch (error) {
                    console.error('Error cargando estad√≠sticas:', error);
                }
            }
            
            async getAllTasks() {
                const transaction = this.db.transaction(['tasks'], 'readonly');
                const store = transaction.objectStore('tasks');
                return store.getAll();
            }
            
            async getAllFiles() {
                const transaction = this.db.transaction(['files'], 'readonly');
                const store = transaction.objectStore('files');
                return store.getAll();
            }
            
            async getTasksByDate(date) {
                const transaction = this.db.transaction(['tasks'], 'readonly');
                const store = transaction.objectStore('tasks');
                const index = store.index('date');
                return index.getAll(date);
            }
            
            async getFilesByDate(date) {
                const transaction = this.db.transaction(['files'], 'readonly');
                const store = transaction.objectStore('files');
                const index = store.index('date');
                return index.getAll(date);
            }
            
            async getJournalByDate(date) {
                const transaction = this.db.transaction(['journals'], 'readonly');
                const store = transaction.objectStore('journals');
                const index = store.index('date');
                const result = await index.get(date);
                return result || null;
            }
            
            backupToLocalStorage(type, data) {
                const backups = JSON.parse(localStorage.getItem(`backup_${type}`) || '[]');
                backups.push({
                    ...data,
                    backedUpAt: new Date().toISOString()
                });
                
                // Mantener solo los √∫ltimos 50 backups
                if (backups.length > 50) {
                    backups.shift();
                }
                
                localStorage.setItem(`backup_${type}`, JSON.stringify(backups));
            }
            
            showAlert(message, type) {
                // Crear notificaci√≥n
                const alert = document.createElement('div');
                alert.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 25px;
                    background: ${type === 'success' ? '#4caf50' : 
                                type === 'warning' ? '#ff9800' : '#f44336'};
                    color: white;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                
                alert.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas ${type === 'success' ? 'fa-check-circle' : 
                                    type === 'warning' ? 'fa-exclamation-triangle' : 'fa-times-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    alert.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => alert.remove(), 300);
                }, 3000);
            }
            
            setupEventListeners() {
                // Sistema de tabs
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tabId = btn.dataset.tab;
                        this.switchTab(tabId);
                    });
                });
                
                // Subida de archivos
                const fileInput = document.getElementById('file-input');
                fileInput.addEventListener('change', (e) => {
                    const files = Array.from(e.target.files);
                    if (files.length > 0) {
                        this.uploadFiles(files);
                        fileInput.value = ''; // Reset input
                    }
                });
                
                // Drag and drop para archivos
                const dropArea = document.getElementById('file-drop-area');
                dropArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropArea.classList.add('dragover');
                });
                
                dropArea.addEventListener('dragleave', () => {
                    dropArea.classList.remove('dragover');
                });
                
                dropArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropArea.classList.remove('dragover');
                    const files = Array.from(e.dataTransfer.files);
                    if (files.length > 0) {
                        this.uploadFiles(files);
                    }
                });
                
                // Configurar fecha inicial de reportes
                const today = this.formatDateInput(new Date());
                document.getElementById('report-start').value = today;
                document.getElementById('report-end').value = today;
            }
            
            switchTab(tabId) {
                // Ocultar todos los tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Desactivar todos los botones
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Mostrar tab seleccionado
                document.getElementById(`tab-${tabId}`).classList.add('active');
                document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
                
                // Cargar datos si es necesario
                if (tabId === 'dashboard') {
                    this.loadDashboardStats();
                } else if (tabId === 'tareas') {
                    this.loadTasks();
                } else if (tabId === 'archivos') {
                    this.loadFilesForDate();
                } else if (tabId === 'calendario') {
                    this.generateCalendar();
                }
            }
            
            openTaskModal() {
                document.getElementById('task-modal').style.display = 'flex';
            }
            
            closeTaskModal() {
                document.getElementById('task-modal').style.display = 'none';
                // Limpiar formulario
                document.getElementById('task-function').value = '';
                document.getElementById('task-title').value = '';
                document.getElementById('task-description').value = '';
                document.getElementById('task-date').value = this.formatDateInput(new Date());
                document.getElementById('task-priority').value = 'normal';
                document.getElementById('task-status').value = 'pendiente';
            }
            
            prevDate() {
                const dateInput = document.getElementById('file-date');
                const currentDate = new Date(dateInput.value);
                currentDate.setDate(currentDate.getDate() - 1);
                dateInput.value = this.formatDateInput(currentDate);
                this.loadFilesForDate();
            }
            
            nextDate() {
                const dateInput = document.getElementById('file-date');
                const currentDate = new Date(dateInput.value);
                currentDate.setDate(currentDate.getDate() + 1);
                dateInput.value = this.formatDateInput(currentDate);
                this.loadFilesForDate();
            }
        }
        
        // ============================================
        // INICIALIZACI√ìN DEL SISTEMA
        // ============================================
        
        let agendaSystem;
        
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                agendaSystem = new AgendaDRTE();
                
                // Hacer funciones globales
                window.switchTab = (tabId) => agendaSystem.switchTab(tabId);
                window.saveJournal = () => agendaSystem.saveJournal();
                window.loadJournal = () => agendaSystem.loadJournal();
                window.loadTodayJournal = () => agendaSystem.loadTodayJournal();
                window.insertJournalTemplate = (type) => agendaSystem.insertJournalTemplate(type);
                window.openTaskModal = () => agendaSystem.openTaskModal();
                window.closeTaskModal = () => agendaSystem.closeTaskModal();
                window.saveTask = () => agendaSystem.saveTask();
                window.filterTasks = (filter) => agendaSystem.loadTasks(filter);
                window.toggleTaskStatus = (taskId) => agendaSystem.toggleTaskStatus(taskId);
                window.deleteTask = (taskId) => agendaSystem.deleteTask(taskId);
                window.openFileUpload = () => document.getElementById('file-input').click();
                window.loadFilesForDate = () => agendaSystem.loadFilesForDate();
                window.prevDate = () => agendaSystem.prevDate();
                window.nextDate = () => agendaSystem.nextDate();
                window.downloadFile = (fileId) => agendaSystem.downloadFile(fileId);
                window.prevMonth = () => agendaSystem.prevMonth();
                window.nextMonth = () => agendaSystem.nextMonth();
                window.generateDailyReport = () => agendaSystem.generateDailyReport();
                window.formatText = (command) => {
                    document.execCommand(command, false, null);
                };
                window.insertBulletList = () => {
                    document.execCommand('insertUnorderedList', false, null);
                };
                window.insertNumberedList = () => {
                    document.execCommand('insertOrderedList', false, null);
                };
                
                console.log('üöÄ Sistema Agenda DRTE MEP inicializado');
                
            } catch (error) {
                console.error('‚ùå Error cr√≠tico:', error);
                alert('Error al cargar la aplicaci√≥n. Por favor, recarga la p√°gina.');
            }
        });
        
        // Animaciones CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
